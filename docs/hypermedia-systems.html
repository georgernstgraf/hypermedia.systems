<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Hypermedia Systems</title>
    <link rel="preconnect" href="https://fonts.bunny.net">
    
    <link rel="stylesheet" href="https://unpkg.com/missing.css@1.0.12/dist/missing.min.css">
    <link rel="stylesheet" href="https://unpkg.com/missing.css@1.0.12/dist/missing-prism.min.css">
    <style>
    @font-face {
        font-family: "Chicago FLF";
        src: url("fonts/ChicagoFLF.ttf") format("truetype");
    }

    @font-face {
        font-family: "Yrsa";
        src: url("fonts/Yrsa-Regular.ttf") format("truetype");
        size-adjust: 125%;
    }
    @font-face {
        font-family: "Yrsa";
        font-weight: bold;
        src: url("fonts/Yrsa-Bold.ttf") format("truetype");
        size-adjust: 125%;
    }
    @font-face {
        font-family: "Yrsa";
        font-style: italic;
        src: url("fonts/Yrsa-Italic.ttf") format("truetype");
        size-adjust: 125%;
    }
    @font-face {
        font-family: "Yrsa";
        font-weight: bold;
        font-style: italic;
        src: url("fonts/Yrsa-BoldItalic.ttf") format("truetype");
        size-adjust: 125%;
    }

    :root {
        --main-font: "Yrsa", serif;
        --secondary-font: sans-serif;
        --display-font: "Chicago FLF", "Impact", "Oswald", sans-serif;
        --mono-font: "Berkeley Mono", "Input Mono", "Iosevka", "Liberation Mono", "Victor Mono", "Consolas", monospace, monospace;

        --rhythm: 1.5rem;
        --line-length: 41em;

        font-size: calc((18 / 16) * 100%);
    }

    @media (max-width: calc(
        3 * /* arbitrary coefficient */
        14ch + /* longest word: programmatically*/
        2 * 1.6rem /* page margins */
    )) {
        :root {
            hyphens: auto;
            -webkit-hyphens: auto; /* safari :( */
        }
    }

    h1, h2, h3, h4, h5, h6 {
        font-weight: normal;
        font-family: var(--display-font);
    }

    :is(h1, h2, h3, h4, h5, h6) code {
        font-family: inherit;
    }

    sub-title, .sub-title {
        color: var(--faded-fg);
    }

    .asciiart {
        line-height: 1;
    }

    /* #region should be added to missingcss native */

    /*temp missing.css fix*/
    :is(small, .\<small\>) *, aside *, footer * { --gap: inherit }

    h1 { font-size: 2.5em }

    body > header { border-block-end: 1px dotted var(--muted-fg) }
    body > footer { border-block-start: none }

    figure {
        display: block;
        background: none;
        border: none;
        padding: 0 var(--gap);
    }
    figure>* { --density: .5 }
    figcaption { font-size: .8em; line-height: calc(var(--rhythm) * 3 / 4); }
    figcaption:first-child { border-block-end: 1px solid var(--faded-fg) }
    figcaption:last-child { border-block-start: 1px solid var(--faded-fg) }

    table tr:not(:last-child) > * {
        padding-bottom: var(--rhythm);
    }

    .iconbutton { box-shadow: none !important; }

    .text-align\:end { text-align: end }

    aside {
        font-size: .8em;
        line-height: calc(var(--rhythm)*3/4);
        --gap: calc(var(--rhythm) * var(--density) * 3 / 4);
        border-block: 1px solid var(--graphical-fg);
        padding-block: var(--gap);
        margin-block: calc(var(--gap)*4/3);
    }

    /* #endregion */

    header, footer, summary, button, input, small, .\<small\>, aside, figcaption, .secondary-font { font-variation-settings: "opsz" 7 }
    pre { line-height: calc(var(--rhythm) * 3 / 4) }
    
    @media (prefers-color-scheme: dark) {
        img[src*="/images/diagram"] { filter: invert(1) }
    }

    /* #region Asciidoc */
    
    .colist {
        counter-reset: colist;
        font-size: .8em;
        line-height: calc(var(--rhythm) * 3 / 4);
        font-variation-settings: "opsz" 8;
    }

    aside .colist {
        font-size: inherit;
        line-height: inherit;
    }

    .colist li {
        counter-increment: colist;
        margin-inline-start: 1.2ch;
    }

    .colist li::marker {
        content: "(" counter(colist) ") ";
        font-family: var(--mono-font);
    }
    /* #endregion */
    </style>
    <meta property="og:title" content="<span class=&quot;allcaps big&quot;>Hypermedia Systems</span>">
<meta property="og:site_name" content="Hypermedia Systems">

</head><body><header>
    
    

    <nav aria-label="Chapters navigation" class="<small>">
        
    
        <div class="grid spacious margin-block">
            
            
        </div>
        
    </nav>

    <h1>
        
        <span class="allcaps big">Hypermedia Systems</span>
    </h1>
</header>



<div class="container">
    <details class="contents">
        <summary>Contents</summary>

        
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_hypermedia_concepts" class="bold">
                Part 1:
                Hypermedia Concepts
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_introduction" class="bold">
                
                Introduction
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_what_is_a_hypermedia_system" class="">
                
                What is a Hypermedia System?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_driven_applications" class="">
                
                Hypermedia-Driven Applications
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_goals" class="">
                
                Goals
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_book_layout" class="">
                
                Book Layout
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_a_new_generation" class="">
                
                Hypermedia: A New Generation
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_hypermedia_in_practice" class="">
                
                HTML Notes: Hypermedia In Practice
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_a_reintroduction" class="bold">
                
                Hypermedia: A Reintroduction
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_what_is_hypermedia" class="">
                
                What Is Hypermedia?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_a_brief_history_of_hypermedia" class="">
                
                A Brief History of Hypermedia
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_the_worlds_most_successful_hypertext_html" class="">
                
                The World’s Most Successful Hypertext: HTML
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_why_use_hypermedia" class="">
                
                Why Use Hypermedia?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_a_hypermedia_resurgence" class="">
                
                A Hypermedia Resurgence?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_when_should_you_use_hypermedia" class="">
                
                When Should You Use Hypermedia?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_when_shouldnt_you_use_hypermedia" class="">
                
                When Shouldn’t You Use Hypermedia?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_a_sophisticated_modern_system_architecture" class="">
                
                Hypermedia: A Sophisticated, Modern System Architecture
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_div_soup" class="">
                
                HTML Notes: &lt;div&gt; Soup
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_components_of_a_hypermedia_system" class="bold">
                
                Components Of A Hypermedia System
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_components_of_a_hypermedia_system_2" class="">
                
                Components Of A Hypermedia System
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_rest" class="">
                
                REST
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_conclusion" class="">
                
                Conclusion
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_html5_soup" class="">
                
                HTML Notes: HTML5 Soup
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_a_web_1_0_application" class="bold">
                
                A Web 1.0 Application
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_picking_a_web_stack" class="">
                
                Picking A “Web Stack”
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_python" class="">
                
                Python
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_introducing_flask_our_first_route" class="">
                
                Introducing Flask: Our First Route
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_contact_app_functionality" class="">
                
                Contact.app Functionality
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_framework_soup" class="">
                
                HTML Notes: Framework Soup
            </a>
            
        </li>
        
    </ul>

        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_driven_web_applications_with_htmx" class="bold">
                Part 2:
                Hypermedia-Driven Web Applications With htmx
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_extending_html_as_hypermedia" class="bold">
                
                Extending HTML As Hypermedia
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_a_close_look_at_a_hyperlink" class="">
                
                A Close Look At A Hyperlink
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_extending_html_as_a_hypermedia_with_htmx" class="">
                
                Extending HTML as a Hypermedia with Htmx
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_triggering_http_requests" class="">
                
                Triggering HTTP Requests
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_targeting_other_elements" class="">
                
                Targeting Other Elements
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_swap_styles" class="">
                
                Swap Styles
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_using_events" class="">
                
                Using Events
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_htmx_html_extended" class="">
                
                Htmx: HTML eXtended
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_passing_request_parameters" class="">
                
                Passing Request Parameters
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_history_support" class="">
                
                History Support
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_conclusion_2" class="">
                
                Conclusion
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_budgeting_for_html" class="">
                
                HTML Notes: Budgeting For HTML
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_htmx_patterns" class="bold">
                
                Htmx Patterns
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_installing_htmx" class="">
                
                Installing Htmx
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_ajax_ifying_our_application" class="">
                
                AJAX-ifying Our Application
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_a_second_step_deleting_contacts_with_http_delete" class="">
                
                A Second Step: Deleting Contacts With HTTP DELETE
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_next_steps_validating_contact_emails" class="">
                
                Next Steps: Validating Contact Emails
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_another_application_improvement_paging" class="">
                
                Another Application Improvement: Paging
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_caution_with_modals_and_display_none" class="">
                
                HTML Notes: Caution With Modals and "'Display: none'"
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_more_htmx_patterns" class="bold">
                
                More Htmx Patterns
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_active_search" class="">
                
                Active Search
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_lazy_loading" class="">
                
                Lazy Loading
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_inline_delete" class="">
                
                Inline Delete
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_bulk_delete" class="">
                
                Bulk Delete
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_accessible_by_default" class="">
                
                HTML Notes: Accessible by Default?
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_a_dynamic_archive_ui" class="bold">
                
                A Dynamic Archive UI
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_ui_requirements" class="">
                
                UI Requirements
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_beginning_our_implementation" class="">
                
                Beginning Our Implementation
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_adding_the_archiving_endpoint" class="">
                
                Adding the Archiving Endpoint
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_conditionally_rendering_a_progress_ui" class="">
                
                Conditionally Rendering A Progress UI
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_polling" class="">
                
                Polling
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_smoothing_things_out_animations_in_htmx" class="">
                
                Smoothing Things Out: Animations in Htmx
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_dismissing_the_download_ui" class="">
                
                Dismissing The Download UI
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_an_alternative_ux_auto_download" class="">
                
                An Alternative UX: Auto-Download
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_a_dynamic_archive_ui_complete" class="">
                
                A Dynamic Archive UI: Complete
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_markdown_soup" class="">
                
                HTML Notes: Markdown soup
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_tricks_of_the_htmx_masters" class="bold">
                
                Tricks Of The Htmx Masters
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_advanced_htmx" class="">
                
                Advanced Htmx
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_htmx_attributes" class="">
                
                Htmx Attributes
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_events" class="">
                
                Events
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_http_requests_responses" class="">
                
                HTTP Requests &amp; Responses
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_updating_other_content" class="">
                
                Updating Other Content
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_debugging" class="">
                
                Debugging
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_security_considerations" class="">
                
                Security Considerations
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_configuring" class="">
                
                Configuring
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_semantic_html" class="">
                
                HTML Notes: Semantic HTML
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_client_side_scripting" class="bold">
                
                Client-Side Scripting
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_is_scripting_allowed" class="">
                
                Is Scripting Allowed?
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_scripting_for_hypermedia" class="">
                
                Scripting for Hypermedia
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_scripting_tools_for_the_web" class="">
                
                Scripting Tools for the Web
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_vanilla_javascript" class="">
                
                Vanilla JavaScript
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_alpine_js" class="">
                
                Alpine.js
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hyperscript" class="">
                
                _hyperscript
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_using_off_the_shelf_components" class="">
                
                Using Off-the-Shelf Components
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_pragmatic_scripting" class="">
                
                Pragmatic Scripting
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_html_is_for_applications" class="">
                
                HTML Notes: HTML is for Applications
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_json_data_apis_hypermedia_driven_applications" class="bold">
                
                JSON Data APIs &amp; Hypermedia-Driven Applications
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_hypermedia_apis_json_data_apis" class="">
                
                Hypermedia APIs &amp; JSON Data APIs
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_adding_a_json_data_api_to_contact_app" class="">
                
                Adding a JSON Data API To Contact.app
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_html_notes_microformats" class="">
                
                HTML Notes: Microformats
            </a>
            
        </li>
        
    </ul>

        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_bringing_hypermedia_to_mobile" class="bold">
                Part 3:
                Bringing Hypermedia To Mobile
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_hyperview_a_mobile_hypermedia" class="bold">
                
                Hyperview: A Mobile Hypermedia
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_the_state_of_mobile_app_development" class="">
                
                The State of Mobile App Development
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_for_mobile_apps" class="">
                
                Hypermedia for Mobile Apps
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_introduction_to_hxml" class="">
                
                Introduction to HXML
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_for_mobile" class="">
                
                Hypermedia, for Mobile
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_notes_maximize_your_server_side_strengths" class="">
                
                Hypermedia Notes: Maximize Your Server-Side Strengths
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_building_a_contacts_app_with_hyperview" class="bold">
                
                Building a Contacts App With Hyperview
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_creating_a_mobile_app" class="">
                
                Creating a mobile app
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_a_searchable_list_of_contacts" class="">
                
                A Searchable List of Contacts
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_editing_a_contact" class="">
                
                Editing a Contact
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_deleting_a_contact_2" class="">
                
                Deleting a Contact
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_adding_a_new_contact_2" class="">
                
                Adding a New Contact
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_deploying_the_app" class="">
                
                Deploying the App
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_one_backend_multiple_hypermedia_formats" class="">
                
                One Backend, Multiple Hypermedia formats
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_contact_app_in_hyperview" class="">
                
                Contact.app, in Hyperview
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_notes_api_endpoints" class="">
                
                Hypermedia Notes: API Endpoints
            </a>
            
        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_extending_the_hyperview_client" class="bold">
                
                Extending the Hyperview Client
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_adding_phone_calls_and_email" class="">
                
                Adding Phone Calls and Email
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_adding_messages" class="">
                
                Adding Messages
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_swipe_gesture_on_contacts" class="">
                
                Swipe Gesture on Contacts
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_mobile_hypermedia_driven_applications" class="">
                
                Mobile Hypermedia-Driven Applications
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_hypermedia_notes_good_enough_ux_and_islands_of_interactivity" class="">
                
                Hypermedia Notes: Good-Enough UX and Islands of Interactivity
            </a>
            
        </li>
        
    </ul>

        </li>
        
    </ul>

        </li>
        
        <li>
            <a href="hypermedia-systems#_conclusion_3" class="bold">
                Part 4:
                Conclusion
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_conclusion_4" class="bold">
                
                Conclusion
            </a>
            
    
    
    <ul class="nested-list">
        
        <li>
            <a href="hypermedia-systems#_hypermedia_reconsidered" class="">
                
                Hypermedia Reconsidered
            </a>
            
        </li>
        
        <li>
            <a href="hypermedia-systems#_pausing_and_reflecting" class="">
                
                Pausing, and Reflecting
            </a>
            
        </li>
        
    </ul>

        </li>
        
    </ul>

        </li>
        
    </ul>

    </details>
</div>


<main><h1 id="_hypermedia_concepts" class="sect0"><sub-title>Part I<v-h>:</v-h></sub-title>  Hypermedia Concepts</h1>
<section class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a book about building applications using hypermedia systems.  <em>Hypermedia systems</em> might seem like a strange phrase:
how is hypermedia a <em>system</em>? Isn’t hypermedia just a way to link documents together?</p>
</div>
<div class="paragraph">
<p>Like with HTML, on the World Wide Web?</p>
</div>
<div class="paragraph">
<p>What do you mean hypermedia <em>systems</em>?</p>
</div>
<div class="paragraph">
<p>Well, yes, HTML is <em>a</em> hypermedia.  But there is more to the way the web works than just HTML:  HTTP, the Hyper Text
Transfer Protocol, is what transfers HTML from servers to clients, and there are many details and features associated
with it: caching, various headers, response codes, and so forth.</p>
</div>
<div class="paragraph">
<p>And then, of course, there are <em>hypermedia servers</em>, which present <em>hypermedia APIs</em> (yes, <em>APIs</em>) to clients over the network.</p>
</div>
<div class="paragraph">
<p>

And, finally, there is the all-important <em>hypermedia client</em>: a software client that understands how to render a <em>hypermedia
response</em> intelligibly to a human, so that a human can interact with the remote system.  The most widely known and used
hypermedia clients are, of course, web browsers.</p>
</div>
<div class="paragraph">
<p>Web browsers are perhaps the most sophisticated pieces of software we use.  They not only understand HTML, CSS and many
other file formats, but they also provide a JavaScript runtime and programming environment that is so powerful that web
developers can create entire applications in it that are nearly as sophisticated as <em>thick clients</em>, that is, native
applications.</p>
</div>
<div class="paragraph">
<p>This JavaScript runtime is so powerful, in fact, that today many developers ignore the <em>hypermedia</em> features of the
browser, in favor of building their web applications entirely in JavaScript.  Applications built in this manner have come
to be called Single Page Applications (SPAs).  Rather than navigating between pages, these web applications use
JavaScript for updating the user interface directly.  When they communicate with a server, these applications
typically use JSON API calls via AJAX.  And they often update the user interface using a “reactive” style frontend
JavaScript library.</p>
</div>
<div class="paragraph">
<p>In these applications HTML becomes a (somewhat awkward) graphical interface description language that is used
because, for historical reasons, that’s what happens to be there, in the browser.</p>
</div>
<div class="paragraph">
<p>Applications built in this style are not <em>hypermedia-driven</em>: they do not take advantage of the underlying hypermedia
system of the web.</p>
</div>
<div class="paragraph">
<p>To explain what a hypermedia-driven application looks like, and to contrast it with the popular SPA approach of today,
we need to first explore the entire <em>hypermedia system</em> of the web, beyond just discussing HTML.  We need to look at the
<em>network architecture</em> of the web, including how a web server delivers a hypermedia API, and how to effectively
use the hypermedia features available in the hypermedia <em>client</em> (e.g., the browser).</p>
</div>
<div class="paragraph">
<p>Each of these are important aspects of building an effective hypermedia-driven application, and it is the entire
<em>hypermedia system</em> that comes together to make hypermedia such a powerful architecture.</p>
</div>
<section class="sect2">
<h3 id="_what_is_a_hypermedia_system">1.1. What is a Hypermedia System?</h3>
<div class="paragraph">
<p>

To understand what a hypermedia system is we’ll first take an in-depth look at <em>the</em> canonical hypermedia system: the
World Wide Web.  Roy Fielding, an engineer who helped create specifications and build the
implementations of many early pieces of the web, gave us the term REpresentational State Transfer, or REST.
In his PhD dissertation he described REST as a <em>network architecture</em>, and he contrasted it with earlier approaches to building
distributed software.</p>
</div>
<div class="paragraph">
<p>
We define a <em>hypermedia system</em> as a system that adheres to the RESTful network architecture in Fielding’s <em>original</em>
sense of this term.</p>
</div>
<div class="paragraph">
<p>Unfortunately, today, you probably associate the term “REST” with JSON APIs, since that is where the term is typically
used in industry.  This is a misapplied use of the term REST because JSON is not a <em>natural</em> hypermedia due to the absence of
hypermedia controls. The exchange of hypermedia is an explicit requirement for a system to be considered “RESTful.”
It is a long story how we got here, using the term REST so incorrectly, and we will go into the details later in this book.
But, for now, if you think REST implies JSON, please try to set that understanding aside while reading this book,
and come to the concept with fresh eyes.</p>
</div>
<div class="paragraph">
<p>It is important to understand that, in his dissertation, Fielding was describing The World Wide Web as it existed in the
late 1990s.  The web, at that point, was simply web browsers exchanging hypermedia.  That system, with its simple links
and forms, was what Fielding was calling RESTful.</p>
</div>
<div class="paragraph">
<p>JSON APIs were a decade away from becoming a common tool in web development: REST was about <em>hypermedia</em> and the 1.0
version of the web.</p>
</div>
</section>
<section class="sect2">
<h3 id="_hypermedia_driven_applications">1.2. Hypermedia-Driven Applications</h3>
<div class="paragraph">
<p>

In this book we are going to take a look at hypermedia as a <em>system architecture</em> and then explore some practical,
<em>modern</em> approaches to building web applications using it.  We will call applications built in this style
<em>Hypermedia-Driven Applications</em>, or HDAs, and we contrast them with a popular style in use today, the Single Page
Application.</p>
</div>
<div class="paragraph">
<p>A Hypermedia-Driven Application is an application built on top of a hypermedia system that respects and utilizes the
hypermedia functionality of that underlying system.</p>
</div>
</section>
<section class="sect2">
<h3 id="_goals">1.3. Goals</h3>
<div class="paragraph">
<p>The goal of this book is to give you a strong sense of how the RESTful, hypermedia system architecture <em>differs</em> from
other client-server systems, and what the strengths (and weaknesses) of the hypermedia approach are.  Further, we hope
to convince you that the hypermedia architecture is <em>relevant</em> to developers building modern web applications.</p>
</div>
<div class="paragraph">
<p>We aim to give you the tools to evaluate the requirements for an application and  answer the question:</p>
</div>
<div class="paragraph">
<p>“Could I build this as a Hypermedia-Driven Application?”</p>
</div>
<div class="paragraph">
<p>We hope that for many applications the answer to that question will be “Yes!”</p>
</div>
</section>
<section class="sect2">
<h3 id="_book_layout">1.4. Book Layout</h3>
<div class="paragraph">
<p>The book is broken into three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
An introduction (or re-introduction) to hypermedia, with a particular focus on HTML and HTTP.  We will finish this
review of core hypermedia concepts by creating a simple “Web 1.0”-style application, Contact.app, for managing contacts.
</li>
<li>
Next we will look at how we can use <a href="https://htmx.org">htmx</a>, a hypermedia-oriented JavaScript library created by the
authors of this book, to improve Contact.app.  By using htmx, we will be able to achieve a level of interactivity in our
application that many developers would expect to require a large, sophisticated front end library, such as React.
Thanks to htmx, we will be able to do this using hypermedia as our system architecture.
</li>
<li>
Finally, we will look at a completely different hypermedia system, Hyperview.  Hyperview is a <em>mobile</em> hypermedia system, related to, but distinct from the web and created by one of the authors of this book — Adam Stepinski.  It supports <em>mobile specific</em> features by providing not only a mobile specific hypermedia, but also a mobile hypermedia client. These novel components, combined with any HTTP server, make it possible to build mobile Hypermedia-Driven Applications.
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that each section is <em>somewhat</em> independent of the others.  If you already know hypermedia in-depth and how basic Web
1.0 applications function, you may want to skip ahead to the second section on htmx and how to build modern web applications
using hypermedia.  Similarly, if you are well versed in htmx and want to dive into a novel <em>mobile</em> hypermedia,
you can skip ahead to the Hyperview section.</p>
</div>
<div class="paragraph">
<p>That being said, the book is designed to be read in order and both the htmx and Hyperview sections build on the Web 1.0
application described at the end of the first section.  Furthermore, even if you <em>are</em> well versed in all the concepts
of hypermedia and details of HTML &amp; HTTP, it is likely worth it to at least skim through the first few chapters for
a refresher.</p>
</div>
</section>
<section class="sect2">
<h3 id="_hypermedia_a_new_generation">1.5. Hypermedia: A New Generation</h3>
<div class="paragraph">
<p>Hypermedia isn’t a frequent topic of discussion these days.  Even many older programmers who grew up with the web
in the late 1990s and early 2000s haven’t thought much about these ideas in years.  Many younger web developers have
grown up knowing nothing but Single Page Applications and the frameworks that are used to build them.</p>
</div>
<div class="paragraph">
<p>In particular, many young web developers began their careers by building React.js applications that interact with a Node server using a
JSON API; they may never have learned about hypermedia as a system at all.</p>
</div>
<div class="paragraph">
<p>This is a tragedy, and, frankly, a failure on the part of the thought leaders in the web development community to properly
communicate and advocate for the hypermedia approach.</p>
</div>
<div class="paragraph">
<p>Hypermedia was a great idea!  It still is!</p>
</div>
<div class="paragraph">
<p>By the end of this book, you will have the tools and the <em>language</em> to put this great idea to work in your own
applications.  And, further, you will be able to bring the ideas and concepts of hypermedia systems
to the broader web development community.</p>
</div>
<div class="paragraph">
<p>Hypermedia can compete, hypermedia <em>can win</em>, hypermedia <em>has won</em> as an architectural choice against the Single
Page Application approach, but <em>only</em> if smart people (like you) learn about it, build with it and then tell the world
about it.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Remember the message? “The future is not set. There is no fate but what we make for ourselves.”</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Kyle Reese, 
<cite>Terminator 2: Judgement Day</cite>
</div>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_hypermedia_in_practice">HTML Notes: Hypermedia In Practice</h3>
<div class="paragraph">
<p>Clearly, HTML plays a central role in the story we tell here. At the end of each chapter we will share what we have learned about writing HTML for hypermedia-driven web applications.</p>
</div>
<div class="paragraph">
<p>To start, remember that our web applications are not islands. We’re writing HTML not just for a particular application, but also to play along with other members of the web. When we write with the hypermedia <em>system</em> in mind, we’re better able to tap the range of abilities available to the web.</p>
</div>
<div class="paragraph">
<p>HTML is hypermedia-friendly when it is written for the full range of constituents of the hypermedia system.
It conveys the state of an application to people viewing our sites with a browser, as well as to people listening to screen readers that read sites aloud. It conveys the aims of our sites to search engines that scrape sites programmatically. It also conveys its behavior as clearly as possible to other developers.</p>
</div>
<div class="paragraph">
<p>No, we can’t fix every problem with good HTML. The mantra that HTML is "accessible by default" is misleading. We would miss out on important opportunities if we shunned other technologies like JavaScript. And we still need to test, a lot, everywhere, to ensure things work as expected.</p>
</div>
<div class="paragraph">
<p>But good HTML lets browsers do a <em>lot</em> of work for us.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_hypermedia_a_reintroduction">Hypermedia: A Reintroduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hypermedia is a universal technology today, almost as common as electricity.</p>
</div>
<div class="paragraph">
<p>Billions of people use hypermedia-based systems every day, mainly by interacting with the <em>Hypertext Markup Language
(HTML)</em>  being exchanged via the <em>Hypertext Transfer Protocol (HTTP)</em> by using a web browser connected to the World Wide Web.</p>
</div>
<div class="paragraph">
<p>People use these systems to get their news, check in on friends, buy things online, play games, send emails and so
forth: the variety and sheer number of online services being delivered by hypermedia is truly astonishing.</p>
</div>
<div class="paragraph">
<p>And yet, despite this ubiquity, the topic of hypermedia itself is a strangely under-explored concept today, left mainly to
specialists.  Yes, you can find a lot of tutorials on how to author HTML, create links and forms, etc.  But it is rare
to see a discussion of HTML <em>as a hypermedia</em> and, more broadly, on how an entire hypermedia <em>system</em> fits together.</p>
</div>
<div class="paragraph">
<p>This is in contrast with the early web development era when concepts like <em>Representational State Transfer (REST)</em>
and <em>Hypermedia As The Engine of Application State (HATEOAS)</em> were discussed frequently, refined and debated among
web developers.</p>
</div>
<div class="paragraph">
<p>In a sad turn of events, today, the world’s most popular hypermedia, HTML, is often viewed resentfully: it is an
awkward, legacy markup language that must be grudgingly used to build user interfaces in what are
increasingly entirely JavaScript-based web applications.</p>
</div>
<div class="paragraph">
<p>HTML happens to be there, in the browser, and so we have to use it.</p>
</div>
<div class="paragraph">
<p>This is a shame and we hope to convince you that hypermedia is <em>not</em> simply a
piece of legacy technology that we have to accept and deal with.  Instead, we aim to show you that hypermedia is a
tremendously innovative, simple and <em>flexible</em> way to build robust applications: <em>Hypermedia-Driven Applications</em>.</p>
</div>
<div class="paragraph">
<p>We hope that by the end of this book you will feel, as we do, that the hypermedia approach deserves a seat at the table
when you, a web developer, are considering the architecture of your next application.  Creating a Hypermedia-Driven
Application on top of a  <em>hypermedia system</em> like the web is a viable and, indeed, often excellent choice for
<em>modern</em> web applications.</p>
</div>
<div class="paragraph">
<p>(And, as the section on Hyperview will show, not just web applications.)</p>
</div>
<section class="sect2">
<h3 id="_what_is_hypermedia">What Is Hypermedia?</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Hypertexts: new forms of writing, appearing on computer screens, that will branch or perform at the reader’s
command. A hypertext is a non-sequential piece of writing; only the computer display makes it practical.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Ted Nelson, 
<cite>https://archive.org/details/SelectedPapers1977/page/n7/mode/2up</cite>
</div>
</div>
<div class="paragraph">
<p>Let us begin at the beginning: what is hypermedia?</p>
</div>
<div class="paragraph">
<p>
Hypermedia is a media, for example a text, that includes <em>non-linear branching</em> from one location in the media to another,
via, for example, hyperlinks embedded in the media. The prefix “hyper-” derives from the Greek prefix “ὑπερ-” which
means “beyond” or “over”, indicating that hypermedia <em>goes beyond</em> normal, passively consumed media like magazines and
newspapers.</p>
</div>
<div class="paragraph">
<p>
Hyperlinks are a canonical example of what is called a <dfn class="dfn">hypermedia control</dfn>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Hypermedia Control</dt>
<dd>
<p>A hypermedia control is an element in a hypermedia that describes (or controls) some sort of
interaction, often with a remote server, by encoding information about that interaction directly and completely within
itself.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Hypermedia controls are what differentiate hypermedia from other sorts of media.</p>
</div>
<div class="paragraph">
<p>
You may be more familiar with the term <dfn class="dfn">hypertext</dfn>, from whose Wikipedia page the above quote is taken.  Hypertext
is a sub-category of hypermedia and much of this book is going to discuss how to build modern applications using
hypertexts such as  HTML, the Hypertext Markup Language, or HXML, a hypertext used by the Hyperview mobile hypermedia
system.</p>
</div>
<div class="paragraph">
<p>Hypertexts like HTML function alongside other technologies crucial for making an entire hypermedia system work: network
protocols like HTTP, other media types such as images and videos, hypermedia servers (i.e., servers providing hypermedia APIs),
sophisticated hypermedia clients (e.g., web browsers), and so on.</p>
</div>
<div class="paragraph">
<p>
Because of this, we prefer the broader term <em>hypermedia systems</em> when describing the underlying architecture of
applications built using hypertext, to emphasize the system architecture over the particular hypermedia being used.</p>
</div>
<div class="paragraph">
<p>It is the entire hypermedia <em>system architecture</em> that is underappreciated and ignored by many modern web developers.</p>
</div>
</section>
<section class="sect2">
<h3 id="_a_brief_history_of_hypermedia">A Brief History of Hypermedia</h3>
<div class="paragraph">
<p>Where did the idea of hypermedia come from?</p>
</div>
<div class="paragraph">
<p>

While there were many precursors to the modern idea of hypertext and the more general hypermedia, many people point
to the 1945 article <em>As We May Think</em> written by Vannevar Bush in The Atlantic as a starting point for looking at what
has become modern hypermedia.</p>
</div>
<div class="paragraph">
<p>In this article Bush described a device called a Memex, which, using a complex mechanical system of reels and microfilm,
along with an encoding system, would allow users to jump between related frames of content.  The Memex was never actually
implemented, but it was an inspiration for later work on the idea of hypermedia.</p>
</div>
<div class="paragraph">
<p>

The terms “hypertext” and “hypermedia” were coined in 1963 by Ted Nelson, who would go on to work on the <em>Hypertext Editing
System</em> at Brown University and who later created the <em>File Retrieval and Editing System (FRESS)</em>, a shockingly advanced
hypermedia system for its time.  (This was perhaps the first digital system to have a notion of “undo”.)</p>
</div>
<div class="paragraph">
<p>
While Nelson was working on his ideas, Douglas Engelbart was busy at work at the Stanford Research Institute, explicitly
attempting to make Vannevar Bush’s Memex a reality.  In 1968, Englebart gave “The Mother of All Demos” in San Francisco,
California.</p>
</div>
<div class="paragraph">
<p>Englebart demonstrated an unbelievable amount of technology:</p>
</div>
<div class="ulist">
<ul>
<li>
Remote, collaborative text editing with his peers in Menlo Park.
</li>
<li>
Video and audio chat.
</li>
<li>
An integrated windowing system, with window resizing, etc.
</li>
<li>
A recognizable hypertext, whereby clicking on underlined text navigated to new content.
</li>
</ul>
</div>
<div class="paragraph">
<p>Despite receiving a standing ovation from a shocked audience after his talk, it was decades before the technologies
Englebart demonstrated became mainstream.</p>
</div>
<section class="sect3">
<h4 id="_modern_implementation">Modern Implementation</h4>
<div class="paragraph">
<p>

In 1990, Tim Berners-Lee, working at CERN, published the first website.  He had been working on the idea of hypertext
for a decade and had finally, out of desperation at the fact it was so hard for researchers to share their research,
found the right moment and institutional support to create the World Wide Web:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Creating the web was really an act of desperation, because the situation without it was very difficult when I was working
at CERN later. Most of the technology involved in the web, like the hypertext, like the Internet, multifont text objects, had all
been designed already. I just had to put them together. It was a step of generalising, going to a higher level of abstraction,
thinking about all the documentation systems out there as being possibly part of a larger imaginary documentation system.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Tim Berners-Lee, 
<cite>https://britishheritage.org/tim-berners-lee-the-world-wide-web</cite>
</div>
</div>
<div class="paragraph">
<p>By 1994 his creation was taking off so quickly that Berners-Lee founded the W3C, a working group of companies and researchers
tasked with improving the web.  All standards created by the W3C were royalty-free and could be adopted and implemented
by anyone, cementing the open, collaborative nature of the web.</p>
</div>
<div class="paragraph">
<p>

In 2000, Roy Fielding, then at U.C. Irvine, published a seminal PhD dissertation on the web: “Architectural Styles and the
Design of Network-based Software Architectures.”  Fielding had been working on the open source Apache HTTP Server and
his thesis was a description of what he felt was a <em>new and distinct networking architecture</em> that had emerged in the early
web.  Fielding had worked on the initial HTTP specifications and, in the paper, defined the web’s hypermedia
network model using the term <em>REpresentational State Transfer (REST)</em>.</p>
</div>
<div class="paragraph">
<p>Fielding’s work became a major touchstone for early web developers, giving them a language to discuss the new technical
medium they were building applications in.</p>
</div>
<div class="paragraph">
<p>We will discuss Fielding’s key ideas in depth in Chapter 2, and try to correct the record with respect to REST,
HATEOAS and hypermedia.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_the_worlds_most_successful_hypertext_html">The World’s Most Successful Hypertext: HTML</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In the beginning was the hyperlink, and the hyperlink was with the web, and the hyperlink was the web.  And it was good.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Rescuing REST From the API Winter, 
<cite>https://intercoolerjs.org/2016/01/18/rescuing-rest.html</cite>
</div>
</div>
<div class="paragraph">
<p>
The system that Berners-Lee, Fielding and many others had created revolved around a hypermedia: HTML.  HTML started as a read-only
hypermedia, used to publish (at first) academic documents.  These documents were linked together via anchor tags which
created <em>hyperlinks</em> between them, allowing users to quickly navigate between documents.</p>
</div>
<div class="paragraph">
<p>When HTML, 2.0 was released, it introduced the notion of the <code>form</code> tag, joining the anchor tag (i.e., hyperlink) as a
second hypermedia control.  The introduction of the form tag made building <em>applications</em> on the web viable by providing
a mechanism for <em>updating</em> resources, rather than just reading them.</p>
</div>
<div class="paragraph">
<p>It was at this point that the web transitioned from an interesting document-oriented system to a compelling
<em>application architecture</em>.</p>
</div>
<div class="paragraph">
<p>Today HTML is the most widely used hypermedia in existence and this book naturally assumes that the reader has a
reasonable familiarity with it.  You do not need to be an HTML (or CSS) expert to understand the code in this book, but
the better you understand the core tags and concepts of HTML, the more you will get out of it.</p>
</div>
<section class="sect3">
<h4 id="_the_essence_of_html_as_a_hypermedia">The Essence of HTML as a Hypermedia</h4>
<div class="paragraph">
<p>Let us consider these two defining hypermedia elements (that is the two defining <em>hypermedia controls</em>) of HTML,
the anchor tag and the form tag, in a bit of detail.</p>
</div>
<section class="sect4">
<h5 id="_anchor_tags">Anchor tags</h5>
<div class="paragraph">
<p>

Anchor tags are so familiar as to be boring but, as the original hypermedia control, it is worth reviewing the mechanics
of hyperlinks to get our minds in the right place for developing a deeper understanding of hypermedia.</p>
</div>
<div class="paragraph">
<p>Consider a simple anchor tag, embedded within a larger HTML document:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A simple hyperlink</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Hypermedia Systems
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>An anchor tag consists of the tag itself, <code>&lt;a&gt;&lt;/a&gt;</code>, as well as the attributes and content within the tag.  Of particular
interest is the <code>href</code> attribute, which specifies a <em>hypertext reference</em> to another document or document fragment.  It
is this attribute that makes the anchor tag a hypermedia control.</p>
</div>
<div class="paragraph">
<p>In a typical web browser, this anchor tag would be interpreted to mean:</p>
</div>
<div class="ulist">
<ul>
<li>
Show the text “Hypermedia Systems” in a manner indicating that it is clickable.
</li>
<li>
When the user clicks on that text, issue an HTTP <code>GET</code> request to the URL <code><a href="index.html" class="bare">https://hypermedia.systems/</a></code>.
</li>
<li>
Take the HTML content in the body of the HTTP response to this request and replace the entire screen in the browser as a new
document, updating the navigation bar to this new URL.
</li>
</ul>
</div>
<div class="paragraph">
<p>Anchors provide the main mechanism we use to navigate around the web today, by selecting links to navigate from document
to document, or from resource to resource.</p>
</div>
<div class="paragraph">
<p>Here is what a user interaction with an anchor tag/hyperlink looks like in visual form:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/http-get-in-action.svg" alt="Browser sends GET request to the server with the path and hostname" width="server responds with page" loading="lazy">
</div>
<figcaption class="title">Figure 1. An HTTP GET In Action</figcaption>
</figure>
<div class="paragraph">
<p>
When the link is clicked the browser (or, as we sometimes refer to it, the <em>hypermedia client</em>) initiates an HTTP
<code>GET</code> request to the URL encoded in the link’s <code>href</code> attribute.</p>
</div>
<div class="paragraph">
<p>Note that the HTTP request includes additional data (i.e., <em>metadata</em>) on what, exactly, the browser wants from the server,
in the form of headers.  We will discuss these headers, and HTTP in more depth in Chapter 2.</p>
</div>
<div class="paragraph">
<p>The <em>hypermedia server</em> then responds to this request with a <em>hypermedia response</em> — the HTML — for the new page.
This may seem like a small and obvious point, but it is an absolutely crucial aspect of a truly RESTful <em>hypermedia
system</em>: the client and server must communicate via hypermedia!</p>
</div>
</section>
<section class="sect4">
<h5 id="_form_tags">Form tags</h5>
<div class="paragraph">
<p>
Anchor tags provide <em>navigation</em> between documents or resources, but don’t allow you to update those resources.  That functionality
falls to the form tag.</p>
</div>
<div class="paragraph">
<p>Here is a simple example of a form in HTML:</p>
</div>
<figure id="listing-1-2" class="listingblock">
<figcaption class="title">A simple form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/signup<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Enter Email To Sign Up...<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Sign Up<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Like an anchor tag, a form tag consists of the tag itself, <code>&lt;form&gt;&lt;/form&gt;</code>, combined with the attributes and
content within the tag.  Note that the form tag does not have an <code>href</code> attribute, but rather has an <code>action</code> attribute
that specifies where to issue an HTTP request.</p>
</div>
<div class="paragraph">
<p>
Furthermore, it also has a <code>method</code> attribute, which specifies exactly which HTTP “method” to use.  In this example
the form is asking the browser to issue a <code>POST</code> request.</p>
</div>
<div class="paragraph">
<p>In contrast with anchor tags, the content and tags <em>within</em> a form can have an effect on the hypermedia interaction
that the form makes with a server.  The <em>values</em> of <code>input</code> tags and other tags such as <code>select</code> tags will be included
with the HTTP request when the form is submitted, as URL parameters in the case of a <code>GET</code> and as part of the request
body in the case of a <code>POST</code>.  This allows a form to include an arbitrary amount of information
collected from a user in a request, unlike the anchor tag.</p>
</div>
<div class="paragraph">
<p>In a typical browser this form tag and its contents would be interpreted by the browser roughly as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
Show a text input and a “Sign Up” button to the user.
</li>
<li>
When the user submits the form by clicking the “Sign Up” button or by hitting the enter key while the input element is
focused, issue an HTTP <code>POST</code> request to the path <code>/signup</code> on the “current” server.
</li>
<li>
Take the HTML content in the body of the HTTP response body and replace the entire screen in the browser as a new
document, updating the navigation bar to this new URL.
</li>
</ul>
</div>
<div class="paragraph">
<p>This mechanism allows the user to issue requests to <em>update the state</em> of resources on the server.  Note that despite
this new type of request the communication between client and server is still done entirely with <em>hypermedia</em>.</p>
</div>
<div class="paragraph">
<p>It is the form tag that makes Hypermedia-Driven Applications possible.</p>
</div>
<div class="paragraph">
<p>If you are an experienced web developer you probably recognize that we are omitting a few details and complications
here.  For example, the response to a form submission often <em>redirects</em> the client to a different URL.</p>
</div>
<div class="paragraph">
<p>This is true, and we will get down into the muck with forms in more detail in later chapters but, for now, this simple
example suffices to demonstrate the core mechanism for updating system state purely within hypermedia.</p>
</div>
<div class="paragraph">
<p>Here is a diagram of the interaction:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/http-post-in-action.svg" alt="When submitting a sign up form" width="browser sends POST request with form data. Server responds creates account and responds with a thank you page." loading="lazy">
</div>
<figcaption class="title">Figure 2. An HTTP POST In Action</figcaption>
</figure>
</section>
<section class="sect4">
<h5 id="_web_1_0_applications">Web 1.0 applications</h5>
<div class="paragraph">
<p>As someone interested in web development, the above diagrams and discussion are probably very familiar to you.  You may
even find this content boring.  But take a step back and consider the fact that these two hypermedia controls,
anchors and forms, are the <em>only</em> native ways for a user to interact with a server in plain HTML.</p>
</div>
<div class="paragraph">
<p>Only two tags!</p>
</div>
<div class="paragraph">
<p>And yet, armed with only these two tags, the early web was able to grow exponentially and offer a staggeringly large
amount of online, dynamic functionality to billions of people.</p>
</div>
<div class="paragraph">
<p>This is strong evidence of the power of hypermedia.  Even today, in a web development world increasingly dominated by large
JavaScript-centric front end frameworks, many people choose to use simple vanilla HTML to achieve their application goals
and are often perfectly happy with the results.</p>
</div>
<div class="paragraph">
<p>These two tags give a tremendous amount of expressive power to HTML.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_so_what_isnt_hypermedia">So What Isn’t Hypermedia?</h4>
<div class="paragraph">
<p>So links and forms are the two main hypermedia-based mechanisms for interacting with a server available in HTML.</p>
</div>
<div class="paragraph">
<p>
Now let’s consider a different approach: let’s interact with a server by issuing an HTTP request via JavaScript.  To
do this, we will use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"><code>fetch()</code></a> API, a popular API for
issuing an “Asynchronous JavaScript and XML,” or AJAX request, available in all modern web browsers:</p>
</div>
<figure id="listing-1-3" class="listingblock">
<figcaption class="title">JavaScript</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/v1/contacts/1'</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">updateUI</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> (3)
    Fetch Contact
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue the request.
</li>
<li>
Convert the response to a JavaScript object.
</li>
<li>
Invoke the <code>updateUI()</code> function with the object.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This button has an <code>onclick</code> attribute that specifies some JavaScript to run when the button is clicked.</p>
</div>
<div class="paragraph">
<p>The JavaScript will issue an AJAX HTTP <code>GET</code> request to <code>/api/v1/contacts/1</code> using <code>fetch()</code>.  An AJAX request is like a
“normal” HTTP request, but it is issued “behind the scenes” by the browser.  The user does not see a
request indicator from the browser as they would with normal links and forms. Additionally, unlike requests issued by those
hypermedia controls, it is up to the JavaScript code to handle the response from the server.</p>
</div>
<div class="paragraph">
<p>
Despite AJAX having XML as part of its acronym, today the HTTP response to this request would almost certainly be in the
JavaScript Object Notation (JSON) format rather than XML.</p>
</div>
<div class="paragraph">
<p>An HTTP response to this request might look something like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">JSON</figcaption>
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{ (1)
  "id": 42, (2)
  "email" : "json-example@example.org" (3)
}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The start of a JSON object.
</li>
<li>
A property, in this case with the name <code>id</code> and the value <code>42</code>.
</li>
<li>
Another property, the email of the contact with this id.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
The JavaScript code above converts the JSON text received from the server into a JavaScript object by calling the
<code>json()</code> method on it.  This new JavaScript object is then handed off to the <code>updateUI()</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>updateUI()</code> method is responsible for updating the UI based on the data encoded in the JavaScript Object,
perhaps by displaying the contact in a bit of HTML generated via a client-side template in the JavaScript application.</p>
</div>
<div class="paragraph">
<p>The details of exactly what the <code>updateUI()</code> function does aren’t important for our discussion.</p>
</div>
<div class="paragraph">
<p>What <em>is</em> important, what is the <em>crucial</em> aspect of this JSON-based server interaction is that it is <em>not</em> using
hypermedia.  The JSON API being used here does not return a hypermedia response.  There are no <em>hyperlinks</em> or other
hypermedia-style controls in it.</p>
</div>
<div class="paragraph">
<p>
This JSON API is, rather, a <em>Data API</em>.</p>
</div>
<div class="paragraph">
<p>Because the response is in JSON and is <em>not</em> hypermedia, the JavaScript <code>updateUI()</code> method must understand how to turn
this contact data into HTML.</p>
</div>
<div class="paragraph">
<p>In particular, the code in <code>updateUI()</code> needs to know about the <em>internal structure</em> and meaning of the data.</p>
</div>
<div class="paragraph">
<p>It needs to know:</p>
</div>
<div class="ulist">
<ul>
<li>
Exactly how the fields in the JSON data object are structured and named.
</li>
<li>
How they relate to one another.
</li>
<li>
How to update the local data this new data corresponds with.
</li>
<li>
How to render this data to the browser.
</li>
<li>
What additional actions/API end points can be called with this data.
</li>
</ul>
</div>
<div class="paragraph">
<p>
In short, the logic in <code>updateUI()</code> needs to have intimate knowledge of the API endpoint at <code>/api/v1/contact/1</code>, knowledge provided
via some side-channel beyond the response itself.  As a result, the <code>updateUI()</code> code and the
API have a strong relationship, known as <em>tight coupling</em>: if the format of the JSON response changes, then the code for <code>updateUI()</code> will almost certainly
also need to be changed as well.</p>
</div>
<section class="sect4">
<h5 id="_single_page_applications">Single Page Applications</h5>
<div class="paragraph">
<p>
This bit of JavaScript, while very modest, is the organic beginnings of a much larger conceptual approach to building
web applications.  This is the beginning of a <em>Single Page Application (SPA)</em>.  The web application is no longer
navigating <em>between</em> pages using hypermedia controls as was the case with links and forms.</p>
</div>
<div class="paragraph">
<p>Instead, the application is exchanging <em>plain data</em> with the server and then updating the content <em>within</em> a single page.</p>
</div>
<div class="paragraph">
<p>When this strategy or architecture is adopted for an entire application, everything happens on a “Single Page” and,
thus the application becomes a “Single Page Application.”</p>
</div>
<div class="paragraph">
<p>The Single Page Application architecture is extremely popular today and has been the dominant approach to building web applications for the last decade. This can be observed by the high level of mind-share and discussion it has received in the industry.</p>
</div>
<div class="paragraph">
<p>Today the vast majority of Single Page Applications adopt far more sophisticated frameworks for managing their
user interface than this simple example shows.  Popular libraries such as React, Angular, Vue.js, etc. are now the common — indeed, the standard — way to build web applications.</p>
</div>
<div class="paragraph">
<p>With these more complex frameworks developers typically work with an elaborate client-side model — that is, with JavaScript objects
stored locally in the browser’s memory that represent the “model” or “domain” of your application.  These JavaScript objects
are updated via JavaScript code and the framework then “reacts” to these changes, updating the user interface.</p>
</div>
<div class="paragraph">
<p>When the user interface is updated by a user these changes also flow <em>into</em> the model objects, establishing a “two-way”
binding mechanism: the model can update the UI, and the UI can update the model.</p>
</div>
<div class="paragraph">
<p>This is a much more sophisticated approach to a web client than hypermedia, and it typically does away almost entirely
with the underlying hypermedia infrastructure available in the browser.</p>
</div>
<div class="paragraph">
<p>HTML is still used to build user interfaces, but the <em>hypermedia</em> aspect of the two major hypermedia controls,
anchors and forms, are unused.  Neither tag interacts with a server via their native <em>hypermedia</em> mechanism.  Rather,
they become user interface elements that drive local interactions with the in-memory domain model via JavaScript,
which is then synchronized with the server using plain data JSON APIs.</p>
</div>
<div class="paragraph">
<p>So, as with our simple button above, the Single Page Application approach foregoes the hypermedia architecture.
It leaves aside the advantages of the existing RESTful architecture of the web and the built-in functionality
found in HTML’s native hypermedia controls in favor of JavaScript driven behaviors.</p>
</div>
<div class="paragraph">
<p>
SPAs are much more like <em>thick client applications</em>, that is, like the client-server applications of the
1980s — an architecture popular <em>before</em> the web came along and that the web was, in many ways, a reaction to.</p>
</div>
<div class="paragraph">
<p>This approach isn’t necessarily wrong, of course: there are times when a thick client approach is the appropriate choice
for an application.  But it is worth thinking about <em>why</em> web developers so frequently make this choice without
considering other alternatives, and if there are reasons <em>not</em> to go down this path.</p>
</div>
</section>
</section>
</section>
<section class="sect2">
<h3 id="_why_use_hypermedia">Why Use Hypermedia?</h3>
<div class="paragraph">
<p></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The emerging norm for web development is to build a React single-page application, with server rendering. The two key
elements of this architecture are something like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
The main UI is built &amp; updated in JavaScript using React or something similar.
</li>
<li>
The backend is an API that that application makes requests against.
</li>
</ol>
</div>
<div class="paragraph">
<p>This idea has really swept the internet. It started with a few major popular websites and has crept into corners like
marketing sites and blogs.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Tom MacWright, 
<cite>https://macwright.com/2020/05/10/spa-fatigue.html</cite>
</div>
</div>
<div class="paragraph">
<p>The JavaScript-based Single Page Application approach has taken the web development world by storm, and if there was one
single reason for its wild success it was this: The Single Page Application offers a far more interactive and immersive experience
than the old, gronky, Web 1.0 hypermedia-based applications could.  SPAs had the ability to smoothly update elements inline on
a page without a dramatic reload of the entire document, they had the ability to use CSS transitions to create nice visual effects,
and the ability to hook into arbitrary events like mouse movements.</p>
</div>
<div class="paragraph">
<p>All of these abilities give JavaScript-based applications a huge advantage in building sophisticated user experiences.</p>
</div>
<div class="paragraph">
<p>Given the popularity, power and success of this modern approach to building web applications, why on earth would you
consider an older, clunkier and less popular approach like hypermedia?</p>
</div>
<section class="sect3">
<h4 id="_javascript_fatigue">JavaScript Fatigue</h4>
<div class="paragraph">
<p>We are glad you asked!</p>
</div>
<div class="paragraph">
<p>
It turns out that the hypermedia architecture, even in its original Web 1.0 form, has a number of advantages when compared with
the Single Page Application + JSON Data API approach.  Three of the biggest are:</p>
</div>
<div class="ulist">
<ul>
<li>
It is an extremely <em>simple</em> approach to building web applications.
</li>
<li>
It is extremely tolerant of content and API changes. In fact, it thrives on them!
</li>
<li>
It leverages tried and true features of web browsers, such as caching.
</li>
</ul>
</div>
<div class="paragraph">
<p>

The first two advantages, in particular, address major pain points in modern web development:</p>
</div>
<div class="ulist">
<ul>
<li>
Single Page Application infrastructure has become extremely complex, often requiring an entire team to manage.
</li>
<li>
JSON API churn — constant changes made to JSON APIs to support application needs — has become a major pain point for
many application teams.
</li>
</ul>
</div>
<div class="paragraph">
<p>The combination of these two problems, along with other issues such as JavaScript library churn, has led to a phenomenon
known as “JavaScript Fatigue.” This refers to a general sense of exhaustion with all the hoops that are necessary to
jump through to get anything done in modern-day web applications.</p>
</div>
<div class="paragraph">
<p>We believe that a hypermedia architecture can help cure JavaScript Fatigue for many developers and teams.</p>
</div>
<div class="paragraph">
<p>But if hypermedia is so great, and if it addresses so many of the problems that beset the web
development industry, why was it set aside in the first place?  After all, hypermedia was there first.  Why didn’t web
developers just stick with it?</p>
</div>
<div class="paragraph">
<p>There are two major reasons hypermedia hasn’t made a comeback in web development.</p>
</div>
<div class="paragraph">
<p>The first is this: the expressiveness of HTML <em>as a hypermedia</em> hasn’t changed much, if at all, since HTML 2.0, which
was released <em>in the mid 1990s</em>.  Many new <em>features</em> have been added to HTML, of course, but there haven’t been <em>any</em>
major new ways to interact with a server in HTML in almost three decades.</p>
</div>
<div class="paragraph">
<p>HTML developers still only have anchor tags and forms available as hypermedia controls, and those hypermedia controls
can still only issue <code>GET</code> and <code>POST</code> requests.</p>
</div>
<div class="paragraph">
<p>This baffling lack of progress by HTML leads immediately to the second, and perhaps more practical reason that
HTML-as-hypermedia has fallen on hard times: as the interactivity and expressiveness of HTML has remained frozen, the
demands of web users have continued to increase, calling for more and more interactive web applications.</p>
</div>
<div class="paragraph">
<p>JavaScript-based applications coupled to data-oriented JSON APIs have stepped in as a way to provide these more
sophisticated user interfaces. It was the <em>user experience</em> that you could achieve in JavaScript, and that you couldn’t
achieve in plain HTML, that drove the web development community to the JavaScript-based
Single Page Application approach. The shift was not driven by any inherent superiority of the Single Page Application as a system
architecture.</p>
</div>
<div class="paragraph">
<p>It didn’t have to be this way.  There is nothing <em>intrinsic</em> to the idea of hypermedia that prevents it from having a
richer, more expressive interactivity model than vanilla HTML.  Rather than moving away from a hypermedia-based
approach, the industry could have demanded more interactivity from HTML.</p>
</div>
<div class="paragraph">
<p>Instead, building thick-client style applications within web browsers became the standard, in an
understandable move to a more familiar model for building rich applications.</p>
</div>
<div class="paragraph">
<p>Not everyone set aside hypermedia, of course. There have been heroic efforts to continue to advance hypermedia outside of
HTML, efforts like HyTime, VoiceXML, and HAL.</p>
</div>
<div class="paragraph">
<p>But HTML, the most widely used hypermedia in the world, stopped making progress as a hypermedia. The web development
world moved on, solving the interactivity problems with HTML by adopting JavaScript-based SPAs and, mostly inadvertently,
a completely different system architecture.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_a_hypermedia_resurgence">A Hypermedia Resurgence?</h3>
<div class="paragraph">
<p>It is interesting to think about how HTML <em>could</em> have advanced.  Instead of stalling as a hypermedia, how could HTML
have continued to develop? Could it have kept adding new hypermedia controls and increasing the expressiveness of
existing ones?  Would it have been possible to build modern web applications within this original, hypermedia-oriented
and RESTful model that made the early web so powerful, so flexible, so much fun?</p>
</div>
<div class="paragraph">
<p>This might seem like idle speculation, but we have some good news on this score: in the last decade a few
idiosyncratic, alternative front end libraries have arisen that attempt to get HTML moving again.  Ironically, these
libraries are written in JavaScript, the technology that supplanted HTML as the center of web development.</p>
</div>
<div class="paragraph">
<p>However, these libraries use JavaScript not as a <em>replacement</em> for the fundamental hypermedia system of the web.</p>
</div>
<div class="paragraph">
<p>Instead, they use JavaScript to augment HTML itself <em>as a hypermedia</em>.</p>
</div>
<div class="paragraph">
<p>These <em>hypermedia-oriented</em> libraries re-center hypermedia as the core technology in web applications.</p>
</div>
<section class="sect3">
<h4 id="_hypermedia_oriented_javascript_libraries">Hypermedia-Oriented JavaScript Libraries</h4>
<div class="paragraph">
<p>
In the web development world there is an ongoing debate between the Single Page Application (SPA) approach and what is now being called the
“Multi-Page Application” (MPA) approach.  MPA is a modern name for the old, Web 1.0 way of building web applications, using
links and forms located on multiple web pages, submitting HTTP requests and getting HTML responses.</p>
</div>
<div class="paragraph">
<p>MPA applications, by their nature, are Hypermedia-Driven Applications: after all, they are exactly what Roy Fielding
was describing in his dissertation.</p>
</div>
<div class="paragraph">
<p>These applications tend to be clunky, but they work reasonably well.  Many web developers and teams choose to accept the
limitations of plain HTML in the interest of simplicity and reliability.</p>
</div>
<div class="paragraph">
<p>Rich Harris, creator of Svelte.js, a popular SPA library, and a thought-leader on the SPA side of the debate, has proposed a mix
of this older MPA style and the newer SPA style.  Harris calls this approach to building web applications “transitional,” in that
it attempts to blend the MPA approach and the newer SPA approach into a coherent whole.  (This is somewhat
similar to the “transitional” trend in architecture, which combines traditional and modern architectural styles.)</p>
</div>
<div class="paragraph">
<p>“Transitional” is a fitting term for mixed-style applications, and it offers a reasonable compromise between the two
approaches, using either one as appropriate on a case-by-case basis.</p>
</div>
<div class="paragraph">
<p>But this compromise still feels unsatisfactory.</p>
</div>
<div class="paragraph">
<p>Must we default to having these two very different architectural models in our applications?</p>
</div>
<div class="paragraph">
<p>Recall that the crux of the trade-off between SPAs and MPAs is the <em>user experience</em>, or interactivity of the application.
This typically drives the decision to choose one approach versus the other for an application or — in the case
of a “transitional” application — for a particular feature.</p>
</div>
<div class="paragraph">
<p>It turns out that by adopting a hypermedia-oriented library, the interactivity gap between the MPA and the SPA approach
closes dramatically.  You can use the MPA approach, that is, the hypermedia approach, for much more of your application
without compromising your user interface. You might even be able to use the hypermedia approach for <em>all</em> your application
needs.</p>
</div>
<div class="paragraph">
<p>Rather than having an SPA with a bit of hypermedia around the edges, or some mix of the two approaches, you can often create
a web application that is <em>primarily</em> or <em>entirely</em> hypermedia-driven, and that still satisfies the interactivity that your
users require.</p>
</div>
<div class="paragraph">
<p>This can <em>tremendously</em> simplify your web application and produce a much more coherent and understandable piece of
software.  While there are still times and places for the more complex SPA approach, which we will discuss later in the book,
by adopting a hypermedia-first approach and using a hypermedia-oriented library to push HTML as far as possible,
your web application can be powerful, interactive <em>and</em> simple.</p>
</div>
<div class="paragraph">
<p>One such hypermedia oriented library is <a href="https://htmx.org">htmx</a>.  Htmx will be the focus of Part Two of this book.
We show that you can, in fact, create many common “modern” UI features found in sophisticated Single
Page Applications by instead using the hypermedia model.</p>
</div>
<div class="paragraph">
<p>And, it is refreshingly fun and simple to do so.</p>
</div>
</section>
<section class="sect3">
<h4 id="_hypermedia_driven_applications_2">Hypermedia-Driven Applications</h4>
<div class="paragraph">
<p>When building a web application with htmx the term Multi-Page Application applies <em>roughly</em>, but it doesn’t fully characterize
the core of the application architecture.  As you will see, htmx doesn’t <em>need</em> to replace entire pages, and, in fact, an
htmx-based application can reside entirely within a single page. We don’t recommend this practice, but it is
possible!</p>
</div>
<div class="paragraph">
<p>So it isn’t quite right to call web applications built with htmx “Multi-Page Applications.”  What the older Web 1.0 MPA
approach and the newer hypermedia-oriented library powered applications have in common is their use of <em>hypermedia</em> as
their core technology and architecture.</p>
</div>
<div class="paragraph">
<p>Therefore, we use the term <em>Hypermedia-Driven Applications (HDAs)</em> to describe both.</p>
</div>
<div class="paragraph">
<p>This clarifies that the core distinction between these two approaches and the SPA approach <em>isn’t</em> the number of pages
in the application, but rather the underlying <em>system</em> architecture.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Hypermedia-Driven Application (HDA)</dt>
<dd>
<p>A web application that uses <em>hypermedia</em> and <em>hypermedia exchanges</em> as its primary
mechanism for communicating with a server.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>So, what does an HDA look like up close?</p>
</div>
<div class="paragraph">
<p>Let’s look at an htmx-powered implementation of the simple JavaScript-powered button above:</p>
</div>
<figure id="listing-1-4" class="listingblock">
<figcaption class="title">An htmx implementation</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/1<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#contact-ui<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Fetch Contact
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
issues a <code>GET</code> request to <code>/contacts/1</code>, replacing the <code>contact-ui</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As with the JavaScript powered button, this button has been annotated with some attributes.  However, in
this case we do not have any (explicit) JavaScript scripting.</p>
</div>
<div class="paragraph">
<p>Instead, we have <em>declarative</em> attributes much like the <code>href</code> attribute on anchor tags and the <code>action</code> attribute on
form tags.  The <code>hx-get</code> attribute tells htmx: “When the user clicks this button, issue a <code>GET</code> request to <code>/contacts/1</code>.”
The <code>hx-target</code> attribute tells htmx: “When the response returns, take the resulting HTML and place it into the element
with the id <code>contact-ui</code>.”</p>
</div>
<div class="paragraph">
<p>Here we get to the crux of htmx and how it allows you to build Hypermedia-Driven Applications:</p>
</div>
<div class="paragraph">
<p><em>The HTTP response from the server is expected to be in HTML format, not JSON</em>.</p>
</div>
<div class="paragraph">
<p>An HTTP response to this htmx-driven request might look something like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">HTML</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    Contact: HTML Example
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:html-example@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>This small bit of HTML would be placed into the element in the DOM with the id <code>contact-ui</code>.</p>
</div>
<div class="paragraph">
<p>Thus, this htmx-powered button is exchanging <em>hypermedia</em> with the server, just like an anchor tag or form
might, and thus the interaction is still using the basic hypermedia model of the web.  Htmx <em>is</em> adding functionality
to this button (via JavaScript), but that functionality is <em>augmenting</em> HTML as a hypermedia. Htmx extends the hypermedia
system of the web, rather than <em>replacing</em> that hypermedia system with a totally different architecture.</p>
</div>
<div class="paragraph">
<p>Despite looking superficially similar to one another it turns out that this htmx-powered button and the JavaScript-based
button are using extremely different system architectures and, thus, approaches to web development.</p>
</div>
<div class="paragraph">
<p>As we walk through building a Hypermedia-Driven Application in this book, the differences between the two approaches
will become more and more apparent.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_when_should_you_use_hypermedia">When Should You Use Hypermedia?</h3>
<div class="paragraph">
<p>
Hypermedia is often, though <em>not always</em>, a great choice for a web application.</p>
</div>
<div class="paragraph">
<p>Perhaps you are building a website or application that simply doesn’t <em>need</em> a huge amount of user-interactivity.  There are
many useful web applications like this, and there is no shame in it!  Applications like Amazon, eBay, any number of news
sites, shopping sites, message boards and so on don’t need a massive amount of interactivity to be effective: they are
mainly text and images, which is exactly what the web was designed for.</p>
</div>
<div class="paragraph">
<p>Perhaps your application adds most of its value on the <em>server side</em>, by coordinating users or by applying sophisticated
data analysis and then presenting it to a user.  Perhaps your application adds value by simply sitting in front of a
well-designed database, with simple Create-Read-Update-Delete (CRUD) operations.  Again, there is no shame in this!</p>
</div>
<div class="paragraph">
<p>In any of these cases, using a hypermedia approach would likely be a great choice: the interactivity needs of
these applications are not dramatic, and much of the value of these applications lives on the server side, rather than on the client side.</p>
</div>
<div class="paragraph">
<p>All of these applications are amenable to what Roy Fielding called “large-grain hypermedia data transfers”: you can simply
use anchor tags and forms, with responses that return entire HTML documents from requests, and things will work just fine.
This is exactly what the web was designed to do!</p>
</div>
<div class="paragraph">
<p>By adopting the hypermedia approach for these applications, you will save yourself a huge amount of client-side complexity
that comes with adopting the Single Page Application approach: there is no need for client-side routing, for managing
a client-side model, for hand-wiring in JavaScript logic, and so forth.  The back button will “just work.” Deep linking
will “just work.” You will be able to focus your efforts on your server, where your application is actually adding value.</p>
</div>
<div class="paragraph">
<p>And, by layering htmx or another hypermedia-oriented library on top of this approach, you can address many of the usability
issues that come with vanilla HTML and take advantage of finer-grained hypermedia transfers.  This opens up a whole slew of new
user interface and experience possibilities, making the set of applications that can be built using hypermedia <em>much</em> larger.</p>
</div>
<div class="paragraph">
<p>But more on that later.</p>
</div>
</section>
<section class="sect2">
<h3 id="_when_shouldnt_you_use_hypermedia">When Shouldn’t You Use Hypermedia?</h3>
<div class="paragraph">
<p>
So, what about that <em>not always</em>?  When isn’t hypermedia going to work well for an application?</p>
</div>
<div class="paragraph">
<p>One example that springs immediately to mind is an online spreadsheet application.  In the case of a spreadsheet,
updating one cell could have a large number of cascading changes that need to be made across the entire sheet.  Worse,
this might need to happen <em>on every keystroke</em>.</p>
</div>
<div class="paragraph">
<p>In this case we have a highly dynamic user interface without clear boundaries as to what might need to be updated given
a particular change.  Introducing a hypermedia-style server round-trip on every cell change would hurt performance
tremendously.</p>
</div>
<div class="paragraph">
<p>This is simply not a situation amenable to the “large-grain hypermedia data transfer” approach of the web.  For an
application like this we would certainly recommend looking into using a sophisticated client-side JavaScript approach.</p>
</div>
<div class="paragraph">
<p><em>However</em> even in the case of an online spreadsheet there are likely areas where the hypermedia approach might help.</p>
</div>
<div class="paragraph">
<p>The spreadsheet application likely also has a settings page.  And perhaps that settings page <em>is</em> amenable to
the hypermedia approach.  If it is simply a set of relatively straight-forward forms that need to be persisted to the
server, the chances are good that hypermedia would, in fact, work great for this part of the app.</p>
</div>
<div class="paragraph">
<p>And, by adopting hypermedia for that part of your application, you might be able to simplify that part of the application
quite a bit. You could then save more of your application’s <em>complexity budget</em> for the core, complicated spreadsheet logic,
keeping the simple stuff simple.</p>
</div>
<div class="paragraph">
<p>Why waste all the complexity associated with a heavy JavaScript framework on something as simple as a settings page?</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">A Complexity Budget</div>
<div class="paragraph">
<p>Any software project has a complexity budget, explicit or not: there is only so much complexity a given development
team can tolerate and every new feature and implementation choice adds at least a bit more to the overall complexity
of the system.</p>
</div>
<div class="paragraph">
<p>
What is particularly nasty about complexity is that it tends to grow exponentially: one day you can keep the entire
system in your head and understand the ramifications of a particular change, and a week later the whole system seems
intractable.  Even worse, efforts to help control complexity, such as introducing abstractions or infrastructure to
manage the complexity, often end up making things even more complex.  Truly, the job of the good software engineer
is to keep complexity under control.</p>
</div>
<div class="paragraph">
<p>The sure-fire way to keep complexity down is also the hardest: say no.  Pushing back on feature requests is an art
and, if you can learn to do it well, making people feel like <em>they</em> said no, you will go far.</p>
</div>
<div class="paragraph">
<p>Sadly this is not always possible: some features will need to be built.  At this point the question becomes: “what is
the simplest thing that could possibly work?”  Understanding the possibilities available in the hypermedia approach
will give you another tool in your “simplest thing” tool chest.</p>
</div>
</div>
</aside>
</section>
<section class="sect2">
<h3 id="_hypermedia_a_sophisticated_modern_system_architecture">Hypermedia: A Sophisticated, Modern System Architecture</h3>
<div class="paragraph">
<p>Hypermedia is often regarded as an old and antiquated technology in web development circles, useful perhaps
for static websites but certainly not a realistic choice for modern, sophisticated web applications.</p>
</div>
<div class="paragraph">
<p>Seriously? Are we claiming that modern web applications can be built using it?</p>
</div>
<div class="paragraph">
<p>Yes, seriously.</p>
</div>
<div class="paragraph">
<p>Contrary to current popular opinion, hypermedia is an <em>innovative</em> and <em>modern</em> system architecture for building
applications, in some ways <em>more modern</em> than the prevailing Single Page Application approaches.  In the remainder
of this book we will reintroduce you to the core, practical concepts of hypermedia and then demonstrate exactly how
you can take advantage of this system architecture in your own software.</p>
</div>
<div class="paragraph">
<p>In the coming chapters you will develop a firm understanding of all the benefits and techniques enabled by this approach.
We hope that, in addition, you will also become as passionate about it as we are.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_div_soup">HTML Notes: &lt;div&gt; Soup</h3>
<div class="paragraph">
<p>The best-known kind of messy HTML is <code>&lt;div&gt;</code> soup.</p>
</div>
<div class="paragraph">
<p>When developers fall back on the generic <code>&lt;div&gt;</code> and <code>&lt;span&gt;</code> elements instead of more meaningful tags,
we either degrade the quality of our websites or create more work for ourselves — probably both.</p>
</div>
<div class="paragraph">
<p>For example, instead of adding a button using the dedicated <code>&lt;button&gt;</code> element,
a <code>&lt;div&gt;</code> element might have a <code>click</code> event listener added to it.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bg-accent padding-4 rounded-2<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>Do stuff<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>There are two main issues with this button:</p>
</div>
<div class="ulist">
<ul>
<li>
It’s not focusable — the Tab key won’t get you to it.
</li>
<li>
There’s no way for assistive tools to tell that it’s a button.
</li>
</ul>
</div>
<div class="paragraph">
<p>Yes, we can fix that by adding <code>role="button"`</code> and <code>tabindex="0"</code>:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bg-accent padding-4 rounded-2<span class="token punctuation">"</span></span>
  <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>
  <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
  <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>Do stuff<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>These are easy fixes, but they’re things you have to <em>remember</em>.
It’s also not obvious from the HTML source that this is a button,
making the source harder to read and the absence of these attributes harder to spot.
The source code of pages with div soup is difficult to edit and debug.</p>
</div>
<div class="paragraph">
<p>To avoid div soup, become friendly with the HTML spec of available tags, and consider each tag another tool in your tool chest. There might be things there you don’t remember from before! (With the 113 elements currently defined in the spec, it’s more of a tool <em>shed</em>).</p>
</div>
<div class="paragraph">
<p>Of course, not every UI pattern has a designated HTML element.
We often need to compose elements and augment them with attributes.
Before you do, though, rummage through the html tool chest. Sometimes you might be surprised by how much is available.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_components_of_a_hypermedia_system">Components Of A Hypermedia System</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>hypermedia system</em> consists of a number of components, including:</p>
</div>
<div class="ulist">
<ul>
<li>
A hypermedia, such as HTML.
</li>
<li>
A network protocol, such as HTTP.
</li>
<li>
A server that presents a hypermedia API responding to network requests with hypermedia responses.
</li>
<li>
A client that properly interprets those responses.
</li>
</ul>
</div>
<div class="paragraph">
<p>In this chapter we will look at these components and their implementation in the context of the web.</p>
</div>
<div class="paragraph">
<p>Once we have reviewed the major components of the web as a hypermedia system, we will look at some key ideas behind this system — especially as developed by Roy
Fielding in his dissertation, “Architectural Styles and the Design of Network-based Software Architectures.”  We will see where the
terms REpresentational State Transfer (REST), RESTful and Hypermedia As The Engine Of Application State (HATEOAS) come from,
and we will analyze these terms in the context of the web.</p>
</div>
<div class="paragraph">
<p>This should give you a stronger understanding of the theoretical basis of the web as a hypermedia system, how it is
supposed to fit together, and why Hypermedia-Driven Applications are RESTful, whereas JSON APIs — despite the way the
term REST is currently used in the industry — are not.</p>
</div>
<section class="sect2">
<h3 id="_components_of_a_hypermedia_system_2">Components Of A Hypermedia System</h3>
<section class="sect3">
<h4 id="_the_hypermedia">The Hypermedia</h4>
<div class="paragraph">
<p>The fundamental technology of a hypermedia system is a hypermedia that allows a
client and server to communicate with one another in a dynamic, non-linear fashion.  Again, what makes a hypermedia
a hypermedia is the presence of <em>hypermedia controls</em>: elements that allow users to select
non-linear actions within the hypermedia. Users can <em>interact</em> with the media in a manner beyond
simply reading from start to end.</p>
</div>
<div class="paragraph">
<p>We have already mentioned the two primary hypermedia controls in HTML, anchors and forms, which allow a browser to
present links and operations to a user through a browser.</p>
</div>
<div class="paragraph">
<p>
In the case of HTML, these links and forms typically specify the target of their operations using <dfn class="dfn">Uniform Resource
Locators (URLs)</dfn>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Uniform Resource Locator</dt>
<dd>
<p>A uniform resource locator is a textual string that refers to, or <em>points to</em> a location
on a network where a <em>resource</em> can be retrieved from, as well as the mechanism by which the resource can be retrieved.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A URL is a string consisting of various subcomponents:</p>
</div>
<figure class="listingblock">
<figcaption class="title">URL Components</figcaption>
<div class="content">
<pre>[scheme]://[userinfo]@[host]:[port][path]?[query]#[fragment]</pre>
</div>
</figure>
<div class="paragraph">
<p>Many of these subcomponents are not required, and are often omitted.</p>
</div>
<div class="paragraph">
<p>A typical URL might look like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A simple URL</figcaption>
<div class="content">
<pre>https://hypermedia.systems/book/contents/</pre>
</div>
</figure>
<div class="paragraph">
<p>This particular URL is made up of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
A protocol or scheme (in this case, <code>https</code>)
</li>
<li>
A domain (e.g., <code>hypermedia.systems</code>)
</li>
<li>
A path (e.g., <code>/book/contents</code>)
</li>
</ul>
</div>
<div class="paragraph">
<p>This URL uniquely identifies a retrievable <em>resource</em> on the internet, to which an <em>HTTP Request</em> can be issued by
a hypermedia client that “speaks” HTTPS, such as a web browser.  If this URL is found as the reference of a
hypermedia control within an HTML document, it implies that there is a <em>hypermedia server</em> on the other side of the
network that understands HTTPS as well, and that can respond to this request with a <em>representation</em> of the given
resource (or redirect you to another location, etc.)</p>
</div>
<div class="paragraph">
<p>Note that URLs are often not written out entirely within HTML.  It is very common to see anchor tags that look like this,
for example:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A Simple Link</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/book/contents/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Table Of Contents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Here we have a <em>relative</em> hypermedia reference, where the protocol, host and port are <em>implied</em> to be that of the “current
document,” that is, the same as whatever the protocol and server were to retrieve the current HTML page.  So, if this
link was found in an HTML document retrieved from <code><a href="index.html" class="bare">https://hypermedia.systems/</a></code>, then the implied URL for this anchor
would be <code><a href="book/contents" class="bare">https://hypermedia.systems/book/contents/</a></code>.</p>
</div>
</section>
<section class="sect3">
<h4 id="_hypermedia_protocols">Hypermedia Protocols</h4>
<div class="paragraph">
<p>The hypermedia control (link) above tells a browser: “When a user clicks on this text, issue a request to
<code><a href="book/contents" class="bare">https://hypermedia.systems/book/contents/</a></code> using the Hypertext Transfer Protocol,” or HTTP.</p>
</div>
<div class="paragraph">
<p>HTTP is the <em>protocol</em> used to transfer HTML (hypermedia) between browsers (hypermedia clients) and servers (hypermedia
servers) and, as such, is the key network technology that binds the distributed hypermedia system of the web together.</p>
</div>
<div class="paragraph">
<p>HTTP version 1.1 is a relatively simple network protocol, so lets take a look at what the <code>GET</code> request triggered by the anchor
tag would look like.  This is the request that would be sent to the server found at <code>hypermedia.systems</code>, on port <code>80</code>
by default:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-http" tabindex="0"><code class="language-http" data-lang="http">GET /book/contents/ HTTP/1.1
Accept: text/html,*/*
Host: hypermedia.systems</code></pre>
</div>
</figure>
<div class="paragraph">
<p>The first line specifies that this is an HTTP <code>GET</code> request.  It then specifies the path of the resource being
requested.  Finally, it contains the HTTP version for this request.</p>
</div>
<div class="paragraph">
<p>After that are a series of HTTP <em>request headers</em>: individual lines of name/value pairs separated by a colon. The request headers provide
<em>metadata</em> that can be used by the server to determine exactly how to respond to the client request.  In this case,
with the <code>Accept</code> header, the browser is saying it would prefer HTML as a response format, but will accept any server response.</p>
</div>
<div class="paragraph">
<p>Next, it has a <code>Host</code> header that specifies which server the request has been sent to. This is useful when multiple
domains are hosted on the same host.</p>
</div>
<div class="paragraph">
<p>An HTTP response from a server to this request might look something like this:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-http" tabindex="0"><code class="language-http" data-lang="http">HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 870
Server: Werkzeug/2.0.2 Python/3.8.10
Date: Sat, 23 Apr 2022 18:27:55 GMT

&lt;html lang="en"&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;h1&gt;HYPERMEDIA SYSTEMS&lt;/h1&gt;
  &lt;/header&gt;
  ...
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</figure>
<div class="paragraph">
<p>In the first line, the HTTP Response specifies the HTTP version being used, followed by a <em>response code</em> of <code>200</code>,
indicating that the given resource was found and that the request succeeded.  This is followed by a string, <code>OK</code> that
corresponds to the response code.  (The actual string doesn’t matter, it is the response code that tells the client
the result of a request, as we will discuss in more detail below.)</p>
</div>
<div class="paragraph">
<p>After the first line of the response, as with the HTTP Request, we see a series of <em>response headers</em> that provide
metadata to the client to assist in displaying the <em>representation</em> of the resource correctly.</p>
</div>
<div class="paragraph">
<p>Finally, we see some new HTML content.  This content is the HTML <em>representation</em> of the requested resource, in this
case a table of contents of a book.  The browser will use this HTML to replace the entire content in its display window,
showing the user this new page, and updating the address bar to reflect the new URL.</p>
</div>
<section class="sect4">
<h5 id="_http_methods">HTTP methods</h5>
<div class="paragraph">
<p>




</p>
</div>
<div class="paragraph">
<p>The anchor tag above issued an HTTP <code>GET</code>, where <code>GET</code> is the <em>method</em> of the request.  The particular method
being used in an HTTP request is perhaps the most important piece of information about it, after the actual resource that
the request is directed at.</p>
</div>
<div class="paragraph">
<p>There are many methods available in HTTP; the ones of most practical importance to developers are the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>GET</code></dt>
<dd>
<p>A GET request retrieves the representation of the specified resource. GET requests should not mutate data.</p>
</dd>
<dt class="hdlist1"><code>POST</code></dt>
<dd>
<p>A POST request submits data to the specified resource. This will often result in a mutation of state on the server.</p>
</dd>
<dt class="hdlist1"><code>PUT</code></dt>
<dd>
<p>A PUT request replaces the data of the specified resource. This results in a mutation of state on the server.</p>
</dd>
<dt class="hdlist1"><code>PATCH</code></dt>
<dd>
<p>A PATCH request replaces the data of the specified resource. This results in a mutation of state on the server.</p>
</dd>
<dt class="hdlist1"><code>DELETE</code></dt>
<dd>
<p>A DELETE request deletes the specified resource. This results in a mutation of state on the server.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>
These methods <em>roughly</em> line up with the “Create/Read/Update/Delete” or CRUD pattern found in many applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>POST</code> corresponds with Creating a resource.
</li>
<li>
<code>GET</code> corresponds with Reading a resource.
</li>
<li>
<code>PUT</code> and <code>PATCH</code> correspond with Updating a resource.
</li>
<li>
<code>DELETE</code> corresponds, well, with Deleting a resource.
</li>
</ul>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Put vs. Post</div>
<div class="paragraph">
<p>While HTTP Actions correspond roughly to CRUD, they are not the same. The technical specifications for these methods make
no such connection, and are often somewhat difficult to read.  Here, for example, is the documentation
on the distinction between a <code>POST</code> and a <code>PUT</code> from <a href="https://www.rfc-editor.org/rfc/rfc2616">RFC-2616</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The target resource in a POST request is intended to handle the enclosed representation according to the
resource’s own semantics, whereas the enclosed representation in a PUT request is defined as replacing the state of the
target resource.  Hence, the intent of PUT is idempotent and visible to intermediaries, even though the exact
effect is only known by the origin server.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— RFC-2616, 
<cite>https://www.rfc-editor.org/rfc/rfc2616#section-9.6</cite>
</div>
</div>
<div class="paragraph">
<p>In plain terms, a <code>POST</code> can be handled by a server pretty much however it likes, whereas a <code>PUT</code> should be handled
as a “replacement” of the resource, although the language, once again allows the server to do pretty much whatever it
would like within the constraint of being <a href="https://developer.mozilla.org/en-US/docs/Glossary/Idempotent"><em>idempotent</em></a>.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>In a properly structured HTML-based hypermedia system you would use an appropriate HTTP method for the operation a
particular hypermedia control performs. For example, if a hypermedia control such as a button <em>deletes</em> a resource,
ideally it should issue an HTTP <code>DELETE</code> request to do so.</p>
</div>
<div class="paragraph">
<p>A strange thing about HTML, though, is that the native hypermedia controls can only issue HTTP <code>GET</code> and <code>POST</code> requests.</p>
</div>
<div class="paragraph">
<p>Anchor tags always issue a <code>GET</code> request.</p>
</div>
<div class="paragraph">
<p>Forms can issue either a <code>GET</code> or <code>POST</code> using the <code>method</code> attribute.</p>
</div>
<div class="paragraph">
<p>Despite the fact that HTML — the world’s most popular hypermedia — has been designed alongside
HTTP (which is the Hypertext Transfer Protocol, after all!): if you wish to issue <code>PUT</code>, <code>PATCH</code> or <code>DELETE</code> requests
you currently <em>have to</em> resort to JavaScript to do so.  Since a <code>POST</code> can do almost anything, it ends up being used for
any mutation on the server, and <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code> are left aside in plain HTML-based
applications.</p>
</div>
<div class="paragraph">
<p>This is an obvious shortcoming of HTML as a hypermedia; it would be wonderful to see this fixed in the
HTML specification. For now, in Chapter 4, we’ll discuss ways to get around this.</p>
</div>
</section>
<section class="sect4">
<h5 id="_http_response_codes">HTTP response codes</h5>
<div class="paragraph">
<p>HTTP request methods allow a client to tell a server <em>what</em> to do to a given resource.  HTTP responses contain
<em>response codes</em>, which tell a client what the result of the request was.  HTTP response codes are numeric
values that are embedded in the HTTP response, as we saw above.</p>
</div>
<div class="paragraph">
<p>The most familiar response code for web developers is probably <code>404</code>, which stands for “Not Found.”  This
is the response code that is returned by web servers when a resource that does not exist is requested from them.</p>
</div>
<div class="paragraph">
<p>
HTTP breaks response codes up into various categories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>100</code>-<code>199</code></dt>
<dd>
<p>Informational responses that provide information about how the server is processing the response.</p>
</dd>
<dt class="hdlist1"><code>200</code>-<code>299</code></dt>
<dd>
<p>Successful responses indicating that the request succeeded.</p>
</dd>
<dt class="hdlist1"><code>300</code>-<code>399</code></dt>
<dd>
<p>Redirection responses indicating that the request should be sent to some other URL.</p>
</dd>
<dt class="hdlist1"><code>400</code>-<code>499</code></dt>
<dd>
<p>  Client error responses indicating that the client made some sort of bad request (e.g., asking for something that didn’t
exist in the case of <code>404</code> errors).</p>
</dd>
<dt class="hdlist1"><code>500</code>-<code>599</code></dt>
<dd>
<p>Server error responses indicating that the server encountered an error internally as it attempted to respond to the request.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Within each of these categories there are multiple response codes for specific situations.</p>
</div>
<div class="paragraph">
<p>Here are some of the more common or interesting ones:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>200 OK</code></dt>
<dd>
<p>The HTTP request succeeded.</p>
</dd>
<dt class="hdlist1"><code>301 Moved Permanently</code></dt>
<dd>
<p>The URL for the requested resource has moved to a new location permanently, and the new URL will be provided in
the <code>Location</code> response header.</p>
</dd>
<dt class="hdlist1"><code>302 Found</code></dt>
<dd>
<p>The URL for the requested resource has moved to a new location temporarily, and the new URL will be provided in
the <code>Location</code> response header.</p>
</dd>
<dt class="hdlist1"><code>303 See Other</code></dt>
<dd>
<p>The URL for the requested resource has moved to a new location, and the new URL will be provided in
the <code>Location</code> response header.  Additionally, this new URL should be retrieved with a <code>GET</code> request.</p>
</dd>
<dt class="hdlist1"><code>401 Unauthorized</code></dt>
<dd>
<p>The client is not yet authenticated (yes, authenticated, despite the name) and must be authenticated
to retrieve the given resource.</p>
</dd>
<dt class="hdlist1"><code>403 Forbidden</code></dt>
<dd>
<p>The client does not have access to this resource.</p>
</dd>
<dt class="hdlist1"><code>404 Not Found</code></dt>
<dd>
<p>The server cannot find the requested resource.</p>
</dd>
<dt class="hdlist1"><code>500 Internal Server Error</code></dt>
<dd>
<p>The server encountered an error when attempting to process the response.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There are some fairly subtle differences between HTTP response codes (and, to be honest, some ambiguities between them).
The difference between a <code>302</code> redirect and a <code>303</code> redirect, for example, is that the former will issue the request to the
new URL using the same HTTP method as the initial request, whereas the latter will always use a <code>GET</code>.  This is a small
but often crucial difference, as we will see later in the book.</p>
</div>
<div class="paragraph">
<p>A well crafted Hypermedia-Driven Application will take advantage of both HTTP methods and HTTP response codes to create
a sensible hypermedia API.  You do not want to build a Hypermedia-Driven Application that uses a <code>POST</code> method for all
requests and responds with <code>200 OK</code> for every response, for example.  (Some JSON Data APIs built on top of HTTP do exactly
this!)</p>
</div>
<div class="paragraph">
<p>When building a Hypermedia-Driven Application, you want, instead, to go “with the grain” of the web and use HTTP methods
and response codes as they were designed to be used.</p>
</div>
</section>
<section class="sect4">
<h5 id="_caching_http_responses">Caching HTTP responses</h5>
<div class="paragraph">
<p>
A constraint of REST (and, therefore, a feature of HTTP) is the notion of caching responses: a server can indicate to
a client (as well as intermediary HTTP servers) that a given response can be cached for future requests to the same
URL.</p>
</div>
<div class="paragraph">
<p>
The cache behavior of an HTTP response from a server can be indicated with the <code>Cache-Control</code> response header.  This
header can have a number of different values indicating the cacheability of a given response.  If, for example, the header
contains the value <code>max-age=60</code>, this indicates that a client may cache this response for 60 seconds, and need not issue
another HTTP request for that resource until that time limit has expired.</p>
</div>
<div class="paragraph">
<p>
Another important caching-related response header is <code>Vary</code>.  This response header can be used to indicate exactly what
headers in an HTTP Request form the unique identifier for a cached result.  This becomes important to allow the browser
to correctly cache content in situations where a particular header affects the form of the server response.</p>
</div>
<div class="paragraph">
<p>

A common pattern in htmx-powered applications, for example, is to use a custom header set by htmx, <code>HX-Request</code>, to
differentiate between “normal” web requests and requests submitted by htmx.  To properly cache the response to these
requests, the <code>HX-Request</code> request header must be indicated by the <code>Vary</code> response header.</p>
</div>
<div class="paragraph">
<p>A full discussion of caching HTTP responses is beyond the scope of this chapter; see
the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching">MDN Article on HTTP Caching</a> if you would like to know more
on the topic.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_hypermedia_servers">Hypermedia Servers</h4>
<div class="paragraph">
<p>Hypermedia servers are any server that can respond to an HTTP request with an HTTP response.  Because HTTP is so simple,
this means that nearly any programming language can be used to build a hypermedia server.  There are a vast number of
libraries available for building HTTP-based hypermedia servers in nearly every programming language imaginable.</p>
</div>
<div class="paragraph">
<p>This turns out to be one of the best aspects of adopting hypermedia as your primary technology for building a web application: it removes
the pressure to adopt JavaScript as a backend technology.  If you use a JavaScript-heavy Single Page Application-based
front end, and you use JSON Data APIs, you are going to feel significant pressure to deploy JavaScript on the back end as
well.</p>
</div>
<div class="paragraph">
<p>In this latter situation, you already have a ton of code written in JavaScript.  Why maintain two separate code bases in
two different languages? Why not create reusable domain logic on the client-side as well as the server-side?  Now that
JavaScript has excellent server-side technologies available like Node and Deno, why not just use a single language for
everything?</p>
</div>
<div class="paragraph">
<p>In contrast, building a Hypermedia-Driven Application gives you a lot more freedom in picking the back end technology you want
to use.  Your decision can be based on the domain of your application, what languages and server software you are familiar
with or are passionate about, or just what you feel like trying out.</p>
</div>
<div class="paragraph">
<p>You certainly aren’t writing your server-side logic in HTML!  And every major programming language has at least one good
web framework and templating library that can be used to handle HTTP requests cleanly.</p>
</div>
<div class="paragraph">
<p>If you are doing something in big data, perhaps you’d like to use Python, which has tremendous support for that
domain.</p>
</div>
<div class="paragraph">
<p>If you are doing AI work, perhaps you’d like to use Lisp, leaning on a language with a long history in that area of research.</p>
</div>
<div class="paragraph">
<p>Maybe you are a functional programming enthusiast and want to use OCaml or Haskell.  Perhaps you just really like Julia or Nim.</p>
</div>
<div class="paragraph">
<p>These are all perfectly valid reasons for choosing a particular server-side technology!</p>
</div>
<div class="paragraph">
<p>By using hypermedia as your system architecture, you are freed up to adopt any of these choices. There simply isn’t a
large JavaScript code base on the front end pressuring you to adopt JavaScript on the back end.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Hypermedia On Whatever you’d Like (HOWL)</div>
<div class="paragraph">
<p>In the htmx community we call this (with tongue in cheek) the HOWL stack: Hypermedia On Whatever you’d Like.  The htmx community
is multi-language and multi-framework, there are rubyists as well as pythonistas, lispers as well as haskellers.  There
are even JavaScript enthusiasts!  All these languages and frameworks are able to adopt hypermedia, and are able to still
share techniques and offer support to one another because they share a common underlying architecture: they are all using
the web as a hypermedia system.</p>
</div>
<div class="paragraph">
<p>Hypermedia, in this sense, provides a “universal language” for the web that we can all use.</p>
</div>
</div>
</aside>
</section>
<section class="sect3">
<h4 id="_hypermedia_clients">Hypermedia Clients</h4>
<div class="paragraph">
<p>
We now come to the final major component in a hypermedia system: the hypermedia client.  Hypermedia <em>clients</em> are software
that understand how to interpret a particular hypermedia, and the hypermedia controls within it, properly.  The canonical
example, of course, is the web browser, which understands HTML and can present it to a user to interact with. Web browsers
are incredibly sophisticated pieces of software.  (So sophisticated, in fact, that they are often re-purposed away from
being a hypermedia client, to being a sort of cross-platform virtual machine for launching Single Page Applications.)</p>
</div>
<div class="paragraph">
<p>Browsers aren’t the only hypermedia clients out there, however.  In the last section of this book we will look at
Hyperview, a mobile-oriented hypermedia.  One of the outstanding features of Hyperview is that it doesn’t simply provide
a hypermedia, HXML, but also provides a <em>working hypermedia client</em> for that hypermedia.  This makes building a proper
Hypermedia-Driven Application with Hyperview extremely easy.</p>
</div>
<div class="paragraph">
<p>A crucial feature of a hypermedia system is what is known as <em>the uniform interface</em>.  We discuss this concept in depth
in the next section on REST.  What is often ignored in discussions about hypermedia is how important the hypermedia
client is in taking advantage of this uniform interface.  A hypermedia client must know how to properly interpret and
present hypermedia controls found in a hypermedia response from a hypermedia server for the whole hypermedia system
to hang together.  Without a sophisticated client that can do this, hypermedia controls and a hypermedia-based API are
much less useful.</p>
</div>
<div class="paragraph">
<p>This is one reason why JSON APIs have rarely adopted hypermedia controls successfully: JSON APIs are typically consumed
by code that is expecting a fixed format and that isn’t designed to be a hypermedia client.  This is totally understandable:
building a good hypermedia client is hard!  For JSON API clients like this, the
power of hypermedia controls embedded within an API response is irrelevant and often simply annoying:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The short answer to this question is that HATEOAS isn’t a good fit for most modern use cases for APIs. That is why
after almost 20 years, HATEOAS still hasn’t gained wide adoption among developers. GraphQL on the other hand is spreading
like wildfire because it solves real-world problems.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Freddie Karlbom, 
<cite>https://techblog.commercetools.com/graphql-and-rest-level-3-hateoas-70904ff1f9cf</cite>
</div>
</div>
<div class="paragraph">
<p>HATEOAS will be described in more detail below, but the takeaway here is that a good hypermedia client is a necessary
component within a larger hypermedia system.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_rest">REST</h3>
<div class="paragraph">
<p>Now that we have reviewed the major components of a hypermedia system, it’s time to look more deeply into the concept of
REST.  The term “REST” comes from Roy Fielding’s PhD dissertation on the architecture
of the web.  Fielding wrote his dissertation at U.C. Irvine, after having helped build much of the infrastructure of the early
web, including the Apache web server.  Roy was attempting to formalize and describe the novel distributed computing system
that he had helped to build.</p>
</div>
<div class="paragraph">
<p>We are going to focus on what we feel is the most important section of Fielding’s writing, from a web development
perspective: Section 5.1. This section contains the core concepts (Fielding calls them <em>constraints</em>) of Representational
State Transfer, or REST.</p>
</div>
<div class="paragraph">
<p>Before we get into the muck, however, it is important to understand that Fielding discusses REST as a <em>network architecture</em>,
that is, as an entirely different way to architect a distributed system.  And, further, as a novel network
architecture that should be <em>contrasted</em> with earlier approaches to distributed systems.</p>
</div>
<div class="paragraph">
<p>It is also important to emphasize that, at the time Fielding wrote his dissertation, JSON APIs and AJAX did not exist.
He was describing the early web, with HTML being transferred over HTTP by early browsers, as a hypermedia system.</p>
</div>
<div class="paragraph">
<p>Today, in a strange turn of events, the term “REST” is mainly associated with JSON Data APIs, rather than with HTML
and hypermedia.  This is extremely funny once you realize that the vast majority of JSON Data APIs aren’t
RESTful, in the original sense, and, in fact, <em>can’t</em> be RESTful, since they aren’t using a natural hypermedia format.</p>
</div>
<div class="paragraph">
<p>To re-emphasize: REST, as coined by Fielding, describes <em>the pre-API web</em>, and letting go of the current, common
usage of the term REST to simply mean “a JSON API” is necessary to develop a proper understanding of the idea.</p>
</div>
<section class="sect3">
<h4 id="_the_constraints_of_rest">The “Constraints” of REST</h4>
<div class="paragraph">
<p>

In his dissertation, Fielding defines various “constraints” to describe how a RESTful system must behave.  This approach
can feel a little round-about and difficult to follow for many people, but it is an appropriate approach for an academic
document.  Given a bit of time thinking about the constraints he outlines and some concrete examples of those
constraints it will become easy to assess whether a given system actually satisfies the architectural requirements of
REST or not.</p>
</div>
<div class="paragraph">
<p>Here are the constraints of REST Fielding outlines:</p>
</div>
<div class="ulist">
<ul>
<li>
It is a client-server architecture (section 5.1.2).
</li>
<li>
It must be stateless; (section 5.1.3) that is, every request contains all information necessary to respond to that request.
</li>
<li>
It must allow for caching (section 5.1.4).
</li>
<li>
It must have a <em>uniform interface</em> (section 5.1.5).
</li>
<li>
It is a layered system (section 5.1.6).
</li>
<li>
Optionally, it can allow for Code-On-Demand (section 5.1.7), that is, scripting.
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s go through each of these constraints in turn and discuss them in detail, looking at how (and to what extent) the web
satisfies each of them.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_client_server_constraint">The Client-Server Constraint</h4>
<div class="paragraph">
<p>See <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_2">Section 5.1.2</a> for the
Client-Server constraint.</p>
</div>
<div class="paragraph">
<p>The REST model Fielding was describing involved both <em>clients</em> (browsers, in the case of the web) and <em>servers</em> (such
as the Apache Web Server he had been working on) communicating via a network connection.  This was the context of his
work: he was describing the network architecture of the World Wide Web, and contrasting it with earlier architectures,
notably thick-client networking models such as the Common Object Request Broker Architecture (CORBA).</p>
</div>
<div class="paragraph">
<p>It should be obvious that any web application, regardless of how it is designed, will satisfy this requirement.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_statelessness_constraint">The Statelessness Constraint</h4>
<div class="paragraph">
<p>See <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_3">Section 5.1.3</a> for the Stateless constraint.</p>
</div>
<div class="paragraph">
<p>As described by Fielding, a RESTful system is stateless: every request should encapsulate all information necessary to
respond to that request, with no side state or context stored on either the client or the server.</p>
</div>
<div class="paragraph">
<p>In practice, for many web applications today, we actually violate this constraint: it is common to establish a
<em>session cookie</em> that acts as a unique identifier for a given user and that is sent along with every request.  While this
session cookie is, by itself, not stateful (it is sent with every request), it is typically
used as a key to look up information stored on the server, in what is usually termed “the session.”</p>
</div>
<div class="paragraph">
<p>This session information is typically stored in some sort of shared storage across multiple web servers, holding things
like the current user’s email or id, their roles, partially created domain objects, caches, and so forth.</p>
</div>
<div class="paragraph">
<p>This violation of the Statelessness REST architectural constraint has proven to be useful for building web applications
and does not appear to have had a major impact on the overall flexibility of the web.  But it is worth bearing in mind that
even Web 1.0 applications often violate the purity of REST in the interest of pragmatic trade-offs.</p>
</div>
<div class="paragraph">
<p>And it must be said that sessions <em>do</em> cause additional operational complexity headaches when deploying hypermedia
servers; these may need shared access to session state information stored across an entire cluster.  So
Fielding was correct in pointing out that an ideal RESTful system, one that did not violate this constraint, would be simpler and therefore more robust.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_caching_constraint">The Caching Constraint</h4>
<div class="paragraph">
<p>See <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_4">Section 5.1.4</a> for the Caching constraint.</p>
</div>
<div class="paragraph">
<p>This constraint states that a RESTful system should support the notion of caching, with explicit information on the
cache-ability of responses for future requests of the same resource.  This allows both clients as well as intermediary
servers between a given client and final server to cache the results of a given request.</p>
</div>
<div class="paragraph">
<p>As we discussed earlier, HTTP has a sophisticated caching mechanism via response headers that is often overlooked or
underutilized when building hypermedia applications.  Given the existence of this functionality, however, it is
easy to see how this constraint is satisfied by the web.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_uniform_interface_constraint">The Uniform Interface Constraint</h4>
<div class="paragraph">
<p>Now we come to the most interesting and, in our opinion, most innovative constraint in REST: that of the <em>uniform interface</em>.</p>
</div>
<div class="paragraph">
<p>This constraint is the source of much of the <em>flexibility</em> and <em>simplicity</em> of a hypermedia system, so we are going to
spend some time on it.</p>
</div>
<div class="paragraph">
<p>See <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_5">Section 5.1.5</a> for the Uniform Interface
constraint.</p>
</div>
<div class="paragraph">
<p>In this section, Fielding says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The central feature that distinguishes the REST architectural style from other network-based styles is its emphasis on
a uniform interface between components…​ In order to obtain a uniform interface, multiple architectural constraints
are needed to guide the behavior of components. REST is defined by four interface constraints: identification of
resources; manipulation of resources through representations; self-descriptive messages; and, hypermedia as the engine
of application state</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite>Architectural Styles and the Design of Network-based Software Architectures</cite>
</div>
</div>
<div class="paragraph">
<p>So we have four sub-constraints that, taken together, form the Uniform Interface constraint.</p>
</div>
<section class="sect4">
<h5 id="_identification_of_resources">Identification of resources</h5>
<div class="paragraph">
<p>In a RESTful system, resources should have a unique identifier.  Today the concept of Universal Resource Locators (URLs) is
common, but at the time of Fielding’s writing they were still relatively new and novel.</p>
</div>
<div class="paragraph">
<p>What might be more interesting today is the notion of a <em>resource</em>, thus being identified: in a RESTful system, <em>any</em> sort of
data that can be referenced, that is, the target of a hypermedia reference, is considered a resource.  URLs, though common
enough today, end up solving the very complex problem of uniquely identifying any and every resource on the internet.</p>
</div>
</section>
<section class="sect4">
<h5 id="_manipulation_of_resources_through_representations">Manipulation of resources through representations</h5>
<div class="paragraph">
<p>In a RESTful system, <em>representations</em> of the resource are transferred between clients and servers.  These
representations can contain both data and metadata about the request (such as “control data” like an HTTP
method or response code).  A particular data format or <em>media type</em> may be used to present a given resource to a client,
and that media type can be negotiated between the client and the server.</p>
</div>
<div class="paragraph">
<p>We saw this latter aspect of the uniform interface in the <code>Accept</code> header in the requests above.</p>
</div>
</section>
<section class="sect4">
<h5 id="_self_descriptive_messages">Self-descriptive messages</h5>
<div class="paragraph">
<p>
The Self-Descriptive Messages constraint, combined with the next one, HATEOAS, form what we consider to be the core of
the Uniform Interface, of REST and why hypermedia provides such a powerful system architecture.</p>
</div>
<div class="paragraph">
<p>The Self-Descriptive Messages constraint requires that, in a RESTful system, messages must be <em>self-describing</em>.</p>
</div>
<div class="paragraph">
<p>This means that <em>all information</em> necessary to both display <em>and also operate</em> on the data being represented must be
present in the response.  In a properly RESTful system, there can be no additional “side” information necessary for a
client to transform a response from a server into a useful user interface.  Everything must “be in” the message itself,
in the form of hypermedia controls.</p>
</div>
<div class="paragraph">
<p>This might sound a little abstract so let’s look at a concrete example.</p>
</div>
<div class="paragraph">
<p>Consider two different potential responses from an HTTP server for the URL <code>https://example.com/contacts/42</code>.</p>
</div>
<div class="paragraph">
<p>Both responses will return information about a contact, but each response will take very different forms.</p>
</div>
<div class="paragraph">
<p>The first implementation returns an HTML representation:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Joe Smith<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Email: joe@example.bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Status: Active<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/42/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Archive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The second implementation returns a JSON representation:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{
  "name": "Joe Smith",
  "email": "joe@example.org",
  "status": "Active"
}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>What can we say about the differences between these two responses?</p>
</div>
<div class="paragraph">
<p>One thing that may initially jump out at you is that the JSON representation is smaller than the HTML
representation.  Fielding notes exactly this trade-off when using a RESTful architecture:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The trade-off, though, is that a uniform interface degrades efficiency, since information is transferred in a
standardized form rather than one which is specific to an application’s needs.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite>Architectural Styles and the Design of Network-based Software Architectures</cite>
</div>
</div>
<div class="paragraph">
<p>So REST <em>trades off</em> representational efficiency for other goals.</p>
</div>
<div class="paragraph">
<p>To understand these other goals, first notice that the HTML representation has a hyperlink in it to navigate to a page
to archive the contact.  The JSON representation, in contrast, does not have this link.</p>
</div>
<div class="paragraph">
<p>What are the ramifications of this fact for a <em>client</em> of the JSON API?</p>
</div>
<div class="paragraph">
<p>
What this means is that the JSON API client must know <em>in advance</em> exactly what other URLs (and request methods) are
available for working with the contact information.  If the JSON client is able to update this contact in some way, it
must know how to do so from some source of information <em>external</em> to the JSON message.  If the contact has a different
status, say “Archived”, does this change the allowable actions?  If so, what are the new allowable actions?</p>
</div>
<div class="paragraph">
<p>The source of all this information might be API documentation, word of mouth or, if the developer controls both the server
and the client, internal knowledge.  But this information is implicit and <em>outside</em> the response.</p>
</div>
<div class="paragraph">
<p>Contrast this with the hypermedia (HTML) response.  In this case, the hypermedia client (that is, the browser) needs
only to know how to render the given HTML.  It doesn’t need to understand what actions are available for this contact:
they are simply encoded <em>within</em> the HTML response itself as hypermedia controls.  It doesn’t need to understand what
the status field means.  In fact, the client doesn’t even know what a contact is!</p>
</div>
<div class="paragraph">
<p>The browser, our hypermedia client, simply renders the HTML and allows the user, who presumably understands the concept
of a Contact, to make a decision on what action to pursue from the actions made available in the representation.</p>
</div>
<div class="paragraph">
<p>This difference between the two responses demonstrates the crux of REST and hypermedia, what makes them so powerful
and flexible: clients (again, web browsers) don’t need to understand <em>anything</em> about the underlying resources being
represented.</p>
</div>
<div class="paragraph">
<p>Browsers only (only! As if it is easy!) need to understand how to interpret and display hypermedia, in this case HTML.  This
gives hypermedia-based systems unprecedented flexibility in dealing with changes to both the backing representations and
to the system itself.</p>
</div>
</section>
<section class="sect4">
<h5 id="_hypermedia_as_the_engine_of_application_state_hateoas">Hypermedia As The Engine of Application State (HATEOAS)</h5>
<div class="paragraph">
<p>
The final sub-constraint on the Uniform Interface is that, in a RESTful system, hypermedia should be “the engine of
application state.” This is sometimes abbreviated as “HATEOAS”, although Fielding prefers to use the terminology
“the hypermedia constraint” when discussing it.</p>
</div>
<div class="paragraph">
<p>This constraint is closely related to the previous self-describing message constraint.  Let us consider again the two different
implementations of the endpoint <code>/contacts/42</code>, one returning HTML and one returning JSON.  Let’s update the situation
such that the contact identified by this URL has now been archived.</p>
</div>
<div class="paragraph">
<p>What do our responses look like?</p>
</div>
<div class="paragraph">
<p>The first implementation returns the following HTML:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Joe Smith<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Email: joe@example.bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Status: Archived<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/42/unarchive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Unarchive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The second implementation returns the following JSON representation:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{
  "name": "Joe Smith",
  "email": "joe@example.org",
  "status": "Archived"
}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>The important point to notice here is that, by virtue of being a self-describing message, the HTML response now shows that
the “Archive” operation is no longer available, and a new “Unarchive” operation has become available.  The HTML representation
of the contact <em>encodes</em> the state of the application; it encodes exactly what can and cannot be done with this particular
representation, in a way that the JSON representation does not.</p>
</div>
<div class="paragraph">
<p>A client interpreting the JSON response must, again, understand not only the general concept of a Contact,
but also specifically what the “status” field with the value “Archived” means.  It must know exactly what operations
are available on an “Archived” contact, to appropriately display them to an end user.  The state of the application is
not encoded in the response, but rather conveyed through a mix of raw data and side channel information such as
API documentation.</p>
</div>
<div class="paragraph">
<p>Furthermore, in the majority of front end SPA frameworks today, this contact information would live <em>in memory</em> in a
JavaScript object representing a model of the contact, while the page data is held in the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">Document Object Model</a> (DOM).  The DOM would be updated based on changes to this model, that
is, the DOM would “react” to changes to this backing JavaScript model.</p>
</div>
<div class="paragraph">
<p>This approach is certainly <em>not</em> using Hypermedia As The Engine Of Application State: rather, it is using a JavaScript
model as the engine of application state, and synchronizing that model with a server and with the browser.</p>
</div>
<div class="paragraph">
<p>With the HTML approach, the Hypermedia is, indeed, The Engine Of Application State: there is no additional model on the
client side, and all state is expressed directly in the hypermedia, in this case HTML.  As state changes on the server,
it is reflected in the representation (that is, HTML) sent back to the client.  The hypermedia client (a browser) doesn’t know
anything about contacts, what the concept of “Archiving” is, or anything else about the particular domain model for this
response: it simply knows how to render HTML.</p>
</div>
<div class="paragraph">
<p>Because a hypermedia client doesn’t need to know anything about the server model beyond how to render hypermedia to
a client, it is incredibly flexible with respect to the representations it receives and displays to users.</p>
</div>
</section>
<section class="sect4">
<h5 id="_hateoas_api_churn">HATEOAS &amp; API churn</h5>
<div class="paragraph">
<p>This last point is critical to understanding the flexibility of hypermedia, so let’s look
at a practical example of it in action. Consider a situation where a new feature has been added to the web application with these
two end points.  This feature allows you to send a message to a given Contact.</p>
</div>
<div class="paragraph">
<p>How would this change each of the two responses—​HTML and JSON—​from the server?</p>
</div>
<div class="paragraph">
<p>The HTML representation might now look like this:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Joe Smith<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Email: joe@example.bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Status: Active<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/42/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Archive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/42/message<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Message<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The JSON representation, on the other hand, might look like this:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{
  "name": "Joe Smith",
  "email": "joe@example.org",
  "status": "Active"
}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>Note that, once again, the JSON representation is unchanged.  There is no indication of this new functionality.  Instead,
a client must <em>know</em> about this change, presumably via some shared documentation between the client and the server.</p>
</div>
<div class="paragraph">
<p>Contrast this with the HTML response.  Because of the uniform interface of the RESTful model and, in particular,
because we are using Hypermedia As The Engine of Application State, no such exchange of documentation is necessary!  Instead,
the client (a browser) simply renders the new HTML with this operation in it, making this operation available for the end user
without any additional coding changes.</p>
</div>
<div class="paragraph">
<p>A pretty neat trick!</p>
</div>
<div class="paragraph">
<p>Now, in this case, if the JSON client is not properly updated, the error state is relatively benign: a new bit of functionality
is simply not made available to users.  But consider a more severe change to the API: what if the archive functionality
was removed?  Or what if the URLs or the HTTP methods for these operations changed in some way?</p>
</div>
<div class="paragraph">
<p>In this case, the JSON client may be broken in a much more serious manner.</p>
</div>
<div class="paragraph">
<p>The HTML response, however, would simply be updated to exclude the removed options or to update the URLs used for them.  Clients
would see the new HTML, display it properly, and allow users to select whatever the new set of operations happens to be.  Once
again, the uniform interface of REST has proven to be extremely flexible: despite a potentially radically new layout
for our hypermedia API, clients continue to work.</p>
</div>
<div class="paragraph">
<p>An important fact emerges from this:  due to this flexibility, hypermedia APIs <em>do not have the versioning headaches
that JSON Data APIs do</em>.</p>
</div>
<div class="paragraph">
<p>Once a Hypermedia-Driven Application has been “entered into” (that is, loaded through some entry point URL), all functionality
and resources are surfaced through self-describing messages.  Therefore, there is no need to exchange documentation with
the client: the client simply renders the hypermedia (in this case HTML) and everything works out.  When a change occurs,
there is no need to create a new version of the API: clients simply retrieve updated hypermedia, which encodes the new
operations and resources in it, and display it to users to work with.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_layered_system">Layered System</h4>
<div class="paragraph">
<p>The final “required” constraint on a RESTful system that we will consider is The Layered System constraint.  This constraint can be found in <a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_6">Section 5.1.6</a> of Fielding’s dissertation.</p>
</div>
<div class="paragraph">
<p>To be frank, after the excitement of the uniform interface constraint, the “layered system” constraint is a bit of a
let down.  But it is still worth understanding and it is actually utilized effectively by The web.  The constraint
requires that a RESTful architecture be “layered,” allowing for multiple servers to act as intermediaries between
a client and the eventual “source of truth” server.</p>
</div>
<div class="paragraph">
<p>These intermediary servers can act as proxies, transform intermediate requests and responses and so forth.</p>
</div>
<div class="paragraph">
<p>A common modern example of this layering feature of REST is the use of Content Delivery Networks (CDNs) to deliver unchanging
static assets to clients more quickly, by storing the response from the origin server in intermediate servers more
closely located to the client making a request.</p>
</div>
<div class="paragraph">
<p>This allows content to be delivered more quickly to the end user and reduces load on the origin server.</p>
</div>
<div class="paragraph">
<p>Not as exciting for web application developers as the uniform interface, at least in our opinion, but useful
nonetheless.</p>
</div>
</section>
<section class="sect3">
<h4 id="_an_optional_constraint_code_on_demand">An Optional Constraint: Code-On-Demand</h4>
<div class="paragraph">
<p>We called The Layered System constraint the final “required” constraint because
Fielding mentions one additional constraint on a RESTful system. This Code On Demand constraint is somewhat awkwardly
described as “optional” (Section 5.1.7).</p>
</div>
<div class="paragraph">
<p>In this section, Fielding says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>REST allows client functionality to be extended by downloading and executing code in the form of applets or scripts. This
simplifies clients by reducing the number of features required to be pre-implemented. Allowing features to be downloaded
after deployment improves system extensibility. However, it also reduces visibility, and thus is only an optional constraint
within REST.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite>Architectural Styles and the Design of Network-based Software Architectures</cite>
</div>
</div>
<div class="paragraph">
<p>So, scripting was and is a native aspect of the original RESTful model of the web, and thus
should of course be allowed in a Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>However, in a Hypermedia-Driven Application the presence of scripting should <em>not</em> change the fundamental networking
model: hypermedia should continue to be the engine of application state, server communication should still consist of
hypermedia exchanges rather than, for example, JSON data exchanges, and so on. (JSON Data API’s certainly have their
place; in Chapter 10 we’ll discuss when and how to use them).</p>
</div>
<div class="paragraph">
<p>Today, unfortunately, the scripting layer of the web, JavaScript, is quite often used to <em>replace</em>, rather than augment
the hypermedia model.  We will elaborate in a later chapter what scripting that does not replace the underlying hypermedia
system of the web looks like.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>After this deep dive into the components and concepts behind hypermedia systems — including Roy Fielding’s insights into their operation — we hope you have much better understanding of REST,
and in particular, of the uniform interface and HATEOAS. We hope you can see <em>why</em> these characteristics make hypermedia
systems so flexible.</p>
</div>
<div class="paragraph">
<p>If you were not aware of the full significance of REST and HATEOAS before now, don’t feel bad: it took some of us over a decade of
working in web development, and building a hypermedia-oriented library to boot, to understand the
special nature of HTML, hypermedia and the web!</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_html5_soup">HTML Notes: HTML5 Soup</h3>
<div class="quoteblock">
<blockquote>
The beginning of wisdom is to call things by their right names.
</blockquote>
<div class="attribution margin-inline-start">
— Confucius
</div>
</div>
<div class="paragraph">
<p>Elements like <code>&lt;section&gt;</code>, <code>&lt;article&gt;</code>, <code>&lt;nav&gt;</code>, <code>&lt;header&gt;</code>, <code>&lt;footer&gt;</code>, <code>&lt;figure&gt;</code> have become a sort of shorthand for HTML.</p>
</div>
<div class="paragraph">
<p>By using these elements, a page can make false promises, like <code>&lt;article&gt;</code> elements being self-contained, reusable entities, to clients like browsers, search engines and scrapers that can’t know better. To avoid this:</p>
</div>
<div class="ulist">
<ul>
<li>
Make sure that the element you’re using fits your use case. Check the HTML spec.
</li>
<li>
Don’t try to be specific when you can’t or don’t need to.
Sometimes, <code>&lt;div&gt;</code> is fine.
</li>
</ul>
</div>
<div class="paragraph">
<p>
The most authoritative resource for learning about HTML is the HTML specification.
The current specification lives on <a href="https://html.spec.whatwg.org/multipage" class="bare">https://html.spec.whatwg.org/multipage</a>.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="hypermedia-systems#_footnotedef_1" title="View footnote.">1</a>]</sup>
There’s no need to rely on hearsay to keep up with developments in HTML.</p>
</div>
<div class="paragraph">
<p>Section 4 of the spec features a list of all available elements,
including what they represent, where they can occur, and what they are allowed to contain.
It even tells you when you’re allowed to leave out closing tags!</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_a_web_1_0_application">A Web 1.0 Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start our journey into Hypermedia-Driven Applications, we are going to create a simple contact management web
application called Contact.app.  We will start with a basic, “Web 1.0-style” Multi-Page Application (MPA), in the grand
CRUD (Create, Read, Update, Delete) tradition.  It will not be the best contact management application in the world, but
it will be simple and it will do its job.</p>
</div>
<div class="paragraph">
<p>This application will also be easy to incrementally improve in the coming chapters by utilizing the hypermedia-oriented
library htmx.</p>
</div>
<div class="paragraph">
<p>By the time we are finished building and enhancing the application, over the next few chapters, it will have some very
slick features that most developers today would assume requires the use of a SPA JavaScript framework.</p>
</div>
<section class="sect2">
<h3 id="_picking_a_web_stack">Picking A “Web Stack”</h3>
<div class="paragraph">
<p>In order to demonstrate how web 1.0 applications work, we need to pick a server-side language and a library for
handling HTTP requests.  Colloquially, this is called our “Server-Side” or “Web” stack, and there are literally hundreds
of options to choose from, many with passionate followings.  You probably have a web framework that you prefer and, while
we wish we could write this book for every possible stack out there, in the interest of simplicity (and sanity) we can only pick one.</p>
</div>
<div class="paragraph">
<p>For this book we are going to use the following stack:</p>
</div>
<div class="ulist">
<ul>
<li>
<a href="https://www.python.org/">Python</a> as our programming language.
</li>
<li>
<a href="https://palletsprojects.com/p/flask/">Flask</a> as our web framework, allowing us to connect HTTP requests to Python logic.
</li>
<li>
<a href="https://palletsprojects.com/p/jinja/">Jinja2</a> for our server-side templating language, allowing us to render HTML responses using a familiar
and intuitive syntax.
</li>
</ul>
</div>
<div class="paragraph">
<p>Why this particular stack?</p>
</div>
<div class="paragraph">
<p>Python is the most popular programming language in the world, as of this writing, according to the
<a href="https://www.tiobe.com/tiobe-index/">TIOBE index</a>, a respected measure of programming language popularity.
More importantly, Python is easy to read even if you aren’t familiar with it.</p>
</div>
<div class="paragraph">
<p>We chose the Flask web framework because it is simple and does not impose a lot of structure on top of the
basics of HTTP request handling.</p>
</div>
<div class="paragraph">
<p>This bare-bones approach is a good match for our needs: in other cases you might consider a more full-featured Python
framework, such as <a href="https://www.djangoproject.com/">Django</a>, which supplies much more functionality out of the box than
Flask does.</p>
</div>
<div class="paragraph">
<p>By using Flask for our book, we will be able to keep our code focused on <em>hypermedia exchanges</em>.</p>
</div>
<div class="paragraph">
<p>We picked Jinja2 templates because they are the default templating language for Flask.  They are simple enough and
similar enough to most other server-side templating languages that most people who are familiar with any server-side
(or client-side) templating library should be able to understand them quickly and easily.</p>
</div>
<div class="paragraph">
<p>Even if this combination of technologies isn’t your preferred stack, please, keep reading: you will learn quite a bit from
the patterns we introduce in the coming chapters and it shouldn’t be hard to map them into your preferred language and
frameworks.</p>
</div>
<div class="paragraph">
<p>With this stack we will be rendering HTML <em>on the server-side</em> to return to clients, rather than producing JSON.  This
is the traditional approach to building web applications.  However, with the rise of SPAs, this approach is not as
widely used a technique as it once was.  Today, as people are rediscovering this style of web applications, the term
“Server-Side Rendering” or SSR is emerging as the way that people talk about it.  This contrasts with
“Client-Side Rendering”, that is, rendering templates in the browser with data retrieved in JSON form from the server,
as is common in SPA libraries.</p>
</div>
<div class="paragraph">
<p>In Contact.app we will intentionally keep things as simple as possible to maximize the teaching value of our code: it
won’t be perfectly factored code, but it will be easy to follow for readers, even if they have little Python experience,
and it should be easy to translate both the application and the techniques demonstrated into your preferred programming
environment.</p>
</div>
</section>
<section class="sect2">
<h3 id="_python">Python</h3>
<div class="paragraph">
<p>Since this book is for learning how to use hypermedia effectively, we’ll just briefly introduce
the various technologies we use <em>around</em> that hypermedia.  This has some obvious drawbacks: if you aren’t comfortable
with Python, for example, some example Python code in the book may be a bit confusing or mysterious at first.</p>
</div>
<div class="paragraph">
<p>If you feel like you need a quick introduction to the language before diving into the code, we recommend the following
books and websites:</p>
</div>
<div class="ulist">
<ul>
<li>
<a href="https://nostarch.com/python-crash-course-3rd-edition">Python Crash Course</a> from No Starch Press
</li>
<li>
<a href="https://learnpythonthehardway.org/python3/">Learn Python The Hard Way</a> by Zed Shaw
</li>
<li>
<a href="https://www.py4e.com/">Python For Everybody</a> by Dr. Charles R. Severance
</li>
</ul>
</div>
<div class="paragraph">
<p>We think most web developers, even developers who are unfamiliar with Python, should be able to follow
along with our examples. Most of the authors of this book hadn’t written much Python before writing it, and we got the
hang of it pretty quickly.</p>
</div>
</section>
<section class="sect2">
<h3 id="_introducing_flask_our_first_route">Introducing Flask: Our First Route</h3>
<div class="paragraph">
<p>
Flask is a simple but flexible web framework for Python. We’ll ease into it by touching on its core elements.</p>
</div>
<div class="paragraph">
<p>


A Flask application consists of a series of <em>routes</em> tied to functions that execute when an HTTP request to a given path is
made.  It uses a Python feature called “decorators” to declare the route that will be handled, which is then followed by
a function to handle requests to that route.  We’ll use the term “handler” to refer to the functions associated
with a route.</p>
</div>
<div class="paragraph">
<p>Let’s create our first route definition, a simple “Hello World” route.  In the following Python code you will see the
<code>@app</code> symbol.  This is the flask decorator that allows us to set up our routes.  Don’t worry too much about
how decorators work in Python, just know that this feature allows us to map a given <em>path</em> to a particular function
(i.e., handler).  The Flask application, when started, will take HTTP requests and look up the matching handler and
invoke it.</p>
</div>
<figure class="listingblock">
<figcaption class="title">A simple “Hello World” route</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/") (1)
def index(): (2)
    return "Hello World!" (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Establishes we are mapping the <code>/</code> path as a route.
</li>
<li>
The next method is the handler for that route.
</li>
<li>
Returns the string “Hello World!” to the client.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The <code>route()</code> method on the Flask decorator takes an argument: the path you wish the route to handle.  Here we
pass in the root or <code>/</code> path, as a string, to handle requests to the root path.</p>
</div>
<div class="paragraph">
<p>This route declaration is then followed by a simple function definition, <code>index()</code>.  In Python, decorators invoked in
this manner apply to the function immediately following them.  Therefore, this function becomes the “handler” for that
route, and will be executed when an HTTP request to the given path is made.</p>
</div>
<div class="paragraph">
<p>Note that the name of the function doesn’t matter, we can call it whatever we’d like so long as it is unique.  In this
case we chose <code>index()</code> because that fits with the route we are handling: the root “index” of the web
application.</p>
</div>
<div class="paragraph">
<p>So we have the <code>index()</code> function immediately following our route definition for the root, and this will become the
handler for the root URL in our web application.</p>
</div>
<div class="paragraph">
<p>The handler in this case is dead simple, it just returns a string, “Hello World!”, to the client.  This isn’t
hypermedia yet, but a browser will render it just fine:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/figure_2-1_hello_world.png" alt="Browser window" width="large text: Hello World!" loading="lazy">
</div>
<figcaption class="title">Figure 3. Hello World!</figcaption>
</figure>
<div class="paragraph">
<p>Great, there’s our first step into Flask, showing the core technique we are going to use to respond to HTTP requests:
routes mapped to handlers.</p>
</div>
<div class="paragraph">
<p>For Contact.app, rather than rendering “Hello World!” at the root path, we are going to do something a little fancy:
we are going to redirect to another path, the <code>/contacts</code> path.  Redirects are a feature of HTTP that allow you to
redirect a client to another location with an HTTP response.</p>
</div>
<div class="paragraph">
<p>
We are going to display a list of contacts as our root page, and, arguably, redirecting to the <code>/contacts</code> path to
display this information is a bit more consistent with the notion of resources with REST.  This is a judgement call on our
part, and not something we feel is too important, but it makes sense in terms of routes we will set up later in the
application.</p>
</div>
<div class="paragraph">
<p>To change our “Hello World” route to a redirect, we only need to change one line of code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Changing “Hello World” to a redirect</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/")
def index():
    return redirect("/contacts") (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Update to a call to <code>redirect()</code>
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now the <code>index()</code> function returns the result of the Flask-supplied <code>redirect()</code> function with the path
we’ve supplied. In this case the path is <code>/contacts</code>, passed in as a string argument.
Now, if you navigate to the root path, <code>/</code>, our Flask application will forward you on to the <code>/contacts</code> path.</p>
</div>
</section>
<section class="sect2">
<h3 id="_contact_app_functionality">Contact.app Functionality</h3>
<div class="paragraph">
<p>
Now that we have some understanding of how to define routes, let’s get down to specifying and then implementing
our web application.</p>
</div>
<div class="paragraph">
<p>What will Contact.app do?</p>
</div>
<div class="paragraph">
<p>Initially, it will allow users to:</p>
</div>
<div class="ulist">
<ul>
<li>
View a list of contacts, including first name, last name, phone and email address
</li>
<li>
Search the contacts
</li>
<li>
Add a new contact
</li>
<li>
View the details of a contact
</li>
<li>
Edit the details of a contact
</li>
<li>
Delete a contact
</li>
</ul>
</div>
<div class="paragraph">
<p>
So, as you can see, Contact.app is a CRUD application, the sort of application that is perfect for an old-school
web 1.0 approach.</p>
</div>
<div class="paragraph">
<p>Note that the source code of Contact.app is available on <a href="https://github.com/bigskysoftware/contact-app">GitHub</a>.</p>
</div>
<section class="sect3">
<h4 id="_showing_a_searchable_list_of_contacts">Showing A Searchable List Of Contacts</h4>
<div class="paragraph">
<p>Let’s add our first real bit of functionality: the ability to show all the contacts in our app in a list (really,
in a table).</p>
</div>
<div class="paragraph">
<p>This functionality is going to be found at the <code>/contacts</code> path, which is the path our previous route is redirecting to.</p>
</div>
<div class="paragraph">
<p>We will use Flask to route the <code>/contacts</code> path to a handler function, <code>contacts()</code>. This function will do one of
two things:</p>
</div>
<div class="ulist">
<ul>
<li>
If there is a search term found in the request, it will filter down to only contacts matching that term
</li>
<li>
If not, it will simply list all contacts
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a common approach in web 1.0 style applications: the same URL that displays all instances of some resource
also serves as the search results page for those resources.  Taking this approach makes it easy to reuse the list
display that is common to both types of request.</p>
</div>
<div class="paragraph">
<p>Here is what the code looks like for this handler:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A handler for server-side search</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q") (1)
    if search is not None:
        contacts_set = Contact.search(search) (2)
    else:
        contacts_set = Contact.all() (3)
    return render_template("index.html", contacts=contacts_set) (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Look for the query parameter named <code>q</code>, which stands for “query.”
</li>
<li>
If the parameter exists, call the <code>Contact.search()</code> function with it.
</li>
<li>
If not, call the <code>Contact.all()</code> function.
</li>
<li>
Pass the result to the <code>index.html</code> template to render to the client.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
We see the same sort of routing code we saw in our first example, but we have a more elaborate handler function.
First, we check to see if a search query parameter named <code>q</code> is part of the request.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Query Strings</dt>
<dd>
<p>A <dfn class="dfn">“query string”</dfn> is  part of the URL specification.  Here is an example URL with a query string in it:
<code><a href="https://example.com/contacts?q=joe" class="bare">https://example.com/contacts?q=joe</a></code>.  The query string is everything after the <code>?</code>, and has a
name-value pair format.  In this URL, the query parameter <code>q</code> is set to the string value <code>joe</code>.  In plain HTML, a
query string can be included in a request either by being hardcoded in an anchor tag or, more dynamically, by
using a form tag with a <code>GET</code> request.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To return to our Flask route, if a query parameter named <code>q</code> is found, we call out to the <code>search()</code> method on a
<code>Contact</code> model object to do the actual contact search and return all the matching contacts.</p>
</div>
<div class="paragraph">
<p>If the query parameter is <em>not</em> found, we simply get all contacts by invoking the <code>all()</code> method on the <code>Contact</code> object.</p>
</div>
<div class="paragraph">
<p>Finally, we render a template, <code>index.html</code> that displays the given contacts, passing in the results of whichever
of these two functions we end up calling.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">A Note On The Contact Class</div>
<div class="paragraph">
<p>The <code>Contact</code> Python class we’re using is the “domain
model” or just “model” class for our application, providing the “business logic” around the management of Contacts.</p>
</div>
<div class="paragraph">
<p>
It could be working with a database (it isn’t) or a simple flat file (it is), but we’re going to skip over the internal details of the model. Think of it as a “normal” domain model class, with methods on it that act in a “normal” manner.</p>
</div>
<div class="paragraph">
<p>We will treat <code>Contact</code> as a <em>resource</em>, and focus on how to effectively provide hypermedia representations
of that resource to clients.</p>
</div>
</div>
</aside>
<section class="sect4">
<h5 id="_the_list_search_templates">The list &amp; search templates</h5>
<div class="paragraph">
<p>Now that we have our handler logic written, we’ll create a template to render
HTML in our response to the client.  At a high level, our HTML response needs to have the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
A list of any matching or all contacts.
</li>
<li>
A search box where a user may type and submit search terms.
</li>
<li>
A bit of surrounding “chrome”: a header and footer for the website that will be the same regardless of the page you
are on.
</li>
</ul>
</div>
<div class="paragraph">
<p>

We are using the Jinja2 templating language, which has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
We can use double-curly braces, <code>{{ }}</code>,  to embed expression values in the template.
</li>
<li>
we can use curly-percents, <code>{% %}</code>, for directives, like iteration or including other content.
</li>
</ul>
</div>
<div class="paragraph">
<p>Beyond this basic syntax, Jinja2 is very similar to other templating languages used to generate content, and should
be easy to follow for most web developers.</p>
</div>
<div class="paragraph">
<p>Let’s look at the first few lines of code in the <code>index.html</code> template:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Start of index.html</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">{% extends 'layout.html' %} (1)

{% block content %} (2)

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  (3)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Term<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (4)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Set the layout template for this template.
</li>
<li>
Delimit the content to be inserted into the layout.
</li>
<li>
Create a search form that will issue an HTTP <code>GET</code> to <code>/contacts</code>.
</li>
<li>
Create an input for a user to type search queries.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The first line of code references a base template, <code>layout.html</code>, with the <code>extends</code> directive.  This layout
template provides the layout for the page (again, sometimes called “the chrome”): it wraps the template content in an
<code>&lt;html&gt;</code> tag, imports any necessary CSS and JavaScript in a <code>&lt;head&gt;</code> element, places a <code>&lt;body&gt;</code> tag around the main
content and so forth.  All the common content wrapped around the “normal” content for the entire application
is located in this file.</p>
</div>
<div class="paragraph">
<p>The next line of code declares the <code>content</code> section of this template.  This content block is used by the <code>layout.html</code>
template to inject the content of <code>index.html</code> within its HTML.</p>
</div>
<div class="paragraph">
<p>Next we have our first bit of actual HTML, rather than just Jinja directives.  We have a simple HTML form that allows
you to search contacts by issuing a <code>GET</code> request to the <code>/contacts</code> path.  The form itself contains a label and
an input with the name “q.” This input’s value will be submitted with the <code>GET</code> request to the <code>/contacts</code> path,
as a query string (since this is a <code>GET</code> request.)</p>
</div>
<div class="paragraph">
<p>Note that the value of this input is set to the Jinja expression <code>{{ request.args.get('q') or '' }}</code>.  This expression
is evaluated by Jinja and will insert the request value of “q” as the input’s value, if it exists.  This will “preserve”
the search value when a user does a search, so that when the results of a search are rendered the text input contains
the term that was searched for.  This makes for a better user experience since the user can see exactly what the
current results match, rather than having a blank text box at the top of the screen.</p>
</div>
<div class="paragraph">
<p>Finally, we have a submit-type input.  This will render as a button and, when it is clicked, it will trigger the
form to issue an HTTP request.</p>
</div>
<div class="paragraph">
<p>
This search interface forms the top of our contact page.  Following it is a table of contacts, either all contacts or the
contacts that match the search, if a search was done.</p>
</div>
<div class="paragraph">
<p>Here is what the template code for the contact table looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The contacts table</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>First<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Last<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>(1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        {% for contact in contacts %} (2)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.phone }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> (3)
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> (4)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Output some headers for our table.
</li>
<li>
Iterate over the contacts that were passed in to the template.
</li>
<li>
Output the values of the current contact, first name, last name, etc.
</li>
<li>
An "operations" column, with links to edit or view the contact details.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This is the core of the page: we construct a table with appropriate headers matching the data we are going
to show for each contact.  We iterate over the contacts that were passed into the template by the handler method using
the <code>for</code> loop directive in Jinja2.  We then construct a series of rows, one for each contact, where we render the
first and last name, phone and email of the contact as table cells in the row.</p>
</div>
<div class="paragraph">
<p>Additionally, we have a table cell that includes two links:</p>
</div>
<div class="ulist">
<ul>
<li>
A link to the "Edit" page for the contact, located at <code>/contacts/{{ contact.id }}/edit</code> (e.g., For the contact with
id 42, the edit link will point to <code>/contacts/42/edit</code>)
</li>
<li>
A link to the "View" page for the contact <code>/contacts/{{ contact.id }}</code> (using our previous contact example, the view
page would be at <code>/contacts/42</code>)
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, we have a bit of end-matter: a link to add a new contact and a Jinja2 directive to end the <code>content</code> block:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “add contact” link</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/new<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Add Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

{% endblock %} (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Link to the page that allows you to create a new contact.
</li>
<li>
The closing element of the <code>content</code> block.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And that’s our complete template.  Using this simple server-side template, in combination with our handler method, we
can respond with an HTML <em>representation</em> of all the contacts requested.  So far, so hypermedia.</p>
</div>
<div class="paragraph">
<p>Here is what the template looks like, rendered with a bit of contact information:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/figure_2-2_table_etc.png" alt="Table showing info of 3 contacts with a title and a search bar above and an Add Contact link below" loading="lazy">
</div>
<figcaption class="title">Figure 4. Contact.app</figcaption>
</figure>
<div class="paragraph">
<p>Now, our application won’t win any design awards at this point, but notice that our template, when rendered,
provides all the functionality necessary to see all the contacts and search them, and also provides links to edit them,
view details of them or even create a new one.</p>
</div>
<div class="paragraph">
<p>And it does all this without the client (that is, the browser) knowing a thing about what contacts are or how to
work with them.  Everything is encoded <em>in</em> the hypermedia.  A web browser accessing this application just knows how to
issue HTTP requests and then render HTML, nothing more about the specifics of our applications end points or underlying
domain model.</p>
</div>
<div class="paragraph">
<p>As simple as our application is at this point, it is thoroughly RESTful.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_adding_a_new_contact">Adding A New Contact</h4>
<div class="paragraph">
<p>The next bit of functionality that we will add to our application is the ability to add new contacts.  To do this, we
are going to need to handle that <code>/contacts/new</code> URL referenced in the “Add Contact” link above.  Note that when a user
clicks on that link, the browser will issue a <code>GET</code> request to the <code>/contacts/new</code> URL.</p>
</div>
<div class="paragraph">
<p>All the other routes we have so far use <code>GET</code> as well, but we are actually going to use two
different HTTP methods for this bit of functionality: an HTTP <code>GET</code> to render a form for adding a new contact,
and then an HTTP <code>POST</code> <em>to the same path</em> to actually create the contact, so we are going to be explicit about the
HTTP method we want to handle when we declare this route.</p>
</div>
<div class="paragraph">
<p>Here is the code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “new contact” GET route</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/new", methods=['GET']) (1)
def contacts_new_get():
    return render_template("new.html", contact=Contact()) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Declare a route, explicitly handling <code>GET</code> requests to this path.
</li>
<li>
Render the <code>new.html</code> template, passing in a new contact object.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Simple enough. We just render a <code>new.html</code> template with a new Contact.  (<code>Contact()</code> is how you construct a new instance
of the <code>Contact</code> class in Python, if you aren’t familiar with it.)</p>
</div>
<div class="paragraph">
<p>While the handler code for this route is very simple, the <code>new.html</code> template is more complicated.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>For the remaining templates we are going to omit the layout directive and the content block declaration, but you
can assume they are the same unless we say otherwise.  This will let us focus on the "meat" of the template.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>If you are familiar with HTML you are probably expecting a form element here, and you will not be disappointed.  We are
going to use the standard form hypermedia control for collecting contact information and submitting it to the server.</p>
</div>
<div class="paragraph">
<p>Here is what our HTML looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “new contact” form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/new<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">&gt;</span></span>Contact Values<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span> (2)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> (4)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A form that submits to the <code>/contacts/new</code> path, using an HTTP <code>POST</code>.
</li>
<li>
A label for the first form input.
</li>
<li>
The first form input, of type email.
</li>
<li>
Any error messages associated with this field.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In the first line of code we create a form that will submit back <em>to the same path</em> that we are handling: <code>/contacts/new</code>.
Rather than issuing an HTTP <code>GET</code> to this path, however, we will issue an HTTP <code>POST</code> to it.  Using a <code>POST</code> in this manner
will signal to the server that we want to create a new Contact, rather than get a form for creating one.</p>
</div>
<div class="paragraph">
<p>We then have a label (always a good practice!) and an input that captures the email of
the contact being created.  The name of the input is <code>email</code> and, when this form is submitted, the value of this input
will be submitted in the <code>POST</code> request, associated with the <code>email</code> key.</p>
</div>
<div class="paragraph">
<p>Next we have inputs for the other fields for contacts:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Inputs and labels for the “new contact” form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>First Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First Name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.first or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['first'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Last Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Last Name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.last or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['last'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Phone<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.phone or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['phone'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Finally, we have a button that will submit the form, the end of the form tag, and a link back to the main contacts table:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The submit button for the “new contact” form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>It is easy to miss in this straight-forward example: we are seeing the flexibility of hypermedia in action.</p>
</div>
<div class="paragraph">
<p>If we add a new field, remove a field, or change the logic around how fields are validated or work with one another,
this new state of affairs would be reflected in the new hypermedia representation given to users.  A user would see the
updated new form and be able to work with these new features, with no software update required.</p>
</div>
<section class="sect4">
<h5 id="_handling_the_post_to_contactsnew">Handling the post to /contacts/new</h5>
<div class="paragraph">
<p>The next step in our application is to handle the <code>POST</code> that this form makes to <code>/contacts/new</code>.</p>
</div>
<div class="paragraph">
<p>To do so, we need to add another route to our application that handles the <code>/contacts/new</code> path. The new route will handle an HTTP <code>POST</code> method instead of an HTTP <code>GET</code>.  We will use the submitted form values to attempt to
create a new Contact.</p>
</div>
<div class="paragraph">
<p>If we are successful in creating a Contact, we will redirect the user to the list of contacts and show a success message.
If we aren’t successful, then we will render the new contact form again with whatever values the user entered and
render error messages about what issues need to be fixed so that the user can correct them.</p>
</div>
<div class="paragraph">
<p>Here is our new request handler:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “new contact” controller code</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/new", methods=['POST'])
def contacts_new():
    c = Contact(None, request.form['first_name'], request.form['last_name'], request.form['phone'],
                request.form['email']) (1)
    if c.save(): (2)
        flash("Created New Contact!")
        return redirect("/contacts") (3)
    else:
        return render_template("new.html", contact=c) (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We construct a new contact object with the values from the form.
</li>
<li>
We try to save it.
</li>
<li>
On success, “flash” a success message &amp; redirect to the <code>/contacts</code> page.
</li>
<li>
On failure, re-render the form, showing any errors to the user.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The logic in this handler is a bit more complex than other methods we have seen.  The first thing
we do is create a new Contact, again using the <code>Contact()</code> syntax in Python to construct the object.  We pass in the values
that the user submitted in the form by using the <code>request.form</code> object, a feature provided by Flask.</p>
</div>
<div class="paragraph">
<p>This <code>request.form</code> allows us to access submitted form values in an easy and convenient way, by simply passing in the same
name associated with the various inputs.</p>
</div>
<div class="paragraph">
<p>We also pass in <code>None</code> as the first value to the <code>Contact</code> constructor.  This is the “id” parameter, and by passing in
<code>None</code> we are signaling that it is a new contact, and needs to have an ID generated for it.    (Again, we are not
going into the details of how this model object is implemented, our only concern is using it to generate
hypermedia responses.)</p>
</div>
<div class="paragraph">
<p>Next, we call the <code>save()</code> method on the Contact object.  This method returns <code>true</code> if the save is successful, and <code>false</code> if
the save is unsuccessful (for example, a bad email was submitted by the user).</p>
</div>
<div class="paragraph">
<p>If we are able to save the contact (that is, there were no validation errors), we create a <em>flash</em> message indicating
success, and redirect the browser back to the list page.  A “flash” is a common feature in web frameworks that allows
you to store a message that will be available on the <em>next</em> request, typically in a cookie or in a session store.</p>
</div>
<div class="paragraph">
<p>Finally, if we are unable to save the contact, we re-render the <code>new.html</code> template with the contact.  This will show the
same template as above, but the inputs will be filled in with the submitted values, and any errors associated with the
fields will be rendered to feedback to the user as to what validation failed.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">The Post/Redirect/Get Pattern</div>
<div class="paragraph">
<p>
This handler implements a common strategy in web 1.0-style development called the
<a href="https://en.wikipedia.org/wiki/Post/Redirect/Get">Post/Redirect/Get</a> or PRG pattern.  By issuing an HTTP redirect once
a contact has been created and forwarding the browser on to another location, we ensure that the <code>POST</code> does not
end up in the browsers request cache.</p>
</div>
<div class="paragraph">
<p>This means that if the user accidentally (or intentionally) refreshes the page, the browser will not submit another <code>POST</code>,
potentially creating another contact.  Instead, it will issue the <code>GET</code> that we redirect to, which should be side-effect
free.</p>
</div>
<div class="paragraph">
<p>We will use the PRG pattern in a few different places in this book.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>OK, so we have our server-side logic set up to save contacts.  And, believe it or not, this is about as complicated as
our handler logic will get, even when we look at adding more sophisticated htmx-driven behaviors.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_viewing_the_details_of_a_contact">Viewing The Details Of A Contact</h4>
<div class="paragraph">
<p>The next piece of functionality we will implement is the detail page for a Contact.  The user will navigate to this
page by clicking the “View” link in one of the rows in the list of contacts.  This will take them to the path
<code>/contact/&lt;contact id&gt;</code> (e.g., <code>/contacts/42</code>).</p>
</div>
<div class="paragraph">
<p>This is a common pattern in web development: contacts are treated as resources and the URLs around these
resources are organized in a coherent manner.</p>
</div>
<div class="ulist">
<ul>
<li>
If you wish to view all contacts, you issue a <code>GET</code> to <code>/contacts</code>.
</li>
<li>
If you want a hypermedia representation allowing you to create a new contact, you issue a <code>GET</code> to <code>/contacts/new</code>.
</li>
<li>
If you wish to view a specific contact (with, say, an id of <code>42), you issue a `GET</code> to <code>/contacts/42</code>.
</li>
</ul>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">The Eternal Bike Shed of URL Design</div>
<div class="paragraph">
<p>It is easy to quibble about the particulars of the path scheme you use for your application:</p>
</div>
<div class="paragraph">
<p>“Should we <code>POST</code> to <code>/contacts/new</code> or to <code>/contacts</code>?”</p>
</div>
<div class="paragraph">
<p>We have seen many arguments online and in person advocating for one approach versus another.  We feel it is more
important to understand the overarching idea of <em>resources</em> and <em>hypermedia representations</em>, rather than
getting worked up about the smaller details of your URL design.</p>
</div>
<div class="paragraph">
<p>We recommend you just pick a reasonable, resource-oriented URL layout you like and then stay consistent.  Remember,
in a hypermedia system, you can always change your endpoints later, because you are using hypermedia as the engine
of application state!</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>Our handler logic for the detail route is going to be <em>very</em> simple: we just look the Contact up by id, which is embedded in
the path of the URL for the route.  To extract this ID we are going to need to introduce a final bit of Flask
functionality: the ability to call out pieces of a path and have them automatically extracted and passed in to a
handler function.</p>
</div>
<div class="paragraph">
<p>Here is what the code looks like, just a few lines of simple Python:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;") (1)
def contacts_view(contact_id=0): (2)
    contact = Contact.find(contact_id) (3)
    return render_template("show.html", contact=contact) (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Map the path, with a path variable named <code>contact_id</code>.
</li>
<li>
The handler takes the value of this path parameter.
</li>
<li>
Look up the corresponding contact.
</li>
<li>
Render the <code>show.html</code> template.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You can see the syntax for extracting values from the path in the first line of code: you enclose the part of the
path you wish to extract in <code>&lt;&gt;</code> and give it a name.  This component of the path will be extracted and then passed
into the handler function, via the parameter with the same name.</p>
</div>
<div class="paragraph">
<p>So, if you were to navigate to the path <code>/contacts/42</code>, the value <code>42</code> would be passed into the <code>contacts_view()</code>
function for the value of <code>contact_id</code>.</p>
</div>
<div class="paragraph">
<p>Once we have the id of the contact we want to look up, we load it up using the <code>find</code> method on the <code>Contact</code> object.  We
then pass this contact into the <code>show.html</code> template and render a response.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_contact_detail_template">The Contact Detail Template</h4>
<div class="paragraph">
<p>Our <code>show.html</code> template is relatively simple, just showing the same information as the table but in a slightly different
format (perhaps for printing).  If we add functionality like “notes” to the application later on, this will give
us a good place to do so.</p>
</div>
<div class="paragraph">
<p>Again, we will omit the “chrome” of the template and focus on the meat:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “contact details” template</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{{contact.first}} {{contact.last}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Phone: {{contact.phone}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Email: {{contact.email}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>We simply render a First Name and Last Name header, with the additional contact information below it,
and a couple of links: a link to edit the contact and a link to navigate back to the full list of contacts.</p>
</div>
</section>
<section class="sect3">
<h4 id="_editing_and_deleting_a_contact">Editing And Deleting A Contact</h4>
<div class="paragraph">
<p>Next up we will tackle the functionality on the other end of that “Edit” link.  Editing a contact is going to look very
similar to creating a new contact.  As with adding a new contact, we are going to need two routes that handle the same
path, but using different HTTP methods: a <code>GET</code> to <code>/contacts/&lt;contact_id&gt;/edit</code> will return a form allowing you to edit
the contact and a <code>POST</code> to that path will update it.</p>
</div>
<div class="paragraph">
<p>We are also going to piggyback the ability to delete a contact along with this editing functionality.  To do this we
will need to handle a <code>POST</code> to <code>/contacts/&lt;contact_id&gt;/delete</code>.</p>
</div>
<div class="paragraph">
<p>Let’s look at the code to handle the <code>GET</code>, which, again, will return an HTML representation of an editing interface
for the given resource:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “edit contact” controller code</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;/edit", methods=["GET"])
def contacts_edit_get(contact_id=0):
    contact = Contact.find(contact_id)
    return render_template("edit.html", contact=contact)</code></pre>
</div>
</figure>
<div class="paragraph">
<p>As you can see this looks a lot like our “Show Contact” functionality.  In fact, it is nearly identical except
for the template: here we render <code>edit.html</code> rather than <code>show.html</code>.</p>
</div>
<div class="paragraph">
<p>While our handler code looked similar to the “Show Contact” functionality, the <code>edit.html</code> template is going to look
very similar to the template for the “New Contact” functionality: we will have a form that submits updated contact
values to the same “edit” URL and that presents all the fields of a contact as inputs for editing, along with any error
messages.</p>
</div>
<div class="paragraph">
<p>Here is the first bit of the form:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “edit contact” form start</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">&gt;</span></span>Contact Values<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue a <code>POST</code> to the <code>/contacts/{{ contact.id }}/edit</code> path.
</li>
<li>
As with the <code>new.html</code> page, the input is tied to the contact’s email.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This HTML is nearly identical to our <code>new.html</code> form, except that this form is going to submit a <code>POST</code> to a different
path, based on the id of the contact that we want to update.  (It’s worth mentioning here that, rather than <code>POST</code>, we
would prefer to use a <code>PUT</code> or <code>PATCH</code>, but those are not available in plain HTML.)</p>
</div>
<div class="paragraph">
<p>Following this we have the remainder of our form, again very similar to the <code>new.html</code> template, and our button
to submit the form.</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “edit contact” form body</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>First Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First Name<span class="token punctuation">"</span></span>
                         <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.first }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['first'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Last Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Last Name<span class="token punctuation">"</span></span>
                         <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.last }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['last'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Phone<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.phone }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['phone'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>In the final part of our template we have a small difference between the <code>new.html</code> and <code>edit.html</code>.  Below the main
editing form, we include a second form that allows you to delete a contact.  It does this by issuing a <code>POST</code>
to the <code>/contacts/&lt;contact id&gt;/delete</code> path.  Just as we would prefer to use a <code>PUT</code> to update a contact, we would
much rather use an HTTP <code>DELETE</code> request to delete one.  Unfortunately that also isn’t possible in plain HTML.</p>
</div>
<div class="paragraph">
<p>To finish up the page, there is a simple hyperlink back to the list of contacts.</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “edit contact” form footer</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/delete<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Delete Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Given all the similarities between the <code>new.html</code> and <code>edit.html</code> templates, you may be wondering why we are not
<em>refactoring</em> these two templates to share logic between them.  That’s a good observation and, in a production system,
we would probably do just that.</p>
</div>
<div class="paragraph">
<p>For our purposes, however, since our application is small and simple, we will leave the templates separate.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Factoring Your Applications</div>
<div class="paragraph">
<p>
One thing that often trips people up who are coming to hypermedia applications from a JavaScript background is the
notion of "components".  In JavaScript-oriented applications it is common to break your app up into small
client-side components that are then composed together.  These components are often developed and tested in isolation and
provide a nice abstraction for developers to create testable code.</p>
</div>
<div class="paragraph">
<p>
With Hypermedia-Driven Applications, in contrast, you factor your application on the server side.  As we said, the above form could be
refactored into a shared template between the edit and create templates, allowing you to achieve a reusable and DRY (Don’t
Repeat Yourself) implementation.</p>
</div>
<div class="paragraph">
<p>Note that factoring on the server-side tends to be coarser-grained than on the client-side: you tend to split out common
<em>sections</em> rather than create lots of individual components.  This has benefits (it tends to be simple) as well as
drawbacks (it is not nearly as isolated as client-side components).</p>
</div>
<div class="paragraph">
<p>Overall, a properly factored server-side hypermedia application can be extremely DRY.</p>
</div>
</div>
</aside>
<section class="sect4">
<h5 id="_handling_the_post_to_contactscontact_idedit">Handling the post to /contacts/&lt;contact_id&gt;/edit</h5>
<div class="paragraph">
<p>Next we need to handle the HTTP <code>POST</code> request that the form in our <code>edit.html</code> template submits.  We will declare
another route that handles the same path as the <code>GET</code> above.</p>
</div>
<div class="paragraph">
<p>Here is the new handler code:</p>
</div>
<div class="paragraph">
<p></p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;/edit", methods=["POST"]) (1)
def contacts_edit_post(contact_id=0):
    c = Contact.find(contact_id) (2)
    c.update(request.form['first_name'], request.form['last_name'], request.form['phone'], request.form['email']) (3)
    if c.save(): (4)
        flash("Updated Contact!")
        return redirect("/contacts/" + str(contact_id)) (5)
    else:
        return render_template("edit.html", contact=c) (6)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Handle a <code>POST</code> to <code>/contacts/&lt;contact_id&gt;/edit</code>.
</li>
<li>
Look the contact up by id.
</li>
<li>
Update the contact with the new information from the form.
</li>
<li>
Attempt to save it.
</li>
<li>
On success, flash a success message &amp; redirect to the detail page.
</li>
<li>
On failure, re-render the edit template, showing any errors.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The logic in this handler is very similar to the logic in the handler for adding a new contact.  The only real difference
is that, rather than creating a new Contact, we look the contact up by id and then call the <code>update()</code> method on it with
the values that were entered in the form.</p>
</div>
<div class="paragraph">
<p>Once again, this consistency between our CRUD operations is one of the nice and simplifying aspects of traditional CRUD web
applications.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_deleting_a_contact">Deleting A Contact</h4>
<div class="paragraph">
<p>
We piggybacked contact delete functionality into the same template used to edit a contact.  This second form will issue
an HTTP <code>POST</code> to <code>/contacts/&lt;contact_id&gt;/delete</code>, and we will need to create a handler for that path as well.</p>
</div>
<div class="paragraph">
<p>Here is what the controller looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “delete contact” controller code</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;/delete", methods=["POST"]) (1)
def contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete() (2)
    flash("Deleted Contact!")
    return redirect("/contacts") (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Handle a <code>POST</code> the <code>/contacts/&lt;contact_id&gt;/delete</code> path.
</li>
<li>
Look up and then invoke the <code>delete()</code> method on the contact.
</li>
<li>
Flash a success message and redirect to the main list of contacts.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The handler code is very simple since we don’t need to do any validation or conditional logic: we simply look up the
contact the same way we have been doing in our other handlers and invoke the <code>delete()</code> method on it, then redirect
back to the list of contacts with a success flash message.</p>
</div>
<div class="paragraph">
<p>No need for a template in this case, the contact is gone.</p>
</div>
</section>
<section class="sect3">
<h4 id="_contact_app_implemented">Contact.app…​ Implemented!</h4>
<div class="paragraph">
<p>And, well…​ believe it or not, that’s our entire contact application!</p>
</div>
<div class="paragraph">
<p>If you’ve struggled with parts of the code so far, don’t worry: we don’t expect you to be a Python or Flask expert (we aren’t!). You just need a basic understanding of how they work to benefit from the remainder of the book.</p>
</div>
<div class="paragraph">
<p>This is a small and simple application, but it does demonstrate many of the aspects of
traditional, web 1.0 applications: CRUD, the Post/Redirect/Get pattern, working
with domain logic in a controller, organizing our URLs in a coherent, resource-oriented manner.</p>
</div>
<div class="paragraph">
<p>And, furthermore, this is a deeply <em>Hypermedia-Driven</em> web application.  Without thinking about it very much, we have
been using REST, HATEOAS and all the other hypermedia concepts we discussed earlier.  We would bet that this simple
little contact app of ours is more RESTful than 99% of all JSON APIs ever built!</p>
</div>
<div class="paragraph">
<p>Just by virtue of using a <em>hypermedia</em>, HTML, we naturally fall into the RESTful network
architecture.</p>
</div>
<div class="paragraph">
<p>So that’s great.  But what’s the matter with this little web app?  Why not end here and go off to develop web 1.0 style
applications?</p>
</div>
<div class="paragraph">
<p>Well, at some level, nothing is wrong with it.  Particularly for an application as simple as this one, the older
way of building web apps might be a perfectly acceptable approach.</p>
</div>
<div class="paragraph">
<p>However, our application does suffer from that “clunkiness” that we mentioned earlier when discussing web 1.0 applications:
every request replaces the entire screen, introducing a noticeable flicker when navigating between pages.  You lose your
scroll state.  You have to click around a bit more than you might in a more sophisticated web application.</p>
</div>
<div class="paragraph">
<p>Contact.app, at this point, just doesn’t feel like a “modern” web application.</p>
</div>
<div class="paragraph">
<p>Is it time to reach for a JavaScript framework and JSON APIs to make our contact application more interactive?</p>
</div>
<div class="paragraph">
<p>No.  No it isn’t.</p>
</div>
<div class="paragraph">
<p>It turns out that we can improve the user experience of this application while retaining its fundamental hypermedia
architecture.</p>
</div>
<div class="paragraph">
<p>In the next few chapters we will look at <a href="https://htmx.org">htmx</a>, a hypermedia-oriented library
that will let us improve our contact application while retaining the hypermedia-based approach we have used so far.</p>
</div>
</section>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_framework_soup">HTML Notes: Framework Soup</h3>
<div class="paragraph">
<p>
Components encapsulate a section of a page along with its dynamic behavior.
While encapsulating behavior is a good way to organize code,
it can also separate elements from their surrounding context,
which can lead to wrong or inadequate relationships between elements.
The result is what one might call <dfn class="dfn">component soup</dfn>,
where information is hidden in component state,
rather than being present in the HTML, which is now incomprehensible due to missing context.</p>
</div>
<div class="paragraph">
<p>Before you reach for components for reuse, consider your options.
Lower-level mechanisms often (allow you to) produce better HTML.
In some cases, components can actually <em>improve</em> the clarity of your HTML.</p>
</div>
<div class="quoteblock">
<blockquote>
The fact that the HTML document is something that you barely touch, because everything you need in there will be injected via JavaScript, puts the document and the page structure out of focus.
</blockquote>
<div class="attribution margin-inline-start">
— Manuel Matuzović, 
<cite><a href="https://www.matuzo.at/blog/2023/single-page-applications-criticism">Why I’m not the biggest fan of Single Page Applications</a></cite>
</div>
</div>
<div class="paragraph">
<p>In order to avoid <code>&lt;div&gt;</code> soup (or Markdown soup, or Component soup), you need to be aware of the markup you’re producing and be able to change it.</p>
</div>
<div class="paragraph">
<p>Some SPA frameworks, and some web components, make this more difficult by putting layers of abstraction between the code the developer writes and the generated markup.</p>
</div>
<div class="paragraph">
<p>While these abstractions can allow developers to create richer UI or work faster,
their pervasiveness means that developers can lose sight of the actual HTML (and JavaScript) being sent to clients.
Without diligent testing, this leads to inaccessibility, poor SEO, and bloat.</p>
</div>
</aside>
</div>
</section>
<h1 id="_hypermedia_driven_web_applications_with_htmx" class="sect0"><sub-title>Part II<v-h>:</v-h></sub-title>  Hypermedia-Driven Web Applications With htmx</h1>
<section class="sect1">
<h2 id="_extending_html_as_hypermedia">Extending HTML As Hypermedia</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous chapter we introduced a simple Web 1.0-style hypermedia application to manage contacts.  Our application
supported the normal CRUD operations for contacts, as well as a simple mechanism for searching contacts.  Our application
was built using nothing but forms and anchor tags, the traditional hypermedia controls used to interact with servers.
The application exchanges hypermedia (HTML) with the server over HTTP, issuing <code>GET</code> and <code>POST</code> HTTP requests and
receiving back full HTML documents in response.</p>
</div>
<div class="paragraph">
<p>It is a basic web application, but it is also definitely a Hypermedia-Driven Application. It is robust, it leverages the
web’s native technologies, and it is simple to understand.</p>
</div>
<div class="paragraph">
<p>So what’s not to like about the application?</p>
</div>
<div class="paragraph">
<p>Unfortunately, our application has a few issues common to web 1.0 style applications:</p>
</div>
<div class="ulist">
<ul>
<li>
From a user experience perspective: there is a noticeable refresh when you move between pages of the application, or when you create, update or
delete a contact.  This is because every user interaction (link click or form submission) requires a full page
refresh, with a whole new HTML document to process after each action.
</li>
<li>
From a technical perspective, all the updates are done with the <code>POST</code> HTTP method.  This, despite the fact that
more logical actions and HTTP request types like <code>PUT</code> and <code>DELETE</code> exist and would make more sense for some
of the operations we implemented.  After all, if we wanted to delete a resource, wouldn’t it make more sense to use an HTTP <code>DELETE</code> request
to do so?  Somewhat ironically, since we have used pure HTML, we are unable to access the full expressive power
of HTTP, which was designed specifically <em>for</em> HTML.
</li>
</ul>
</div>
<div class="paragraph">
<p>The first point, in particular, is noticeable in Web 1.0 style applications like ours and is what is responsible for giving
them the reputation for being “clunky” when compared with their more sophisticated JavaScript-based Single Page Application
cousins.</p>
</div>
<div class="paragraph">
<p>We could address this issue by adopting a Single Page Application framework, and updating our server-side to
provide JSON-based responses.  Single Page Applications eliminate the clunkiness of web 1.0 applications by updating a
web page without refreshing it: they can mutate parts of the Document Object Model (DOM) of the existing page without
needing to replace (and re-render) the entire page.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">The DOM</div>
<div class="paragraph">
<p>
The DOM is the internal model that a browser builds up when it processes HTML, forming a tree of “nodes” for
the tags and other content in the HTML.  The DOM provides a programmatic JavaScript API that allows you to update the nodes
in a page directly, without the use of hypermedia.  Using this API, JavaScript code can insert new content, or remove or
update existing content, entirely outside the normal browser request mechanism.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>There are a few different styles of SPA, but, as we discussed in Chapter 1, the most common approach today is to tie
the DOM to a JavaScript model and then let an SPA framework like <a href="https://reactjs.org/">React</a> or <a href="https://vuejs.org/">Vue</a>
<em>reactively</em> update the DOM when a JavaScript model is updated: you make a change to a JavaScript object that is
stored locally in memory in the browser, and the web page “magically” updates its state to reflect the change in the
model.</p>
</div>
<div class="paragraph">
<p>In this style of application, communication with the server is typically done via a JSON Data API,
with the application sacrificing the advantages of hypermedia in order to provide a better, smoother user experience.</p>
</div>
<div class="paragraph">
<p>Many web developers today would not even consider the hypermedia approach due to the perceived “legacy” feel of these
web 1.0 style applications.</p>
</div>
<div class="paragraph">
<p>Now, the second more technical issue we mentioned may strike you as a bit pedantic, and we are the first to admit that
conversations around REST and which HTTP Action is right for a given operation can become very tedious.  But still, it’s
odd that, when using plain HTML, it is impossible to use all the functionality of HTTP!</p>
</div>
<div class="paragraph">
<p>Just seems wrong, doesn’t it?</p>
</div>
<section class="sect2">
<h3 id="_a_close_look_at_a_hyperlink">A Close Look At A Hyperlink</h3>
<div class="paragraph">
<p>It turns out that we can boost the interactivity of our application and address both of these issues <em>without</em> resorting
to the SPA approach.  We can do so by using a <em>hypermedia-oriented</em> JavaScript library, <a href="https://htmx.org">htmx</a>. The authors of this book built htmx specifically to extend HTML as a hypermedia and address the issues
with legacy HTML applications we mentioned above (as well as a few others.)</p>
</div>
<div class="paragraph">
<p>Before we get into how htmx allows us to improve the UX of our Web 1.0 style application, let’s revisit the
hyperlink/anchor tag from Chapter 1.  Recall, a hyperlink is what is known as a <em>hypermedia control</em>, a mechanism that
describes some sort of interaction with a server by encoding information about that interaction directly and completely
within the control itself.</p>
</div>
<div class="paragraph">
<p>

Consider again this simple anchor tag which, when interpreted by a browser, creates a hyperlink to the website for
this book:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A simple hyperlink, revisited</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Hypermedia Systems
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Let’s break down exactly what happens with this link:</p>
</div>
<div class="ulist">
<ul>
<li>
The browser will render the text “Hypermedia Systems” to the screen, likely with a decoration indicating it is clickable.
</li>
<li>
Then, when a user clicks on the text…​
</li>
<li>
The browser will issue an HTTP <code>GET</code> to <code><a href="index.html" class="bare">https://hypermedia.systems</a></code>…​
</li>
<li>
The browser will load the HTML body of the HTTP response into the browser window, replacing the current document.
</li>
</ul>
</div>
<div class="paragraph">
<p>So we have four aspects of a simple hypermedia link like this, with the last three aspects supplying the mechanism that
distinguishes a hyperlink from “normal” text and, thus, makes this a hypermedia control.</p>
</div>
<div class="paragraph">
<p>Now, let’s take a moment and think about how we can <em>generalize</em> these last three aspects of a hyperlink.</p>
</div>
<section class="sect3">
<h4 id="_why_only_anchors_forms">Why Only Anchors &amp; Forms?</h4>
<div class="paragraph">
<p>Consider: what makes anchor tags (and forms) so special?</p>
</div>
<div class="paragraph">
<p>Why can’t other elements issue HTTP requests as well?</p>
</div>
<div class="paragraph">
<p>For example, why shouldn’t <code>button</code> elements be able to issue HTTP requests?  It seems arbitrary to have to wrap a
form tag around a button just to make deleting contacts work in our application, for example.</p>
</div>
<div class="paragraph">
<p>Maybe: other elements should be able to issue HTTP requests as well.  Maybe other elements should be able to act as
hypermedia controls on their own.</p>
</div>
<div class="paragraph">
<p>This is our first opportunity to generalize HTML as a hypermedia.</p>
</div>
<div class="box info"><div class="title titlebar">Opportunity 1</div><td class="content">

<div class="paragraph">
<p>HTML could be extended to allow <em>any</em> element to issue a request to the server and act as a hypermedia control.</p>
</div>
</td></div>
</section>
<section class="sect3">
<h4 id="_why_only_click_submit_events">Why Only Click &amp; Submit Events?</h4>
<div class="paragraph">
<p>Next, let’s consider the event that triggers the request to the server on our link: a click event.</p>
</div>
<div class="paragraph">
<p>

Well, what’s so special about clicking (in the case of anchors) or submitting (in the case of forms) things?  Those are
just two of many, many events that are fired by the DOM, after all.  Events like mouse down, or key up, or blur are all
events you might want to use to issue an HTTP request.</p>
</div>
<div class="paragraph">
<p>Why shouldn’t these other events be able to trigger requests as well?</p>
</div>
<div class="paragraph">
<p>This gives us our second opportunity to expand the expressiveness of HTML:</p>
</div>
<div class="box info"><div class="title titlebar">Opportunity 2</div><td class="content">

<div class="paragraph">
<p>HTML could be extended to allow <em>any</em> event — not just a click, as in the case of hyperlinks — to trigger HTTP requests.</p>
</div>
</td></div>
</section>
<section class="sect3">
<h4 id="_why_only_get_post">Why Only GET &amp; POST?</h4>
<div class="paragraph">
<p>
Getting a bit more technical in our thinking leads us to the problem we noted earlier: plain HTML only
give us access to the <code>GET</code> and <code>POST</code> actions of HTTP.</p>
</div>
<div class="paragraph">
<p>HTTP <em>stands</em> for Hypertext Transfer Protocol, and yet the format it was explicitly designed for, HTML, only supports
two of the five developer-facing request types.  You <em>have</em> to use JavaScript and issue an AJAX request to get at the
other three: <code>DELETE</code>, <code>PUT</code> and <code>PATCH</code>.</p>
</div>
<div class="paragraph">
<p>Let’s recall what these different HTTP request types are designed to represent:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>GET</code> corresponds with “getting” a representation for a resource from a URL: it is a pure read, with no mutation of
the resource.
</li>
<li>
<code>POST</code> submits an entity (or data) to the given resource, often creating or mutating the resource and causing a state change.
</li>
<li>
<code>PUT</code> submits an entity (or data) to the given resource for update or replacement, again likely causing a state change.
</li>
<li>
<code>PATCH</code> is similar to <code>PUT</code> but implies a partial update and state change rather than a complete replacement of the entity.
</li>
<li>
<code>DELETE</code> deletes the given resource.
</li>
</ul>
</div>
<div class="paragraph">
<p>These operations correspond closely to the CRUD operations we discussed in Chapter 2. By giving us access to only two
of the five, HTML hamstrings our ability to take full advantage of HTTP.</p>
</div>
<div class="paragraph">
<p>This gives us our third opportunity to expand the expressiveness of HTML:</p>
</div>
<div class="box info"><div class="title titlebar">Opportunity 3</div><td class="content">

<div class="paragraph">
<p>HTML could be extended so that it allows access to the missing three HTTP methods, <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code>.</p>
</div>
</td></div>
</section>
<section class="sect3">
<h4 id="_why_only_replace_the_entire_screen">Why Only Replace The Entire Screen?</h4>
<div class="paragraph">
<p>

As a final observation, consider the last aspect of a hyperlink: it replaces the <em>entire</em> screen when a user clicks on it.</p>
</div>
<div class="paragraph">
<p>It turns out that this technical detail is the primary culprit for poor user experience in Web 1.0 Applications.
A full page refresh can cause a flash of unstyled content, where content "jumps" on the screen as it transitions from
its initial to its styled final form.  It also destroys the scroll state of the user by scrolling to the
top of the page, removes focus from a focused element and so forth.</p>
</div>
<div class="paragraph">
<p>But, if you think about it, there is no rule saying that hypermedia exchanges <em>must</em> replace the entire document.</p>
</div>
<div class="paragraph">
<p>This gives us our fourth, final and perhaps most important opportunity to generalize HTML:</p>
</div>
<div class="box info"><div class="title titlebar">Opportunity 4</div><td class="content">

<div class="paragraph">
<p>HTML could be extended to allow the responses to requests to replace elements <em>within</em> the current document, rather than
requiring that they replace the <em>entire</em> document.</p>
</div>
</td></div>
<div class="paragraph">
<p>This is actually a very old concept in hypermedia.  Ted Nelson, in his 1980 book “Literary Machines” coined the term
<em>transclusion</em> to capture this idea: the inclusion of content into an existing document via a hypermedia reference.
If HTML supported this style of “dynamic transclusion,” then Hypermedia-Driven Applications could function much more like
a Single Page Application, where only part of the DOM is updated by a given user interaction or network request.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_extending_html_as_a_hypermedia_with_htmx">Extending HTML as a Hypermedia with Htmx</h3>
<div class="paragraph">
<p>These four opportunities present us a way to extend HTML well beyond its current abilities, but
in a way that is <em>entirely within</em> the hypermedia model of the web. The fundamentals of HTML, HTTP, the browser,
and so on, won’t be changed dramatically.  Rather, these generalizations of <em>existing functionality</em> already found within
HTML would simply let us accomplish <em>more</em> using HTML.</p>
</div>
<div class="paragraph">
<p>
Htmx is a JavaScript library that extends HTML in exactly this manner, and it will be the focus of the next few chapters
of this book.  Again, htmx is not the only JavaScript library that takes this hypermedia-oriented approach (other excellent
examples are <a href="https://unpoly.com">Unpoly</a> and <a href="https://hotwire.dev">Hotwire</a>), but htmx is the purest in
its pursuit of extending HTML as a hypermedia.</p>
</div>
<section class="sect3">
<h4 id="_installing_and_using_htmx">Installing and Using Htmx</h4>
<div class="paragraph">
<p>From a practical “getting started” perspective, htmx is a simple, dependency-free and stand-alone JavaScript library that
can be added to a web application by simply including it via a <code>script</code> tag in your <code>head</code> element.</p>
</div>
<div class="paragraph">
<p>
Because of this simple installation model, you can take advantage of tools like public CDNs to install the library.</p>
</div>
<div class="paragraph">
<p>Below is an example using the popular <a href="https://unpkg.com">unpkg</a> Content Delivery Network (CDN) to install version <code>1.9.2</code>
of the library.  We use an integrity hash to ensure that the delivered JavaScript content matches what we expect.  This
SHA can be found on the htmx website.</p>
</div>
<div class="paragraph">
<p>We also mark the script as <code>crossorigin="anonymous"</code> so no credentials will be sent to the CDN.</p>
</div>
<figure id="listing-3-2" class="listingblock">
<figcaption class="title">Installing htmx</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/htmx.org@1.9.2<span class="token punctuation">"</span></span>
        <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sha384-L6OqL9pRWyyFU3+/bjdSri+iIphTN/bvYyM37tICVyOJkWZLpP2vGn6VUEXgzg6h<span class="token punctuation">"</span></span>
        <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>If you are used to modern JavaScript development, with complex build systems and large numbers of dependencies, it may
be a pleasant surprise to find that that’s all it takes to install htmx.</p>
</div>
<div class="paragraph">
<p>This is in the spirit of the early web, when you could simply include a script tag and things would “just work.”</p>
</div>
<div class="paragraph">
<p>If you don’t want to use a CDN, you can download htmx to your local system and adjust the
script tag to point to wherever you keep your static assets.  Or, you may have a build system
that automatically installs dependencies.  In this case you can use the Node Package Manager (npm) name for the library:
<code>htmx.org</code> and install it in the usual manner that your build system supports.</p>
</div>
<div class="paragraph">
<p>Once htmx has been installed, you can begin using it immediately.</p>
</div>
</section>
<section class="sect3">
<h4 id="_no_javascript_required">No JavaScript Required…​</h4>
<div class="paragraph">
<p>And here we get to the interesting part of htmx: htmx does not require you, the user of htmx, to actually write any JavaScript.</p>
</div>
<div class="paragraph">
<p>
Instead, you will use <em>attributes</em> placed directly on elements in your HTML to drive more dynamic behavior.  Htmx extends
HTML as a hypermedia, and it is designed to make that extension feel as natural and consistent as possible with existing
HTML concepts.  Just as an anchor tag uses an <code>href</code> attribute to specify the URL to retrieve, and forms use an <code>action</code>
attribute to specify the URL to submit the form to, htmx uses HTML <em>attributes</em> to specify the URL that an HTTP request
should be issued to.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_triggering_http_requests">Triggering HTTP Requests</h3>
<div class="paragraph">
<p>




Let’s look at the first feature of htmx: the ability for any element in a web page to issue HTTP requests.  This is the
core functionality provided by htmx, and it consists of five attributes that can be used to issue the five different
developer-facing types of HTTP requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>hx-get</code> - issues an HTTP <code>GET</code> request.
</li>
<li>
<code>hx-post</code> - issues an HTTP <code>POST</code> request.
</li>
<li>
<code>hx-put</code> - issues an HTTP <code>PUT</code> request.
</li>
<li>
<code>hx-patch</code> - issues an HTTP <code>PATCH</code> request.
</li>
<li>
<code>hx-delete</code> - issues an HTTP <code>DELETE</code> request.
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these attributes, when placed on an element, tells the htmx library: “When a user clicks (or whatever) this
element, issue an HTTP request of the specified type.”</p>
</div>
<div class="paragraph">
<p>The values of these attributes are similar to the values of both <code>href</code> on anchors and <code>action</code> on forms: you specify the
URL you wish to issue the given HTTP request type to.  Typically, this is done via a server-relative path.</p>
</div>
<div class="paragraph">
<p>
For example, if we wanted a button to issue a <code>GET</code> request to <code>/contacts</code> then we would write the following
HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A simple htmx-powered button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get The Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A simple button that issues an HTTP <code>GET</code> to <code>/contacts</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The htmx library will see the <code>hx-get</code> attribute on this button, and hook up some JavaScript logic to issue an HTTP
<code>GET</code> AJAX request to the <code>/contacts</code> path when the user clicks on it.</p>
</div>
<div class="paragraph">
<p>Very easy to understand and very consistent with the rest of HTML.</p>
</div>
<section class="sect3">
<h4 id="_its_all_just_html">It’s All Just HTML</h4>
<div class="paragraph">
<p>
With the request issued by the button above, we get to perhaps the most important thing to understand about htmx:
it expects the response to this AJAX request <em>to be HTML</em>.  Htmx is an extension of HTML.  A native hypermedia control
like an anchor tag will typically get an HTML response to an HTTP request it creates.  Similarly, htmx expects the server to
respond to the requests that <em>it</em> makes with HTML.</p>
</div>
<div class="paragraph">
<p>This may surprise web developers who are used to responding to an AJAX request with JSON,
which is far and away the most common response format for such requests.  But AJAX requests are just HTTP requests and
there is no rule saying they must use JSON.  Recall again that AJAX stands for Asynchronous JavaScript &amp; XML, so JSON
is already a step away from the format originally envisioned for this API: XML.</p>
</div>
<div class="paragraph">
<p>Htmx simply goes another direction and expects HTML.</p>
</div>
</section>
<section class="sect3">
<h4 id="_htmx_vs_plain_html_responses">Htmx vs. “Plain” HTML Responses</h4>
<div class="paragraph">
<p>There is an important difference between the HTTP responses to “normal” anchor or form driven HTTP requests and to
htmx-powered requests: in the case of htmx triggered requests, responses can be <em>partial</em> bits of HTML.</p>
</div>
<div class="paragraph">
<p>

In htmx-powered interactions, as you will see, we are often not replacing the entire document.  Rather we are using
“transclusion” to include content <em>within</em> an existing document.  Because of this, it is often not necessary or desirable
to transfer an entire HTML document from the server to the browser.</p>
</div>
<div class="paragraph">
<p>This fact can be used to save bandwidth as well as resource loading time. Less overall content is transferred from
the server to the client, and it isn’t necessary to reprocess a <code>head</code> tag with style sheets, script tags, and so forth.</p>
</div>
<div class="paragraph">
<p>When the “Get Contacts” button is clicked, a <em>partial</em> HTML response might look something like this:</p>
</div>
<figure id="listing-3-3" class="listingblock">
<figcaption class="title">A partial HTML response to an htmx request</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:joe@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Joe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:sarah@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sarah<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:fred@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Fred<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>This is just an unordered list of contacts with some clickable elements in it.  Note that there is no opening
<code>html</code> tag, no <code>head</code> tag, and so forth: it is a <em>raw</em> HTML list, without any decoration around it.  A response in a
real application might contain more sophisticated HTML than this simple list, but even if it were more complicated
it wouldn’t need to be an entire page of HTML: it could just be the “inner” content of the HTML representation for
this resource.</p>
</div>
<div class="paragraph">
<p>Now, this simple list response is perfect for htmx.  Htmx will simply take the returned content and then swap it in to
the DOM in place of some element in the page.  (More on exactly where it will be placed in the DOM in a moment.)  Swapping
in HTML content in this manner is fast and efficient because it leverages the existing native HTML parser in the browser,
rather than requiring a significant amount of client-side JavaScript to be executed.</p>
</div>
<div class="paragraph">
<p>This small HTML response shows how htmx stays within the hypermedia
paradigm: just like a “normal” hypermedia control in a “normal” web application, we see hypermedia being transferred
to the client in a stateless and uniform manner.</p>
</div>
<div class="paragraph">
<p>This button just gives us a slightly more sophisticated mechanism for building a web application using hypermedia.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_targeting_other_elements">Targeting Other Elements</h3>
<div class="paragraph">
<p>Now, given that htmx has issued a request and gotten back some HTML as a response, and that we are going to swap this
content into the existing page (rather than replacing the entire page), the question becomes: where should this new
content be placed?</p>
</div>
<div class="paragraph">
<p>It turns out that the default htmx behavior is to simply put the returned content inside the element that triggered the
request.  That’s <em>not</em> a good thing in the case of our button: we will end up with a list of contacts awkwardly embedded within
the button element.  That will look pretty silly and is obviously not what we want.</p>
</div>
<div class="paragraph">
<p>
Fortunately htmx provides another attribute, <code>hx-target</code> which can be used to specify exactly <em>where</em> in the DOM the
new content should be placed.  The value of the <code>hx-target</code> attribute is a Cascading Style Sheet (CSS) <em>selector</em> that
allows you to specify the element to put the new hypermedia content into.</p>
</div>
<div class="paragraph">
<p>Let’s add a <code>div</code> tag that encloses the button with the id <code>main</code>.  We will then target this <code>div</code> with the response:</p>
</div>
<div class="paragraph">
<p></p>
</div>
<figure id="listing-3-4" class="listingblock">
<figcaption class="title">A simple htmx-powered button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A <code>div</code> element that wraps the button.
</li>
<li>
The <code>hx-target</code> attribute that specifies the target of the response.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We have added <code>hx-target="#main"</code> to our button, where <code>#main</code> is a CSS selector that says “The thing with the ID ‘main’.”</p>
</div>
<div class="paragraph">
<p>By using CSS selectors, htmx builds on top of familiar and standard HTML concepts.  This keeps the
additional conceptual load for working with htmx to a minimum.</p>
</div>
<div class="paragraph">
<p>Given this new configuration, what would the HTML on the client look like after a user clicks on this button and a
response has been received and processed?</p>
</div>
<div class="paragraph">
<p>It would look something like this:</p>
</div>
<figure id="listing-3-5" class="listingblock">
<figcaption class="title">Our HTML after the htmx request finishes</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:joe@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Joe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:sarah@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sarah<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:fred@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Fred<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The response HTML has been swapped into the <code>div</code>, replacing the button that triggered the request.  Transclusion!  And
this has happened “in the background” via AJAX, without a clunky page refresh.</p>
</div>
</section>
<section class="sect2">
<h3 id="_swap_styles">Swap Styles</h3>
<div class="paragraph">
<p>Now, perhaps we don’t want to load the content from the server response <em>into</em> the div, as child elements.  Perhaps,
for whatever reason, we wish to <em>replace</em> the entire div with the response.  To handle this, htmx provides another
attribute, <code>hx-swap</code>, that allows you to specify exactly <em>how</em> the content should be swapped into the DOM.</p>
</div>
<div class="paragraph">
<p>









The <code>hx-swap</code> attribute supports the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>innerHTML</code> - The default, replace the inner html of the target element.
</li>
<li>
<code>outerHTML</code> - Replace the entire target element with the response.
</li>
<li>
<code>beforebegin</code> - Insert the response before the target element.
</li>
<li>
<code>afterbegin</code> - Insert the response before the first child of the target element.
</li>
<li>
<code>beforeend</code> - Insert the response after the last child of the target element.
</li>
<li>
<code>afterend</code> - Insert the response after the target element.
</li>
<li>
<code>delete</code> - Deletes the target element regardless of the response.
</li>
<li>
<code>none</code> - No swap will be performed.
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two values, <code>innerHTML</code> and <code>outerHTML</code>, are taken from the standard DOM properties that allow you to replace content
within an element or in place of an entire element respectively.</p>
</div>
<div class="paragraph">
<p>The next four values are taken from the <code>Element.insertAdjacentHTML()</code> DOM API, which allow you to place an element or
elements around a given element in various ways.</p>
</div>
<div class="paragraph">
<p>The last two values, <code>delete</code> and <code>none</code> are specific to htmx.  The first option will remove the target element from the
DOM, while the second option will do nothing (you may want to only work with response headers, an advanced technique we
will look at later in the book.)</p>
</div>
<div class="paragraph">
<p>Again, you can see htmx stays as close as possible to existing web standards in order to minimize the conceptual load
necessary for its use.</p>
</div>
<div class="paragraph">
<p>So let’s consider that case where, rather than replacing the <code>innerHTML</code> content of the main div above, we want to
replace the <em>entire div</em> with the HTML response.</p>
</div>
<div class="paragraph">
<p>To do so would require only a small change to our button, adding a new <code>hx-swap</code> attribute:</p>
</div>
<figure id="listing-3-6" class="listingblock">
<figcaption class="title">Replacing the entire div</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hx-swap</code> attribute specifies how to swap in new content.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when a response is received, the <em>entire</em> div will be replaced with the hypermedia content:</p>
</div>
<figure id="listing-3-7" class="listingblock">
<figcaption class="title">Our HTML after the htmx request finishes</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:joe@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Joe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:sarah@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Sarah<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:fred@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Fred<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>You can see that, with this change, the target div has been entirely removed from the DOM, and the list that was returned
as the response has replaced it.</p>
</div>
<div class="paragraph">
<p>Later in the book we will see additional uses for <code>hx-swap</code>, for example when we implement infinite scrolling in our
contact management application.</p>
</div>
<div class="paragraph">
<p>Note that with the <code>hx-get</code>, <code>hx-post</code>, <code>hx-put</code>, <code>hx-patch</code> and <code>hx-delete</code> attributes, we have addressed two of the
four opportunities for improvement that we enumerated regarding plain HTML:</p>
</div>
<div class="ulist">
<ul>
<li>
Opportunity 1: We can now issue an HTTP request with <em>any</em> element (in this case we are using a button).
</li>
<li>
Opportunity 3: We can issue <em>any sort</em> of HTTP request we want, <code>PUT</code>, <code>PATCH</code> and <code>DELETE</code>, in particular.
</li>
</ul>
</div>
<div class="paragraph">
<p>And, with <code>hx-target</code> and <code>hx-swap</code> we have addressed a third shortcoming: the requirement that the entire page be replaced.</p>
</div>
<div class="ulist">
<ul>
<li>
Opportunity 4: We can now replace any element we want in our page via transclusion, and we can do so in any manner we want.
</li>
</ul>
</div>
<div class="paragraph">
<p>So, with only seven relatively simple additional attributes, we have addressed most of the shortcomings of HTML as a
hypermedia that we identified earlier.</p>
</div>
<div class="paragraph">
<p>What’s next? Recall the one other opportunity we noted: the fact that only a <code>click</code> event (on an anchor) or a <code>submit</code> event
(on a form) can trigger an HTTP request. Let’s look at how we can address that limitation.</p>
</div>
</section>
<section class="sect2">
<h3 id="_using_events">Using Events</h3>
<div class="paragraph">
<p>Thus far we have been using a button to issue a request with htmx.  You have probably intuitively understood that the
button would issue its request when you clicked on the button since, well, that’s what you do with buttons: you click on them.</p>
</div>
<div class="paragraph">
<p>And, yes, by default when an <code>hx-get</code> or another request-driving annotation from htmx is placed on a button, the request
will be issued when the button is clicked.</p>
</div>
<div class="paragraph">
<p>
However, htmx generalizes this notion of an event triggering a request by using, you guessed it, another attribute:
<code>hx-trigger</code>.  The <code>hx-trigger</code> attribute allows you to specify one or more events that will cause the element to
trigger an HTTP request.</p>
</div>
<div class="paragraph">
<p>Often you don’t need to use <code>hx-trigger</code> because the default triggering event will be what you want.
The default triggering event depends on the element type, and should be fairly intuitive:</p>
</div>
<div class="ulist">
<ul>
<li>
Requests on <code>input</code>, <code>textarea</code> &amp; <code>select</code> elements are triggered by the <code>change</code> event.
</li>
<li>
Requests on <code>form</code> elements are triggered on the <code>submit</code> event.
</li>
<li>
Requests on all other elements are triggered by the <code>click</code> event.
</li>
</ul>
</div>
<div class="paragraph">
<p>To demonstrate how <code>hx-trigger</code> works, consider the following situation: we want to trigger the request
on our button when the mouse enters it.  Now, this is certainly not a <em>good</em> UX pattern, but bear with us: we are just
using this an example.</p>
</div>
<div class="paragraph">
<p>To respond to a mouse entering the button, we would add the following attribute to our button:</p>
</div>
<figure id="listing-3-8" class="listingblock">
<figcaption class="title">A (bad?) button that triggers on mouse entry</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mouseenter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue a request on the…​ <code>mouseenter</code> event.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, with this <code>hx-trigger</code> attribute in place, whenever the mouse enters this button, a request will be triggered. Silly,
but it works.</p>
</div>
<div class="paragraph">
<p>Let’s try something a bit more realistic and potentially useful: let’s add support for a keyboard shortcut for
loading the contacts, <code>Ctrl-L</code> (for “Load”).  To do this we will need to take advantage of additional syntax that
the <code>hx-trigger</code> attribute supports: event filters and additional arguments.</p>
</div>
<div class="paragraph">
<p>
Event filters are a mechanism for determining if a given event should trigger a request or not.  They are applied to an
event by adding square brackets after it: <code>someEvent[someFilter]</code>.  The filter itself is a JavaScript expression that
will be evaluated when the given event occurs.  If the result is truthy, in the JavaScript sense, it will trigger the
request.  If not, the request will not be triggered.</p>
</div>
<div class="paragraph">
<p>
In the case of keyboard shortcuts, we want to catch the <code>keyup</code> event in addition to the click event:</p>
</div>
<figure id="listing-3-9" class="listingblock">
<figcaption class="title">A start, trigger on keyup</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click, keyup<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A trigger with two events.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
Note that we have a comma separated list of events that can trigger this element, allowing us to respond to more than
one potential triggering event.  We still want to respond to the <code>click</code> event and load the contacts, in addition
to handling the <code>Ctrl-L</code> keyboard shortcut.</p>
</div>
<div class="paragraph">
<p>Unfortunately there are two problems with our <code>keyup</code> addition:  As it stands, it will trigger requests on <em>any</em> keyup
event that occurs.  And, worse, it will only trigger when a keyup occurs <em>within</em> this button.  The
user would need to tab onto the button to make it active and then begin typing.</p>
</div>
<div class="paragraph">
<p>Let’s fix these two issues. To fix the first one, we will use a trigger filter to test that Control key and the “L” key
are pressed together:</p>
</div>
<div class="paragraph">
<p></p>
</div>
<figure id="listing-3-10" class="listingblock">
<figcaption class="title">Getting better with filter on keyup</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click, keyup[ctrlKey &amp;&amp; key == 'l']<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
<code>keyup</code> now has a filter, so the control key and L must be pressed.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The trigger filter in this case is <code>ctrlKey &amp;&amp; key == 'l'</code>.  This can be read as “A key up event, where the ctrlKey property
is true and the key property is equal to l.” Note that the properties <code>ctrlKey</code> and <code>key</code> are resolved against the event
rather than the global name space, so you can easily filter on the properties of a given event.  You can use any expression
you like for a filter, however: calling a global JavaScript function, for example, is perfectly acceptable.</p>
</div>
<div class="paragraph">
<p>OK, so this filter limits the keyup events that will trigger the request to only <code>Ctrl-L</code> presses.  However, we still have
the problem that, as it stands, only <code>keyup</code> events <em>within</em> the button will trigger the request.</p>
</div>
<div class="paragraph">
<p>
If you are not familiar with the JavaScript event bubbling model: events typically “bubble” up to parent elements.  So an
event like <code>keyup</code> will be triggered first on the focused element, and then on its parent (enclosing) element, and so
on, until it reaches the top level <code>document</code> object that is the root of all other elements.</p>
</div>
<div class="paragraph">
<p>

To support a global keyboard shortcut that works regardless of what element has focus, we will take advantage of
event bubbling and a feature that the <code>hx-trigger</code> attribute supports: the ability to listen to <em>other elements</em> for
events.  The syntax for doing this is the <code>from:</code> modifier, which is added after an event name and that allows you to
specify a specific element to listen for the given event on using a CSS selector.</p>
</div>
<div class="paragraph">
<p>
In this case, we want to listen to the <code>body</code> element, which is the parent element of all visible elements on the page.</p>
</div>
<div class="paragraph">
<p>Here is what our updated <code>hx-trigger</code> attribute looks like:</p>
</div>
<figure id="listing-3-11" class="listingblock">
<figcaption class="title">Even better, listen for keyup on the body</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click, keyup[ctrlKey &amp;&amp; key == 'L'] from:body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>(1)
    Get The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Listen to the 'keyup' event on the <code>body</code> tag.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, in addition to clicks, the button will listen for <code>keyup</code> events on the body of the page.  So it will issue a
request when it is clicked on and also whenever someone hits <code>Ctrl-L</code> within the body of the page.</p>
</div>
<div class="paragraph">
<p>And now we have a nice keyboard shortcut for our Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>
The <code>hx-trigger</code> attribute supports many more modifiers, and it is more elaborate than other htmx attributes. This is because
events, in general, are complicated and require a lot of details to get just right.  The default trigger will often
suffice, however, and you typically don’t need to reach for complicated <code>hx-trigger</code> features when using htmx.</p>
</div>
<div class="paragraph">
<p>Even with more sophisticated trigger specifications like the keyboard shortcut we just added, the overall feel of htmx is
<em>declarative</em> rather than <em>imperative</em>.  That keeps htmx-powered applications “feeling like” standard web 1.0 applications
in a way that adding significant amounts of JavaScript does not.</p>
</div>
</section>
<section class="sect2">
<h3 id="_htmx_html_extended">Htmx: HTML eXtended</h3>
<div class="paragraph">
<p>And hey, check it out!  With <code>hx-trigger</code> we have addressed the final opportunity for improvement of HTML that we
outlined at the start of this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
Opportunity 2: We can use <em>any</em> event to trigger an HTTP request.
</li>
</ul>
</div>
<div class="paragraph">
<p>That’s a grand total of eight, count 'em, <em>eight</em> attributes that all fall squarely within the same conceptual model as
normal HTML and that, by extending HTML as a hypermedia, open up a whole new world of user interaction possibilities
within it.</p>
</div>
<div class="paragraph">
<p>
Here is a table summarizing those opportunities and which htmx attributes address them:</p>
</div>
<div class="dlist">
<div class="title">Opportunities for improving HTML</div>
<dl>
<dt class="hdlist1">Any element should be able to make HTTP requests</dt>
<dd>
<p><code>hx-get</code>, <code>hx-post</code>, <code>hx-put</code>, <code>hx-patch</code>, <code>hx-delete</code></p>
</dd>
<dt class="hdlist1">Any event should be able to trigger an HTTP request</dt>
<dd>
<p><code>hx-trigger</code></p>
</dd>
<dt class="hdlist1">Any HTTP Action should be available</dt>
<dd>
<p><code>hx-put</code>, <code>hx-patch</code>, <code>hx-delete</code></p>
</dd>
<dt class="hdlist1">Any place on the page should be replaceable (transclusion)</dt>
<dd>
<p><code>hx-target</code>, <code>hx-swap</code></p>
</dd>
</dl>
</div>
</section>
<section class="sect2">
<h3 id="_passing_request_parameters">Passing Request Parameters</h3>
<div class="paragraph">
<p>
So far we have just looked at a situation where a button makes a simple <code>GET</code> request.  This is conceptually very
close to what an anchor tag might do.  But there is that other native hypermedia control in HTML-based applications:
forms.  Forms are used to pass additional information beyond just a URL up to the server in a request.</p>
</div>
<div class="paragraph">
<p>This information is captured via input and input-like elements within the form via the various types of input tags
available in HTML.</p>
</div>
<div class="paragraph">
<p>Htmx allows you include this additional information in a way that mirrors HTML
itself.</p>
</div>
<section class="sect3">
<h4 id="_enclosing_forms">Enclosing Forms</h4>
<div class="paragraph">
<p>The simplest way to pass input values with a request in htmx is to enclose the element making a request within a form
tag.</p>
</div>
<div class="paragraph">
<p>
Let’s take our original button for retrieving contacts and repurpose it for searching contacts:</p>
</div>
<figure id="listing-3-12" class="listingblock">
<figcaption class="title">An htmx-powered search button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Contacts:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search Contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
        Search The Contacts
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
With an enclosing form tag, all input values will be submitted.
</li>
<li>
A new input for user search text entry.
</li>
<li>
Our button has been converted to an <code>hx-post</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Here we have added a form tag surrounding the button along with a search input that can be used to enter a term to
search contacts.</p>
</div>
<div class="paragraph">
<p>
Now, when a user clicks on the button, the value of the input with the id <code>search</code> will be included in the request.  This
is by virtue of the fact that there is a form tag enclosing both the button and the input: when an htmx-driven request
is triggered, htmx will look up the DOM hierarchy for an enclosing form, and, if one is found, it will include all
values from within that form.  (This is sometimes referred to as “serializing” the form.)</p>
</div>
<div class="paragraph">
<p>You might have noticed that the button was switched from a <code>GET</code> request to a <code>POST</code> request.  This is because, by default,
htmx does <em>not</em> include the closest enclosing form for <code>GET</code> requests, but it <em>does</em> include the form for all other types
of requests.</p>
</div>
<div class="paragraph">
<p>This may seem a little strange, but it avoids junking up URLs that are used within forms when dealing with history
entries, which we will discuss in a bit.  And you can always include an enclosing form’s values with an element that
uses a <code>GET</code> by using the <code>hx-include</code> attribute, discussed next.</p>
</div>
</section>
<section class="sect3">
<h4 id="_including_inputs">Including Inputs</h4>
<div class="paragraph">
<p>
While enclosing all the inputs you want included in a request is the most common approach for inputs
in htmx requests, it isn’t always possible or desirable: form tags can have layout consequences and simply cannot be
placed in some spots in HTML documents.  A good example of the latter situation is in table row (<code>tr</code>) elements: the
<code>form</code> tag is not a valid child or parent of table rows, so you can’t place a form within or around a
row of data in a table.</p>
</div>
<div class="paragraph">
<p>

To address this issue, htmx provides a mechanism for including input values in requests: the <code>hx-include</code> attribute.
The <code>hx-include</code> attribute allows you to select input values that you wish to include in a request via CSS selectors.</p>
</div>
<div class="paragraph">
<p>Here is the above example reworked to include the input, dropping the form:</p>
</div>
<figure id="listing-3-13" class="listingblock">
<figcaption class="title">An htmx-powered search button with <code>hx-include</code></figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Contacts:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search Contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Search The Contacts
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
<code>hx-include</code> can be used to include values directly in a request.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The <code>hx-include</code> attribute takes a CSS selector value and allows you to specify exactly which values to send along
with the request.  This can be useful if it is difficult to colocate an element issuing a request with all the desired inputs.</p>
</div>
<div class="paragraph">
<p>It is also useful when you do, in fact, want to submit values with a <code>GET</code> request and overcome the default behavior of
htmx.</p>
</div>
<section class="sect4">
<h5 id="_relative_css_selectors">Relative CSS selectors</h5>
<div class="paragraph">
<p>
The <code>hx-include</code> attribute and, in fact, most attributes that take a CSS selector, also support <em>relative</em> CSS selectors.
These allow you to specify a CSS selector <em>relative</em> to the element it is declared on.  Here are some examples:</p>
</div>
<div class="paragraph">
<p>
<code>closest</code>::
Find the closest parent element matching the given selector, e.g., <code>closest form</code>.</p>
</div>
<div class="paragraph">
<p>
<code>next</code>::
Find the next element (scanning forward) matching the given selector, e.g., <code>next input</code>.</p>
</div>
<div class="paragraph">
<p>
<code>previous</code>::
Find the previous element (scanning backwards) matching the given selector, e.g., <code>previous input</code>.</p>
</div>
<div class="paragraph">
<p>
<code>find</code>::
Find the next element within this element matching the given selector, e.g., <code>find input</code>.</p>
</div>
<div class="paragraph">
<p>
<code>this</code>::
The current element.</p>
</div>
<div class="paragraph">
<p>Using relative CSS selectors often allows you to avoid generating ids for elements, since you can take advantage
of their local structural layout instead.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_inline_values">Inline Values</h4>
<div class="paragraph">
<p>
A final way to include values in htmx-driven requests is to use the <code>hx-vals</code> attribute, which allows you to include
“static” values in the request.  This can be useful if you have additional information that you want to include in
requests, but you don’t want to have this information embedded in, for example, hidden inputs (which would be the
standard mechanism for including additional, hidden information in HTML.)</p>
</div>
<div class="paragraph">
<p>


Here is an example of <code>hx-vals</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">An htmx-powered button with <code>hx-vals</code></figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-vals</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>{"state":"MT"}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get The Contacts In Montana
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
<code>hx-vals</code>, a JSON value to include in the request.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The parameter <code>state</code> with the value <code>MT</code> will be included in the <code>GET</code> request, resulting in a path and parameters that
looks like this:  <code>/contacts?state=MT</code>.  Note that we switched the <code>hx-vals</code> attribute to use single quotes
around its value.  This is because JSON strictly requires double quotes and, therefore, to avoid escaping we needed to
use the single-quote form for the attribute value.</p>
</div>
<div class="paragraph">
<p>
You can also prefix <code>hx-vals</code> with a <code>js:</code> and pass values evaluated at the time of the request, which can be useful for
including things like a dynamically maintained variable, or value from a third party JavaScript library.</p>
</div>
<div class="paragraph">
<p>For example, if the <code>state</code> variable were maintained dynamically, via some JavaScript, and there existed a JavaScript
function, <code>getCurrentState()</code>, that returned the currently selected state, it could be included dynamically in htmx
requests like so:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A dynamic value</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-vals</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>js:{"state":getCurrentState()}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get The Contacts In The Selected State
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
With the <code>js:</code> prefix, this expression will evaluate at submit time.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>These three mechanisms, using <code>form</code> tags, using the <code>hx-include</code> attribute and using the <code>hx-vals</code> attribute, allow you
to include values in your hypermedia requests with htmx in a manner that should feel very familiar and in keeping with
the spirit of HTML, while also giving you the flexibility to achieve what you want.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_history_support">History Support</h3>
<div class="paragraph">
<p>We have a final piece of functionality to close out our overview of htmx: browser history support.  When you use normal
HTML links and forms, your browser will keep track of all the pages that you have visited.  You can then use the back button
to navigate back to a previous page and, once you have done this, you can use a forward button to go forward to the
original page you were on.</p>
</div>
<div class="paragraph">
<p>
This notion of history was one of the killer features of the early web.  Unfortunately it turns out that history becomes
tricky when you move to the Single Page Application paradigm.  An AJAX request does not, by itself, register a web
page in your browser’s history, which is a good thing: an AJAX request may have nothing to do with the state of the
web page (perhaps it is just recording some activity in the browser), so it wouldn’t be appropriate to create a new
history entry for the interaction.</p>
</div>
<div class="paragraph">
<p>However, there are likely to be a lot of AJAX driven interactions in a Single Page Application where it <em>is</em> appropriate
to create a history entry.  There is a JavaScript API to work with browser history, but this API is deeply annoying and difficult to work with, and thus often ignored by JavaScript developers.</p>
</div>
<div class="paragraph">
<p>If you have ever used a Single Page Application and accidentally clicked the back button, only to lose your entire
application state and have to start over, you have seen this problem in action.</p>
</div>
<div class="paragraph">
<p>In htmx, as with Single Page Application frameworks, you will often need to explicitly work with the history API.
Fortunately, since htmx sticks so close to the native model of the web and since it is declarative, getting web history
right is typically much easier to do in an htmx-based application.</p>
</div>
<div class="paragraph">
<p>Consider the button we have been looking at to load contacts:</p>
</div>
<figure id="listing-3-14" class="listingblock">
<figcaption class="title">Our trusty button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Get The Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>As it stands, if you click this button it will retrieve the content from <code>/contacts</code> and load it into the element with the
id <code>main</code>, but it will <em>not</em> create a new history entry.</p>
</div>
<div class="paragraph">
<p>

If we wanted it to create a history entry when this request happened, we would add a new attribute to the button, the
<code>hx-push-url</code> attribute:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our trusty button, now with history!</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#main<span class="token punctuation">"</span></span> <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get The Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
<code>hx-push-url</code> will create an entry in history when the button is clicked.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when the button is clicked, the <code>/contacts</code> path will be put into the browser’s navigation bar and a history entry
will be created for it.  Furthermore, if the user clicks the back button, the original content for the page will be
restored, along with the original URL.</p>
</div>
<div class="paragraph">
<p>
Now, the name <code>hx-push-url</code> for this attribute might sound a little obscure, but it is based on the JavaScript API,
<code>history.pushState()</code>.  This notion of “pushing” derives from the fact that history entries are modeled as a stack, and
so you are “pushing” new entries onto the top of the stack of history entries.</p>
</div>
<div class="paragraph">
<p>With this relatively simple, declarative mechanism, htmx allows you to integrate with the back button in a way that mimics the
“normal” behavior of HTML.</p>
</div>
<div class="paragraph">
<p>Now, there is one additional thing we need to handle to get history “just right”: we have “pushed” the <code>/contacts</code> path
into the browsers location bar successfully, and the back button works.  But what if someone refreshes their browser while
on the <code>/contacts</code> page?</p>
</div>
<div class="paragraph">
<p>In this case, you will need to handle the htmx-based “partial” response as well as the non-htmx “full page” response.  You
can do this using HTTP headers, a topic we will go into in detail later in the book.</p>
</div>
</section>
<section class="sect2">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph">
<p>So that’s our whirlwind introduction to htmx.  We’ve only seen about ten attributes from the library, but you
can see a hint of just how powerful these attributes can be. Htmx enables a much
more sophisticated web application than is possible in plain HTML, with minimal additional conceptual load compared to most JavaScript-based approaches.</p>
</div>
<div class="paragraph">
<p>Htmx aims to incrementally improve HTML as a hypermedia in a manner that is
conceptually coherent with the underlying markup language.  Like any technical choice, this is not without
trade-offs: by staying so close to HTML, htmx does not give developers a lot of infrastructure that many might feel
should be there “by default”.</p>
</div>
<div class="paragraph">
<p>By staying closer to the native model of the web, htmx aims to strike a balance between simplicity and functionality,
deferring to other libraries for more elaborate frontend extensions on top of the existing web platform.  The good news
is that htmx plays well with others, so when these needs arise it is often easy enough to bring in another library to handle
them.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_budgeting_for_html">HTML Notes: Budgeting For HTML</h3>
<div class="paragraph">
<p>The close relationship between content and markup means that
good HTML is labor-intensive.
Most sites have a separation between the authors,
who are rarely familiar with HTML,
and the developers, who need to develop a generic system able to handle any content that’s thrown at it — this separation usually taking the form of a CMS.
As a result, having markup tailored to content, which is often necessary for advanced HTML, is rarely feasible.</p>
</div>
<div class="paragraph">
<p>Furthermore, for internationalized sites, content in different languages being injected into the same elements can degrade markup quality as stylistic conventions differ between languages.
It’s an expense few organizations can spare.</p>
</div>
<div class="paragraph">
<p>Thus, we don’t expect every site to contain perfectly conformant HTML.
What’s most important is to avoid <em>wrong</em> HTML — it can be better to fall back on a more generic element than to be precisely incorrect.</p>
</div>
<div class="paragraph">
<p>If you have the resources, however, putting more care in your HTML will produce a more polished site.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_htmx_patterns">Htmx Patterns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we’ve seen how htmx extends HTML as a hypermedia, it’s time to put it into action.  As we use htmx, we will still
be using hypermedia: we will issue HTTP requests and get back HTML.  But, with the additional functionality that htmx provides,
we will have a more <em>powerful hypermedia</em> to work with, allowing us to accomplish much more sophisticated interfaces.</p>
</div>
<div class="paragraph">
<p>This will allow us to address user experience issues, such as long feedback cycles or painful page refreshes, without
needing to write much, if any, JavaScript, and without creating a JSON API.  Everything will be implemented in hypermedia,
using the core hypermedia concepts of the early web.</p>
</div>
<section class="sect2">
<h3 id="_installing_htmx">Installing Htmx</h3>
<div class="paragraph">
<p>
The first thing we need to do is install htmx in our web application.  We are going to do this by downloading the
source and saving it locally in our application, so we aren’t dependent on any external systems.  This is known as “vendoring”
the library.  We can grab the latest version of htmx by navigating our browser to <code><a href="https://unpkg.com/htmx.org" class="bare">https://unpkg.com/htmx.org</a></code>, which will
redirect us to the source of the latest version of the library.</p>
</div>
<div class="paragraph">
<p>We can save the content from this URL into the <code>static/js/htmx.js</code> file in our project.</p>
</div>
<div class="paragraph">
<p>You can, of course, use a more sophisticated JavaScript package manager such as Node Package Manager (NPM) or yarn to install
htmx.  You do this by referring to its package name, <code>htmx.org</code>, in the manner appropriate for your tool.  However,
htmx is very small (approximately 12kb when compressed and zipped) and is dependency free, so using it does not require
an elaborate mechanism or build tool.</p>
</div>
<div class="paragraph">
<p>With htmx downloaded locally to our applications <code>/static/js</code> directory, we can now load it in to our application.
We do this by adding the following <code>script</code> tag to the <code>head</code> tag in our <code>layout.html</code> file, which will make htmx
available and active on every page in our application:</p>
</div>
<figure id="listing-4-1" class="listingblock">
<figcaption class="title">Installing htmx</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/htmx.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Recall that the <code>layout.html</code> file is a <em>layout</em> file included in most templates that wraps the content of those templates
in common HTML, including a <code>head</code> element that we are using here to install htmx.</p>
</div>
<div class="paragraph">
<p>Believe it or not, that’s it!  This simple script tag will make htmx’s functionality available across our entire application.</p>
</div>
</section>
<section class="sect2">
<h3 id="_ajax_ifying_our_application">AJAX-ifying Our Application</h3>
<div class="paragraph">
<p>

To get our feet wet with htmx, the first feature we are going to take advantage of is known as “boosting.” This is
a bit of a “magic” feature in that we don’t need to do much beyond adding a single attribute, <code>hx-boost</code>, to the
application.</p>
</div>
<div class="paragraph">
<p>When you put <code>hx-boost</code> on a given element with the value <code>true</code>, it will “boost” all anchor and form elements within that
element.  “Boost”, here, means that htmx will convert all those anchors and forms from “normal” hypermedia controls
into AJAX-powered hypermedia controls.  Rather than issuing “normal” HTTP requests that replace the whole page, the links
and forms will issue AJAX requests. Htmx then swaps the inner content of the <code>&lt;body&gt;</code> tag in the response to these
requests into the existing pages <code>&lt;body&gt;</code> tag.</p>
</div>
<div class="paragraph">
<p>This makes navigation feel faster because the browser will not be re-interpreting most of the tags in the response
<code>&lt;head&gt;</code> and so forth.</p>
</div>
<section class="sect3">
<h4 id="_boosted_links">Boosted Links</h4>
<div class="paragraph">
<p>Let’s take a look at an example of a boosted link.  Below is a link to a hypothetical settings page for a web application.
Because it has <code>hx-boost="true"</code> on it, htmx will halt the normal link behavior of issuing a request to the <code>/settings</code> path and replacing
the entire page with the response.  Instead, htmx will issue an AJAX request to <code>/settings</code>, take the result and replace
the <code>body</code> element with the new content.</p>
</div>
<figure class="listingblock">
<figcaption class="title">A boosted link</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hx-boost</code> attribute makes this link AJAX-powered.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You might reasonably ask: what’s the advantage here?  We are issuing an AJAX request and simply replacing the entire body.</p>
</div>
<div class="paragraph">
<p>Is that significantly different from just issuing a normal link request?</p>
</div>
<div class="paragraph">
<p>Yes, it is in fact different: with a boosted link, the browser is able to avoid any processing associated with the head tag.  The head
tag often contains many scripts and CSS file references.  In the boosted scenario, it is not necessary to re-process those
resources: the scripts and styles have already been processed and will continue to apply to the new content.  This can
often be a very easy way to speed up your hypermedia application.</p>
</div>
<div class="paragraph">
<p>A second question you might have is: does the response need to be formatted specially to work with <code>hx-boost</code>?  After all,
the settings page would normally render an <code>html</code> tag, with a <code>head</code> tag and so forth.  Do you need to handle “boosted”
requests specially?</p>
</div>
<div class="paragraph">
<p>The answer is no: htmx is smart enough to pull out only the content of the <code>body</code> tag to swap in to the new page.
The <code>head</code> tag is mostly ignored: only the title tag, if it is present, will be processed.  This means you don’t need to
do anything special on the server side to render templates that <code>hx-boost</code> can handle: just return the normal HTML for
your page, and it should work fine.</p>
</div>
<div class="paragraph">
<p>Note that boosted links (and forms) will also continue to update the navigation bar and history, just like normal links,
so users will be able to use the browser back button, will be able to copy and paste URLs (or “deep links”) and so on.
Links will act pretty much like “normal”, they will just be faster.</p>
</div>
</section>
<section class="sect3">
<h4 id="_boosted_forms">Boosted Forms</h4>
<div class="paragraph">
<p>Boosted form tags work in a similar way to boosted anchor tags: a boosted form will use an AJAX request rather than the
usual browser-issued request, and will replace the entire body with the response.</p>
</div>
<div class="paragraph">
<p>Here is an example of a form that posts messages to the <code>/messages</code> endpoint using an HTTP <code>POST</code> request.  By adding
<code>hx-boost</code> to it, those requests will be done in AJAX, rather than the normal browser behavior.</p>
</div>
<figure id="listing-4-2" class="listingblock">
<figcaption class="title">A boosted form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/messages<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>(1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Enter A Message...<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Post Your Message<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
As with the link, <code>hx-boost</code> makes this form AJAX-powered.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
A big advantage of the AJAX-based request that <code>hx-boost</code> uses (and the lack of head processing that occurs) is that it
avoids what is known as a <dfn class="dfn">flash of unstyled content</dfn>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Flash Of Unstyled Content (FOUC)</dt>
<dd>
<p>A situation where a browser renders a web page before all the styling information is
available for the page.  A FOUC causes a disconcerting momentary “flash” of the unstyled content, which is then restyled
when all the style information is available.  You will notice this as a flicker when you move around the internet: text,
images and other content can “jump around” on the page as styles are applied to it.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With <code>hx-boost</code> the site’s styling is already loaded <em>before</em> the new content is retrieved, so there is no such flash of
unstyled content.  This can make a “boosted” application feel both smoother and also snappier in general.</p>
</div>
</section>
<section class="sect3">
<h4 id="_attribute_inheritance">Attribute Inheritance</h4>
<div class="paragraph">
<p>Let’s expand on our previous example of a boosted link, and add a few more boosted links alongside it.  We’ll add links
so that we have one to the <code>/contacts</code> page, the <code>/settings</code> page, and the <code>/help</code> page.  All these
links are boosted and will behave in the manner that we have described above.</p>
</div>
<div class="paragraph">
<p>This feels a little redundant, doesn’t it?  It seems silly to annotate all three links with the <code>hx-boost="true"</code> attribute
right next to one another.</p>
</div>
<figure id="listing-4-3" class="listingblock">
<figcaption class="title">A set of boosted links</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Contacts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/help<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Help<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>
Htmx offers a feature to help reduce this redundancy: attribute inheritance.  With most attributes in htmx, if you
place it on a parent, the attribute will also apply to children elements.  This is how Cascading Style Sheets work, and
that idea inspired htmx to adopt a similar “cascading htmx attributes” feature.</p>
</div>
<div class="paragraph">
<p>To avoid the redundancy in this example, let’s introduce a <code>div</code> element that encloses all the links and then “hoist” the
<code>hx-boost</code> attribute up to that parent <code>div</code>. This will let us remove the redundant <code>hx-boost</code> attributes but ensure all the links are
still boosted, inheriting that functionality from the parent <code>div</code>.</p>
</div>
<div class="paragraph">
<p>Note that any legal HTML element could be used here, we just use a <code>div</code> out of habit.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Boosting links via the parent</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Contacts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/help<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Help<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hx-boost</code> has been moved to the parent div.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now we don’t have to put an <code>hx-boost="true"</code> on every link and, in fact, we can add more links alongside the
existing ones, and they, too, will be boosted, without us needing to explicitly annotate them.</p>
</div>
<div class="paragraph">
<p>That’s fine, but what if you have a link that you <em>don’t</em> want boosted within an element that has <code>hx-boost="true"</code> on
it?  A good example of this situation is when a link is to a resource to be downloaded, such as a PDF.  Downloading a
file can’t be handled well by an AJAX request, so you probably want that link to behave “normally”, issuing a full
page request for the PDF, which the browser will then offer to save as a file on the user’s local system.</p>
</div>
<div class="paragraph">
<p>To handle this situation, you simply override the parent <code>hx-boost</code> value with <code>hx-boost="false"</code> on the
anchor tag that you don’t want to boost:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Disabling boosting</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Contacts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/help<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Help<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/help/documentation.pdf<span class="token punctuation">"</span></span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Download Docs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (2)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hx-boost</code> is still on the parent div.
</li>
<li>
The boosting behavior is overridden for this link.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
Here we have a new link to a documentation PDF that we wish to function like a regular link.  We have added
<code>hx-boost="false"</code> to the link and this declaration will override the <code>hx-boost="true"</code> on the parent <code>div</code>, reverting
it to regular link behavior and, thus, allowing for the file download behavior that we want.</p>
</div>
</section>
<section class="sect3">
<h4 id="_progressive_enhancement">Progressive Enhancement</h4>
<div class="paragraph">
<p>
A nice aspect of <code>hx-boost</code> is that it is an example of <dfn class="dfn">progressive enhancement</dfn>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Progressive Enhancement</dt>
<dd>
<p>A software design philosophy that aims to provide as much essential content and functionality
to as many users as possible, while delivering a better experience to users with more advanced web browsers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Consider the links in the example above.  What would happen if someone did not have JavaScript enabled?</p>
</div>
<div class="paragraph">
<p>No problem. The application would continue to work, but it would issue regular HTTP requests, rather than AJAX-based
HTTP requests.  This means that your web application will work for the maximum number of users; those with modern
browsers (or users who have not turned off JavaScript) can take advantage of the benefits of the AJAX-style navigation
that htmx offers, and others can still use the app just fine.</p>
</div>
<div class="paragraph">
<p>Compare the behavior of htmx’s <code>hx-boost</code> attribute with a JavaScript heavy Single Page Application: such an application
often won’t function <em>at all</em> without JavaScript enabled. It is often very difficult to adopt a progressive enhancement
approach when you use an SPA framework.</p>
</div>
<div class="paragraph">
<p>This is <em>not</em> to say that every htmx feature offers progressive enhancement.  It is certainly possible to build features that
do not offer a “No JS” fallback in htmx, and, in fact, many of the features we will build later in the book will fall
into this category.  We will note when a feature is progressive enhancement friendly and when it is not.</p>
</div>
<div class="paragraph">
<p>Ultimately, it is up to you, the developer, to decide if the trade-offs of progressive enhancement (a more basic UX,
limited improvements over plain HTML) are worth the benefits for your application users.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_hx_boost_to_contact_app">Adding “hx-boost” to Contact.app</h4>
<div class="paragraph">
<p>For the contact app we are building, we want this htmx “boost” behavior…​ well, everywhere.</p>
</div>
<div class="paragraph">
<p>Right?  Why not?</p>
</div>
<div class="paragraph">
<p>How could we accomplish that?</p>
</div>
<div class="paragraph">
<p>Well, it’s easy (and pretty common in htmx-powered web applications): we can just add <code>hx-boost</code> on the
<code>body</code> tag of our <code>layout.html</code> template, and we are done.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Boosting the entire contact.app</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>(1)
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
All links and forms will be boosted now!
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now every link and form in our application will use AJAX by default, making it feel much snappier.  Consider the
“New Contact” link that we created on the main page:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A newly boosted “add contact” link</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/new<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Add Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Even though we haven’t touched anything on this link or on the server-side handling of the URL it targets, it will
now “just work” as a boosted link, using AJAX for a snappier user experience, including updating history, back button
support and so on.  And, if JavaScript isn’t enabled, it will fall back to the normal link behavior.</p>
</div>
<div class="paragraph">
<p>All this with one htmx attribute.</p>
</div>
<div class="paragraph">
<p>The <code>hx-boost</code> attribute is neat, but is different than other htmx attributes in that it is pretty “magical”: by
making one small change you modify the behavior of a large number of elements on the page, turning them into
AJAX-powered elements.  Most other htmx attributes are generally lower level and require more explicit annotations in
order to specify exactly what you want htmx to do.  In general, this is the design philosophy of htmx: prefer explicit
over implicit and obvious over “magic.”</p>
</div>
<div class="paragraph">
<p>However, the <code>hx-boost</code> attribute was too useful to allow dogma to override practicality, and so it is included as a
feature in the library.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_a_second_step_deleting_contacts_with_http_delete">A Second Step: Deleting Contacts With HTTP DELETE</h3>
<div class="paragraph">
<p>For our next step with htmx, recall that Contact.app has a small form on the edit page of a contact that is
used to delete the contact:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Plain HTML form to delete a contact</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/delete<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Delete Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>This form issued an HTTP <code>POST</code> to, for example, <code>/contacts/42/delete</code>, in order to delete the contact with the ID 42.</p>
</div>
<div class="paragraph">
<p>
We mentioned previously that one of the annoying things about HTML is that you can’t issue an HTTP <code>DELETE</code>
(or <code>PUT</code> or <code>PATCH</code>) request directly, even though these are all part of HTTP and HTTP is <em>obviously designed</em> for
transferring HTML.</p>
</div>
<div class="paragraph">
<p>Thankfully, now, with htmx, we have a chance to rectify this situation.</p>
</div>
<div class="paragraph">
<p>The “right thing,” from a RESTful, resource-oriented perspective is, rather than issuing an HTTP <code>POST</code> to
<code>/contacts/42/delete</code>, to issue an HTTP <code>DELETE</code> to <code>/contacts/42</code>.  We want to delete the contact.  The contact is
a resource.  The URL for that resource is <code>/contacts/42</code>.  So the ideal is a <code>DELETE</code> request to <code>/contacts/42/</code>.</p>
</div>
<div class="paragraph">
<p>Let’s update our application to do this by adding the htmx <code>hx-delete</code> attribute to the “Delete Contact” button:</p>
</div>
<figure class="listingblock">
<figcaption class="title">An htmx-powered button for deleting a contact</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Now, when a user clicks this button, htmx will issue an HTTP <code>DELETE</code> request via AJAX to the URL for the contact
in question.</p>
</div>
<div class="paragraph">
<p>
A couple of things to notice:</p>
</div>
<div class="ulist">
<ul>
<li>
We no longer need a <code>form</code> tag to wrap the button, because the button itself carries the hypermedia action that
it performs directly on itself.
</li>
<li>
We no longer need to use the somewhat awkward <code>"/contacts/{{ contact.id }}/delete"</code> route, but can simply use the
<code>"/contacts/{{ contact.id }}</code> route, since we are issuing a <code>DELETE</code>.  By using a <code>DELETE</code> we disambiguate between
a request intended to update the contact and a request intended to delete it, using the native HTTP tools available
for exactly this reason.
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that we have done something pretty magical here: we have turned this button into a <em>hypermedia control</em>.  It is no
longer necessary that this button be placed within a larger <code>form</code> tag in order to trigger an HTTP request: it is a
stand-alone, and fully featured hypermedia control on its own.  This is at the heart of htmx, allowing any element to become
a hypermedia control and fully participate in a Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>We should also note that, unlike with the <code>hx-boost</code> examples above, this solution will <em>not</em> degrade gracefully.  To make
this solution degrade gracefully, we would need to wrap the button in a form element and handle a <code>POST</code> on the server
side as well.</p>
</div>
<div class="paragraph">
<p>In the interest of keeping our application simple, we are going to omit that more elaborate solution.</p>
</div>
<section class="sect3">
<h4 id="_updating_the_server_side_code">Updating The Server-Side Code</h4>
<div class="paragraph">
<p>We have updated the client-side code (if HTML can be considered code) so it now issues a <code>DELETE</code> request to the appropriate
URL, but we still have some work to do.  Since we updated both the route and the HTTP method we are using, we are going to
need to update the server-side implementation as well to handle this new HTTP request.</p>
</div>
<figure class="listingblock">
<figcaption class="title">The original server-side code for deleting a contact</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;/delete", methods=["POST"])
def contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete()
    flash("Deleted Contact!")
    return redirect("/contacts")</code></pre>
</div>
</figure>
<div class="paragraph">
<p>We’ll need to make two changes to our handler: update the route, and update the HTTP method we are using to delete contacts.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updated handler with new route and method</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;", methods=["DELETE"]) (1)
def contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete()
    flash("Deleted Contact!")
    return redirect("/contacts")</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An updated path and method for the handler.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Pretty simple, and much cleaner.</p>
</div>
<section class="sect4">
<h5 id="_a_response_code_gotcha">A response code gotcha</h5>
<div class="paragraph">
<p>
Unfortunately, there is a problem with our updated handler: by default, in Flask the <code>redirect()</code> method responds with
a <code>302 Found</code> HTTP Response Code.</p>
</div>
<div class="paragraph">
<p>According to the Mozilla Developer Network (MDN) web docs on the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/302"><code>302 Found</code></a>
response, this means that the HTTP <em>method</em> of the request <em>will be unchanged</em> when the redirected HTTP request is issued.</p>
</div>
<div class="paragraph">
<p>We are now issuing a <code>DELETE</code> request with htmx and then being redirected to the <code>/contacts</code> path by flask.  According to this
logic, that would mean that the redirected HTTP request would still be a <code>DELETE</code> method.  This means that, as it stands,
the browser will issue a <code>DELETE</code> request to <code>/contacts</code>.</p>
</div>
<div class="paragraph">
<p>This is definitely <em>not</em> what we want: we would like the HTTP redirect to issue a <code>GET</code> request, slightly modifying the
Post/Redirect/Get behavior we discussed earlier to be a Delete/Redirect/Get.</p>
</div>
<div class="paragraph">
<p>Fortunately, there is a different response code, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/303"><code>303 See Other</code></a>,
that does what we want: when a browser receives a <code>303 See Other</code> redirect response, it will issue a <code>GET</code> to the new
location.</p>
</div>
<div class="paragraph">
<p>So we want to update our code to use the <code>303</code> response code in the controller.</p>
</div>
<div class="paragraph">
<p>Thankfully, this is very easy: there is a second parameter to <code>redirect()</code> that takes the numeric response code you wish
to send.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updated handler with <code>303</code> redirect response</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;", methods=["DELETE"])
def contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete()
    flash("Deleted Contact!")
    return redirect("/contacts", 303) (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The response code is now a 303.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when you want to remove a given contact, you can simply issue a <code>DELETE</code> to the same URL as you used to access the
contact in the first place.</p>
</div>
<div class="paragraph">
<p>This is a natural HTTP-based approach to deleting a resource.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_targeting_the_right_element">Targeting The Right Element</h4>
<div class="paragraph">
<p>
We aren’t quite finished with our updated delete button.  Recall that, by default, htmx “targets” the element
that triggers a request, and will place the HTML returned by the server inside that element.  Right now, the “Delete Contact”
button is targeting itself.</p>
</div>
<div class="paragraph">
<p>That means that, since the redirect to the <code>/contacts</code> URL is going to re-render the entire contact list, we will end up
with that contact list placed <em>inside</em> the “Delete Contact” button.</p>
</div>
<div class="paragraph">
<p>Mis-targeting like this comes up from time to time when you are working with htmx and can lead to some pretty funny situations.</p>
</div>
<div class="paragraph">
<p>The fix for this is easy: add an explicit target to the button, and target the <code>body</code> element with the response:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A fixed htmx-powered button for deleting a contact</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
          <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    Delete Contact
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An explicit target added to the button.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now our button behaves as expected: clicking on the button will issue an HTTP <code>DELETE</code> to the server against the URL for
the current contact, delete the contact and redirect back to the contact list page, with a nice flash message.</p>
</div>
<div class="paragraph">
<p>Is everything working smoothly now?</p>
</div>
</section>
<section class="sect3">
<h4 id="_updating_the_location_bar_url_properly">Updating The Location Bar URL Properly</h4>
<div class="paragraph">
<p>Well, almost.</p>
</div>
<div class="paragraph">
<p>
If you click on the button you will notice that, despite the redirect, the URL in the location bar is
not correct.  It still points to <code>/contacts/{{ contact.id }}</code>.  That’s because we haven’t told htmx to update
the URL: it just issues the <code>DELETE</code> request and then updates the DOM with the response.</p>
</div>
<div class="paragraph">
<p>As we mentioned, boosting via <code>hx-boost</code> will naturally update the location bar for you, mimicking normal anchors and forms, but in
this case we are building a custom button hypermedia control to issue a <code>DELETE</code>.  We
need to let htmx know that we want the resulting URL from this request “pushed” into the location bar.</p>
</div>
<div class="paragraph">
<p>
We can achieve this by adding the <code>hx-push-url</code> attribute with the value <code>true</code> to our button:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Deleting a contact, now with proper location information</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
          <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
          <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Delete Contact
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We tell htmx to push the redirected URL up into the location bar.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p><em>Now</em> we are done.</p>
</div>
<div class="paragraph">
<p>We have a button that, all by itself, is able to issue a properly formatted HTTP <code>DELETE</code> request to
the correct URL, and the UI and location bar are all updated correctly.  This was accomplished with three declarative
attributes placed directly on the button: <code>hx-delete</code>, <code>hx-target</code> and <code>hx-push-url</code>.</p>
</div>
<div class="paragraph">
<p>This required more work than the <code>hx-boost</code> change, but the explicit code makes it easy to see what the button is doing
as a custom hypermedia control.  The resulting solution feels clean; it takes advantage of
the built-in features of the web as a hypermedia system without any URL hacks.</p>
</div>
</section>
<section class="sect3">
<h4 id="_one_more_thing">One More Thing…​</h4>
<div class="paragraph">
<p>

There is one additional “bonus” feature we can add to our “Delete Contact” button: a confirmation dialog.  Deleting
a contact is a destructive operation and as it stands right now, if the user inadvertently clicked the “Delete Contact”
button, the application would just delete that contact.  Too bad, so sad for the user.</p>
</div>
<div class="paragraph">
<p>Fortunately htmx has an easy mechanism for adding a confirmation message on destructive operations like this: the
<code>hx-confirm</code> attribute.  You can place this attribute on an element, with a message as its value, and the JavaScript
method <code>confirm()</code> will be called before a request is issued, which will show a simple confirmation dialog to the user
asking them to confirm the action. Very easy and a great way to prevent accidents.</p>
</div>
<div class="paragraph">
<p>Here is how we would add confirmation of the contact delete operation:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Confirming deletion</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
          <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
          <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
          <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Delete Contact
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This message will be shown to the user, asking them to confirm the delete.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when someone clicks on the “Delete Contact” button, they will be presented with a prompt that asks “Are you sure
you want to delete this contact?” and they will have an opportunity to cancel if they clicked the button in error.  Very
nice.</p>
</div>
<div class="paragraph">
<p>With this final change we now have a pretty solid “delete contact” mechanism: we are using the correct RESTful routes
and HTTP Methods, we are confirming the deletion, and we have removed a lot of the cruft that normal HTML imposes on us,
all while using declarative attributes in our HTML and staying firmly within the normal hypermedia model of the web.</p>
</div>
</section>
<section class="sect3">
<h4 id="_progressive_enhancement_2">Progressive Enhancement?</h4>
<div class="paragraph">
<p>
As we noted earlier about this solution: it is <em>not</em> a progressive enhancement to our web application. If
someone has disabled JavaScript then this “Delete Contact” button will no longer work.  We would need to do additional
work to keep the older form-based mechanism working in a JavaScript-disabled environment.</p>
</div>
<div class="paragraph">
<p>Progressive Enhancement can be a hot-button topic in web development, with lots of passionate opinions and perspectives.
Like nearly all JavaScript libraries, htmx makes it possible to create applications that do not function in the absence of
JavaScript. Retaining support for non-JavaScript clients requires additional work and complexity in your application.  It
is important to determine exactly how important supporting non-JavaScript clients is before you begin using htmx, or any
other JavaScript framework, for improving your web applications.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_next_steps_validating_contact_emails">Next Steps: Validating Contact Emails</h3>
<div class="paragraph">
<p>
Let’s move on to another improvement in our application. A big part of any web app is validating the data that is
submitted to the server: ensuring emails are correctly formatted and unique, numeric values are valid, dates are
acceptable, and so forth.</p>
</div>
<div class="paragraph">
<p>Currently, our application has a small amount of validation that is done entirely server-side and that displays an error
message when an error is detected.</p>
</div>
<div class="paragraph">
<p>We are not going to go into the details of how validation works in the model objects, but recall what
the code for updating a contact looks like from Chapter 3:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Server-side validation on contact update</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">def contacts_edit_post(contact_id=0):
    c = Contact.find(contact_id)
    c.update(request.form['first_name'], request.form['last_name'], request.form['phone'], request.form['email'])
    if c.save(): (1)
        flash("Updated Contact!")
        return redirect("/contacts/" + str(contact_id))
    else:
        return render_template("edit.html", contact=c) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We attempt to save the contact.
</li>
<li>
If the save does not succeed we re-render the form to display error messages.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So we attempt to save the contact, and, if the <code>save()</code> method returns true, we redirect to the contact’s detail page.
If the <code>save()</code> method does not return true, that indicates that there was a validation error; instead of redirecting,
we re-render the HTML for editing the contact.  This gives the user a chance to correct the errors, which are displayed
alongside the inputs.</p>
</div>
<div class="paragraph">
<p>Let’s take a look at the HTML for the email input:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Validation error messages</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>(1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Display any errors associated with the email field
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We have a label for the input, an input of type <code>text</code> and then a bit of HTML to display any error messages associated
with the email.  When the template is rendered on the server, if there are errors associated with the contact’s email, they will
be displayed in this span, which will be highlighted red.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Server-Side Validation Logic</div>
<div class="paragraph">
<p>Right now there is a bit of logic in the contact class that checks if there are any other contacts with
the same email address, and adds an error to the contact model if so, since we do not want to have duplicate emails in the
database.  This is a very common validation example: emails are usually unique and adding two contacts with the same email
is almost certainly a user error.</p>
</div>
<div class="paragraph">
<p>Again, we are not going into the details of how validation works in our models, but almost all server-side frameworks provide ways to validate data and collect errors to display to the user.  This sort of infrastructure is very common in
Web 1.0 server-side frameworks.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>The error message shown when a user attempts to save a contact with a duplicate email is "Email Must Be Unique":</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_validation_error.png" alt="Red text next to email input in form: Email Must Be Unique" loading="lazy">
</div>
<figcaption class="title">Figure 5. Email validation error</figcaption>
</figure>
<div class="paragraph">
<p>All of this is done using plain HTML and using Web 1.0 techniques, and it works well.</p>
</div>
<div class="paragraph">
<p>However, as the application currently stands, there are two annoyances.</p>
</div>
<div class="ulist">
<ul>
<li>
First, there is no email format validation: you can enter whatever characters you’d like as an email and,
as long as they are unique, the system will allow it.
</li>
<li>
Second, we only check the email’s uniqueness when all the data is submitted: if a user has entered a duplicate email, they will not find out until they have filled in
all the fields.  This could be
quite annoying if the user was accidentally reentering a contact and had to put all the contact information in
before being made aware of this fact.
</li>
</ul>
</div>
<section class="sect3">
<h4 id="_updating_our_input_type">Updating Our Input Type</h4>
<div class="paragraph">
<p>
For the first issue, we have a pure HTML mechanism for improving our application: HTML 5 supports inputs of
type <code>email</code>.  All we need to do is switch our input from type <code>text</code> to type <code>email</code>, and the browser will
enforce that the value entered properly matches the email format:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Changing the input to type <code>email</code></figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A change of the <code>type</code> attribute to <code>email</code> ensures that values entered are valid emails.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With this change, when the user enters a value that isn’t a valid email, the browser will display an
error message asking for a properly formed email in that field.</p>
</div>
<div class="paragraph">
<p>So a simple single-attribute change done in pure HTML improves our validation and addresses the first problem
we noted.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Server-Side vs. Client-Side Validations</div>
<div class="paragraph">
<p>
Experienced web developers might be grinding their teeth at the code above: this validation
is done on <em>the client-side</em>.  That is, we are relying on the browser to detect the malformed
email and correct the user.  Unfortunately, the client-side is not trustworthy: a browser may have a
bug in it that allows the user to circumvent this validation code.  Or, worse, the user may be malicious
and figure out a mechanism around our validation entirely, such as using the developer console to edit the HTML.</p>
</div>
<div class="paragraph">
<p>This is a perpetual danger in web development: all validations done on the client-side cannot be trusted
and, if the validation is important, <em>must be redone</em> on the server-side.  This is less of a problem in
Hypermedia-Driven Applications than in Single Page Applications, because the focus of HDAs is the server-side, but it is worth bearing in mind as you build your application.</p>
</div>
</div>
</aside>
</section>
<section class="sect3">
<h4 id="_inline_validation">Inline Validation</h4>
<div class="paragraph">
<p>
While we have improved our validation experience a bit, the user must still submit the form to get any feedback
on duplicate emails.  We can next use htmx to improve this user experience.</p>
</div>
<div class="paragraph">
<p>It would be better if the user were able to see a duplicate email error immediately after entering the email value.  It
turns out that inputs fire a <code>change</code> event and, in fact, the <code>change</code> event is the <em>default trigger</em> for inputs in htmx.
So, putting this feature to work, we can implement the following behavior: when the user enters an email, immediately
issue a request to the server and validate that email, and render an error message if necessary.</p>
</div>
<div class="paragraph">
<p>Recall the current HTML for our email input:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The initial email configuration</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> (2)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This is the input that we want to have drive an HTTP request to validate the email.
</li>
<li>
This is the span we want to put the error message, if any, into.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So we want to add an <code>hx-get</code> attribute to this input.  This will cause the input to issue an HTTP <code>GET</code> request to a
given URL to validate the email.  We then want to target the error span following the input with any error message
returned from the server.</p>
</div>
<div class="paragraph">
<p>Let’s make those changes to our HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our updated HTML</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/email<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
           <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>next .error<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
           <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue an HTTP <code>GET</code> to the <code>email</code> endpoint for the contact.
</li>
<li>
Target the next element with the class <code>error</code> on it.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that in the <code>hx-target</code> attribute we are using a <em>relative positional</em> selector, <code>next</code>.  This is a feature of htmx and
an extension to normal CSS.  Htmx supports prefixes that will find targets <em>relative</em> to the current element.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Relative Positional Expressions in Htmx</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>next</code></dt>
<dd>
<p>Scan forward in the DOM for the next matching element, e.g., <code>next .error</code></p>
</dd>
<dt class="hdlist1"><code>previous</code></dt>
<dd>
<p>Scan backwards in the DOM for the closest previous matching element, e.g., <code>previous .alert</code></p>
</dd>
<dt class="hdlist1"><code>closest</code></dt>
<dd>
<p>Scan the parents of this element for matching element, e.g., <code>closest table</code></p>
</dd>
<dt class="hdlist1"><code>find</code></dt>
<dd>
<p>Scan the children of this element for matching element, e.g., <code>find span</code></p>
</dd>
<dt class="hdlist1"><code>this</code></dt>
<dd>
<p>the current element is the target (default)</p>
</dd>
</dl>
</div>
</div>
</aside>
<div class="paragraph">
<p>By using relative positional expressions we can avoid adding explicit ids to elements and take advantage of the local
structure of HTML.</p>
</div>
<div class="paragraph">
<p>So, in our example with added <code>hx-get</code> and <code>hx-target</code> attributes, whenever someone changes the value of the input (remember, <code>change</code> is the
<em>default</em> trigger for inputs in htmx) an HTTP <code>GET</code> request will be issued to the given URL. If there are any errors, they will be loaded into the error span.</p>
</div>
</section>
<section class="sect3">
<h4 id="_validating_emails_server_side">Validating Emails Server-Side</h4>
<div class="paragraph">
<p>Next, let’s look at the server-side implementation.  We are going to add another endpoint, similar to our edit
endpoint in some ways: it is going to look up the contact based on the ID encoded in the URL.  In this case, however,
we only want to update the email of the contact, and we obviously don’t want to save it!  Instead, we will call the
<code>validate()</code> method on it.</p>
</div>
<div class="paragraph">
<p>That method will validate the email is unique and so forth.  At that point we can return any errors associated with the
email directly, or the empty string if none exist.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Code for our email validation endpoint</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;/email", methods=["GET"])
def contacts_email_get(contact_id=0):
    c = Contact.find(contact_id) (1)
    c.email = request.args.get('email') (2)
    c.validate() (3)
    return c.errors.get('email') or "" (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Look up the contact by id.
</li>
<li>
Update its email (note that since this is a <code>GET</code>, we use the <code>args</code> property rather than the <code>form</code> property).
</li>
<li>
Validate the contact.
</li>
<li>
Return a string, either the errors associated with the email field or, if there are none, the empty string.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With this small bit of server-side code in place, we now have the following user experience: when a user enters an email
and tabs to the next input field, they are immediately notified if the email is already taken.</p>
</div>
<div class="paragraph">
<p>Note that the email validation is <em>still</em> done when the entire contact is submitted for an update, so there is no danger
of allowing duplicate email contacts to slip through: we have simply made it possible for users to catch this situation
earlier by use of htmx.</p>
</div>
<div class="paragraph">
<p>It is also worth noting that this particular email validation <em>must</em> be done on the server side: you cannot
determine that an email is unique across all contacts unless you have access to the data store of record.  This is another
simplifying aspect of Hypermedia-Driven Applications: since validations are done server-side, you have access to all
the data you might need to do any sort of validation you’d like.</p>
</div>
<div class="paragraph">
<p>Here again we want to stress that this interaction is done entirely within the hypermedia model: we are using declarative
attributes and exchanging hypermedia with the server in a manner very similar to how links or forms work. But we have managed
to improve our user experience dramatically.</p>
</div>
</section>
<section class="sect3">
<h4 id="_taking_the_user_experience_further">Taking The User Experience Further</h4>
<div class="paragraph">
<p>Despite the fact that we haven’t added a lot of code here, we have a fairly sophisticated user interface, at
least when compared with plain HTML-based applications.  However, if you have used more advanced Single Page Applications
you have probably seen the pattern where an email field (or a similar sort of input) is validated <em>as you type</em>.</p>
</div>
<div class="paragraph">
<p>This seems like the sort of interactivity that is only possible with a sophisticated, complex JavaScript framework, right?</p>
</div>
<div class="paragraph">
<p>Well, no.</p>
</div>
<div class="paragraph">
<p>It turns out that you can implement this functionality in htmx, using pure HTML attributes.</p>
</div>
<div class="paragraph">
<p>



In fact, all we need to do is to change our trigger.  Currently, we are using the default trigger for inputs, which is the
<code>change</code> event.  To validate as the user types, we would want to capture the <code>keyup</code> event as well:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Triggering With <code>keyup</code> events</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>next .error<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
           <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An explicit <code>keyup</code> trigger has been added along with <code>change</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With this tiny change, every time a user types a character we will issue a request and validate the email.  Simple.</p>
</div>
</section>
<section class="sect3">
<h4 id="_debouncing_our_validation_requests">Debouncing Our Validation Requests</h4>
<div class="paragraph">
<p>
Simple, yes, but probably not what we want: issuing a new request on every key up event would be very wasteful
and could potentially overwhelm your server.  What we want instead is only issue the request if the user has paused for
a small amount of time.  This is called “debouncing” the input, where requests are delayed until things have “settled down”.</p>
</div>
<div class="paragraph">
<p>Htmx supports a <code>delay</code> modifier for triggers that allows you to debounce a request by adding a delay before the request
is sent. If another event of the same kind appears within that interval, htmx will not issue the request and will reset
the timer.</p>
</div>
<div class="paragraph">
<p>This turns out to be exactly what we want for our email input: if the user is busy typing in an email we won’t interrupt them,
but as soon as they pause or leave the field, we’ll issue a request.</p>
</div>
<div class="paragraph">
<p>Let’s add a delay of 200 milliseconds to the <code>keyup</code> trigger, which is long enough to detect that the user has stopped
typing.:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Debouncing the <code>keyup</code> event</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>next .error<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup delay:200ms<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
           <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We debounce the <code>keyup</code> event by adding a <code>delay</code> modifier.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now we no longer issue a stream of validation requests as the user types.  Instead, we wait until the user pauses for
a bit and then issue the request.  Much better for our server, and still a great user experience.</p>
</div>
</section>
<section class="sect3">
<h4 id="_ignoring_non_mutating_keys">Ignoring Non-Mutating Keys</h4>
<div class="paragraph">
<p>There is one last issue we should address with the keyup event: as it stands we will issue a request no matter <em>which</em> keys
are pressed, even if they are keys that have no effect on the value of the input, such as arrow keys.  It would be better
if there were a way to only issue a request if the input value has changed.</p>
</div>
<div class="paragraph">
<p>
And it turns out that htmx has support for that exact pattern, by using the <code>changed</code> modifier for events.  (Not to be
confused with the <code>change</code> event triggered by the DOM on input elements.)</p>
</div>
<div class="paragraph">
<p>By adding <code>changed</code> to our <code>keyup</code> trigger, the input will not issue validation requests unless the keyup event actually
updates the inputs value:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Only sending requests when the input value changes</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/email<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>next .error<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup delay:200ms changed<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
           <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Email<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.email }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors['email'] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We do away with pointless requests by only issuing them when the input’s value has actually changed.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>That’s some pretty good-looking and powerful HTML, providing an experience that most developers would think requires
a complicated client-side solution.</p>
</div>
<div class="paragraph">
<p>With a total of three attributes and a simple new server-side endpoint, we have added a fairly sophisticated user
experience to our web application.  Even better, any email validation rules we add on the server side will
<em>automatically</em> just work using this model: because we are using hypermedia as our communication mechanism there is no
need to keep a client-side and server-side model in sync with one another.</p>
</div>
<div class="paragraph">
<p>A great demonstration of the power of the hypermedia architecture!</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_another_application_improvement_paging">Another Application Improvement: Paging</h3>
<div class="paragraph">
<p>
Let’s move on from the contact editing page for a bit and improve the root page of the application, found
at the <code>/contacts</code> path and rendering the <code>index.html</code> template.</p>
</div>
<div class="paragraph">
<p>Currently, Contact.app does not support paging: if there are 10,000 contacts in the database we will show
all 10,000 contacts on the root page.  Showing so much data can bog a browser (and a server) down, so most web applications
adopt a concept of “paging” to deal with data sets this large, where only one “page” of a smaller number of items is
shown, with the ability to navigate around the pages in the data set.</p>
</div>
<div class="paragraph">
<p>Let’s fix our application so that we only show ten contacts at a time with a “Next” and “Previous” link if there are more
than 10 contacts in the contact database.</p>
</div>
<div class="paragraph">
<p>The first change we will make is to add a simple paging widget to our <code>index.html</code> template.</p>
</div>
<div class="paragraph">
<p>We will conditionally include two links:</p>
</div>
<div class="ulist">
<ul>
<li>
If we are beyond the “first” page, we will include a link to the previous page
</li>
<li>
If there are ten contacts in the current result set, we will include a link to the next page
</li>
</ul>
</div>
<div class="paragraph">
<p>This isn’t a perfect paging widget: ideally we’d show the number of pages and offer the ability to do more
specific page navigation, and there is the possibility that the next page might have 0 results in it since
we aren’t checking the total results count, but it will do for now for our simple application.</p>
</div>
<div class="paragraph">
<p>Let’s look at the jinja template code for this in <code>index.html</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding paging widgets to our list of contacts</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> (1)
        {% if page &gt; 1 %}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?page={{ page - 1 }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Previous<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (2)
        {% endif %}
        {% if contacts|length == 10 %}
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?page={{ page + 1 }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Next<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (3)
        {% endif %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Include a new div under the table to hold our navigation links.
</li>
<li>
If we are beyond page 1, include an anchor tag with the page decremented by one.
</li>
<li>
If there are 10 contacts in the current page, include an anchor tag linking to the next page by incrementing it by one.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that here we are using a special jinja filter syntax <code>contacts|length</code> to compute the length of the contacts
list.  The details of this filter syntax is beyond the scope of this book, but in this case you can think of it as
invoking the <code>contacts.length</code> property and then comparing that with <code>10</code>.</p>
</div>
<div class="paragraph">
<p>Now that we have these links in place, let’s address the server-side implementation of paging.</p>
</div>
<div class="paragraph">
<p>We are using the <code>page</code> request parameter to encode the paging state of the UI.  So, in our handler, we need to look for
that <code>page</code> parameter and pass that through to our model, as an integer, so the model knows which page of contacts to return:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding paging to our request handler</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    page = int(request.args.get("page", 1)) (1)
    if search is not None:
        contacts_set = Contact.search(search)
    else:
        contacts_set = Contact.all(page) (2)
    return render_template("index.html", contacts=contacts_set, page=page)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Resolve the page parameter, defaulting to page 1 if no page is passed in.
</li>
<li>
Pass the page through to the model when loading all contacts so it knows which page of 10 contacts to
return.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This is fairly straightforward: we just need to get another parameter, like the <code>q</code> parameter we passed in for
searching contacts earlier, convert it to an integer and then pass it through to the <code>Contact</code> model, so it
knows which page to return.</p>
</div>
<div class="paragraph">
<p>And, with that small change, we are done: we now have a very basic paging mechanism for our web application.</p>
</div>
<div class="paragraph">
<p>And, believe it or not, it is already using AJAX, thanks to our use of <code>hx-boost</code> in the application.  Easy!</p>
</div>
<section class="sect3">
<h4 id="_click_to_load">Click To Load</h4>
<div class="paragraph">
<p>
This paging mechanism is fine for a basic web application, and it is used extensively on the internet.  But it has some
drawbacks associated with it: every time you click the “Next” or “Previous” buttons you get a whole new page of contacts
and lose any context you had on the previous page.</p>
</div>
<div class="paragraph">
<p>Sometimes a more advanced paging UI pattern might be better.  Maybe, rather than loading in a new page of elements and
replacing the current elements, it would be nicer to append the next page of elements <em>inline</em>, after the current
elements.</p>
</div>
<div class="paragraph">
<p>This is the common “click to load” UX pattern, found in more advanced web applications.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_click_to_load.png" alt="Button at the end of the contacts table: Load More" loading="lazy">
</div>
<figcaption class="title">Figure 6. A Click To Load UI</figcaption>
</figure>
<div class="paragraph">
<p>Here, you have a button that you can click, and it will load the next set of contacts directly into the page, rather
than “paging” to the next page.  This allows you to keep the current contacts “in context” visually on the page, but
still progress through them as you would in a normal, paged user interface.</p>
</div>
<div class="paragraph">
<p>Let’s see how we can implement this UX pattern in htmx.</p>
</div>
<div class="paragraph">
<p>It’s actually surprisingly simple: we can just take the existing “Next” link and repurpose it a bit using
nothing but a few htmx attributes!</p>
</div>
<div class="paragraph">
<p>
We want to have a button that, when clicked, appends the rows from the next page of contacts to the current,
existing table, rather than re-rendering the whole table.  This can be achieved by adding a new row to our table
that has just such a button in it:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Changing to “click to load”</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        {% for contact in contacts %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.phone }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
        {% if contacts|length == 10 %} (1)
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>closest tr<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
                            <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span>   <span class="token attr-name">(3)</span>
                            <span class="token attr-name">hx-select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody &gt; tr<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
                            <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?page={{ page + 1 }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                      Load More
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {% endif %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Only show “Load More” if there are 10 contact results in the current page.
</li>
<li>
Target the closest enclosing row.
</li>
<li>
Replace the entire row with the response from the server.
</li>
<li>
Select out the table rows from the response.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Let’s go through each attribute in detail here.</p>
</div>
<div class="paragraph">
<p>First, we are using <code>hx-target</code> to target the “closest” <code>tr</code> element, that is, the closest <em>parent</em> table row.</p>
</div>
<div class="paragraph">
<p>Second, we want to replace this <em>entire</em> row with whatever content comes back from the server.</p>
</div>
<div class="paragraph">
<p>Third, we want to yank out only the <code>tr</code> elements in the response.  We are replacing this <code>tr</code> element with a new set
of <code>tr</code> elements, which will have additional contact information in them, as well as, if necessary, a new “Load More”
button that points to the <em>next</em> next page.  To do this, we use a CSS selector <code>tbody &gt; tr</code> to ensure we only pull
out the rows in the body of the table in the response.  This avoids including rows in the table header, for example.</p>
</div>
<div class="paragraph">
<p>Finally, we issue an HTTP <code>GET</code> to the url that will serve the next page of contacts, which looks just like the “Next”
link from above.</p>
</div>
<div class="paragraph">
<p>Somewhat surprisingly, no server-side changes are necessary for this new functionality.  This is because of the flexibility
that htmx gives you with respect to how it processes server responses.</p>
</div>
<div class="paragraph">
<p>So, four attributes, and we now have a sophisticated “Click To Load” UX, via htmx.</p>
</div>
</section>
<section class="sect3">
<h4 id="_infinite_scroll">Infinite Scroll</h4>
<div class="paragraph">
<p>
Another common pattern for dealing with large sets of things is known as the “Infinite Scroll” pattern.  In this pattern,
as the last item of a list or table of elements is scrolled into view, more elements are loaded and appended to the list
or table.</p>
</div>
<div class="paragraph">
<p>Now, this behavior makes more sense in situations where a user is exploring a category or series of social media posts, rather
than in the context of a contact application.  However, for completeness, and to just show what you can do with
htmx, we will implement this pattern as well.</p>
</div>
<div class="paragraph">
<p>It turns out that we can repurpose the “Click To Load” code to implement this new pattern quite easily: if you think
about it for a moment, infinite scroll is really just the “Click To Load” logic, but rather than loading when a click
event occurs, we want to load when an element is “revealed” in the view portal of the browser.</p>
</div>
<div class="paragraph">
<p>As luck would have it, htmx offers a synthetic (non-standard) DOM event, <code>revealed</code> that can be used in tandem
with the <code>hx-trigger</code> attribute, to trigger a request when, well, when an element is revealed.</p>
</div>
<div class="paragraph">
<p>
So let’s convert our button to a span and take advantage of this event:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Changing to “infinite scroll”</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">{% if contacts|length == 10 %} (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>closest tr<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
                  <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>revealed<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
                  <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span>
                  <span class="token attr-name">hx-select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody &gt; tr<span class="token punctuation">"</span></span>
                  <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?page={{ page + 1 }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Loading More...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
{% endif %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We have converted our element from a button to a span, since the user will not be clicking on it.
</li>
<li>
We trigger the request when the element is revealed, that is when it comes into view in the portal.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>All we needed to do to convert from “Click to Load” to “Infinite Scroll” was to update our element to be
a span and then add the <code>revealed</code> event trigger.</p>
</div>
<div class="paragraph">
<p>The fact that switching to infinite scroll was so easy shows how well htmx generalizes HTML: just a few attributes allow
us to dramatically expand what we can achieve in the hypermedia.</p>
</div>
<div class="paragraph">
<p>And, again, we are doing all this while taking advantage of the RESTful model of the web. Despite all this new
behavior, we are still exchanging hypermedia with the server, with no JSON API response to be seen.</p>
</div>
<div class="paragraph">
<p>As the web was designed.</p>
</div>
</section>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_caution_with_modals_and_display_none">HTML Notes: Caution With Modals and "'Display: none'"</h3>
<div class="paragraph">
<p>

<em>Think twice about modals.</em> Modal windows have become popular, almost standard, in many web applications today.</p>
</div>
<div class="paragraph">
<p>Unfortunately, modal windows do not play well with much of the infrastructure of the web and introduce client-side state that can be difficult (though not impossible) to integrate cleanly with the hypermedia-based approach.</p>
</div>
<div class="paragraph">
<p>Modal windows can be used safely for views that don’t constitute a resource or correspond to a domain entity:</p>
</div>
<div class="ulist">
<ul>
<li>
Alerts
</li>
<li>
Confirmation dialogs
</li>
<li>
Forms for creating/updating entities
</li>
</ul>
</div>
<div class="paragraph">
<p>Otherwise, consider using alternatives such as inline editing, or a separate page, rather than a modal.</p>
</div>
<div class="paragraph">
<p><em>Use <code>display: none;</code> with care</em>. The issue is that it is not purely cosmetic — it also removes elements from the accessibility tree and keyboard focus. This is sometimes done to present the same content to visual and aural interfaces. If you want to hide an element visually without hiding it from assistive technology (e.g. the element contains information that is communicated through styling), you can use this utility class:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-css" tabindex="0"><code class="language-css" data-lang="css"><span class="token selector">.vh</span> <span class="token punctuation">{</span>
	<span class="token property">clip</span><span class="token punctuation">:</span> <span class="token function">rect</span><span class="token punctuation">(</span>0 0 0 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token property">clip-path</span><span class="token punctuation">:</span> <span class="token function">inset</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token property">block-size</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
	<span class="token property">inline-size</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span>
	<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
	<span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p><code>vh</code> is short for “visually hidden.” This class uses multiple methods and workarounds to make sure no browser removes the element’s function.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_more_htmx_patterns">More Htmx Patterns</h2>
<div class="sectionbody">
<section class="sect2">
<h3 id="_active_search">Active Search</h3>
<div class="paragraph">
<p>So far so good with Contact.app: we have a nice little web application with some significant improvements over a plain
HTML-based application. We’ve added a proper “Delete Contact” button, done some dynamic validation of input and looked
at different approaches to add paging to the application.  As we have said, many web developers would expect that
a lot of JavaScript-based scripting would be required to get these features, but we’ve done it all in relatively
pure HTML, using only htmx attributes.</p>
</div>
<div class="paragraph">
<p>We <em>will</em> eventually add some client-side scripting to our application: hypermedia is powerful, but it isn’t <em>all powerful</em> and
sometimes scripting might be the best (or only) way to achieve a given goal.  For now, however, let’s see what we can accomplish
with hypermedia.</p>
</div>
<div class="paragraph">
<p>The first advanced htmx feature we will create is known as the “Active Search” pattern.  Active Search is when, as a
user types text into a search box, the results of that search are dynamically shown.  This pattern was made popular
when Google adopted it for search results, and many applications now implement it.</p>
</div>
<div class="paragraph">
<p>To implement Active Search, we are going to use techniques closely related to the way we did email validation in the
previous chapter.  If you think about it, the two features are similar in many ways: in both cases we want to issue
a request as the user types into an input and then update some other element with a response.  The server-side implementations
will, of course, be very different, but the frontend code will look fairly similar due to htmx’s general approach of “issue
a request on an event and replace something on the screen.”</p>
</div>
<section class="sect3">
<h4 id="_our_current_search_ui">Our Current Search UI</h4>
<div class="paragraph">
<p>Let’s recall what the search field in our application currently looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our search form</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Term<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>q</code> or “query” parameter our client-side code uses to search.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Recall that we have some server-side code that looks for the <code>q</code> parameter and, if it is present, searches the contacts
for that term.</p>
</div>
<div class="paragraph">
<p>As it stands right now, the user must hit enter when the search input is focused, or click the “Search” button.  Both
of these events will trigger a <code>submit</code> event on the form, causing it to issue an HTTP <code>GET</code> and re-rendering the whole
page.</p>
</div>
<div class="paragraph">
<p>Currently, thanks to <code>hx-boost</code>, the form will use an AJAX request for this <code>GET</code>, but we  don’t yet get that nice
search-as-you-type behavior we want.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_active_search">Adding Active Search</h4>
<div class="paragraph">
<p>
To add active search behavior, we will attach a few htmx attributes to the search input.  We will leave the current form as it is, with an <code>action</code> and <code>method</code>, so that the normal
search behavior works even if a user does not have JavaScript enabled.  This will make our “Active Search” improvement a nice “progressive enhancement.”</p>
</div>
<div class="paragraph">
<p>So, in addition to the regular form behavior, we <em>also</em> want to issue an HTTP <code>GET</code> request when a key up occurs.  We want
to issue this request to the same URL as the normal form submission.  Finally, we only want to do this after a small
pause in typing has occurred.</p>
</div>
<div class="paragraph">
<p>As we said, this functionality is very similar to what we needed for email validation. We can, in fact copy
the <code>hx-trigger</code> attribute directly from our email validation example, with its small 200-millisecond delay, to allow a
user to stop typing before a request is triggered.</p>
</div>
<div class="paragraph">
<p>This is another example of how common patterns come up again and again when using htmx.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding active search behavior</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Term<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search, keyup delay:200ms changed<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (3)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Keep the original attributes, so search will work if JavaScript is not available.
</li>
<li>
Issue a <code>GET</code> to the same URL as the form.
</li>
<li>
Nearly the same <code>hx-trigger</code> specification as for the email input validation.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We made a small change to the <code>hx-trigger</code> attribute: we switched out the <code>change</code> event for the <code>search</code> event.
The <code>search</code> event is triggered when someone clears the search or hits the enter key.  It is a non-standard event, but
it doesn’t hurt to include here.  The main functionality of the feature is provided by the second triggering event, the <code>keyup</code>.
As in the email example, this trigger is delayed with the <code>delay:200ms</code> modifier to “debounce” the input requests and
avoid hammering our server with requests on every keyup.</p>
</div>
</section>
<section class="sect3">
<h4 id="_targeting_the_correct_element">Targeting The Correct Element</h4>
<div class="paragraph">
<p>What we have is close to what we want, but we need to set up the correct target.  Recall that the default
target for an element is itself.  As things currently stand, an HTTP <code>GET</code> request will be issued to the <code>/contacts</code> path,
which will, as of now, return an entire HTML document of search results, and then this whole document will be inserted
into the <em>inner</em> HTML of the search input.</p>
</div>
<div class="paragraph">
<p>This is, in fact, nonsense: <code>input</code> elements aren’t allowed to have any HTML inside of them. The browser will,
sensibly, just ignore the htmx request to put the response HTML inside the input.  So, at this point, when a user
types anything into our input, a request will be issued (you can see it in your browser development console if you try
it out) but, unfortunately, it will appear to the user as if nothing has happened at all.</p>
</div>
<div class="paragraph">
<p>To fix this issue, what do we want to target with the update instead?  Ideally we’d like to just target the actual
results: there is no reason to update the header or search input, and that could cause an annoying flash as focus jumps
around.</p>
</div>
<div class="paragraph">
<p>The <code>hx-target</code> attribute allows us to do exactly that.  Let’s use it to target the results body, the <code>tbody</code> element in
the table of contacts:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding active search behavior</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Search Term<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search, keyup delay:200ms changed<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
       ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Target the <code>tbody</code> tag on the page.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Because there is only one <code>tbody</code> on the page, we can use the general CSS selector <code>tbody</code> and htmx will target the
body of the table on the page.</p>
</div>
<div class="paragraph">
<p>Now if you try typing something into the search box, we’ll see some results: a request is made and the results are inserted
into the document within the <code>tbody</code>.  Unfortunately, the content that is coming back is still an entire HTML document.</p>
</div>
<div class="paragraph">
<p>Here we end up with a “double render” situation, where an entire document has been inserted <em>inside</em> another element, with
all the navigation, headers and footers and so forth re-rendered within that element.  This is an example of one of those mis-targeting issues we mentioned earlier.</p>
</div>
<div class="paragraph">
<p>Thankfully, it is pretty easy to fix.</p>
</div>
</section>
<section class="sect3">
<h4 id="_paring_down_our_content">Paring Down Our Content</h4>
<div class="paragraph">
<p>Now, we could use the same trick we reached for in the “Click To Load” and “Infinite Scroll” features: the <code>hx-select</code>
attribute.  Recall that the <code>hx-select</code> attribute allows us to pick out the part of the response we are interested in using
a CSS selector.</p>
</div>
<div class="paragraph">
<p>So we could add this to our input:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Using “hx-select” for active search</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup delay:200ms changed<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody tr<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Adding an <code>hx-select</code> that picks out the table rows in the <code>tbody</code> of the response.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>However, that isn’t the only fix for this problem, and, in this case, it isn’t the most efficient one.  Instead, let’s
change the <em>server-side</em> of our Hypermedia-Driven Application to serve <em>only the HTML content needed</em>.</p>
</div>
</section>
<section class="sect3">
<h4 id="_http_request_headers_in_htmx">HTTP Request Headers In Htmx</h4>
<div class="paragraph">
<p>In this section, we’ll look at another, more advanced technique for dealing with a situation where we only want a <em>partial
bit</em> of HTML, rather than a full document. Currently, we are letting the server create the full HTML document as response
and then, on the client side, we filter the HTML down to the bits that we want.  This is easy to do, and, in fact, might
be necessary if we don’t control the server side or can’t easily modify responses.</p>
</div>
<div class="paragraph">
<p>In our application, however, since we are doing “Full Stack” development (that is: we control both frontend <em>and</em> backend
code, and can easily modify either) we have another option: we can modify our server responses to return only the content
necessary, and remove the need to do client-side filtering.</p>
</div>
<div class="paragraph">
<p>This turns out to be more efficient, since we aren’t returning all the content surrounding the bit we are interested in,
saving bandwidth as well as CPU and memory on the server side.  So let’s explore returning
different HTML content based on the context information that htmx provides with the HTTP requests it makes.</p>
</div>
<div class="paragraph">
<p>Here’s a look again at the current server-side code for our search logic:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Server-side search</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    if search is not None:
        contacts_set = Contact.search(search) (1)
    else:
        contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This is where the search logic happens.
</li>
<li>
We simply re-render the <code>index.html</code> template every time, no matter what.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>How do we want to change this?  We want to render two different bits of HTML content <em>conditionally</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
If this is a “normal” request for the entire page, we want to render the <code>index.html</code> template in the current
manner.  In fact, we don’t want anything to change if this is a “normal” request.
</li>
<li>
However, if this is an “Active Search” request, we only want to render the content that is within the <code>tbody</code>,
that is, just the table rows of the page.
</li>
</ul>
</div>
<div class="paragraph">
<p>So we need some way to determine exactly which of these two different types of requests to the <code>/contact</code> URL is being
made, in order to know exactly which content we want to render.</p>
</div>
<div class="paragraph">
<p>It turns out that htmx helps us distinguish between these two cases by including a number of HTTP <em>Request Headers</em> when
it makes requests.  Request Headers are a feature of HTTP, allowing clients (e.g., web browsers) to include name/value pairs
of metadata associated with requests to help the server understand what the client is requesting.</p>
</div>
<div class="paragraph">
<p>Here is an example of (some of) the headers the FireFox browser issues when requesting <code><a href="index.html" class="bare">https://hypermedia.systems</a></code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">HTTP headers</figcaption>
<div class="content">
<pre class="highlight language-http" tabindex="0"><code class="language-http" data-lang="http">GET / HTTP/2
Host: hypermedia.systems
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:103.0) Gecko/20100101 Firefox/103.0
Accept:	text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Cache-Control: no-cache
Connection: keep-alive
DNT: 1
Pragma: no-cache</code></pre>
</div>
</figure>
<div class="paragraph">
<p>Htmx takes advantage of this feature of HTTP and adds additional headers and, therefore, additional <em>context</em> to the
HTTP requests that it makes.  This allows you to inspect those headers and choose
what logic to execute on the server, and what sort of HTML response you want to send to the client.</p>
</div>
<div class="paragraph">
<p>Here is a table of the HTTP headers that htmx includes in HTTP requests:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>HX-Boosted</code></dt>
<dd>
<p>This will be the string “true” if the request is made via an element using hx-boost</p>
</dd>
<dt class="hdlist1"><code>HX-Current-URL</code></dt>
<dd>
<p>This will be the current URL of the browser</p>
</dd>
<dt class="hdlist1"><code>HX-History-Restore-Request</code></dt>
<dd>
<p>This will be the string “true” if the request is for history restoration after a miss in the local history cache</p>
</dd>
<dt class="hdlist1"><code>HX-Prompt</code></dt>
<dd>
<p>This will contain the user response to an hx-prompt</p>
</dd>
<dt class="hdlist1"><code>HX-Request</code></dt>
<dd>
<p>This value is always “true” for htmx-based requests</p>
</dd>
<dt class="hdlist1"><code>HX-Target</code></dt>
<dd>
<p>This value will be the id of the target element if it exists</p>
</dd>
<dt class="hdlist1"><code>HX-Trigger-Name</code></dt>
<dd>
<p>This value will be the name of the triggered element if it exists</p>
</dd>
<dt class="hdlist1"><code>HX-Trigger</code></dt>
<dd>
<p>This value will be the id of the triggered element if it exists</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Looking through this list of headers, the last one stands out: we have an id, <code>search</code> on our search input.  So the
value of the <code>HX-Trigger</code> header should be set to <code>search</code> when the request is coming from the search input, which
has the id <code>search</code>.</p>
</div>
<div class="paragraph">
<p>Let’s add some conditional logic to our controller to look for that header and, if the value is <code>search</code>, we render
only the rows rather than the whole <code>index.html</code> template:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updating our server-side search</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search': (1)
          # TODO: render only the rows here (2)
    else:
        contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
If the request header <code>HX-Trigger</code> is equal to “search” we want to do something different.
</li>
<li>
We need to learn how to render just the table rows.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>OK, so how do we render only the result rows?</p>
</div>
</section>
<section class="sect3">
<h4 id="_factoring_your_templates">Factoring Your Templates</h4>
<div class="paragraph">
<p>Now we come to a common pattern in htmx: we want to <em>factor</em> our server-side templates.  This means that we want to
break our templates up a bit so that they can be called from multiple contexts.  In this case, we want to break the rows of
the results table out to a separate template we will call <code>rows.html</code>. We will include it from
the original <code>index.html</code> template, and also use it in our controller to render it by itself when we want to respond with only the
rows for Active Search requests.</p>
</div>
<div class="paragraph">
<p>Here’s what the table in our <code>index.html</code> file currently looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The contacts table</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>First<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Last<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        {% for contact in contacts %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.phone }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The <code>for</code> loop in this template is what produces all the rows in the final content generated by <code>index.html</code>.
What we want to do is to move the <code>for</code> loop and, therefore, the rows it creates out to a <em>separate template file</em> so that
only that small bit of HTML can be rendered independently from <code>index.html</code>.</p>
</div>
<div class="paragraph">
<p>Again, let’s call this new template <code>rows.html</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our new <code>rows.html</code> file</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">{% for contact in contacts %} (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.phone }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.email }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
{% endfor %}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>Using this template we can render only the <code>tr</code> elements for a given collection of contacts.</p>
</div>
<div class="paragraph">
<p>Of course, we still want to include this content in the <code>index.html</code> template: we are <em>sometimes</em> going to be
rendering the entire page, and sometimes only rendering the rows.  In order to keep the <code>index.html</code> template rendering
properly, we can include the <code>rows.html</code> template by using the jinja <code>include</code> directive at the position we want the content
from <code>rows.html</code> inserted:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Including the new file</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>First<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Last<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        {% include 'rows.html' %} (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This directive “includes” the <code>rows.html</code> file, inserting its content into the current template.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So far, so good: our <code>/contacts</code> page is still rendering properly, just as it did before we split the rows out of the
<code>index.html</code> template.</p>
</div>
</section>
<section class="sect3">
<h4 id="_using_our_new_template">Using Our New Template</h4>
<div class="paragraph">
<p>The last step in factoring our templates is to modify our web controller to take advantage of the new <code>rows.html</code> template
file when it responds to an active search request.</p>
</div>
<div class="paragraph">
<p>Since <code>rows.html</code> is just another template, just like <code>index.html</code>, all we need to do is call the <code>render_template</code>
function with <code>rows.html</code> rather than <code>index.html</code>. This will render <em>only</em> the row content rather than the entire
page:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updating our server-side search</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
          return render_template("rows.html", contacts=contacts_set) (1)
    else:
        contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Render the new template in the case of an active search.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when an Active Search request is made, rather than getting an entire HTML document back, we only get a partial
bit of HTML, the table rows for the contacts that match the search.  These rows are then inserted into the <code>tbody</code> on
the index page, without any need for <code>hx-select</code> or other client-side processing.</p>
</div>
<div class="paragraph">
<p>And, as a bonus, the old form-based search <em>still works</em>. We conditionally render the rows
only when the <code>search</code> input issues the HTTP request via htmx.  Again, this is a progressive enhancement to our
application.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">HTTP Headers &amp; Caching</div>
<div class="paragraph">
<p>One subtle aspect of the approach we are taking here, using headers to determine the content of what we return, is
a feature baked into HTTP: caching.  In our request handler, we are now returning different content depending on the
value of the <code>HX-Trigger</code> header.  If we were to use HTTP Caching, we might get into a situation where someone makes
a <em>non-htmx</em> request (e.g., refreshing a page) and yet the <em>htmx</em> content is returned from the HTTP cache, resulting
in a partial page of content for the user.</p>
</div>
<div class="paragraph">
<p>The solution to this problem is to use the HTTP Response <code>Vary</code> header and call out the htmx headers that you are using
to determine what content you are returning.  A full explanation of HTTP Caching is beyond the scope of this book, but the
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching">MDN article on the topic</a> is quite good, and the <a href="https://htmx.org/docs/#caching">htmx
documentation</a> discusses this issue as well.</p>
</div>
</div>
</aside>
</section>
<section class="sect3">
<h4 id="_updating_the_navigation_bar_with_hx_push_url">Updating the Navigation Bar With “hx-push-url”</h4>
<div class="paragraph">
<p>One shortcoming of our current Active Search implementation, when compared with the normal form submission, is that when
you submit the form version it updates the navigation bar of the browser to include the search term.  So, for example, if
you search for “joe” in the search box, you will end up with a url that looks like this in your browser’s nav bar:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The updated location after a form search</figcaption>
<div class="content">
<pre>https://example.com/contacts?q=joe</pre>
</div>
</figure>
<div class="paragraph">
<p>This is a nice feature of browsers: it allows you to bookmark this search or to copy the URL and send it to someone else.
All they have to do is to click on the link, and they will repeat the exact same search.  This is also tied in with
the browser’s notion of history: if you click the back button it will take you to the previous URL that you came
from.  If you submit two searches and want to go back to the first one, you can simply hit back and the browser
will “return” to that search.</p>
</div>
<div class="paragraph">
<p>
As it stands right now, during our Active Search, we are not updating the browser’s navigation bar. So, users aren’t getting links that can be copied and pasted, and you aren’t getting history entries either, which means no back button support.  Fortunately, we’ve already seen how to fix this: with the <code>hx-push-url</code> attribute.</p>
</div>
<div class="paragraph">
<p>The <code>hx-push-url</code> attribute lets you tell htmx “Please push the URL of this request into the browser’s navigation bar.”
Push might seem like an odd verb to use here, but that’s the term that the underlying browser history API uses, which
stems from the fact that it models browser history as a “stack” of locations: when you go to a new location, that
location is “pushed” onto the stack of history elements, and when you click “back”, that location is “popped” off
the history stack.</p>
</div>
<div class="paragraph">
<p>So, to get proper history support for our Active Search, all we need to do is to set the <code>hx-push-url</code> attribute to
<code>true</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updating the URL during active search</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup delay:200ms changed<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
By adding the <code>hx-push-url</code> attribute with the value <code>true</code>, htmx will update the URL when it makes a request.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, as Active Search requests are sent, the URL in the browser’s navigation bar is updated to have the proper query in
it, just like when the form is submitted.</p>
</div>
<div class="paragraph">
<p>You might not <em>want</em> this behavior.  You might feel it would be confusing to users to see the navigation bar updated
and have history entries for every Active Search made, for example.  Which is fine: you can simply omit the <code>hx-push-url</code>
attribute and it will go back to the behavior you want.  The goal with htmx is to be flexible enough to achieve the UX
that <em>you</em> want, while staying within the declarative HTML model.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_a_request_indicator">Adding A Request Indicator</h4>
<div class="paragraph">
<p>A final touch for our Active Search pattern is to add a request indicator to let the user know that a search is in
progress.  As it stands the user has no explicit signal that the active search functionality is handling a request. If the search takes a bit, a user may end up thinking that the feature isn’t working.  By adding a request indicator we let
the user know that the hypermedia application is busy and they should wait (hopefully not too long!) for the request to
complete.</p>
</div>
<div class="paragraph">
<p>Htmx provides support for request indicators via the <code>hx-indicator</code> attribute.  This attribute takes, you guessed it,
a CSS selector that points to the indicator for a given element.  The indicator can be anything, but it is typically
some sort of animated image, such as a gif or svg file, that spins or otherwise communicates visually that “something
is happening.”</p>
</div>
<div class="paragraph">
<p>

Let’s add a spinner after our search input:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a request indicator to search</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change, keyup delay:200ms changed<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tbody<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
       <span class="token attr-name">hx-indicator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#spinner<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spinner<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>htmx-indicator<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/img/spinning-circles.svg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Request In Flight...<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hx-indicator</code> attribute points to the indicator image after the input.
</li>
<li>
The indicator is a spinning circle svg file, and has the <code>htmx-indicator</code> class on it.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We have added the spinner right after the input.  This visually co-locates the request indicator with the element
making the request, and makes it easy for a user to see that something is in fact happening.</p>
</div>
<div class="paragraph">
<p>It just works, but how does htmx make the spinner appear and disappear? Note that the indicator <code>img</code> tag has the <code>htmx-indicator</code> class on it.  <code>htmx-indicator</code> is a CSS class that is
automatically injected into the page by htmx.  This class sets the default <code>opacity</code> of an element to <code>0</code>, which hides
the element from view, while at the same time not disrupting the layout of the page.</p>
</div>
<div class="paragraph">
<p>When an htmx request is triggered that points to this indicator, another class, <code>htmx-request</code> is added to the indicator
which transitions its opacity to 1.  So you can use just about anything as an indicator, and it will be hidden by default. Then, when a request is in flight, it will be shown.  This is all done via standard CSS classes, allowing you to control
the transitions and even the mechanism by which the indicator is shown (e.g., you might use <code>display</code> rather than
<code>opacity</code>).</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Use Request Indicators!</div>
<div class="paragraph">
<p>Request indicators are an important UX aspect of any distributed application.  It is unfortunate that browsers have
de-emphasized their native request indicators over time, and it is doubly unfortunate that request indicators are not
part of the JavaScript ajax APIs.</p>
</div>
<div class="paragraph">
<p>Be sure not to neglect this significant aspect of your application.  Requests might seem instant when you are
working on your application locally, but in the real world they can take quite a bit longer due to network latency.  It’s
often a good idea to take advantage of browser developer tools that allow you to throttle your local browser’s response
times.  This will give you a better idea of what real world users are seeing, and show you where indicators might help
users understand exactly what is going on.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>With this request indicator, we now have a pretty sophisticated user experience when compared with plain HTML, but
we’ve built it all as a hypermedia-driven feature.  No JSON or JavaScript to be seen.  And our implementation has the benefit of being a progressive enhancement; the application will continue to work for clients
that don’t have JavaScript enabled.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_lazy_loading">Lazy Loading</h3>
<div class="paragraph">
<p>
With Active Search behind us, let’s move on to a very different sort of enhancement: lazy loading.  Lazy loading is
when the loading of a particular bit of content is deferred until later, when needed.  This is commonly used as a
performance enhancement: you avoid the processing resources necessary to produce some data until that data is actually
needed.</p>
</div>
<div class="paragraph">
<p>Let’s add a count of the total number of contacts to Contact.app, just below the bottom of our contacts table.  This will
give us a potentially expensive operation that we can use to demonstrate how to add lazy loading with htmx.</p>
</div>
<div class="paragraph">
<p>First let’s update our server code in the <code>/contacts</code> request handler to get a count of the total number of contacts.
We will pass that count through to the template to render some new HTML.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a count to the UI</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    page = int(request.args.get("page", 1))
    count = Contact.count() (1)
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
            return render_template("rows.html", contacts=contacts_set, page=page, count=count)
    else:
        contacts_set = Contact.all(page)
    return render_template("index.html", contacts=contacts_set, page=page, count=count) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Get the total count of contacts from the Contact model.
</li>
<li>
Pass the count out to the <code>index.html</code> template to use when rendering.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As with the rest of the application, in the interest of staying focused on the <em>hypermedia</em> part of Contact.app, we’ll skip over the details of how <code>Contact.count()</code> works.  We just need to know that:</p>
</div>
<div class="ulist">
<ul>
<li>
It returns the total count of contacts in the contact database.
</li>
<li>
It may be slow (for the sake of our example).
</li>
</ul>
</div>
<div class="paragraph">
<p>Next lets add some HTML to our <code>index.html</code> that takes advantage of this new bit of data, showing a message next
to the "Add Contact" link with the total count of users.  Here is what our HTML looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a contact count element to the application</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/new<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Add Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>({{ count }} total Contacts)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>(1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A simple span with some text showing the total number of contacts.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Well that was easy, wasn’t it?  Now our users will see the total number of contacts next to the link to add new
contacts, to give them a sense of how large the contact database is.  This sort of rapid development is one of the
joys of developing web applications the old way.</p>
</div>
<div class="paragraph">
<p>Here is what the feature looks like in our application:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_total_contacts.png" alt="(22 total Contacts)" loading="lazy">
</div>
<figcaption class="title">Figure 7. Total contact count display</figcaption>
</figure>
<div class="paragraph">
<p>Beautiful.</p>
</div>
<div class="paragraph">
<p>Of course, as you probably suspected, all is not perfect.  Unfortunately, upon shipping this feature to production, we
start getting complaints from users that the application “feels slow.” Like all good developers faced with
a performance issue, rather than guessing what the issue might be, we try to get a performance profile of the application
to see what exactly is causing the problem.</p>
</div>
<div class="paragraph">
<p>It turns out, surprisingly, that the problem is that innocent looking <code>Contacts.count()</code> call, which is taking up to
a second and a half to complete.  Unfortunately, for reasons beyond the scope of this book, it is not possible to improve
that load time, nor is possible to cache the result.</p>
</div>
<div class="paragraph">
<p>This leaves us with two options:</p>
</div>
<div class="ulist">
<ul>
<li>
Remove the feature.
</li>
<li>
Come up with some other way to mitigate the performance issue.
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s assume that we can’t remove the feature, and therefore look at how we can mitigate this performance issue by
using htmx instead.</p>
</div>
<section class="sect3">
<h4 id="_pulling_out_the_expensive_code">Pulling Out The Expensive Code</h4>
<div class="paragraph">
<p>The first step in implementing the Lazy Load pattern is to pull the expensive code — that is, the call to <code>Contacts.count()</code> — out of the request handler for the <code>/contacts</code> endpoint.</p>
</div>
<div class="paragraph">
<p>Let’s put this function call into its own HTTP request handler as a new HTTP endpoint that we will put at <code>/contacts/count</code>.
For this new endpoint, we won’t need to render a template at all: its sole job is going to be to render that small bit of text
that is in the span, “(22 total Contacts).”</p>
</div>
<div class="paragraph">
<p>Here is what the new code will look like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Pulling the expensive code out</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    page = int(request.args.get("page", 1)) (1)
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
            return render_template("rows.html", contacts=contacts_set, page=page)
    else:
        contacts_set = Contact.all(page)
    return render_template("index.html", contacts=contacts_set, page=page) (2)

@app.route("/contacts/count")
def contacts_count():
    count = Contact.count() (3)
    return "(" + str(count) + " total Contacts)" (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We no longer call <code>Contacts.count()</code> in this handler.
</li>
<li>
<code>Count</code> is no longer passed out to the template to render in the <code>/contacts</code> handler.
</li>
<li>
We create a new handler at the <code>/contacts/count</code> path that does the expensive calculation.
</li>
<li>
Return the string with the total number of contacts.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So now we have moved the performance issue out of the <code>/contacts</code> handler code, which renders the main contacts table,
and created a new HTTP endpoint that will produce this expensive-to-create count string for us.</p>
</div>
<div class="paragraph">
<p>Now we need to get the content from this new handler <em>into</em> the span, somehow.  As we said earlier, the default behavior
of htmx is to place any content it receives for a given request into the <code>innerHTML</code> of an element, and that turns out
to be exactly what we want here: we want to retrieve this text and put it into the <code>span</code>.  So we can simply place an
<code>hx-get</code> attribute on the span, pointing to this new path, and do exactly that.</p>
</div>
<div class="paragraph">
<p>However, recall that the default <em>event</em> that will trigger a request for a <code>span</code> element in htmx is the <code>click</code> event.
Well, that’s not what we want!  Instead, we want this request to trigger immediately, when the page loads.</p>
</div>
<div class="paragraph">
<p>To do this, we can add the <code>hx-trigger</code> attribute to update the trigger of the requests for the element, and use the
<code>load</code> event.</p>
</div>
<div class="paragraph">
<p>The <code>load</code> event is a special event that htmx triggers on all content when it is loaded into the DOM.  By setting <code>hx-trigger</code>
to <code>load</code>, we will cause htmx to issue the <code>GET</code> request when the <code>span</code> element is loaded into the page.</p>
</div>
<div class="paragraph">
<p>Here is our updated template code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a contact count element to the application</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/new<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Add Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/count<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>(1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue a <code>GET</code> to <code>/contacts/count</code> when the <code>load</code> event occurs.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that the <code>span</code> starts empty: we have removed the content from it, and we are allowing the request to <code>/contacts/count</code>
to populate it instead.</p>
</div>
<div class="paragraph">
<p>And, check it out, our <code>/contacts</code> page is fast again!  When you navigate to the page it feels very snappy and
profiling shows that yes, indeed, the page is loading much more quickly.  Why is that?  Well, we’ve deferred the
expensive calculation to a secondary request, allowing the initial request to finish loading faster.</p>
</div>
<div class="paragraph">
<p>You might say “OK, great, but it’s still taking a second or two to get the total count on the page.”  True, but
often the user may not be particularly interested in the total count.  They may just want to come to the page and
search for an existing user, or perhaps they may want to edit or add a user.  The total count of contacts
is just a “nice to have” bit of information in these cases.</p>
</div>
<div class="paragraph">
<p>By deferring the calculation of the count in this manner we let users get on with their use of the application while we
perform the expensive calculation.</p>
</div>
<div class="paragraph">
<p>Yes, the total time to get all the information on the screen takes just as long.  It actually will be a bit longer, since
we now need two HTTP requests to get all the information for the page.  But the <em>perceived performance</em> for the end user will
be much better: they can do what they want nearly immediately, even if some information isn’t available instantaneously.</p>
</div>
<div class="paragraph">
<p>Lazy Loading is a great tool to have in your belt when optimizing web application performance.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_an_indicator">Adding An Indicator</h4>
<div class="paragraph">
<p>
A shortcoming of the current implementation is that currently there is no indication that the count request is in flight,
it just appears at some point when the request finishes.</p>
</div>
<div class="paragraph">
<p>This isn’t ideal.  What we want here is an indicator, just like we added in our Active Search example.  And, in fact, we can
simply reuse that same exact spinner image, copy-and-pasted into the new HTML we have created.</p>
</div>
<div class="paragraph">
<p>Now, in this case, we have a one-time request and, once the request is over, we are not going to need the spinner anymore.
So it doesn’t make sense to use the exact same approach we did with the active search example.  Recall that in that
case we placed a spinner <em>after</em> the span and using the <code>hx-indicator</code> attribute to point to it.</p>
</div>
<div class="paragraph">
<p>In this case, since the spinner is only used once, we can put it <em>inside</em> the content of the span.  When the request
completes the content in the response will be placed inside the span, replacing the spinner with the computed contact
count.  It turns out that htmx allows you to place indicators with the <code>htmx-indicator</code> class on them inside of elements
that issue htmx-powered requests.  In the absence of an <code>hx-indicator</code> attribute, these internal indicators will be shown
when a request is in flight.</p>
</div>
<div class="paragraph">
<p>So let’s add that spinner from the active search example as the initial content in our span:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding an indicator to our lazily loaded content</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/count<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spinner<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>htmx-indicator<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/img/spinning-circles.svg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>(1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Yep, that’s it.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now when the user loads the page, rather than having the total contact count magically appear,
there is a nice spinner indicating that something is coming.  Much better.</p>
</div>
<div class="paragraph">
<p>Note that all we had to do was copy and paste our indicator from the active search example into the <code>span</code>.  Once again
we see how htmx provides flexible, composable features and building blocks. Implementing a new feature is often just copy-and-paste, maybe a tweak or two, and you are done.</p>
</div>
</section>
<section class="sect3">
<h4 id="_but_thats_not_lazy">But That’s Not Lazy!</h4>
<div class="paragraph">
<p>
You might say “OK, but that’s not really lazy.  We are still loading the count immediately when the page is loaded,
we are just doing it in a second request.  You aren’t really waiting until the value is actually needed.”</p>
</div>
<div class="paragraph">
<p>Fine.  Let’s make it <em>lazy</em> lazy: we’ll only issue the request when the <code>span</code> scrolls into view.</p>
</div>
<div class="paragraph">
<p>To do that, lets recall how we set up the infinite scroll example: we used the <code>revealed</code> event for our trigger.  That’s
all we want here, right?  When the element is revealed we issue the request?</p>
</div>
<div class="paragraph">
<p>Yep, that’s it.  Once again, we can mix and match concepts across various UX patterns to come up with solutions to
new problems in htmx.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Making it truly lazy</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/count<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>revealed<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spinner<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>htmx-indicator<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/img/spinning-circles.svg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Change the <code>hx-trigger</code> to <code>revealed</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now we have a truly lazy implementation, deferring the expensive computation until we are absolutely sure we need it. A
pretty cool trick, and, again, a simple one-attribute change demonstrates the flexibility of both htmx and the hypermedia
approach.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_inline_delete">Inline Delete</h3>
<div class="paragraph">
<p>
For our next hypermedia trick, we are going to implement the “Inline Delete” pattern.  With this feature, a contact can
be deleted directly from the table of all contacts, rather than requiring the user to navigate all the way to the edit view
of particular contact, in order to access the “Delete Contact” button we added in the last chapter.</p>
</div>
<div class="paragraph">
<p>Recall that we already have “Edit” and “View” links for each row, in the <code>rows.html</code> template:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The existing row actions</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Now we want to add a “Delete” link as well.  And, thinking on it, we want that link to act an awful lot like the
“Delete Contact” button from <code>edit.html</code>, don’t we?  We’d like to issue an HTTP <code>DELETE</code> to the URL for the given
contact and we want a confirmation dialog to ensure the user doesn’t accidentally delete a contact.</p>
</div>
<div class="paragraph">
<p>Here is the “Delete Contact” button html:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The existing row actions</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Delete Contact
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>As you may suspect by now, this is going to be another copy-and-paste job.</p>
</div>
<div class="paragraph">
<p>One thing to note is that, in the case of the “Delete Contact” button, we wanted to re-render the whole screen and update
the URL, since we are going to be returning from the edit view for the contact to the list view of all contacts.  In
the case of this link, however, we are already on the list of contacts, so there is no need to update the URL, and
we can omit the <code>hx-push-url</code> attribute.</p>
</div>
<div class="paragraph">
<p>
Here is the code for our inline “Delete” link:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The existing row actions</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Almost a straight copy of the “Delete Contact” button.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As you can see, we have added a new anchor tag and given it a blank target (the <code>#</code> value in its <code>href</code> attribute) to
retain the correct mouse-over styling behavior of the link.  We’ve also copied the <code>hx-delete</code>, <code>hx-confirm</code> and
<code>hx-target</code> attributes from the “Delete Contact” button, but omitted the <code>hx-push-url</code> attributes since we don’t want
to update the URL of the browser.</p>
</div>
<div class="paragraph">
<p>We now have inline delete working, even with a confirmation dialog.  A user can click on the “Delete” link and the
row will disappear from the UI as the entire page is re-rendered.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">A Style Sidebar</div>
<div class="paragraph">
<p>One side effect of adding this delete link is that we are starting to pile up the actions in a contact row:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_stacked_actions.png" alt="All 3 table rows have Edit, View, Delete links at the end" loading="lazy">
</div>
<figcaption class="title">Figure 8. That’s a lot of actions</figcaption>
</figure>
<div class="paragraph">
<p>It would be nice if we didn’t show the actions all in a row, and, additionally, it would be nice if we only showed the
actions when the user indicated interest in a given row.  We will return to this problem after we look at the relationship
between scripting and a Hypermedia-Driven Application in a later chapter.</p>
</div>
<div class="paragraph">
<p>For now, let’s just tolerate this less-than-ideal user interface, knowing that we will fix it later.</p>
</div>
</div>
</aside>
<section class="sect3">
<h4 id="_narrowing_our_target">Narrowing Our Target</h4>
<div class="paragraph">
<p>We can get even fancier here, however.  What if, rather than re-rendering the whole page, we just removed the row
for the contact?  The user is looking at the row anyway, so is there really a need to re-render the whole page?</p>
</div>
<div class="paragraph">
<p>To do this, we’ll need to do a couple of things:</p>
</div>
<div class="ulist">
<ul>
<li>
We’ll need to update this link to target the row that it is in.
</li>
<li>
We’ll need to change the swap to <code>outerHTML</code>, since we want to replace (really, remove) the entire row.
</li>
<li>
We’ll need to update the server side to render empty content when the <code>DELETE</code> is issued from a “Delete” link rather
than from the “Delete Contact” button on the contact edit page.
</li>
</ul>
</div>
<div class="paragraph">
<p>First things first, update the target of our “Delete” link to be the row that the link is in, rather than the entire
body.  We can once again take advantage of the relative positional <code>closest</code> feature to target the closest <code>tr</code>, like
we did in our “Click To Load” and “Infinite Scroll” features:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The existing row actions</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>closest tr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Updated to target the closest enclosing <code>tr</code> (table row) of the link.
</li>
</ol>
</div></figure>

</section>
<section class="sect3">
<h4 id="_updating_the_server_side">Updating The Server Side</h4>
<div class="paragraph">
<p>Now we need to update the server side.  We want to keep the “Delete Contact” button working as well, and in
that case the current logic is correct.  So we’ll need some way to differentiate between <code>DELETE</code> requests that are
triggered by the button and <code>DELETE</code> requests that come from this anchor.</p>
</div>
<div class="paragraph">
<p>The cleanest way to do this is to add an <code>id</code> attribute to the “Delete Contact” button, so that we can inspect the
<code>HX-Trigger</code> HTTP Request header to determine if the delete button was the cause of the request.  This is a simple
change to the existing HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding an <code>id</code> to the “delete contact” button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete-btn<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
            <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
            <span class="token attr-name">hx-push-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span>
            <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        Delete Contact
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An <code>id</code> attribute has been added to the button.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>By giving this button an id attribute, we now have a mechanism for differentiating between the delete button in the
<code>edit.html</code> template and the delete links in the <code>rows.html</code> template.  When this button issues a request, it will
look something like this:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-http" tabindex="0"><code class="language-http" data-lang="http">DELETE http://example.org/contacts/42 HTTP/1.1
Accept: text/html,*/*
Host: example.org
...
HX-Trigger: delete-btn
...</code></pre>
</div>
</figure>
<div class="paragraph">
<p>You can see that the request now includes the <code>id</code> of the button. This allows us to write code very similar to what we did
for the active search pattern, using a conditional on the <code>HX-Trigger</code> header to determine what we want to do.  If that
header has the value <code>delete-btn</code>, then we know the request came from the button on the edit page, and we can do what we
are currently doing: delete the contact and redirect to <code>/contacts</code> page.</p>
</div>
<div class="paragraph">
<p>If it <em>does not</em> have that value, then we can simply delete the contact and return an empty string.  This empty string
will replace the target, in this case the row for the given contact, thereby removing the row from the UI.</p>
</div>
<div class="paragraph">
<p>Let’s refactor our server-side code to do this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updating our server code to handle two different delete patterns</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/&lt;contact_id&gt;", methods=["DELETE"])
def contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete()
    if request.headers.get('HX-Trigger') == 'delete-btn': (1)
        flash("Deleted Contact!")
        return redirect("/contacts", 303)
    else:
        return "" (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
If the delete button on the edit page submitted this request, then continue to do the previous logic.
</li>
<li>
If not, simply return an empty string, which will delete the row.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And that’s our server-side implementation:  when a user clicks “Delete” on a contact row and confirms the delete, the row will
disappear from the UI.  Once again, we have a situation where just changing a few lines of simple code gives us a
dramatically different behavior. Hypermedia is powerful in this manner.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_htmx_swapping_model">The Htmx Swapping Model</h4>
<div class="paragraph">
<p>
This is pretty cool, but there is another improvement we can make if we take some time to understand the htmx content
swapping model: it would be nice if, rather than just instantly deleting the row, we faded it out before we removed
it.  The fade would make it clear that the row is being removed, giving the user some nice visual feedback on the
deletion.</p>
</div>
<div class="paragraph">
<p>It turns out we can do this pretty easily with htmx, but to do so we’ll need to dig in to exactly how htmx swaps content.</p>
</div>
<div class="paragraph">
<p>You might think that htmx simply puts the new content into the DOM, but that’s not in fact how it works.  Instead, content
goes through a series of steps as it is added to the DOM:</p>
</div>
<div class="ulist">
<ul>
<li>
When content is received and about to be swapped into the DOM, the <code>htmx-swapping</code> CSS class is added to the target
element.
</li>
<li>
A small delay then occurs (we will discuss why this delay exists in a moment).
</li>
<li>
Next, the <code>htmx-swapping</code> class is removed from the target and the <code>htmx-settling</code> class is added.
</li>
<li>
The new content is swapped into the DOM.
</li>
<li>
Another small delay occurs.
</li>
<li>
Finally, the <code>htmx-settling</code> class is removed from the target.
</li>
</ul>
</div>
<div class="paragraph">
<p>There is more to the swap mechanic (settling, for example, is a more advanced topic that we will discuss in a later chapter)
but this is enough for now.</p>
</div>
<div class="paragraph">
<p>Now, there are small delays in the process here, typically on the order of a few milliseconds.  Why so?  It turns out
that these small delays allow <em>CSS transitions</em> to occur.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">CSS Transitions</div>
<div class="paragraph">
<p>
CSS transitions are a technology that allow you to animate a transition from one style to another.  So, for example, if
you changed the height of something from 10 pixels to 20 pixels, by using a CSS transition you can make the element
smoothly animate to the new height.  These sorts of animations are fun, often increase application usability, and are
a great mechanism to add polish to your web application.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>Unfortunately, CSS transitions are difficult to access in plain HTML: you usually have to use JavaScript and add or remove classes
to get them to trigger.  This is why the htmx swap model is more complicated than you might initially think. By swapping
in classes and adding small delays, you can access CSS transitions purely within HTML, without needing to write any
JavaScript!</p>
</div>
</section>
<section class="sect3">
<h4 id="_taking_advantage_of_htmx_swapping">Taking Advantage of “htmx-swapping”</h4>
<div class="paragraph">
<p>OK, so, let’s go back and look at our inline delete mechanic:  we click an htmx-enhanced link which deletes the contact
and then swaps some empty content in for the row.  We know that before the <code>tr</code> element is removed, it will have the
<code>htmx-swapping</code> class added to it.  We can take advantage of that to write a CSS transition that fades the opacity of
the row to 0.  Here is what that CSS looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a fade out transition</figcaption>
<div class="content">
<pre class="highlight language-css" tabindex="0"><code class="language-css" data-lang="css"><span class="token selector">tr.htmx-swapping</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>1<span class="token punctuation">)</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token punctuation">(</span>2<span class="token punctuation">)</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> opacity 1s ease-out<span class="token punctuation">;</span> <span class="token punctuation">(</span>3<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We want this style to apply to <code>tr</code> elements with the <code>htmx-swapping</code> class on them.
</li>
<li>
The <code>opacity</code> will be 0, making it invisible.
</li>
<li>
The <code>opacity</code> will transition to 0 over a 1 second time period, using the <code>ease-out</code> function.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Again, this is not a CSS book and we are not going to go deeply into the details of CSS transitions, but hopefully the
above makes sense to you, even if this is the first time you’ve seen CSS transitions.</p>
</div>
<div class="paragraph">
<p>So, think about what this means from the htmx swapping model:  when htmx gets content back to swap into the row it will
put the <code>htmx-swapping</code> class on the row and wait a bit.  This will allow the transition to a zero opacity to occur,
fading the row out.  Then the new (empty) content will be swapped in, which will effectively remove the row.</p>
</div>
<div class="paragraph">
<p>Sounds good, and we are nearly there.  There is one more thing we need to do: the default “swap delay” for htmx is very
short, a few milliseconds.  That makes sense in most cases: you don’t want to have much of a delay before you put the
new content into the DOM.  But, in this case, we want to give the CSS animation time to complete before we do the swap,
we want to give it a second, in fact.</p>
</div>
<div class="paragraph">
<p>
Fortunately htmx has an option for the <code>hx-swap</code> annotation that allows you to set the swap delay: following the swap
type you can add <code>swap:</code> followed by a timing value to tell htmx to wait a specific amount of time before it swaps.  Let’s
update our HTML to allow a one second delay before the swap is done for the delete action:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The existing row actions</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML swap:1s<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
        <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete this contact?<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>closest tr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A swap delay changes how long htmx waits before it swaps in new content.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With this modification, the existing row will stay in the DOM for an additional second, with the <code>htmx-swapping</code> class
on it.  This will give the row time to transition to an opacity of zero, giving the fade out effect we want.</p>
</div>
<div class="paragraph">
<p>Now, when a user clicks on a “Delete” link and confirms the delete, the row will slowly fade out and then, once it has
faded to a 0 opacity, it will be removed.  Pretty fancy, and all done in a declarative, hypermedia-oriented manner, no
JavaScript required.  (Well, obviously htmx is written in JavaScript, but you know what we mean: we didn’t have to write
any JavaScript to implement the feature.)</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_bulk_delete">Bulk Delete</h3>
<div class="paragraph">
<p>
The final feature we are going to implement in this chapter is a “Bulk Delete.”  The current mechanism for deleting users
is nice, but it would be annoying if a user wanted to delete five or ten contacts at a time, wouldn’t it?  For the bulk
delete feature, we want to add the ability to select rows via a checkbox input and delete them all in a single go by clicking
a “Delete Selected Contacts” button.</p>
</div>
<div class="paragraph">
<p>To get started with this feature, we’ll need to add a checkbox input to each row in the <code>rows.html</code> template.  This input
will have the name <code>selected_contact_ids</code> and its value will be the <code>id</code> of the contact for the current row.</p>
</div>
<div class="paragraph">
<p>Here is what the updated code for <code>rows.html</code> looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding a checkbox to each row</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">{% for contact in contacts %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected_contact_ids<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ contact.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  ... omitted
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
{% endfor %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A new cell with the checkbox input whose value is set to the current contact’s id.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’ll also need to add an empty column in the header for the table to accommodate the checkbox column.  With that
done we now get a series of check boxes, one for each row, a pattern no doubt familiar to you from the web:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_checkboxes.png" alt="Table rows each have a checkbox in the first column" loading="lazy">
</div>
<figcaption class="title">Figure 9. Checkboxes for our contact rows</figcaption>
</figure>
<div class="paragraph">
<p>If you are not familiar with or have forgotten the way checkboxes work in HTML: a checkbox will submit its value associated
with the name of the input if and only if it is checked.  So if, for example, you checked the contacts with the ids 3,
7 and 9, then those three values would all be submitted to the server.  Since all the checkboxes in this case have
the same name, <code>selected_contact_ids</code>, all three values would be submitted with the name <code>selected_contact_ids</code>.</p>
</div>
<section class="sect3">
<h4 id="_the_delete_selected_contacts_button">The “Delete Selected Contacts” Button</h4>
<div class="paragraph">
<p>The next step is to add a button below the table that will delete all the selected contacts.  We want this button, like
our delete links in each row, to issue an HTTP <code>DELETE</code>, but rather than issuing it to the URL for a given contact, like
we do with the inline delete links and with the delete button on the edit page, here we want to issue the <code>DELETE</code> to
the <code>/contacts</code> URL.</p>
</div>
<div class="paragraph">
<p>As with the other delete elements, we want to confirm that the user wishes to delete the contacts,
and, for this case, we are going to target the body of page, since we are going to re-render the whole table.</p>
</div>
<div class="paragraph">
<p>Here is what the button code looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “delete selected contacts” button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
        <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete these contacts?<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
        <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
    Delete Selected Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue a <code>DELETE</code> to <code>/contacts</code>.
</li>
<li>
Confirm that the user wants to delete the selected contacts.
</li>
<li>
Target the body.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Pretty easy.  One question though: how are we going to include the values of all the selected checkboxes in the
request?  As it stands right now, this is just a stand-alone button, and it doesn’t have any information indicating that
it should include any other information in the <code>DELETE</code> request it makes.</p>
</div>
<div class="paragraph">
<p>
Fortunately, htmx has a few different ways to include values of inputs with a request.</p>
</div>
<div class="paragraph">
<p>One way would be to use the <code>hx-include</code> attribute, which allows you to use a CSS selector to specify the elements
you want to include in the request.  That would work fine here, but we are going to use another approach that is a bit
simpler in this case.</p>
</div>
<div class="paragraph">
<p>
By default, if an element is a child of a <code>form</code> element and makes a non-<code>GET</code> request, htmx will include all the values of
inputs within that form.  In situations like this, where there is a bulk operation for a table, it is common to enclose
the whole table in a form tag, so that it is easy to add buttons that operate on the selected items.</p>
</div>
<div class="paragraph">
<p>Let’s add that form tag around the table, and be sure to enclose the button in it as well:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “delete selected contacts” button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span> (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
          ... omitted
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
                <span class="token attr-name">hx-confirm</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete these contacts?<span class="token punctuation">"</span></span>
                <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Delete Selected Contacts
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span> (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The form tag encloses the entire table.
</li>
<li>
The form tag also encloses the button.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when the button issues a <code>DELETE</code>, it will include all the contact ids that have been selected as the
<code>selected_contact_ids</code> request variable.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_server_side_for_delete_selected_contacts">The Server Side for Delete Selected Contacts</h4>
<div class="paragraph">
<p>The server-side implementation is going to look like our original server-side code for deleting a contact.
In fact, once again, we can just copy and paste, and make a few fixes:</p>
</div>
<div class="ulist">
<ul>
<li>
We want to change the URL to <code>/contacts</code>.
</li>
<li>
We want the handler to get <em>all</em> the ids submitted as <code>selected_contact_ids</code> and iterate over each one, deleting the
given contact.
</li>
</ul>
</div>
<div class="paragraph">
<p>Those are the only changes we need to make!  Here is what the server-side code looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The “delete selected contacts” button</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/", methods=["DELETE"]) (1)
def contacts_delete_all():
    contact_ids = list(map(int, request.form.getlist("selected_contact_ids"))) (2)
    for contact_id in contact_ids: (3)
        contact = Contact.find(contact_id)
        contact.delete() (4)
    flash("Deleted Contacts!") (5)
    contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We handle a <code>DELETE</code> request to the <code>/contacts/</code> path.
</li>
<li>
Convert the <code>selected_contact_ids</code> values submitted to the server from a list of strings to a list integers.
</li>
<li>
Iterate over all of the ids.
</li>
<li>
Delete the given contact with each id.
</li>
<li>
Beyond that, it’s the same code as our original delete handler: flash a message and render the <code>index.html</code> template.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So, we took the original delete logic and slightly modified it to deal with an array of ids, rather than a single id.</p>
</div>
<div class="paragraph">
<p>You might notice one other small change: we did away with the redirect that was in the original
delete code.  We did so because we are already on the page we want to re-render, so there is no reason
to redirect and have the URL update to something new.  We can just re-render the page, and the new list of contacts (sans the
contacts that were deleted) will be re-rendered.</p>
</div>
<div class="paragraph">
<p>And there we go, we now have a bulk delete feature for our application.  Once again, not a huge amount of code, and we
are implementing these features entirely by exchanging hypermedia with a server in the traditional, RESTful manner of
the web.</p>
</div>
</section>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_accessible_by_default">HTML Notes: Accessible by Default?</h3>
<div class="paragraph">
<p>

Accessibility problems can arise when we try to implement controls that aren’t built into HTML.</p>
</div>
<div class="paragraph">
<p>Earlier, in Chapter One, we looked at the example of a &lt;div&gt; improvised to work like a button.
Let’s look at a different example: what if you make something that looks like a set of tabs, but you use radio buttons and CSS hacks to build it? It’s a neat hack that makes the rounds in web development communities from time to time.</p>
</div>
<div class="paragraph">
<p>The problem here is that tabs have requirements beyond clicking to change content.
Your improvised tabs may be missing features that will lead to user confusion and frustration, as well as some undesirable behaviors.
From the <a href="https://www.w3.org/WAI/ARIA/apg/patterns/tabs/">ARIA Authoring Practices Guide on tabs</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keyboard interaction</p>
<div class="ulist">
<ul>
<li>
Can the tabs be focused with the Tab key?
</li>
</ul>
</div>
</li>
<li>
<p>ARIA roles, states, and properties</p>
<div class="ulist">
<ul>
<li>
“[The element that contains the tabs] has role <code>tablist</code>.”
</li>
<li>
“Each [tab] has role <code>tab</code> […​]”
</li>
<li>
“Each element that contains the content panel for a <code>tab</code> has role <code>tabpanel</code>.”
</li>
<li>
“Each [tab] has the property <code>aria-controls</code> referring to its associated tabpanel element.”
</li>
<li>
“The active <code>tab</code> element has the state <code>aria-selected</code> set to <code>true</code> and all other <code>tab</code> elements have it set to <code>false</code>.”
</li>
<li>
“Each element with role <code>tabpanel</code> has the property <code>aria-labelledby</code> referring to its associated <code>tab</code> element.”
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You would need to write a lot of code to make your improvised tabs fulfill all of these requirements. Some of the ARIA attributes can be added directly in HTML,
but they are repetitive
and others (like <code>aria-selected</code>) need to be set through JavaScript since they are dynamic.
The keyboard interactions can be error-prone too.</p>
</div>
<div class="paragraph">
<p>It’s not impossible, not even that hard, to make your own tab set implementation.
However, it’s difficult to trust that a new implementation will work for all users in all environments, since most of us have limited resources for testing.</p>
</div>
<div class="paragraph">
<p><em>Stick with established libraries</em> for UI interactions. If a use case requires a bespoke solution, <em>test exhaustively</em> for keyboard interaction and accessibility. Test manually.
Test automatically. Test with screen readers, test with a keyboard, test on different browsers and hardware, and run linters (while coding and/or in CI). Testing is critical to ensure machine readability, or human readability, or page weight.</p>
</div>
<div class="paragraph">
<p>
Also consider: Does the information need to be presented as tabs?
Sometimes the answer is yes, but if not, a sequence of details and disclosures fulfills a very similar purpose.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>Disclosure 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
  Disclosure 1 contents
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span>Disclosure 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span>
  Disclosure 2 contents
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Compromising UX just to avoid JavaScript is bad development.
But sometimes it’s possible to achieve an equal (or better!) quality of UX while allowing for a simpler and more robust implementation.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_a_dynamic_archive_ui">A Dynamic Archive UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contact.app has come a long way from a traditional web 1.0-style web application:
we’ve added active search, bulk delete, some nice animations, and a slew of other features.  We have reached a level
of interactivity that most web developers would assume requires some sort of Single-Page Application JavaScript framework,
but we’ve done it using htmx-powered hypermedia instead.</p>
</div>
<div class="paragraph">
<p>
Let’s look at how we can add a final significant feature to Contact.app: downloading an archive of all the contacts.</p>
</div>
<div class="paragraph">
<p>From a hypermedia perspective, downloading a file isn’t exactly rocket science: using the HTTP <code>Content-Disposition</code>
response header, we can easily tell the browser to download and save a file to the local computer.</p>
</div>
<div class="paragraph">
<p>However, let’s make this problem more interesting: let’s add in the fact that the export can take a bit of time,
from five to ten seconds, or sometimes even longer, to complete.</p>
</div>
<div class="paragraph">
<p>This means that if we implemented the download as a “normal” HTTP request, driven by a link or a button, the user might
sit with very little visual feedback, wondering if the download is actually happening, while the export is being completed.
They might even give up in frustration and click the download hypermedia control again, causing a <em>second</em> archive
request.  Not good.</p>
</div>
<div class="paragraph">
<p>This turns out to be a classic problem in web app development.  When faced with potentially long-running process like this,
we ultimately have two options:</p>
</div>
<div class="ulist">
<ul>
<li>
When the user triggers the action, block until it is complete and then respond with the result.
</li>
<li>
Begin the action and return immediately, showing some sort of UI indicating that things are in progress.
</li>
</ul>
</div>
<div class="paragraph">
<p>Blocking and waiting for the action to complete is certainly the simpler way to handle it, but it can be a bad user
experience, especially if the action takes a while to complete.  If you’ve ever clicked on something in a web 1.0-style
application and then had to sit there for what seems like an eternity before anything happens, you’ve seen the
practical results of this choice.</p>
</div>
<div class="paragraph">
<p>The second option, starting the action asynchronously (say, by creating a thread, or submitting it
to a job runner system) is much nicer from a user experience perspective: the server can respond immediately and the user
doesn’t need to sit there wondering what’s going on.</p>
</div>
<div class="paragraph">
<p>But the question is, what do you respond <em>with</em>?  The job probably isn’t complete yet, so you can’t provide a link
to the results.</p>
</div>
<div class="paragraph">
<p>We have seen a few different “simple” approaches in this scenario in various web applications:</p>
</div>
<div class="ulist">
<ul>
<li>
Let the user know that the process has started and that they will be emailed a link to the completed process
results when it is finished.
</li>
<li>
Let the user know that the process has started and recommend that they should manually refresh the page to see the
status of the process.
</li>
<li>
Let the user know that the process has started and automatically refresh the page every few seconds using some JavaScript.
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these will work, but none of them is a great user experience.</p>
</div>
<div class="paragraph">
<p>What we’d <em>really</em> like in this scenario is something more like what you see when, for example, you download a large file via the
browser: a nice progress bar indicating where in the process you are, and, when the process is complete, a link to click immediately
to view the result of the process.</p>
</div>
<div class="paragraph">
<p>This may sound like something impossible to implement with hypermedia, and, to be honest, we’ll need to push htmx pretty hard
to make this all work, but, when it is done, it won’t be <em>that</em> much code, and we will be able to achieve the user experience
we want for this archiving feature.</p>
</div>
<section class="sect3">
<h4 id="_ui_requirements">UI Requirements</h4>
<div class="paragraph">
<p>Before we dive into the implementation, let’s discuss in broad terms what our new UI should look like:  we want a button
in the application labeled “Download Contact Archive.” When a user clicks on that button, we want to replace that
button with a UI that shows the progress of the archiving process, ideally with a progress bar.  As the archive job makes
progress, we want to move the progress bar along towards completion.  Then, when the archive job is done, we want to
show a link to the user to download the contact archive file.</p>
</div>
<div class="paragraph">
<p>
In order to actually do the archiving, we are going to use a python class, <code>Archiver</code>, that implements all the
functionality that we need.  As with the <code>Contact</code> class, we aren’t going to go into the implementation details of <code>Archiver</code>, because that’s beyond the scope of this book.  For now you just need to know is that it provides all the server-side
behavior necessary to start a contact archive process and get the results when that process is done.</p>
</div>
<div class="paragraph">
<p><code>Archiver</code> gives us the following methods to work with:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>status()</code> - A string representing the status of the download, either <code>Waiting</code>, <code>Running</code> or <code>Complete</code>
</li>
<li>
<code>progress()</code> - A number between 0 and 1, indicating how much progress the archive job has made
</li>
<li>
<code>run()</code> - Starts a new archive job (if the current status is <code>Waiting</code>)
</li>
<li>
<code>reset()</code> - Cancels the current archive job, if any, and resets to the “Waiting” state
</li>
<li>
<code>archive_file()</code> - The path to the archive file that has been created on the server, so we can send it to the client
</li>
<li>
<code>get()</code> - A class method that lets us get the Archiver for the current user
</li>
</ul>
</div>
<div class="paragraph">
<p>A fairly uncomplicated API.</p>
</div>
<div class="paragraph">
<p>The only somewhat tricky aspect to the whole API is that the <code>run()</code> method
is <em>non-blocking</em>. This means that it does not <em>immediately</em> create the archive file, but rather it starts a background job
(as a thread) to do the actual archiving.  This can be confusing if you aren’t used to multithreading in code: you might
be expecting the <code>run()</code> method to “block”, that is, to actually execute the entire export and only return when it is
finished.  But, if it did that, we wouldn’t be able to start the archive process and immediately render our desired
archive progress UI.</p>
</div>
</section>
<section class="sect3">
<h4 id="_beginning_our_implementation">Beginning Our Implementation</h4>
<div class="paragraph">
<p>We now have everything we need to begin implementing our UI: a reasonable outline of what it is going to look like, and
the domain logic to support it.</p>
</div>
<div class="paragraph">
<p>So, to start, note that this UI is largely self-contained: we
want to replace the button with the download progress bar, and then the progress bar with a link to download the results
of the completed archive process.</p>
</div>
<div class="paragraph">
<p>The fact that our archive user interface is all going to be within a specific part of the UI is a strong hint
that we will want to create a new template to handle it.  Let’s call this template <code>archive_ui.html</code>.</p>
</div>
<div class="paragraph">
<p>Also note that we are going to want to replace the entire download UI in multiple cases:</p>
</div>
<div class="ulist">
<ul>
<li>
When we start the download, we will want to replace the button with a progress bar.
</li>
<li>
As the archive process proceeds, we will want to replace/update the progress bar.
</li>
<li>
When the archive process completes, we will want to replace the progress bar with a download link.
</li>
</ul>
</div>
<div class="paragraph">
<p>To update the UI in this way, we need to set a good target for the updates.  So, let’s
wrap the entire UI in a <code>div</code> tag, and then use that <code>div</code> as the target for all our operations.</p>
</div>
<div class="paragraph">
<p>Here is the start of the template for our new archive user interface:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our initial archive UI template</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span>
    <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
    <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This div will be the target for all elements within it.
</li>
<li>
Replace the entire div every time using <code>outerHTML</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Next, lets add the “Download Contact Archive” button to the <code>div</code> that will kick off the archive-then-download
process.  We’ll use a <code>POST</code> to the path <code>/contacts/archive</code> to trigger the start of the archiving process:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding the archive button</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
      Download Contact Archive
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This button will issue a <code>POST</code> to <code>/contacts/archive</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Finally, let’s include this new template in our main <code>index.html</code> template, above the contacts table:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our initial archive UI template</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">{% block content %}

    {% include 'archive_ui.html' %} (1)

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This template will now be included in the main template.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With that done, we now have a button showing up in our web application to get the download going.  Since the enclosing
<code>div</code> has an <code>hx-target="this"</code> on it, the button will inherit that target and replace that enclosing <code>div</code> with whatever HTML
comes back from the <code>POST</code> to <code>/contacts/archive</code>.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_the_archiving_endpoint">Adding the Archiving Endpoint</h4>
<div class="paragraph">
<p>Our next step is to handle the <code>POST</code> that our button is making.  We want to get the
<code>Archiver</code> for the current user and invoke the <code>run()</code> method on it.  This will start the archive process running.  Then
we will render some new content indicating that the process is running.</p>
</div>
<div class="paragraph">
<p>To do that, we want to reuse the <code>archive_ui</code> template to handle rendering the archive UI for both states,
when the archiver is “Waiting” and when it is “Running.”  (We will handle the “Complete” state in a bit).</p>
</div>
<div class="paragraph">
<p>This is a very common pattern: we put all the different potential UIs for a given chunk of the user interface into
a single template, and conditionally render the appropriate interface.  By keeping everything in one file, it makes
it much easier for other developers (or for us, if we come back after a while!) to understand exactly how the UI
works on the client side.</p>
</div>
<div class="paragraph">
<p>Since we are going to conditionally render different user interfaces based on the state of the archiver, we will need
to pass the archiver out to the template as a parameter.  So, again: we need to invoke <code>run()</code> on the archiver in our
controller and then pass the archiver along to the template, so it can render the UI appropriate for the current
status of the archive process.</p>
</div>
<div class="paragraph">
<p>Here is what the code looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Server-side code to start the archive process</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["POST"]) (1)
def start_archive():
    archiver = Archiver.get() (2)
    archiver.run() (3)
    return render_template("archive_ui.html", archiver=archiver) (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Handle <code>POST</code> to <code>/contacts/archive</code>.
</li>
<li>
Look up the Archiver.
</li>
<li>
Invoke the non-blocking <code>run()</code> method on it.
</li>
<li>
Render the <code>archive_ui.html</code> template, passing in the archiver.
</li>
</ol>
</div></figure>

</section>
<section class="sect3">
<h4 id="_conditionally_rendering_a_progress_ui">Conditionally Rendering A Progress UI</h4>
<div class="paragraph">
<p>
Now let’s turn our attention to updating our archiving UI by setting <code>archive_ui.html</code> to conditionally render different content depending on the state of the archive process.</p>
</div>
<div class="paragraph">
<p>Recall that the archiver has a <code>status()</code> method. When we pass the archiver through
as a variable to the template, we can consult this <code>status()</code> method to see
the status of the archive process.</p>
</div>
<div class="paragraph">
<p>If the archiver has the status <code>Waiting</code>, we want to render the “Download Contact Archive” button. If the status is <code>Running</code>, we want to render
a message indicating that progress is happening. Let’s update our template code
to do just that:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding conditional rendering</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% if archiver.status() == "Waiting" %} (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Download Contact Archive
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    {% elif archiver.status() == "Running" %}(2)
       Running...(3)
    {% endif %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Only render the archive button if the status is “Waiting.”
</li>
<li>
Render different content when status is “Running.”
</li>
<li>
For now, just some text saying the process is running.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>OK, great, we have some conditional logic in our template view, and the server-side logic to support kicking off the
archive process.  We don’t have a progress bar yet, but we’ll get there!  Let’s see how this works as it stands, and
refresh the main page of our application…​</p>
</div>
<figure class="listingblock">
<figcaption class="title">Something Went Wrong</figcaption>
<div class="content">
<pre>UndefinedError
jinja2.exceptions.UndefinedError: 'archiver' is undefined</pre>
</div>
</figure>
<div class="paragraph">
<p>Ouch!</p>
</div>
<div class="paragraph">
<p>We get an error message right out of the box.  Why?  Ah, we are including the <code>archive_ui.html</code> in the
<code>index.html</code> template, but now the <code>archive_ui.html</code> template expects the archiver to be passed through to it, so
it can conditionally render the correct UI.</p>
</div>
<div class="paragraph">
<p>That’s an easy fix: we just need to pass the archiver through when we render the <code>index.html</code> template as well:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Including the archiver when we render index.html</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    if search is not None:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
            return render_template("rows.html", contacts=contacts_set)
    else:
        contacts_set = Contact.all()
    return render_template("index.html", contacts=contacts_set, archiver=Archiver.get())(1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Pass through archiver to the main template
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now with that done, we can load up the page.  And, sure enough, we can see the “Download Contact Archive” button.</p>
</div>
<div class="paragraph">
<p>When we click on it, the button is replaced with the content “Running…​”, and we can see in our development console
on the server-side that the job is indeed getting kicked off properly.</p>
</div>
</section>
<section class="sect2">
<h3 id="_polling">Polling</h3>
<div class="paragraph">
<p>
That’s definitely progress, but we don’t exactly have the best progress indicator here: just some static text telling
the user that the process is running.</p>
</div>
<div class="paragraph">
<p>We want to make the content update as the process makes progress and, ideally, show a progress bar indicating
how far along it is.  How can we do that in htmx using plain old hypermedia?</p>
</div>
<div class="paragraph">
<p>The technique we want to use here is called “polling”, where we issue a request on an interval and update the UI based
on the new state of the server.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Polling?  Really?</div>
<div class="paragraph">
<p>Polling has a bit of a bad rap, and it isn’t the sexiest technique in the world: today
developers might look at a more advanced technique like WebSockets or Server Sent Events (SSE) to address this situation.</p>
</div>
<div class="paragraph">
<p>But, say what one will, polling <em>works</em> and it is drop-dead simple.  You need to be careful not to overwhelm
your system with polling requests, but, with a bit of care, you can create a reliable, passively updated component in
your UI using it.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>Htmx offers two types of polling.  The first is “fixed rate polling”, which uses a special <code>hx-trigger</code> syntax to indicate
that something should be polled on a fixed interval.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Fixed interval polling</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/messages<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>every 3s<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Trigger a <code>GET</code> to <code>/messages</code> every three seconds.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This works great in situations when you want to poll indefinitely, for example if you want to constantly poll for new
messages to display to the user.  However, fixed rate polling isn’t ideal when you have a definite process after which
you want to stop polling: it keeps polling forever, until the element it is on is removed from the DOM.</p>
</div>
<div class="paragraph">
<p>In our case, we have a definite process with an ending to it.  So, it will be better to use the second polling
technique, known as “load polling.”  In load polling, we take advantage of the fact that htmx triggers a <code>load</code> event
when content is loaded into the DOM.  We can create a trigger on this <code>load</code> event, and add a bit of a delay so that
the request doesn’t trigger immediately.</p>
</div>
<div class="paragraph">
<p>With this, we can conditionally render the <code>hx-trigger</code> on every request: when a process has completed we simply do not include the <code>load</code> trigger, and the load polling stops.  This offers a nice and simple way to poll until a definite
process finishes.</p>
</div>
<section class="sect3">
<h4 id="_using_polling_to_update_the_archive_ui">Using Polling To Update The Archive UI</h4>
<div class="paragraph">
<p>Let’s use load polling to update our UI as the archiver makes progress.  To show the progress, let’s use
a CSS-based progress bar, taking advantage of the <code>progress()</code> method which returns a number between 0 and 1 indicating
how close the archive process is to completion.</p>
</div>
<div class="paragraph">
<p>Here is the snippet of HTML we will use:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A CSS-based progress bar</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span>
         <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The width of the inner element corresponds to the progress.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This CSS-based progress bar has two components: an outer <code>div</code> that provides the wire frame for the progress bar,
 and an inner <code>div</code> that is the actual progress bar indicator.  We set the width of the inner progress bar to some percentage
(note we need to multiply the <code>progress()</code> result by 100 to get a percentage) and that will make the progress
indicator the appropriate width within the parent div.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">What about the &lt;progress&gt; Element?</div>
<div class="paragraph">
<p>We are perhaps dipping our toes into the "div soup" here, using a <code>div</code> tag when there is a perfectly good HTML5 tag,
the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/progress"><code>progress</code></a> element, that is designed specifically
for showing, well, progress.</p>
</div>
<div class="paragraph">
<p>We decided not to use the <code>progress</code> element for this example because we want our progress bar to update smoothly, and
we will need to use a CSS technique not available for the <code>progress</code> element to make that happen.  That’s unfortunate, but
sometimes we have to play with the cards we are dealt.</p>
</div>
<div class="paragraph">
<p>We will, however, use the proper <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/roles/progressbar_role">progress bar roles</a>
to make our <code>div</code>-based progress bar play well with assistive technologies.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>
Let’s update our progress bar to have the proper ARIA roles and values:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A CSS-based progress bar</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span>
         <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressbar<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
         <span class="token attr-name">aria-valuenow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ archiver.progress() * 100}}}<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
         <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This element will act as a progress bar
</li>
<li>
The progress will be the percentage completeness of the archiver, with 100 indicating fully complete
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Finally, for completeness, here is the CSS we’ll use for this progress bar:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The CSS for our progress bar</figcaption>
<div class="content">
<pre class="highlight language-css" tabindex="0"><code class="language-css" data-lang="css"><span class="token selector">.progress</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 1px 2px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.progress-bar</span> <span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 0%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #337ab7<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 -1px 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>.15<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> width .6s ease<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Which ends up rendering like this:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_progress_bar.png" alt="A blue progress bar that’s a little under half full" loading="lazy">
</div>
<figcaption class="title">Figure 10. Our CSS-Based Progress Bar</figcaption>
</figure>
<section class="sect4">
<h5 id="_adding_the_progress_bar_ui">Adding The Progress Bar UI</h5>
<div class="paragraph">
<p>Let’s add the code for our progress bar into our <code>archive_ui.html</code> template for the case when the archiver is
running, and let’s update the copy to say “Creating Archive…​”:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding the progress bar</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% if archiver.status() == "Waiting" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Download Contact Archive
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    {% elif archiver.status() == "Running" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            Creating Archive...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span> (1)
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressbar<span class="token punctuation">"</span></span>
                     <span class="token attr-name">aria-valuenow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ archiver.progress() * 100}}<span class="token punctuation">"</span></span>
                     <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endif %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Our shiny new progress bar
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now when we click the “Download Contact Archive” button, we get the progress bar.  But it still doesn’t update
because we haven’t implemented load polling yet: it just sits there, at zero.</p>
</div>
<div class="paragraph">
<p>To get the progress bar updating dynamically, we’ll need to implement load polling using <code>hx-trigger</code>.  We can add this
to pretty much any element inside the conditional block for when the archiver is running, so let’s add it to that <code>div</code> that is
wrapping around the “Creating Archive…​” text and the progress bar.</p>
</div>
<div class="paragraph">
<p>Let’s make it poll by issuing an HTTP <code>GET</code> to the same path as the <code>POST</code>: <code>/contacts/archive</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Implementing load polling</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% if archiver.status() == "Waiting" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Download Contact Archive
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    {% elif archiver.status() == "Running" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load delay:500ms<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
            Creating Archive...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressbar<span class="token punctuation">"</span></span>
                     <span class="token attr-name">aria-valuenow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ archiver.progress() * 100}}<span class="token punctuation">"</span></span>
                     <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endif %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Issue a <code>GET</code> to <code>/contacts/archive</code> 500 milliseconds after the content loads.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>When this <code>GET</code> is issued to <code>/contacts/archive</code>, it is going to replace
the <code>div</code> with the id <code>archive-ui</code>, not just itself.  The <code>hx-target</code> attribute on the <code>div</code> with the id <code>archive-ui</code> is
<em>inherited</em> by all child elements within that <code>div</code>, so the children will all target that outermost <code>div</code> in the
<code>archive_ui.html</code> file.</p>
</div>
<div class="paragraph">
<p>Now we need to handle the <code>GET</code> to <code>/contacts/archive</code> on the server.  Thankfully, this is quite easy: all we
want to do is re-render <code>archive_ui.html</code> with the archiver:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Handling progress updates</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["GET"]) (1)
def archive_status():
    archiver = Archiver.get()
    return render_template("archive_ui.html", archiver=archiver) (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
handle <code>GET</code> to the <code>/contacts/archive</code> path
</li>
<li>
just re-render the <code>archive_ui.html</code> template
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Like so much else with hypermedia, the code is very readable and not complicated.</p>
</div>
<div class="paragraph">
<p>Now, when we click the “Download Contact Archive”, sure enough, we get a progress bar that updates every 500
milliseconds.  As the result of the call to <code>archiver.progress()</code> incrementally updates from 0 to 1, the
progress bar moves across the screen for us.  Very cool!</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_downloading_the_result">Downloading The Result</h4>
<div class="paragraph">
<p>We have one final state to handle, the case when <code>archiver.status()</code> is set to “Complete”, and there is a JSON
archive of the data ready to download.  When the archiver is complete, we can get the local JSON file on the server
from the archiver via the <code>archive_file()</code> call.</p>
</div>
<div class="paragraph">
<p>Let’s add another case to our if statement to handle the “Complete” state, and, when the archive job is complete, lets
render a link to a new path, <code>/contacts/archive/file</code>, which will respond with the archived JSON file.  Here is
the new code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Rendering A Download Link When Archiving Completes</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-ui<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span> <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>outerHTML<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% if archiver.status() == "Waiting" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Download Contact Archive
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    {% elif archiver.status() == "Running" %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load delay:500ms<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            Creating Archive...
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressbar<span class="token punctuation">"</span></span>
                     <span class="token attr-name">aria-valuenow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ archiver.progress() * 100}}<span class="token punctuation">"</span></span>
                     <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% elif archiver.status() == "Complete" %} (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive/file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Archive Ready!  Click here to download. &amp;downarrow;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (2)
    {% endif %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
If the status is “Complete”, render a download link.
</li>
<li>
The link will issue a <code>GET</code> to <code>/contacts/archive/file</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that the link has <code>hx-boost</code> set to <code>false</code>.  It has this so that the link will not inherit the boost behavior
that is present for other links and, thus, will not be issued via AJAX.  We want this “normal” link behavior because an
AJAX request cannot download a file directly, whereas a plain anchor tag can.</p>
</div>
</section>
<section class="sect3">
<h4 id="_downloading_the_completed_archive">Downloading The Completed Archive</h4>
<div class="paragraph">
<p>The final step is to handle the <code>GET</code> request to <code>/contacts/archive/file</code>.  We want to send the file that the
archiver created down to the client.  We are in luck: Flask has a mechanism for sending a file as
a downloaded response, the <code>send_file()</code> method.</p>
</div>
<div class="paragraph">
<p>As you see in the code that follows, we pass three arguments to <code>send_file()</code>:
the path to the archive file that the archiver
created, the name of the file that we want the browser to create, and if we want it sent “as an attachment.”
This last argument tells Flask to set the HTTP response header <code>Content-Disposition</code> to <code>attachment</code> with the given filename; this is what triggers the browser’s file-downloading behavior.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Sending A File To The Client</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/archive/file", methods=["GET"])
def archive_content():
    manager = Archiver.get()
    return send_file(manager.archive_file(), "archive.json", as_attachment=True) (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Send the file to the client via Flask’s <code>send_file()</code> method.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Perfect.  Now we have an archive UI that is very slick.  You click the “Download Contacts Archive” button and a progress
bar appears.  When the progress bar reaches 100%, it disappears and a link to download the archive file appears.  The user
can then click on that link and download their archive.</p>
</div>
<div class="paragraph">
<p>We’re offering a user experience that is much more user-friendly than the common
click-and-wait experience of many websites.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_smoothing_things_out_animations_in_htmx">Smoothing Things Out: Animations in Htmx</h3>
<div class="paragraph">
<p>As nice as this UI is, there is one minor annoyance: as the progress bar updates it “jumps” from one position to the next.
This feels a bit like a full page refresh in web 1.0 style applications. Is there a way we can fix this? (Obviously there
is, this why we went with a <code>div</code> rather than a <code>progress</code> element!)</p>
</div>
<div class="paragraph">
<p>Let’s walk through the cause of this visual problem and how we might fix it. (If you’re in a hurry to get to an answer,
feel free to jump ahead to “our solution.”)</p>
</div>
<div class="paragraph">
<p>
It turns out that there is a native HTML technology for smoothing out changes on an element from one state to another:
the CSS Transitions API, the same one that we discussed in Chapter 4. Using CSS Transitions, you can smoothly animate an
element between different styling by using the <code>transition</code> property.</p>
</div>
<div class="paragraph">
<p>If you look back at our CSS definition of the <code>.progress-bar</code> class, you will see the following transition definition:
<code>transition: width .6s ease;</code>. This means that when the width of the progress bar is changed from, say 20% to
30%, the browser will animate over a period of .6 seconds using the “ease” function
(which has a nice accelerate/decelerate effect).</p>
</div>
<div class="paragraph">
<p>So why isn’t that transition being applied in our current UI?  The reason is that, in our example, htmx is
<em>replacing</em> the progress bar with a new one every time it polls.  It isn’t updating the width
of an <em>existing</em> element.  CSS transitions, unfortunately, only apply when the properties of an existing element change
inline, not when the element is replaced.</p>
</div>
<div class="paragraph">
<p>This is a reason why pure HTML-based applications can feel jerky and unpolished when compared with their SPA
counterparts: it is hard to use CSS transitions without some JavaScript.</p>
</div>
<div class="paragraph">
<p>But there is some good news: htmx has a way to utilize CSS transitions even when it replaces content in the DOM.</p>
</div>
<section class="sect3">
<h4 id="_the_settling_step_in_htmx">The “Settling” Step in Htmx</h4>
<div class="paragraph">
<p>

When we discussed the htmx swap model in Chapter 4, we focused on the classes that htmx adds and removes, but we skipped
over the process of “settling.” In htmx, settling involves several steps:  when htmx is
about to replace a chunk of content, it looks through the new content and finds all elements with an <code>id</code> on it.  It then
looks in the <em>existing</em> content for elements with the same <code>id</code>.</p>
</div>
<div class="paragraph">
<p>If there is one, it does the following somewhat elaborate shuffle:</p>
</div>
<div class="ulist">
<ul>
<li>
The <em>new</em> content gets the attributes of the <em>old</em> content temporarily.
</li>
<li>
The new content is inserted.
</li>
<li>
After a small delay, the new content has its attributes reverted to their actual values.
</li>
</ul>
</div>
<div class="paragraph">
<p>So, what is this strange little dance supposed to achieve?</p>
</div>
<div class="paragraph">
<p>Well, if an element has a stable id between swaps, you can now write CSS transitions between various states.  Since the
<em>new</em> content briefly has the <em>old</em> attributes, the normal CSS transition mechanism will kick in when the actual values
are restored.</p>
</div>
</section>
<section class="sect3">
<h4 id="_our_smoothing_solution">Our Smoothing Solution</h4>
<div class="paragraph">
<p>So, we arrive at our fix.</p>
</div>
<div class="paragraph">
<p>All we need to do is add a stable ID to our <code>progress-bar</code> element.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Smoothing things out</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>archive-progress<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progress-bar<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>progressbar<span class="token punctuation">"</span></span>
         <span class="token attr-name">aria-valuenow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ archiver.progress() * 100}}<span class="token punctuation">"</span></span>
         <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token selector">width:</span><span class="token punctuation">{</span><span class="token punctuation">{</span> archiver.<span class="token function">progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 100 <span class="token punctuation">}</span><span class="token punctuation">}</span>%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The progress bar div now has a stable id across requests.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Despite the complicated mechanics going on behind the scenes in htmx, the solution is as simple as adding a stable
<code>id</code> attribute to the element we want to animate.</p>
</div>
<div class="paragraph">
<p>Now, rather than jumping on every update, the progress bar should smoothly move across the screen as it is updating, using the CSS transition
defined in our style sheet. The htmx swapping model allows us to achieve this even though we are replacing the content with new HTML.</p>
</div>
<div class="paragraph">
<p>And voila: we have a nice, smoothly animated progress bar for our contact archiving feature. The result has the look and
feel of a JavaScript-based solution, but we did it with the simplicity of an HTML-based approach.</p>
</div>
<div class="paragraph">
<p>Now that, dear reader, does spark joy.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_dismissing_the_download_ui">Dismissing The Download UI</h3>
<div class="paragraph">
<p>Some users may change their mind, and decide not to download the archive. They may never witness our glorious progress bar, but
that’s OK. We’re going to give these users a button to dismiss the download link and return to the original export UI state.</p>
</div>
<div class="paragraph">
<p>To do this, we’ll add a button that issues a <code>DELETE</code> to the path <code>/contacts/archive</code>, indicating that the current
archive can be removed or cleaned up.</p>
</div>
<div class="paragraph">
<p>We’ll add it after the download link, like so:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Clearing the download</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive/file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Archive Ready!  Click here to download. &amp;downarrow;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Clear Download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A simple button that issues a <code>DELETE</code> to <code>/contacts/archive</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now the user has a button that they can click on to dismiss the archive download link.  But we will need to hook it up
on the server side.  As usual, this is pretty straightforward: we create a new handler for the <code>DELETE</code> HTTP Action,
invoke the <code>reset()</code> method on the archiver, and re-render the <code>archive_ui.html</code> template.</p>
</div>
<div class="paragraph">
<p>Since this button is picking up the same <code>hx-target</code> and <code>hx-swap</code> configuration as everything else, it “just works.”</p>
</div>
<div class="paragraph">
<p>Here is the server-side code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The handler to reset the download</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/contacts/archive", methods=["DELETE"])
def reset_archive():
    archiver = Archiver.get()
    archiver.reset() (1)
    return render_template("archive_ui.html", archiver=archiver)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Call <code>reset()</code> on the archiver
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This looks pretty similar to our other handlers, doesn’t it?</p>
</div>
<div class="paragraph">
<p>Sure does!  That’s the idea!</p>
</div>
</section>
<section class="sect2">
<h3 id="_an_alternative_ux_auto_download">An Alternative UX: Auto-Download</h3>
<div class="paragraph">
<p>
While we prefer the current user experience for archiving contacts, there are other alternatives. Currently, a progress
bar shows the progress of the process and, when it completes, the user is presented with a link to actually download the
file. Another pattern that we see on the web is "auto-downloading", where the file downloads immediately without the user
needing to click a link.</p>
</div>
<div class="paragraph">
<p>We can add this functionality quite easily to our application with just a bit of scripting.  We will discuss scripting
in a Hypermedia-Driven Application in more depth in chapter 9, but, put briefly: scripting is perfectly
acceptable in a HDA, as long as it doesn’t replace the core hypermedia mechanics of the application.</p>
</div>
<div class="paragraph">
<p>For our auto-download feature we will use <a href="https://hyperscript.org">_hyperscript</a>, our preferred scripting option.
JavaScript would also work here, and would be nearly as simple; again, we’ll discuss scripting options in detail
in Chapter 9.</p>
</div>
<div class="paragraph">
<p>All we need to do to implement the auto-download feature is the following: when the download link renders, automatically
click on the link for the user.</p>
</div>
<div class="paragraph">
<p>The _hyperscript code reads almost the same as the previous sentence (which is a major reason why we love hyperscript):</p>
</div>
<figure class="listingblock">
<figcaption class="title">Auto-downloading</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">hx-boost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/archive/file<span class="token punctuation">"</span></span>
     <span class="token special-attr"><span class="token attr-name">_</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value hyperscript language-hyperscript"><span class="token keyword"><span class="token hs-start bold">on</span></span> load click<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">me</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> (1)
    Archive Downloading! Click here if the download does not start.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A bit of _hyperscript to make the file auto-download.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Crucially, the scripting here is simply <em>enhancing</em> the existing hypermedia, rather than replacing it with
a non-hypermedia request. This is hypermedia-friendly scripting, as we will cover in more depth in a bit.</p>
</div>
</section>
<section class="sect2">
<h3 id="_a_dynamic_archive_ui_complete">A Dynamic Archive UI: Complete</h3>
<div class="paragraph">
<p>In this chapter we’ve managed to create a dynamic UI for our contact archive functionality, with a progress bar and
auto-downloading, and we’ve done nearly all of it — with the exception of a small bit of scripting for auto-download — in
pure hypermedia. It took about 16 lines of front end code and 16 lines of backend code to build the whole thing.</p>
</div>
<div class="paragraph">
<p>HTML, with a bit of help from a hypermedia-oriented JavaScript library such as htmx, can in fact be extremely powerful and expressive.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_markdown_soup">HTML Notes: Markdown soup</h3>
<div class="paragraph">
<p><dfn class="dfn">Markdown soup</dfn> is the lesser known sibling of <code>&lt;div&gt;</code> soup.
This is the result of web developers limiting themselves to the set of elements that the Markdown language provides shorthand for,
even when these elements are incorrect.
More seriously, it’s important to be aware of the full power of our tools, including HTML.
Consider the following example of an IEEE-style citation:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-markdown" tabindex="0"><code class="language-markdown" data-lang="markdown">[1] C.H. Gross, A. Stepinski, and D. Akşimşek, (1)
_Hypermedia Systems_, (2)
Bozeman, MT, USA: Big Sky Software.
Available: &lt;https://hypermedia.systems/&gt;</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The reference number is written in brackets.
</li>
<li>
Underscores around the book title creates an &lt;em&gt; element.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Here, &lt;em&gt; is used because it’s the only Markdown element that is presented in italics by default.
This indicates that the book title is being stressed, but the purpose is to mark it as the title of a work.
HTML has the <code>&lt;cite&gt;</code> element that’s intended for this exact purpose.</p>
</div>
<div class="paragraph">
<p>Furthermore, even though this is a numbered list perfect for the <code>&lt;ol&gt;</code> element, which Markdown supports, plain text is used for the reference numbers instead.
Why could this be?
The IEEE citation style requires that these numbers are presented in square brackets.
This could be achieved on an <code>&lt;ol&gt;</code> with CSS,
but Markdown doesn’t have a way to add a class to elements meaning the square brackets would apply to all ordered lists.</p>
</div>
<div class="paragraph">
<p>
Don’t shy away from using embedded HTML in Markdown.
For larger sites, also consider Markdown extensions.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-markdown" tabindex="0"><code class="language-markdown" data-lang="markdown">{.ieee-reference-list} (1)
1. C.H. Gross, A. Stepinski, and D. Akşimşek, (2)
   &lt;cite&gt;Hypermedia Systems&lt;/cite&gt;, (3)
   Bozeman, MT, USA: Big Sky Software.
   Available: &lt;https://hypermedia.systems/&gt;</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Many Markdown dialects let us add ids, classes and attributes using curly braces.
</li>
<li>
We can now use the &lt;ol&gt; element, and create the brackets in CSS.
</li>
<li>
We use <code>&lt;cite&gt;</code> to mark the title of the work being cited (not the whole citation!)
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You can also use custom processors to produce extra-detailed HTML instead of writing it by hand:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-markdown" tabindex="0"><code class="language-markdown" data-lang="markdown">{% reference_list %} (1)
[hypers2023]: (2)
C.H. Gross, A. Stepinski, and D. Akşimşek, _Hypermedia Systems_,
Bozeman, MT, USA: Big Sky Software, 2023.
Available: &lt;https://hypermedia.systems/&gt;
{% end %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
<code>reference_list</code> is a macro that will transform the plain text to highly-detailed HTML.
</li>
<li>
A processor can also resolve identifiers, so we don’t have to manually keep the reference list in order and the in-text citations in sync.
</li>
</ol>
</div></figure>

</aside>
</div>
</section>
<section class="sect1">
<h2 id="_tricks_of_the_htmx_masters">Tricks Of The Htmx Masters</h2>
<div class="sectionbody">
<section class="sect2">
<h3 id="_advanced_htmx">Advanced Htmx</h3>
<div class="paragraph">
<p>In this chapter we are going to look deeper into the htmx toolkit.  We’ve accomplished quite a bit with what we’ve
learned so far. Still, when you are developing Hypermedia-Driven Applications, there will be times when you need to
reach for additional options and techniques.</p>
</div>
<div class="paragraph">
<p>We will go over the more advanced attributes in htmx, as well as expand on the advanced details of attributes we have
already used.</p>
</div>
<div class="paragraph">
<p>Additionally, we will look at functionality that htmx offers beyond simple HTML attributes:  how htmx extends
standard HTTP request and responses, how htmx works with (and produces) events, and how to approach situations where
there isn’t a simple, single target on the page to be updated.</p>
</div>
<div class="paragraph">
<p>Finally, we will take a look at practical considerations when doing htmx development: how to debug htmx-based applications
effectively, security considerations you will need to take into account when working with htmx, and how to configure
the behavior of htmx.</p>
</div>
<div class="paragraph">
<p>With the features and techniques in this chapter, you will be able to pull off extremely
sophisticated user interfaces using only htmx and perhaps a small bit of hypermedia-friendly client-side scripting.</p>
</div>
</section>
<section class="sect2">
<h3 id="_htmx_attributes">Htmx Attributes</h3>
<div class="paragraph">
<p>
Thus far we have used about fifteen different attributes from htmx in our application.  The most important ones have been:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>hx-get</code>, <code>hx-post</code>, etc.</dt>
<dd>
<p>To specify the AJAX request an element should make</p>
</dd>
<dt class="hdlist1"><code>hx-trigger</code></dt>
<dd>
<p>To specify the event that triggers a request</p>
</dd>
<dt class="hdlist1"><code>hx-swap</code></dt>
<dd>
<p>To specify how to swap the returned HTML content into the DOM</p>
</dd>
<dt class="hdlist1"><code>hx-target</code></dt>
<dd>
<p>To specify where in the DOM to swap the returned HTML content</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Two of these attributes, <code>hx-swap</code> and <code>hx-trigger</code>, support a number of useful options for creating more advanced
Hypermedia-Driven Applications.</p>
</div>
<section class="sect3">
<h4 id="_hx_swap">hx-swap</h4>
<div class="paragraph">
<p>
We’ll start with the hx-swap attribute. This is often not included on elements that issue htmx-driven requests because
its default behavior — <code>innerHTML</code>, which swaps the inner HTML of the element — tends to cover most use cases.</p>
</div>
<div class="paragraph">
<p>We earlier saw situations where we wanted to override the default behavior and use <code>outerHTML</code>, for example.  And, in
chapter 2, we discussed some other swap options beyond these two, <code>beforebegin</code>, <code>afterend</code>, etc.</p>
</div>
<div class="paragraph">
<p>In chapter 5, we also looked at the <code>swap</code> delay modifier for <code>hx-swap</code>, which allowed us to fade some content out
before it was removed from the DOM.</p>
</div>
<div class="paragraph">
<p>In addition to these, <code>hx-swap</code> offers further control with the following modifiers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>settle</code></dt>
<dd>
<p>
Like <code>swap</code>, this allows you to apply a specific delay between when the content has been swapped into the DOM and when
its attributes are “settled”, that is, updated from their old values (if any) to their new values. This can give you
fine-grained control over CSS transitions.</p>
</dd>
<dt class="hdlist1"><code>show</code></dt>
<dd>
<p>
Allows you to specify an element that should be shown — that is, scrolled into the viewport of the browser if
necessary — when a request is completed.</p>
</dd>
<dt class="hdlist1"><code>scroll</code></dt>
<dd>
<p>
Allows you to specify a scrollable element (that is, an element with scrollbars), that should be scrolled to the top or
bottom when a request is completed.</p>
</dd>
<dt class="hdlist1"><code>focus-scroll</code></dt>
<dd>
<p>
Allows you to specify that htmx should scroll to the focused element when a request completes. The default for this
modifier is “false.”</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>So, for example, if we had a button that issued a <code>GET</code> request, and we wished to scroll to the top of the <code>body</code> element
when the request completed, we would write the following HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Scrolling to the top of the page</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#content-div<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-swap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>innerHTML show:body:top<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This tells htmx to show the top of the body after the swap occurs.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>More details and examples can be found online in the <code>hx-swap</code> <a href="https://htmx.org/attributes/hx-swap/">documentation</a>.</p>
</div>
</section>
<section class="sect3">
<h4 id="_hx_trigger">hx-trigger</h4>
<div class="paragraph">
<p>

Like <code>hx-swap</code>, <code>hx-trigger</code> can often be omitted when you are using htmx, because the default behavior is typically
what you want.  Recall the default triggering events are determined by an element’s type:</p>
</div>
<div class="ulist">
<ul>
<li>
Requests on <code>input</code>, <code>textarea</code> &amp; <code>select</code> elements are triggered by the <code>change</code> event.
</li>
<li>
Requests on <code>form</code> elements are triggered on the <code>submit</code> event.
</li>
<li>
Requests on all other elements are triggered by the <code>click</code> event.
</li>
</ul>
</div>
<div class="paragraph">
<p>There are times, however, when you want a more elaborate trigger specification.  A classic example is the active search
example we implemented in Contact.app:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The active search input</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ request.args.get('q') or '' }}<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span>
           <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search, keyup delay:200ms changed<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An elaborate trigger specification.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This example took advantage of two modifiers available for the <code>hx-trigger</code> attribute:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>delay</code></dt>
<dd>
<p>
Allows you to specify a delay to wait before a request is issued.  If the event occurs again, the first event is discarded and the timer resets.  This allows you to “debounce” requests.</p>
</dd>
<dt class="hdlist1"><code>changed</code></dt>
<dd>
<p>
Allows you to specify that a request should only be issued when the <code>value</code> property of the given element has changed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>hx-trigger</code> has several additional modifiers.  This makes sense, because events are fairly complex and we want to be
able to take advantage of all the power they offer.  We will discuss events in more detail below.</p>
</div>
<div class="paragraph">
<p>Here are the other modifiers available on <code>hx-trigger</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>once</code></dt>
<dd>
<p>
The given event will only trigger a request once.</p>
</dd>
<dt class="hdlist1"><code>throttle</code></dt>
<dd>
<p>
Allows you to throttle events, only issuing them once every certain interval.  This is different than <code>delay</code> in that
the first event will trigger immediately, but any following events will not trigger until the throttle time period
has elapsed.</p>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>
A CSS selector that allows you to pick another element to listen for events on.  We will see an example of this used later in the chapter.</p>
</dd>
<dt class="hdlist1"><code>target</code></dt>
<dd>
<p>
  A CSS selector that allows you to filter events to only those that occur directly on a given element.  In the DOM,
  events “bubble” to their parent elements, so a <code>click</code> event on a button will also trigger a <code>click</code> event on a parent
  <code>div</code>, all the way up to the <code>body</code> element.  Sometimes you want to specify an event directly on a given element, and
  this attribute allows you to do that.</p>
</dd>
<dt class="hdlist1"><code>consume</code></dt>
<dd>
<p>
  If this option is set to <code>true</code>, the triggering event will be cancelled and not propagate to parent elements.</p>
</dd>
<dt class="hdlist1"><code>queue</code></dt>
<dd>
<p>
  This option allows you to specify how events are queued in htmx.  By default, when htmx receives a triggering event,
  it will issue a request and start an event queue.  If the request is still in flight when another event is received,
  it will queue the event and, when the request finishes, trigger a new request.  By default, it only keeps the last
  event it receives, but you can modify that behavior using this option: for example, you can set it to <code>none</code> and ignore
  all triggering events that occur during a request.</p>
</dd>
</dl>
</div>
<section class="sect4">
<h5 id="_trigger_filters">Trigger filters</h5>
<div class="paragraph">
<p>
The <code>hx-trigger</code> attribute also allows you to specify a <em>filter</em> for events by using square brackets enclosing a
JavaScript expression after the event name.</p>
</div>
<div class="paragraph">
<p>Let’s say you have a complex situation where contacts should only be retrievable in certain situations. You have
a JavaScript function, <code>contactRetrievalEnabled()</code> that returns a boolean, <code>true</code> if contacts can be retrieved and
<code>false</code> otherwise.  How could you use this function to place a gate on a button that issues a request to <code>/contacts</code>?</p>
</div>
<div class="paragraph">
<p>To do this using an event filter in htmx, you would write the following HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The active search input</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-hyperscript">
  function contactRetrievalEnabled<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">/</span><span class="token operator">/</span> code <span class="token keyword">to</span> test <span class="token keyword"><span class="token hs-start bold">if</span></span> contact retrieval <span class="token keyword">is</span> enabled
      <span class="token operator">..</span><span class="token operator">.</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>click[contactRetrievalEnabled()]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A request is issued on click only when <code>contactRetrievalEnabled()</code> returns <code>true</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The button will not issue a request if <code>contactRetrievalEnabled()</code> returns false, allowing you to dynamically control
when the request will be made.  There are common situations that call for an event trigger, when you only want to issue
a request under specific circumstances:</p>
</div>
<div class="ulist">
<ul>
<li>
if a certain element has focus
</li>
<li>
if a given form is valid
</li>
<li>
if a set of inputs have specific values
</li>
</ul>
</div>
<div class="paragraph">
<p>Using event filters, you can use whatever logic you’d like to filter requests by htmx.</p>
</div>
</section>
<section class="sect4">
<h5 id="_synthetic_events">Synthetic events</h5>
<div class="paragraph">
<p>
In addition to these modifiers, <code>hx-trigger</code> offers a few “synthetic” events, that is events that are not part of the
regular DOM API.  We have already seen <code>load</code> and <code>revealed</code> in our lazy loading and infinite scroll examples, but
htmx also gives you an <code>intersect</code> event that triggers when an element intersects its parent element.</p>
</div>
<div class="paragraph">
<p>
This synthetic event uses the modern Intersection Observer API, which you can read more about
at <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API">MDN</a>.</p>
</div>
<div class="paragraph">
<p>Intersection gives you fine-grained control over exactly when a request should be triggered.  For example, you can
set a threshold and specify that the request be issued only when an element is 50% visible.</p>
</div>
<div class="paragraph">
<p>The <code>hx-trigger</code> attribute certainly is the most complex in htmx. More details and examples can be found in its
<a href="https://htmx.org/attributes/hx-trigger/">documentation</a>.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_other_attributes">Other Attributes</h4>
<div class="paragraph">
<p>Htmx offers many other less commonly used attributes for fine-tuning the behavior of your Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>Here are some of the most useful ones:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">hx-push-url</dt>
<dd>
<p>
  “Pushes” the request URL (or some other value) into the navigation bar.</p>
</dd>
<dt class="hdlist1">hx-preserve</dt>
<dd>
<p>
  Preserves a bit of the DOM between requests; the original content will be kept, regardless of what is returned.</p>
</dd>
<dt class="hdlist1">hx-sync</dt>
<dd>
<p>
  Synchronized requests between two or more elements.</p>
</dd>
<dt class="hdlist1">hx-disable</dt>
<dd>
<p>
  Disables htmx behavior on this element and any children.  We will come back to this when we discuss the topic of security.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Let’s take a look at <code>hx-sync</code>, which allows us to synchronize AJAX requests between two or more elements.  Consider
a simple case where we have two buttons that both target the same element on the screen:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Two competing buttons</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get Settings
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>This is fine and will work, but what if a user clicks the “Get Contacts” button and then the request takes a while to
respond?  And, in the meantime the user clicks the “Get Settings” button?  In this case we would have two requests in
flight at the same time.</p>
</div>
<div class="paragraph">
<p>If the <code>/settings</code> request finished first and displayed the user’s setting information, they might be very surprised
if they began making changes and then, suddenly, the <code>/contacts</code> request finished and replaced the entire body with
the contacts instead!</p>
</div>
<div class="paragraph">
<p>To deal with this situation, we might consider using an <code>hx-indicator</code> to alert the user that something is going on, making
it less likely that they click the second button.  But if we really want to guarantee that there is only one request
at a time issued between these two buttons, the right thing to do is to use the <code>hx-sync</code> attribute.  Let’s enclose
both buttons in a <code>div</code> and eliminate the redundant <code>hx-target</code> specification by hoisting the attribute up to that
<code>div</code>.  We can then use <code>hx-sync</code> on that div to coordinate requests between the two buttons.</p>
</div>
<div class="paragraph">
<p>Here is our updated code:</p>
</div>
<div class="paragraph">
<p></p>
</div>
<figure class="listingblock">
<figcaption class="title">Syncing two buttons</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span>  <span class="token attr-name">(1)</span>
     <span class="token attr-name">hx-sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>this<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
      Get Contacts
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
      Get Settings
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Hoist the duplicate <code>hx-target</code> attributes to the parent <code>div</code>.
</li>
<li>
Synchronize on the parent <code>div</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>By placing the <code>hx-sync</code> attribute on the <code>div</code> with the value <code>this</code>, we are saying “Synchronize all htmx requests that
occur within this <code>div</code> element with one another.”  This means that if one button already has a request in flight, other
buttons within the <code>div</code> will not issue requests until that has finished.</p>
</div>
<div class="paragraph">
<p>The <code>hx-sync</code> attribute supports a few different strategies that allow you to, for example, replace an existing request
in flight, or queue requests with a particular queuing strategy.  You can find complete documentation, as well as
examples, at the htmx.org page for <a href="https://htmx.org/attributes/hx-sync/"><code>hx-sync</code></a>.</p>
</div>
<div class="paragraph">
<p>As you can see, htmx offers a lot of attribute-driven functionality for more advanced Hypermedia-Driven Applications.
A complete reference for all htmx attributes can be found <a href="https://htmx.org/reference/#attributes">on the htmx website</a>.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_events">Events</h3>
<div class="paragraph">
<p>
Thus far we have worked with JavaScript events in htmx primarily via the <code>hx-trigger</code> attribute.  This attribute has
proven to be a powerful mechanism for driving our application using a declarative, HTML-friendly syntax.</p>
</div>
<div class="paragraph">
<p>However, there is much more we can do with events. Events play a crucial role both in the extension of HTML as a
hypermedia, and, as we’ll see, in hypermedia-friendly scripting. Events are the “glue” that brings the DOM, HTML,
htmx and scripting together. You might think of the DOM as a sophisticated "event bus" for applications.</p>
</div>
<div class="paragraph">
<p>We can’t emphasize enough: to build advanced Hypermedia-Driven Applications, it is worth the effort to learn about events
<a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events">in depth</a>.</p>
</div>
<section class="sect3">
<h4 id="_htmx_generated_events">Htmx-Generated Events</h4>
<div class="paragraph">
<p>
In addition to making it easy to <em>respond</em> to events, htmx also <em>emits</em> many useful events.  You can use these events to
add more functionality to your application, either via htmx itself, or by way of scripting.</p>
</div>
<div class="paragraph">
<p>Here are some of the most commonly used events triggered by htmx:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>htmx:load</code></dt>
<dd>
<p>
  Triggered when new content is loaded into the DOM by htmx.</p>
</dd>
<dt class="hdlist1"><code>htmx:configRequest</code></dt>
<dd>
<p>
  Triggered before a request is issued, allowing you to programmatically configure the request or cancel it entirely.</p>
</dd>
<dt class="hdlist1"><code>htmx:afterRequest</code></dt>
<dd>
<p>
  Triggered after a request has responded.</p>
</dd>
<dt class="hdlist1"><code>htmx:abort</code></dt>
<dd>
<p>
  A custom event that can be sent to an htmx-powered element to abort an open request.</p>
</dd>
</dl>
</div>
</section>
<section class="sect3">
<h4 id="_using_the_htmxconfigrequest_event">Using the htmx:configRequest Event</h4>
<div class="paragraph">
<p>Let’s look at an example of how to work with htmx-emitted events. We’ll use the <code>htmx:configRequest</code> event to configure
an HTTP request.</p>
</div>
<div class="paragraph">
<p>
Consider the following scenario: your server-side team has decided that they want you to include a server-generated
token for extra security on every request. The token is going to be stored in <code>localStorage</code> in the browser, in the slot
<code>special-token</code>.</p>
</div>
<div class="paragraph">
<p>The token is being set via some JavaScript (don’t worry about the details yet) when the user first logs in:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Getting The Token in JavaScript</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    localStorage<span class="token punctuation">[</span><span class="token string">'special-token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Get the value of the token then set it into localStorage
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The server-side team wants you to include this special token on every request made by htmx, as the <code>X-SPECIAL-TOKEN</code> header.
How could you achieve this?  One way would be to catch the <code>htmx:configRequest</code> event and update the <code>detail.headers</code>
object with this token from <code>localStorage</code>.</p>
</div>
<div class="paragraph">
<p>In VanillaJS, it would look something like this, placed in a <code>&lt;script&gt;</code> tag in the <code>&lt;head&gt;</code> of our HTML document:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding the <code>X-SPECIAL-TOKEN</code> header</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"htmx:configRequest"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">configEvent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    configEvent<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'X-SPECIAL-TOKEN'</span><span class="token punctuation">]</span> <span class="token operator">=</span> localStorage<span class="token punctuation">[</span><span class="token string">'special-token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Retrieve the value from local storage and set it into a header.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As you can see, we add a new value to the <code>headers</code> property of the event’s detail property.  After the event handler
executes, this <code>headers</code> property is read by htmx and used to construct the request headers for the AJAX request it makes.</p>
</div>
<div class="paragraph">
<p>The <code>detail</code> property of the <code>htmx:configRequest</code> event contains a slew of useful properties that you can update to change the
"shape" of the request, including:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>detail.parameters</code></dt>
<dd>
<p>
Allows you to add or remove request parameters</p>
</dd>
<dt class="hdlist1"><code>detail.target</code></dt>
<dd>
<p>
Allows you to update the target of the request</p>
</dd>
<dt class="hdlist1"><code>detail.verb</code></dt>
<dd>
<p>
Allows you to update HTTP "verb" of the request (e.g. <code>GET</code>)</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>So, for example, if the server-side team decided they wanted the token included as a parameter, rather than as a
request header, you could update your code to look like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding the <code>token</code> parameter</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"htmx:configRequest"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">configEvent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    configEvent<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> localStorage<span class="token punctuation">[</span><span class="token string">'special-token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Retrieve the value from local storage and set it into a parameter.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As you can see, this gives you a lot of flexibility in updating the AJAX request that htmx makes.</p>
</div>
<div class="paragraph">
<p>The full documentation for the <code>htmx:configRequest</code> event (and other events you might be interested in) can be found
<a href="https://htmx.org/events/#htmx:configRequest">on the htmx website</a>.</p>
</div>
</section>
<section class="sect3">
<h4 id="_canceling_a_request_using_htmxabort">Canceling a Request Using htmx:abort</h4>
<div class="paragraph">
<p>

We can listen for any of the many useful events from htmx, and we can respond to those events using <code>hx-trigger</code>.  What
else can we do with events?</p>
</div>
<div class="paragraph">
<p>It turns out that htmx itself listens for one special event, <code>htmx:abort</code>.  When htmx receives this
event on an element that has a request in flight, it will abort the request.</p>
</div>
<div class="paragraph">
<p>Consider a situation where we have a potentially long-running request to <code>/contacts</code>, and we want to offer a way for
the users to cancel the request.  What we want is a button that issues the request, driven by htmx, of course, and then
another button that will send an <code>htmx:abort</code> event to the first one.</p>
</div>
<div class="paragraph">
<p>Here is what the code might look like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A button with an abort</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-btn<span class="token punctuation">"</span></span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  Get Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'contacts-btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'htmx:abort'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> (2)
  Cancel
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A normal htmx-driven <code>GET</code> request to <code>/contacts</code>
</li>
<li>
JavaScript to look up the button and send it an <code>htmx:abort</code> event
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>So now, if a user clicks on the “Get Contacts” button and the request takes a while, they can click on the “Cancel”
button and end the request.  Of course, in a more sophisticated user interface, you may want to disable the “Cancel”
button unless an HTTP request is in flight, but that would be a pain to implement in pure JavaScript.</p>
</div>
<div class="paragraph">
<p>Thankfully this isn’t too bad to implement in hyperscript, so let’s take a look at what that would look like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A hyperscript-Powered Button With An Abort</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-btn<span class="token punctuation">"</span></span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  Get Contacts
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">_</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value hyperscript language-hyperscript"><span class="token keyword"><span class="token hs-start bold">on</span></span> click <span class="token keyword"><span class="token hs-start bold">send</span></span> htmx<span class="token punctuation">:</span>abort <span class="token keyword">to</span> <span class="token id-ref selector">#contacts-btn</span>
           <span class="token keyword"><span class="token hs-start bold">on</span></span> htmx<span class="token punctuation">:</span>beforeRequest <span class="token keyword">from</span> <span class="token id-ref selector">#contacts-btn</span> <span class="token keyword"><span class="token hs-start bold">remove</span></span> <span class="token attribute">@<span class="token attr-name">disabled</span></span> <span class="token keyword">from</span> <span class="token builtin">me</span>
           <span class="token keyword"><span class="token hs-start bold">on</span></span> htmx<span class="token punctuation">:</span>afterRequest <span class="token keyword">from</span> <span class="token id-ref selector">#contacts-btn</span> <span class="token keyword"><span class="token hs-start bold">add</span></span> <span class="token attribute">@<span class="token attr-name">disabled</span></span> <span class="token keyword">to</span> <span class="token builtin">me</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
  Cancel
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Now we have a “Cancel” button that is enabled only when a request from the <code>contacts-btn</code> button is in flight.  And
we are taking advantage of htmx-generated and handled events, as well as the event-friendly syntax of hyperscript, to
make it happen.  Slick!</p>
</div>
</section>
<section class="sect3">
<h4 id="_server_generated_events">Server Generated Events</h4>
<div class="paragraph">
<p>We are going to talk more about the various ways that htmx enhances regular HTTP requests and responses in the next section,
but, since it involves events, we are going to discuss one HTTP Response header that htmx supports: <code>HX-Trigger</code>.  We
have discussed before how HTTP requests and responses support <em>headers</em>, name-value pairs that contain metadata about
a given request or response.  We took advantage of the <code>HX-Trigger</code> request header, which includes the id of the element
that triggered a given request.</p>
</div>
<div class="paragraph">
<p>
In addition to this <em>request header</em>, htmx also supports a <em>response header</em> also named <code>HX-Trigger</code>.  This response header
allows you to <em>trigger an event</em> on the element that submitted an AJAX request.  This turns out to be a powerful way
to coordinate elements in the DOM in a decoupled manner.</p>
</div>
<div class="paragraph">
<p>To see how this might work, let’s consider the following situation: we have a button that grabs new contacts from some
remote system on the server.  We will ignore the details of the server-side implementation, but we know that if we issue
a <code>POST</code> to the <code>/sync</code> path, it will trigger a synchronization with the system.</p>
</div>
<div class="paragraph">
<p>Now, this synchronization may or may not result in new contacts being created.  In the case where new contacts <em>are</em>
created, we want to refresh our contacts table.  In the case where no contacts are created, we don’t want to refresh
the table.</p>
</div>
<div class="paragraph">
<p>To implement this we could conditionally add an <code>HX-Trigger</code> response header with the value <code>contacts-updated</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Conditionally Triggering a <code>contacts-updated</code> event</figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route('/sync', methods=["POST"])
def sync_with_server():
    contacts_updated = RemoteServer.sync() (1)
    resp = make_response(render_template('sync.html'))
    if contacts_updated (2)
      resp.headers['HX-Trigger'] = 'contacts-updated'
    return resp</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A call to the remote system that synchronized our contact database with it
</li>
<li>
If any contacts were updated we conditionally trigger the <code>contacts-updated</code> event on the client
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This value would trigger the <code>contacts-updated</code> event on the button that
made the AJAX request to <code>/sync</code>.  We can then take advantage of the <code>from:</code> modifier of the <code>hx-trigger</code>
attribute to listen for that event. With this pattern we can effectively trigger htmx requests from the server side.</p>
</div>
<div class="paragraph">
<p>Here is what the client-side code might look like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">The Contacts Table</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/integrations/1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
     Pull Contacts From Integration
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

      ...

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">hx-get</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/table<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-updated from:body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
      ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The response to this request may conditionally trigger the <code>contacts-updated</code> event
</li>
<li>
This table listens for the event and refreshes when it occurs
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The table listens for the <code>contacts-updated</code> event, and it does so on the <code>body</code> element.  It listens on the <code>body</code>
element since the event will bubble up from the button, and this allows us to not couple the button and table together:
we can move the button and table around as we like and, via events, the behavior we want will continue to work fine.
Additionally, we may want <em>other</em> elements or requests to trigger the <code>contacts-updated</code> event, so this provides a
general mechanism for refreshing the contacts table in our application.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_http_requests_responses">HTTP Requests &amp; Responses</h3>
<div class="paragraph">
<p>We have just seen an advanced feature of HTTP responses supported by htmx, the <code>HX-Trigger</code> response header,
but htmx supports quite a few more headers for both requests and responses.  In chapter 4 we discussed the
headers present in HTTP Requests.  Here are some of the more important headers you can use to change htmx behavior with
HTTP responses:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>HX-Location</code></dt>
<dd>
<p>
Causes a client-side redirection to a new location</p>
</dd>
<dt class="hdlist1"><code>HX-Push-Url</code></dt>
<dd>
<p>
  Pushes a new URL into the location bar</p>
</dd>
<dt class="hdlist1"><code>HX-Refresh</code></dt>
<dd>
<p>
  Refreshes the current page</p>
</dd>
<dt class="hdlist1"><code>HX-Retarget</code></dt>
<dd>
<p>
  Allows you to specify a new target to swap the response content into on the client side</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can find a reference for all requests and response headers in the <a href="https://htmx.org/reference/#headers">htmx documentation</a>.</p>
</div>
<section class="sect3">
<h4 id="_http_response_codes_2">HTTP Response Codes</h4>
<div class="paragraph">
<p>
Even more important than response headers, in terms of information conveyed to the client, is the <em>HTTP Response Code</em>.
We discussed HTTP Response Codes in Chapter 3.  By and large htmx handles various response codes in the manner that
you would expect: it swaps content for all 200-level response codes and does nothing for others.  There are, however,
two “special” 200-level response codes:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>204 No Content</code> - When htmx receives this response code, it will <em>not</em> swap any content into the DOM (even if the response
has a body)
</li>
<li>
<code>286</code> - When htmx receives this response code to a request that is polling, it will stop the polling
</li>
</ul>
</div>
<div class="paragraph">
<p>You can override the behavior of htmx with respect to response codes by, you guessed it, responding to an event!  The
<code>htmx:beforeSwap</code> event allows you to change the behavior of htmx with respect to various status codes.</p>
</div>
<div class="paragraph">
<p>Let’s say that, rather than doing nothing when a <code>404</code> occurred, you wanted to alert the user that an error had occurred.
To do so, you want to invoke a JavaScript method, <code>showNotFoundError()</code>.  Let’s add some code to use the <code>htmx:beforeSwap</code>
event to make this happen:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Showing a 404 dialog</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'htmx:beforeSwap'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token function">showNotFoundError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Hook into the <code>htmx:beforeSwap</code> event.
</li>
<li>
If the response code is a <code>404</code>, show the user a dialog.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You can also use the <code>htmx:beforeSwap</code> event to configure if the response should be swapped into the DOM and what element
the response should target.  This gives you quite a bit of flexibility in choosing how you want to use HTTP Response
codes in your application.  Full documentation on the <code>htmx:beforeSwap</code> event can be found at <a href="https://htmx.org/events/#htmx:beforeSwap">htmx.org</a>.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_updating_other_content">Updating Other Content</h3>
<div class="paragraph">
<p>Above we saw how to use a server-triggered event, via the <code>HX-Trigger</code> HTTP response header, to update a piece of the
DOM based on the response to another part of the DOM.  This technique addresses the general problem that comes up
in Hypermedia-Driven Applications: “How do I update other content?”  After all, in normal HTTP requests, there is only
one “target”, the entire screen, and, similarly, in htmx-based requests, there is only one target: either the explicit
or implicit target of the element.</p>
</div>
<div class="paragraph">
<p>If you want to update other content in htmx, you have a few options:</p>
</div>
<section class="sect3">
<h4 id="_expanding_your_selection">Expanding Your Selection</h4>
<div class="paragraph">
<p>The first option, and the simplest, is to “expand the target.” That is, rather than simply replacing a small part
of the screen, expand the target of your htmx-driven request until it is large enough to enclose all the elements that
need to be updated on a screen.  This has the tremendous advantage of being simple and reliable.  The downside is that
it may not provide the user experience that you want, and it may not play well with a particular server-side template
layout.  Regardless, we always recommend at least thinking about this approach first.</p>
</div>
</section>
<section class="sect3">
<h4 id="_out_of_band_swaps">Out of Band Swaps</h4>
<div class="paragraph">
<p>

A second option, a bit more complex, is to take advantage of “Out Of Band” content support in htmx.  When
htmx receives a response, it will inspect it for top-level content that includes the <code>hx-swap-oob</code> attribute.  That content will be removed from the response, so it will not be swapped into the DOM in the normal manner.  Instead,
it will be swapped in for the content that it matches by id.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example.  Consider the situation we had earlier, where a contacts table needs to be updated if an integration pulls down any new contacts.  Previously we solved this by using events and
a server-triggered event via the <code>HX-Trigger</code> response header.</p>
</div>
<div class="paragraph">
<p>This time, we’ll use the <code>hx-swap-oob</code> attribute in the response to the
<code>POST</code> to <code>/integrations/1</code>. The new contacts table content will “piggyback” on the response.</p>
</div>
<figure class="listingblock">
<figcaption class="title">The updated contacts table</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">hx-post</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/integrations/1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
     Pull Contacts From Integration
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

      ...

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-table<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
      ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The button still issues a <code>POST</code> to <code>/integrations/1</code>.
</li>
<li>
The table no longer listens for an event, but it now has an id.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Next, the response to the <code>POST</code> to <code>/integrations/1</code> will include the
content that needs to be swapped into the button, per the usual htmx mechanism.  But it will also include a new,
updated version of the contacts table, which will be marked as <code>hx-swap-oob="true"</code>.  This content will be removed from
the response so that it is not inserted into the button. Instead, it is swapped into the DOM in place of the existing
table since it has a matching id.</p>
</div>
<figure class="listingblock">
<figcaption class="title">A response with out-of-band content</figcaption>
<div class="content">
<pre class="highlight language-none" tabindex="0"><code class="language-none">HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
...

Pull Contacts From Integration (1)

&lt;table id="contacts-table" hx-swap-oob="true"&gt; (2)
  ...
&lt;/table&gt;</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This content will be placed in the button.
</li>
<li>
This content will be removed from the response and swapped by id.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Using this piggybacking technique, you can update content wherever needed on a page.
The <code>hx-swap-oob</code> attribute supports other additional features, all of which are <a href="https://htmx.org/attributes/hx-swap-oob/">documented</a>.</p>
</div>
<div class="paragraph">
<p>Depending on how exactly your server-side templating technology works, and what level of interactivity your application
requires, out of band swapping can be a powerful mechanism for content updates.</p>
</div>
</section>
<section class="sect3">
<h4 id="_events_2">Events</h4>
<div class="paragraph">
<p>
Finally, the most complex mechanism for updating content is the one we saw back in the events section: using server-triggered
events to update elements.  This approach can be very clean, but also requires a deeper conceptual knowledge of HTML
and events, and a commitment to the event-driven approach.  While we like this style of development, it isn’t for everyone.
We typically recommend this pattern only if the htmx philosophy of event-driven hypermedia really speaks to you.</p>
</div>
<div class="paragraph">
<p>If it <em>does</em> speak to you, however, we say: go for it.  We’ve created some very complex and flexible user interfaces using
this approach, and we are quite fond of it.</p>
</div>
</section>
<section class="sect3">
<h4 id="_being_pragmatic">Being Pragmatic</h4>
<div class="paragraph">
<p>
All of these approaches to the “Updating Other Content” problem will work, and will often work well.  However, there may
come a point where it would just be simpler to use a different approach for your UI, like the reactive one.  As much as we like
the hypermedia approach, the reality is that there are some UX patterns that simply cannot be implemented
easily using it.  The canonical example of this sort of pattern, which we have mentioned before, is something like a live
online spreadsheet: it is simply too complex a user interface, with too many interdependencies, to be done well via
exchanges of hypermedia with a server.</p>
</div>
<div class="paragraph">
<p>In cases like this, and any time you feel like an htmx-based solution is proving to be more complex than another approach
might be, we recommend that you consider a different technology. Be pragmatic, and use the right tool for the job.  You can always
use htmx for the parts of your application that aren’t as complex and don’t need the full complexity of a reactive framework,
and save that complexity budget for the parts that do.</p>
</div>
<div class="paragraph">
<p>We encourage you to learn many different web technologies, with an eye to the strengths
and weaknesses of each one.  This will give you a deep tool chest to reach into when problems present themselves. Our
experience is that, with htmx, hypermedia is a tool you can reach for frequently.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_debugging">Debugging</h3>
<div class="paragraph">
<p>

We are not ashamed to admit: we are big fans of events.  They
are the underlying technology of almost any interesting user interface, and are particularly useful in the DOM once they
have been unlocked for general use in HTML.  They let you build nicely decoupled software while often preserving
the locality of behavior we like so much.</p>
</div>
<div class="paragraph">
<p>However, events are not perfect. One area where events can be particularly tricky to deal with is <em>debugging</em>: you
often want to know why an event <em>isn’t</em> happening.  But where can you set a break point for something that <em>isn’t</em> happening?
The answer, as of right now, is: you can’t.</p>
</div>
<div class="paragraph">
<p>There are two techniques that can help in this regard, one provided by htmx, the other provided by Chrome, the browser
by Google.</p>
</div>
<section class="sect3">
<h4 id="_logging_htmx_events">Logging Htmx Events</h4>
<div class="paragraph">
<p>The first technique, provided by htmx itself, is to call the <code>htmx.logAll()</code> method.  When you do this, htmx will log
all the internal events that occur as it goes about its business, loading up content, responding to events and so forth.</p>
</div>
<div class="paragraph">
<p>This can be overwhelming, but with judicious filtering can help you zero in on a problem.  Here are what (a bit of) the logs
look like when clicking on the “docs” link on <a href="https://htmx.org" class="bare">https://htmx.org</a>, with <code>logAll()</code> enabled:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Htmx logs</figcaption>
<div class="content">
<pre class="highlight language-text" tabindex="0"><code class="language-text" data-lang="text">htmx:configRequest
&lt;a href="/docs/"&gt;
Object { parameters: {}, unfilteredParameters: {}, headers: {…}, target: body, verb: "get", errors: [], withCredentials: false, timeout: 0, path: "/docs/", triggeringEvent: a
, … }
htmx.js:439:29
htmx:beforeRequest
&lt;a href="/docs/"&gt;
Object { xhr: XMLHttpRequest, target: body, requestConfig: {…}, etc: {}, pathInfo: {…}, elt: a
 }
htmx.js:439:29
htmx:beforeSend
&lt;a class="htmx-request" href="/docs/"&gt;
Object { xhr: XMLHttpRequest, target: body, requestConfig: {…}, etc: {}, pathInfo: {…}, elt: a.htmx-request
 }
htmx.js:439:29
htmx:xhr:loadstart
&lt;a class="htmx-request" href="/docs/"&gt;
Object { lengthComputable: false, loaded: 0, total: 0, elt: a.htmx-request
 }
htmx.js:439:29
htmx:xhr:progress
&lt;a class="htmx-request" href="/docs/"&gt;
Object { lengthComputable: true, loaded: 4096, total: 19915, elt: a.htmx-request
 }
htmx.js:439:29
htmx:xhr:progress
&lt;a class="htmx-request" href="/docs/"&gt;
Object { lengthComputable: true, loaded: 19915, total: 19915, elt: a.htmx-request
 }
htmx.js:439:29
htmx:beforeOnLoad
&lt;a class="htmx-request" href="/docs/"&gt;
Object { xhr: XMLHttpRequest, target: body, requestConfig: {…}, etc: {}, pathInfo: {…}, elt: a.htmx-request
 }
htmx.js:439:29
htmx:beforeSwap
&lt;body hx-ext="class-tools, preload"&gt;</code></pre>
</div>
</figure>
<div class="paragraph">
<p>Not exactly easy on the eyes, is it?</p>
</div>
<div class="paragraph">
<p>But, if you take a deep breath and squint, you can see that it isn’t
<em>that</em> bad: a series of htmx events, some of which we have seen before (there’s <code>htmx:configRequest</code>!), get logged
to the console, along with the element they are triggered on.</p>
</div>
<div class="paragraph">
<p>After a bit of reading and filtering, you will be
able to make sense of the event stream, and it can help you debug htmx-related issues.</p>
</div>
</section>
<section class="sect3">
<h4 id="_monitoring_events_in_chrome">Monitoring Events in Chrome</h4>
<div class="paragraph">
<p>The preceding technique is useful if the problem is occurring somewhere <em>within</em> htmx, but what if htmx is never getting
triggered at all?  This comes up some times, like when, for example, you have accidentally typed an event name incorrectly
somewhere.</p>
</div>
<div class="paragraph">
<p>In cases like this you will need recourse to a tool available in the browser itself.  Fortunately, the Chrome browser
by Google provides a very useful function, <code>monitorEvents()</code>, that allows you to monitor <em>all</em> events that are triggered
on an element.</p>
</div>
<div class="paragraph">
<p>This feature is available <em>only</em> in the console, so you can’t use it in code on your page.  But, if
you are working with htmx in Chrome, and are curious why an event isn’t triggering on an element, you can open the
developers console and type the following:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Htmx logs</figcaption>
<div class="content">
<pre class="highlight language-javascript" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="token function">monitorEvents</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"some-element"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>This will then print <em>all</em> the events that are triggered on the element with the id <code>some-element</code> to the console.  This
can be very useful for understanding exactly which events you want to respond to with htmx, or troubleshooting why an
expected event isn’t occurring.</p>
</div>
<div class="paragraph">
<p>Using these two techniques will help you as you (infrequently, we hope) troubleshoot event-related issues when developing
with htmx.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_security_considerations">Security Considerations</h3>
<div class="paragraph">
<p>

In general, htmx and hypermedia tends to be more secure than JavaScript heavy approaches to building web applications. This
is because, by moving much of the processing to the back end, the hypermedia approach tends not to expose as much surface
area of your system to end users for manipulation and shenanigans.</p>
</div>
<div class="paragraph">
<p>However, even with hypermedia, there are still situations that require care when doing development.  Of particular
concern are situations where user-generated content is shown to other users: a clever user might try to insert
htmx code that tricks the other users into clicking on content that triggers actions they don’t want to take.</p>
</div>
<div class="paragraph">
<p>In general, all user-generated content should be escaped on the server-side, and most server-side rendering frameworks
provide functionality for handling this situation.  But there is always a risk that something slips through the cracks.</p>
</div>
<div class="paragraph">
<p>
In order to help you sleep better at night, htmx provides the <code>hx-disable</code> attribute.  When this attribute is placed
on an element, all htmx attributes within that element will be ignored.</p>
</div>
<section class="sect3">
<h4 id="_content_security_policies_htmx">Content Security Policies &amp; Htmx</h4>
<div class="paragraph">
<p>
A Content Security Policy (CSP) is a browser technology that allows you to detect and prevent certain types of
content injection-based attacks.  A full discussion of CSPs is beyond the scope of this book, but we refer you to
the  <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Mozilla Developer Network article</a> on the topic for more information.</p>
</div>
<div class="paragraph">
<p>A common feature to disable using a CSP is the <code>eval()</code> feature of JavaScript, which allows you to evaluate arbitrary
JavaScript code from a string.  This has proven to be a security issue and many teams have decided that it is not worth
the risk to keep it enabled in their web applications.</p>
</div>
<div class="paragraph">
<p>
Htmx does not make heavy use of <code>eval()</code> and, thus, a CSP with this restriction in place will be fine.  The one
feature that does rely on <code>eval()</code> is event filters, discussed above.  If you decide to disable <code>eval()</code> for your
web application, you will not be able to use the event filtering syntax.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_configuring">Configuring</h3>
<div class="paragraph">
<p>
There are a large number of configuration options available for htmx.  Some examples of things you can configure are:</p>
</div>
<div class="ulist">
<ul>
<li>
The default swap style
</li>
<li>
The default swap delay
</li>
<li>
The default timeout of AJAX requests
</li>
</ul>
</div>
<div class="paragraph">
<p>A full list of configuration options can be found in the config section of the <a href="https://htmx.org/docs/#config">main htmx documentation</a>.</p>
</div>
<div class="paragraph">
<p>Htmx is typically configured via a <code>meta</code> tag, found in the header of a page.  The name of the meta tag should be
<code>htmx-config</code>, and the content attribute should contain the configuration overrides, formatted as JSON.  Here is
an example:</p>
</div>
<figure class="listingblock">
<figcaption class="title">An htmx configuration via <code>meta</code> tag</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>htmx-config<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>{"defaultSwapStyle":"outerHTML"}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>In this case, we are overriding the default swap style from the usual <code>innerHTML</code> to <code>outerHTML</code>.  This might be useful
if you find yourself using <code>outerHTML</code> more frequently than <code>innerHTML</code> and want to avoid having to explicitly set that
swap value throughout your application.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_semantic_html">HTML Notes: Semantic HTML</h3>
<div class="paragraph">
<p>Telling people to "use semantic HTML" instead of "read the spec" has led to a lot of people guessing at the meaning of tags — "`looks pretty semantic to me!" — instead of engaging with the spec.</p>
</div>
<div class="quoteblock">
<blockquote>
I think being asked to write <em>meaningful</em> HTML better lights the path to realizing that it isn’t about what the text means to humans—​it’s about using tags for the purpose outlined in the specs to meet the needs of software like browsers, assistive technologies, and search engines.
</blockquote>
<div class="attribution margin-inline-start">
— https://t-ravis.com/post/doc/semantic_the_8_letter_s-word/
</div>
</div>
<div class="paragraph">
<p>We recommend talking about, and writing, <em>conformant</em> HTML.
(We can always bikeshed further).
Use the elements to the full extent provided by the HTML specification,
and let the software take from it whatever meaning they can.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_client_side_scripting">Client-Side Scripting</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
REST allows client functionality to be extended by downloading and executing code in the form of applets or scripts.
This simplifies clients by reducing the number of features required to be pre-implemented.
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite>Architectural Styles and the Design of Network-based Software Architectures</cite>
</div>
</div>
<div class="paragraph">
<p>Thus far we have (mostly) avoided writing any JavaScript (or _hyperscript) in Contact.app, mainly because the functionality
we implemented has not required it.  In this chapter we are going to look at scripting and, in particular, hypermedia-friendly
scripting within the context of a Hypermedia-Driven Application.</p>
</div>
<section class="sect2">
<h3 id="_is_scripting_allowed">Is Scripting Allowed?</h3>
<div class="paragraph">
<p>A common criticism of the web is that it’s being misused.  There is a narrative that WWW was created as a delivery system
for “documents”, and only came to be used for “applications” by way of an accident or bizarre circumstances.</p>
</div>
<div class="paragraph">
<p>However, the concept of hypermedia challenges the split of document and application. Hypermedia systems like HyperCard, which preceded the web, featured rich capabilities for active
and interactive experiences, including scripting.</p>
</div>
<div class="paragraph">
<p>HTML, as specified and implemented, does lack affordances needed to build highly interactive applications. This doesn’t mean, however, that hypermedia’s <em>purpose</em> is “documents”
over “applications.”</p>
</div>
<div class="paragraph">
<p>Rather, while the theoretical foundation is there, the implementation is underdeveloped. With JavaScript being the
only extension point and hypermedia controls not being well integrated to JavaScript (why can’t one click a link without
halting the program?), developers have not internalized hypermedia and have instead used the web as a dumb pipe for apps
that imitate “native” ones.</p>
</div>
<div class="paragraph">
<p>A goal of this book is to show that it is possible to build sophisticated web applications using the original technology
of the web, hypermedia, without the application developer needing to reach for the abstractions provided by the large,
popular JavaScript frameworks.</p>
</div>
<div class="paragraph">
<p>Htmx itself is, of course, written in JavaScript, and one of its advantages is that hypermedia interactions that go
through htmx expose a rich interface to JavaScript code with configuration, events, and htmx’s own extension support.</p>
</div>
<div class="paragraph">
<p>Htmx expands the expressiveness of HTML enough that it removes the need for scripting in many situations.
This makes htmx attractive to people who don’t want to write JavaScript, and there are many of those sorts of developers,
wary of the complexity of Single Page Application frameworks.</p>
</div>
<div class="paragraph">
<p>However, dunking on JavaScript is not the aim of the htmx project.
The goal of htmx is not less JavaScript, but less code, more readable and hypermedia-friendly code.</p>
</div>
<div class="paragraph">
<p>Scripting has been a massive force multiplier for the web. Using scripting, web application developers are not only able
to enhance their HTML websites, but also create full-fledged client-side applications that can often compete with
native, thick client applications.</p>
</div>
<div class="paragraph">
<p>This JavaScript-centric approach to building web applications is a testament to the power of the web and to the sophistication
of web browsers in particular.  It has its place in web development: there are situations where the hypermedia approach
simply can’t provide the level of interaction that an SPA can.</p>
</div>
<div class="paragraph">
<p>However, in addition to this more JavaScript-centric style, we want to develop a style of scripting more compatible and
consistent with Hypermedia-Driven Applications.</p>
</div>
</section>
<section class="sect2">
<h3 id="_scripting_for_hypermedia">Scripting for Hypermedia</h3>
<div class="paragraph">
<p>
Borrowing from Roy Fielding’s notion of “constraints” defining REST, we offer two constraints of hypermedia-friendly
scripting.  You are scripting in an HDA-compatible manner if the following two constraints are adhered to:</p>
</div>
<div class="ulist">
<ul>
<li>
The main data format exchanged between server and client must be hypermedia, the same as it would be without scripting.
</li>
<li>
Client-side state, outside the DOM itself, is kept to a minimum.
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of these constraints is to confine scripting to where it shines best and where nothing else comes close:
<em>interaction design</em>.  Business logic and presentation logic are the responsibility of the server, where we can pick
whichever languages or tools are appropriate for our business domain.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">The Server</div>
<div class="paragraph">
<p>Keeping business logic and presentation logic both “on the server” does not mean these two “concerns” are mixed or
coupled. They can be modularized on the server. In fact, they <em>should</em> be modularized on the server, along with all the
other concerns of our application.</p>
</div>
<div class="paragraph">
<p>Note also that, especially in web development parlance, the humble “server” is usually a whole fleet of racks, virtual
machines, containers and more. Even a worldwide network of datacenters is reduced to “the server” when discussing
the server-side of a Hypermedia-Driven Application.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>Satisfying these two constraints sometimes requires us to diverge from what is typically considered best practice for
JavaScript. Keep in mind that the cultural wisdom of JavaScript was largely developed in JavaScript-centric SPA applications.</p>
</div>
<div class="paragraph">
<p>The Hypermedia-Driven Application cannot as comfortably fall back on this tradition. This chapter is our contribution to the
development of a new style and best practices for what we are calling Hypermedia-Driven Applications.</p>
</div>
<div class="paragraph">
<p>Unfortunately, simply listing “best practices” is rarely convincing or edifying. To be honest, it’s boring.</p>
</div>
<div class="paragraph">
<p>Instead, we will demonstrate these best practices by implementing client-side features in Contact.app.  To cover different aspects of hypermedia-friendly scripting, we will
implement three different features:</p>
</div>
<div class="ulist">
<ul>
<li>
An overflow menu to hold the <em>Edit</em>, <em>View</em> and <em>Delete</em> actions, to clean up visual clutter in our list of contacts.
</li>
<li>
An improved interface for bulk deletion.
</li>
<li>
A keyboard shortcut for focusing the search box.
</li>
</ul>
</div>
<div class="paragraph">
<p>The important takeaway in the implementation of each of these features is that, while they are implemented entirely on
the client-side using scripting, they <em>don’t exchange information with the server</em> via a non-hypermedia format, such
as JSON, and that they don’t store a significant amount of state outside of the DOM itself.</p>
</div>
</section>
<section class="sect2">
<h3 id="_scripting_tools_for_the_web">Scripting Tools for the Web</h3>
<div class="paragraph">
<p>The primary scripting language for the web is, of course, JavaScript, which is ubiquitous in web development today.</p>
</div>
<div class="paragraph">
<p>A bit of interesting internet lore, however, is that JavaScript was not always the only built-in option.
As the quote from Roy Fielding at the start of this chapter hints, “applets” written in other languages such as Java were considered to be
part of the scripting infrastructure of the web. In addition, there was a time period when Internet Explorer supported VBScript,
a scripting language based on Visual Basic.</p>
</div>
<div class="paragraph">
<p>Today, we have a variety of <em>transcompilers</em> (often shortened to <em>transpilers</em>) that convert many languages to JavaScript,
such as TypeScript, Dart, Kotlin, ClojureScript, F# and more. There is also the WebAssembly (WASM) bytecode format, which
is supported as a compilation target for C, Rust, and the WASM-first language AssemblyScript.</p>
</div>
<div class="paragraph">
<p>However, most of these options are not geared towards a hypermedia-friendly style of scripting. Compile-to-JS languages
are often paired with SPA-oriented libraries (Dart and AngularDart, ClojureScript and Reagent, F# and Elm), and WASM is
currently mainly geared toward linking to C/C++ libraries from JavaScript.</p>
</div>
<div class="paragraph">
<p>We will instead focus on three client-side scripting technologies that <em>are</em> hypermedia-friendly:</p>
</div>
<div class="ulist">
<ul>
<li>
VanillaJS, that is, using JavaScript without depending on any framework.
</li>
<li>
Alpine.js, a JavaScript library for adding behavior directly in HTML.
</li>
<li>
_hyperscript, a non-JavaScript scripting language created alongside htmx. Like AlpineJS, _hyperscript is usually embedded in HTML.
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s take a quick look at each of these scripting options, so we know what we are dealing with.</p>
</div>
<div class="paragraph">
<p>Note that, as with CSS, we are going to show you just enough of each of these options to give  a flavor of how they work and, we hope, spark your interest in looking into any of them more extensively.</p>
</div>
</section>
<section class="sect2">
<h3 id="_vanilla_javascript">Vanilla JavaScript</h3>
<div class="paragraph">
<p></p>
</div>
<div class="quoteblock">
<blockquote>
No code is faster than no code.
</blockquote>
<div class="attribution margin-inline-start">
— Merb
</div>
</div>
<div class="paragraph">
<p>Vanilla JavaScript is simply using plain JavaScript in your application, without any intermediate layers.
The term “Vanilla” entered frontend web dev parlance as it became assumed that any sufficiently “advanced” web app would
use some library with a name ending in “.js”. As JavaScript matured as a scripting language, however, standardized across browsers and
provided more and more functionality, these frameworks and libraries became less important.</p>
</div>
<div class="paragraph">
<p>Somewhat ironically though, as JavaScript became more powerful and removed the need for the first generation of
JavaScript libraries such as jQuery, it also enabled people to build complex SPA libraries.  These SPA libraries are often
even more elaborate than the original first generation of JavaScript libraries.</p>
</div>
<div class="paragraph">
<p>A quote from the website <a href="http://vanilla-js.com" class="bare">http://vanilla-js.com</a>, which is well worth visiting even though it’s slightly out of date,
captures the situation well:</p>
</div>
<div class="quoteblock">
<blockquote>
VanillaJS is the lowest-overhead, most comprehensive framework I’ve ever used.
</blockquote>
<div class="attribution margin-inline-start">
— http://vanilla-js.com
</div>
</div>
<div class="paragraph">
<p>With JavaScript having matured as a scripting language, this is certainly the case for many applications. It is
especially true in the case of HDAs, since, by using hypermedia, your application will not need many of the features
typically provided by more elaborate Single Page Application JavaScript frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
Client-side routing
</li>
<li>
An abstraction over DOM manipulation  (i.e., templates that automatically update when referenced variables change)
</li>
<li>
Server side rendering <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="hypermedia-systems#_footnotedef_2" title="View footnote.">2</a>]</sup>
</li>
<li>
Attaching dynamic behavior to server-rendered tags on load (i.e., “hydration”)
</li>
<li>
Network requests
</li>
</ul>
</div>
<div class="paragraph">
<p>Without all this complexity being handled in JavaScript, your framework needs are dramatically reduced.</p>
</div>
<div class="paragraph">
<p>One of the best things about VanillaJS is how you install it: you don’t have to!</p>
</div>
<div class="paragraph">
<p>You can just start writing JavaScript in your web application, and it will simply work.</p>
</div>
<div class="paragraph">
<p>That’s the good news. The bad news is that, despite improvements over the last decade, JavaScript has some significant
limitations as a scripting language that can make it less than ideal as a stand-alone scripting technology for
Hypermedia-Driven Applications:</p>
</div>
<div class="ulist">
<ul>
<li>
Being as established as it is, it has accreted a lot of features and warts.
</li>
<li>
It has a complicated and confusing set of features for working with asynchronous code.
</li>
<li>
Working with events is surprisingly difficult.
</li>
<li>
DOM APIs (a large portion of which were originally designed for Java, yes <em>Java</em>)
are verbose and don’t have a habit of making common functionality easy to use.
</li>
</ul>
</div>
<div class="paragraph">
<p>None of these limitations are deal-breakers, of course. Many of them are gradually being fixed and many people prefer
the “close to the metal” (for lack of a better term) nature of vanilla JavaScript over more elaborate client-side scripting approaches.</p>
</div>
<section class="sect3">
<h4 id="_a_simple_counter">A Simple Counter</h4>
<div class="paragraph">
<p>To dive into vanilla JavaScript as a front end scripting option, let’s create a simple counter widget.</p>
</div>
<div class="paragraph">
<p>Counter widgets are a common “Hello World” example for JavaScript frameworks, so looking at how it can be done in
vanilla JavaScript (as well as the other options we are going to look at) will be instructive.</p>
</div>
<div class="paragraph">
<p>Our counter widget will be very simple: it will have a number, shown as text, and a button that increments the number.</p>
</div>
<div class="paragraph">
<p>One problem with tackling this problem in vanilla JavaScript is that it lacks one thing that most JavaScript frameworks
provide: a default code and architectural style.</p>
</div>
<div class="paragraph">
<p>With vanilla JavaScript, there are no rules!</p>
</div>
<div class="paragraph">
<p>This isn’t all bad. It presents a great opportunity to take a small journey through various styles that people have
developed for writing their JavaScript.</p>
</div>
<section class="sect4">
<h5 id="_an_inline_implementation">An inline implementation</h5>
<div class="paragraph">
<p>To begin, let’s start with the simplest thing imaginable: all of our JavaScript will be written inline, directly in the
HTML.  When the button is clicked, we will look up the <code>output</code> element holding the number, and increment the number
contained within it.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Counter in vanilla JavaScript, inline version</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-output<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
    <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span> (2)
      document.querySelector(<span class="token punctuation">'</span>#my-output<span class="token punctuation">'</span>) (3)
        .textContent++ (4)
    <span class="token punctuation">"</span></span></span>
  <span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Our output element has an ID to help us find it.
</li>
<li>
We use the <code>onclick</code> attribute to add an event listener.
</li>
<li>
Find the output via a querySelector() call.
</li>
<li>
JavaScript allows us use the <code>++</code> operator on strings.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Not too bad.</p>
</div>
<div class="paragraph">
<p>It’s not the most beautiful code, and can be irritating especially if you aren’t used to the DOM APIs.</p>
</div>
<div class="paragraph">
<p>It’s a little annoying that we needed to add an <code>id</code> to the <code>output</code> element. The <code>document.querySelector()</code> function
is a bit verbose compared with, say, the <code>$</code> function, as provided by jQuery.</p>
</div>
<div class="paragraph">
<p>But it works. It’s also easy enough to understand, and crucially it doesn’t require any other JavaScript libraries.</p>
</div>
<div class="paragraph">
<p>So that’s the simple, inline approach with VanillaJS.</p>
</div>
</section>
<section class="sect4">
<h5 id="_separating_our_scripting_out">Separating our scripting out</h5>
<div class="paragraph">
<p>While the inline implementation is simple in some sense, a more standard way to write this would be to move the code
into a separate JavaScript file. This JavaScript file would then either be linked to via a <code>&lt;script src&gt;</code> tag or
placed into an inline <code>&lt;script&gt;</code> tag by a build process.</p>
</div>
<div class="paragraph">
<p>Here we see the HTML and JavaScript <em>separated out</em> from one another, in different files. The HTML is now “cleaner” in
that there is no JavaScript in it.</p>
</div>
<div class="paragraph">
<p>The JavaScript is a bit more complex than in our inline version: we need to look up the button using a query selector
and add an <em>event listener</em> to handle the click event and increment the counter.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Counter HTML</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-output<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increment-btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<figure class="listingblock">
<figcaption class="title">Counter JavaScript</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">const</span> counterOutput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#my-output"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> incrementBtn  <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".counter .increment-btn"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

incrementBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  counterOutput<span class="token punctuation">.</span>innerHTML<span class="token operator">++</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Find the output element.
</li>
<li>
Find the button.
</li>
<li>
We use <code>addEventListener</code>, which is preferable to <code>onclick</code> for many reasons.
</li>
<li>
The logic stays the same, only the structure around it changes.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
In moving the JavaScript out to another file, we are following a software design principle known as <em>Separation of Concerns (SoC).</em></p>
</div>
<div class="paragraph">
<p>Separation of Concerns posits that the various “concerns” (or aspects) of a software project should be divided up into
multiple files, so that they don’t “pollute” one another. JavaScript isn’t markup, so it shouldn’t be in your HTML,
it should be <em>elsewhere</em>.  Styling information, similarly, isn’t markup, and so it belongs in a separate file as well
(A CSS file, for example.)</p>
</div>
<div class="paragraph">
<p>For quite some time, this Separation of Concerns was considered the “orthodox” way to build web applications.</p>
</div>
<div class="paragraph">
<p>A stated goal of Separation of Concerns is that we should be able to modify and evolve each concern independently, with
confidence that we won’t break any of the other concerns.</p>
</div>
<div class="paragraph">
<p>However, let’s look at exactly how this principle has worked out in our simple counter example.  If you look closely
at the new HTML, it turns out that we’ve had to add a class to the button.  We added this class so that we could look the button
up in JavaScript and add in an event handler for the “click” event.</p>
</div>
<div class="paragraph">
<p>Now, in both the HTML and the JavaScript, this class name is just a string and there isn’t any process to <em>verify</em> that
the button has the right classes on it or its parents to ensure that the event handler is actually added to the right element.</p>
</div>
<div class="paragraph">
<p>
Unfortunately, it has turned out that the careless use of CSS selectors in JavaScript can cause what is known as
<em>jQuery soup</em>.  jQuery soup is a situation where:</p>
</div>
<div class="ulist">
<ul>
<li>
The JavaScript that attaches a given behavior to a given element is difficult to find.
</li>
<li>
Code reuse is difficult.
</li>
<li>
The code ends up wildly disorganized and “flat”, with lots of unrelated event handlers mixed together.
</li>
</ul>
</div>
<div class="paragraph">
<p>The name “jQuery soup” comes from the fact that most JavaScript-heavy applications used to be built in jQuery (many still are),
which, perhaps inadvertently, tended to encourage this style of JavaScript.</p>
</div>
<div class="paragraph">
<p>So, you can see that the notion of Separation of Concerns doesn’t always work as well as promised: our concerns
end up intertwined or coupled pretty deeply, even when we separate them into different files.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/separation-of-concerns.svg" alt="Expectation: HTML concern, CSS concern, JS concern. Reality: HTML Co co co CSS nc nc nc JS ern ern ern" loading="lazy">
</div>
</figure>
<div class="paragraph">
<p>To show that it isn’t just naming between concerns that can get you into trouble, consider another small change to our HTML
that demonstrates the problems with our separation of concerns: imagine that we decide to change the number field from
an <code>&lt;output&gt;</code> tag to an <code>&lt;input type="number"&gt;</code>.</p>
</div>
<div class="paragraph">
<p>This small change to our HTML will break our JavaScript, despite the fact we have “separated” our concerns.</p>
</div>
<div class="paragraph">
<p>The fix for this issue is simple enough (we would need to change the <code>.textContent</code> property to <code>.value</code> property), but
it demonstrates the burden of synchronizing markup changes and code changes across multiple files.  Keeping everything
in sync can become increasingly difficult as your application size increases.</p>
</div>
<div class="paragraph">
<p>The fact that small changes to our HTML can break our scripting indicates that the two are <em>tightly coupled</em>, despite being
broken up into multiple files.  This tight coupling suggests that separation between HTML and JavaScript (and CSS) is often
an illusory separation of concerns: the concerns are sufficiently related to one another that they aren’t easily separated.</p>
</div>
<div class="paragraph">
<p>In Contact.app we are not <em>concerned</em> with “structure,” “styling” or “behavior”; we are concerned with collecting contact
info and presenting it to users. SoC, in the way it’s formulated in web development orthodoxy, is not really an inviolate
architectural guideline, but rather a stylistic choice that, as we can see, can even become a hindrance.</p>
</div>
</section>
<section class="sect4">
<h5 id="_locality_of_behavior">Locality of Behavior</h5>
<div class="paragraph">
<p>
It turns out that there is a burgeoning reaction <em>against</em> the Separation of Concerns design principle.  Consider the
following web technologies and techniques:</p>
</div>
<div class="ulist">
<ul>
<li>
JSX
</li>
<li>
LitHTML
</li>
<li>
CSS-in-JS
</li>
<li>
Single-File Components
</li>
<li>
Filesystem based routing
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these technologies <em>colocate</em> code in various languages that address a single <em>feature</em> (typically a UI widget).</p>
</div>
<div class="paragraph">
<p>All of them mix <em>implementation</em> concerns together in order to present a unified abstraction to the end-user.  Separating
technical detail concerns just isn’t as much of an, ahem, concern.</p>
</div>
<div class="paragraph">
<p>Locality of Behavior (LoB) is an alternative software design principle that we coined, in opposition to Separation of Concerns.
It describes the following characteristic of a piece of software:</p>
</div>
<div class="quoteblock">
<blockquote>
The behavior of a unit of code should be as obvious as possible by looking only at that unit of code.
</blockquote>
<div class="attribution margin-inline-start">
— https://htmx.org/essays/locality-of-behaviour/
</div>
</div>
<div class="paragraph">
<p>In simple terms: you should be able to tell what a button does by simply looking at the code or markup that creates that button.
This does not mean you need to inline the entire implementation, but that you shouldn’t need to hunt for it or require prior knowledge of the codebase to find it.</p>
</div>
<div class="paragraph">
<p>We will demonstrate Locality of Behavior in all of our examples, both the counter demos and the features we add to Contact.app.
Locality of behavior is an explicit design goal of both _hyperscript and Alpine.js (which we will cover later) as well as htmx.</p>
</div>
<div class="paragraph">
<p>All of these tools achieve Locality of Behavior by having you embed attributes directly within your HTML, as opposed to
having code look up elements in a document through CSS selectors in order to add event listeners onto them.</p>
</div>
<div class="paragraph">
<p>In a Hypermedia-Driven Application, we feel that the Locality of Behavior design principle is often more important than
the more traditional Separation of Concerns design principle.</p>
</div>
</section>
<section class="sect4">
<h5 id="_what_to_do_with_our_counter">What to do with our counter?</h5>
<div class="paragraph">
<p>
So, should we go back to the <code>onclick</code> attribute way of doing things? That approach certainly wins in Locality of
Behavior, and has the additional benefit that it is baked into HTML.</p>
</div>
<div class="paragraph">
<p>Unfortunately, however, the <code>on*</code> JavaScript attributes also come with some drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
They don’t support custom events.
</li>
<li>
There is no good mechanism for associating long-lasting variables with an element — all variables are discarded when an event listener completes executing.
</li>
<li>
If you have multiple instances of an element, you will need to repeat the listener code on each, or use something more clever like event delegation.
</li>
<li>
JavaScript code that directly manipulates the DOM gets verbose, and clutters the markup.
</li>
<li>
An element cannot listen for events on another element.
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider this common situation: you have a popup, and you want it to be dismissed when a user clicks outside of it.  The
listener will need to be on the body element in this situation, far away from the actual popup markup. This means that
the body element would need to have listeners attached to it that deal with many unrelated components.  Some of these
components may not even be on the page when it was first rendered, if they are added dynamically after the initial
HTML page is rendered.</p>
</div>
<div class="paragraph">
<p>So vanilla JavaScript and Locality of Behavior don’t seem to mesh <em>quite</em> as well as we would like them to.</p>
</div>
<div class="paragraph">
<p>The situation is not hopeless, however: it’s important to understand that LoB does not require behavior to be <em>implemented</em>
at a use site, but merely <em>invoked</em> there.  That is, we don’t need to write all our code on a given element, we just
need to make it clear that a given element is <em>invoking</em> some code, which can be located elsewhere.</p>
</div>
<div class="paragraph">
<p>Keeping this in mind, it <em>is</em> possible to improve LoB while writing JavaScript in a separate file, provided we have a
reasonable system for structuring our JavaScript.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_rsjs">RSJS</h4>
<div class="paragraph">
<p>
RSJS (the “Reasonable System for JavaScript Structure,” <a href="https://ricostacruz.com/rsjs/" class="bare">https://ricostacruz.com/rsjs/</a>) is a set of guidelines for
JavaScript architecture targeted at “a typical non-SPA website.” RSJS provides a solution to the lack of a standard code
style for vanilla JavaScript that we mentioned earlier.</p>
</div>
<div class="paragraph">
<p>Here are the RSJS guidelines most relevant for our counter widget:</p>
</div>
<div class="ulist">
<ul>
<li>
“Use <code>data-</code> attributes” in HTML:  invoking behavior via adding data attributes makes it obvious there is JavaScript happening, as opposed to using random classes or IDs that may be mistakenly removed or changed.
</li>
<li>
“One component per file”: the name of the file should match the data attribute so that it can be found easily, a win for LoB.
</li>
</ul>
</div>
<div class="paragraph">
<p>To follow the RSJS guidelines, let’s restructure our current HTML and JavaScript files.  First, we will use <em>data attributes</em>,
that is, HTML attributes that begin with <code>data-</code>, a standard feature of HTML, to indicate that our HTML is a counter
component.  We will then update our JavaScript to use an attribute selector that looks for the <code>data-counter</code> attribute
as the root element in our counter component and wires in the appropriate event handlers and logic.  Additionally, let’s
rework the code to use <code>querySelectorAll()</code> and add the counter functionality to <em>all</em> counter components found on the
page.  (You never know how many counters you might want!)</p>
</div>
<div class="paragraph">
<p>Here is what our code looks like now:</p>
</div>
<div class="openblock">
<div class="title">Counter in vanilla JavaScript, with RSJS</div>
<div class="content">
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span> <span class="token attr-name">data-counter</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-output<span class="token punctuation">"</span></span> <span class="token attr-name">data-counter-output</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span> (2)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increment-btn<span class="token punctuation">"</span></span> <span class="token attr-name">data-counter-increment</span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Invoke a JavaScript behavior with a data attribute.
</li>
<li>
Mark relevant descendant elements.
</li>
</ol>
</div></figure>

<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token comment">// counter.js (1)</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"[data-counter]"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span>
    output <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[data-counter-output]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    increment <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[data-counter-increment]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    increment<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> output<span class="token punctuation">.</span>textContent<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
File should have the same name as the data attribute, so that we can locate it easily.
</li>
<li>
Get all elements that invoke this behavior.
</li>
<li>
Get any child elements we need.
</li>
<li>
Register event handlers.
</li>
</ol>
</div></figure>

</div>
</div>
<div class="paragraph">
<p>Using RSJS solves, or at least alleviates, many of the problems we pointed out with our first, unstructured example of VanillaJS being
split out to a separate file:</p>
</div>
<div class="ulist">
<ul>
<li>
The JS that attaches behavior to a given element is <em>clear</em> (though only through naming conventions).
</li>
<li>
Reuse is <em>easy</em> — you can create another counter component on the page and it will just work.
</li>
<li>
The code is <em>well-organized</em> — one behavior per file.
</li>
</ul>
</div>
<div class="paragraph">
<p>All in all, RSJS is a good way to structure your vanilla JavaScript in a Hypermedia-Driven Application.  So long as the
JavaScript isn’t communicating with a server via a plain data JSON API, or holding a bunch of internal state outside of
the DOM, this is perfectly compatible with the HDA approach.</p>
</div>
<div class="paragraph">
<p>Let’s implement a feature in Contact.app using the RSJS/vanilla JavaScript approach.</p>
</div>
</section>
<section class="sect3">
<h4 id="_vanillajs_in_action_an_overflow_menu">VanillaJS in Action: An Overflow Menu</h4>
<div class="paragraph">
<p>Our homepage has “Edit”, “View” and “Delete” links for every contact in our table. This uses a lot of space and creates
visual clutter.  Let’s fix that by placing these actions inside a drop-down menu with a button to open it.</p>
</div>
<div class="paragraph">
<p>If you’re less familiar with JavaScript and the code here starts to feel too complicated, don’t worry; the Alpine.js and _hyperscript examples — which we’ll look at next — are easier to follow.</p>
</div>
<div class="paragraph">
<p>Let’s begin by sketching the markup we want for our dropdown menu.  First, we need an element, we’ll use a <code>&lt;div&gt;</code>, to enclose the
entire widget and mark it as a menu component.  Within this div, we will have a standard <code>&lt;button&gt;</code> that will function
as the mechanism that shows and hides our menu items.  Finally, we’ll have another <code>&lt;div&gt;</code> that holds the menu items
that we are going to show.</p>
</div>
<div class="paragraph">
<p>These menu items will be simple anchor tags, as they are in the current contacts table.</p>
</div>
<div class="paragraph">
<p>Here is what our updated, RSJS-structured HTML looks like:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-overflow-menu</span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">aria-haspopup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span>
        <span class="token attr-name">aria-controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-menu-{{ contact.id }}<span class="token punctuation">"</span></span>
        <span class="token punctuation">&gt;</span></span>Options<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span> <span class="token attr-name">hidden</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-menu-{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuitem<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (4)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuitem<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>View<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ... --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Mark the root element of the menu component
</li>
<li>
This button will open and close our menu
</li>
<li>
A container for our menu items
</li>
<li>
Menu items
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The roles and ARIA attributes are based on the Menu and Menu Button patterns from the ARIA Authoring Practices Guide.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">What is ARIA?</div>
<div class="paragraph">
<p>
As we web developers create more interactive, app-like websites, HTML’s repertoire of elements won’t have all we need.
As we have seen, using CSS and JavaScript, we can endow existing elements with extended behavior and appearances, rivaling
those of native controls.</p>
</div>
<div class="paragraph">
<p>However, there was one thing web apps couldn’t replicate. While these widgets may <em>look</em> similar enough to the real deal, assistive technology (e.g., screen readers) could only deal with the underlying HTML elements.</p>
</div>
<div class="paragraph">
<p>Even if you take the time to get all the keyboard interactions right, some users often are unable to work with these custom
elements easily.</p>
</div>
<div class="paragraph">
<p>ARIA was created by W3C’s Web Accessibility Initiative (WAI) in 2008 to address this problem.  At a surface level, it is
a set of attributes you can add to HTML to make it meaningful to assistive software such as a screen reader.</p>
</div>
<div class="paragraph">
<p>ARIA has two main components that interact with one another:</p>
</div>
<div class="paragraph">
<p>The first is the <code>role</code> attribute. This attribute has a predefined set of possible values:
<code>menu, dialog, radiogroup</code> etc.
The <code>role</code> attribute <em>does not add any behavior</em> to HTML elements.
Rather, it is a promise you make to the user.  When
you annotate an element as <code>role='menu'</code>, you are saying: <em>I will make this element work like a menu.</em></p>
</div>
<div class="paragraph">
<p>If you add a <code>role</code> to an element but you <em>don’t</em> uphold the promise,
the experience for many users will be <em>worse</em> than if the element had no <code>role</code> at all.
Thus, it is written:</p>
</div>
<div class="quoteblock">
<blockquote>
No ARIA is better than Bad ARIA.
</blockquote>
<div class="attribution margin-inline-start">
— W3C, 
<cite>Read Me First | APG https://www.w3.org/WAI/ARIA/apg/practices/read-me-first/</cite>
</div>
</div>
<div class="paragraph">
<p>The second component of ARIA is the <em>states and properties</em>, all sharing the <code>aria-</code> prefix:
<code>aria-expanded, aria-controls, aria-label</code> etc.
These attributes can specify various things such as the state of a widget, the relationships between components, or
additional semantics.
Once again, these attributes are <em>promises</em>, not implementations.</p>
</div>
<div class="paragraph">
<p>Rather than learn all the roles and attributes and try to combine them into a usable widget,
the best course of action for most developers is to rely on the ARIA Authoring Practices Guide (APG),
a web resource with practical information aimed directly at web developers.</p>
</div>
<div class="paragraph">
<p>If you’re new to ARIA, check out the following W3C resources:</p>
</div>
<div class="ulist">
<ul>
<li>
ARIA: Read Me First: <a href="https://www.w3.org/WAI/ARIA/apg/practices/read-me-first/" class="bare">https://www.w3.org/WAI/ARIA/apg/practices/read-me-first/</a>
</li>
<li>
ARIA UI patterns: <a href="https://www.w3.org/WAI/ARIA/apg/patterns/" class="bare">https://www.w3.org/WAI/ARIA/apg/patterns/</a>
</li>
<li>
ARIA Good Practices: <a href="https://www.w3.org/WAI/ARIA/apg/practices/" class="bare">https://www.w3.org/WAI/ARIA/apg/practices/</a>
</li>
</ul>
</div>
<div class="paragraph">
<p>Always remember to <strong>test</strong> your website for accessibility to ensure all users can interact with it easily and effectively.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>With this brief introduction to ARIA, let’s return to our VanillaJS drop down menu.  We’ll begin with the RSJS
boilerplate: query for all elements with some data attribute, iterate over them, get any relevant descendants.</p>
</div>
<div class="paragraph">
<p>Note that, below, we’ve modified the RSJS boilerplate a bit to integrate with htmx; we load the
overflow menu when htmx loads new content.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">function</span> <span class="token function">overflowMenu</span><span class="token punctuation">(</span><span class="token parameter">subtree <span class="token operator">=</span> document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  subtree<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"[data-overflow-menu]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">menuRoot</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span>
    button <span class="token operator">=</span> menuRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[aria-haspopup]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    menu <span class="token operator">=</span> menuRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[role=menu]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>menu<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"[role=menuitem]"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"htmx:load"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">overflowMenu</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
With RSJS, you’ll be writing <code>document.querySelectorAll(…​).forEach</code> a lot.
</li>
<li>
To keep the HTML clean, we use ARIA attributes rather than custom data attributes here.
</li>
<li>
Use the spread operator to convert a <code>NodeList</code> into a normal <code>Array</code>.
</li>
<li>
Initialize all overflow menus when the page is loaded or content is inserted by htmx.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Conventionally, we would keep track of whether the menu is open using a JavaScript variable or a property in a JavaScript
state object.  This approach is common in large, JavaScript-heavy web applications.</p>
</div>
<div class="paragraph">
<p>However, this approach has some drawback:</p>
</div>
<div class="ulist">
<ul>
<li>
We would need to keep the DOM in sync with the state (harder without a framework).
</li>
<li>
We would lose the ability to serialize the HTML (as this open state isn’t stored in the DOM, but rather in JavaScript).
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead of taking this approach, we will use the DOM to store our state.  We’ll lean on the <code>hidden</code> attribute on the
menu element to tell us it’s closed. If the HTML of the page is snapshotted and restored, the menu can be restored as
well by simply re-running the JS.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">  items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>menu<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"[role=menuitem]"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">isOpen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>menu<span class="token punctuation">.</span>hidden<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>hidden</code> attribute is helpfully reflected as a <code>hidden</code> <em>property</em>, so we don’t need to use <code>getAttribute</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’ll also make the menu items non-tabbable, so we can manage their focus ourselves.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">  <span class="token keyword">const</span> <span class="token function-variable function">isOpen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>menu<span class="token punctuation">.</span>hidden<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

  items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"tabindex"</span><span class="token punctuation">,</span> <span class="token string">"-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Now let’s implement toggling the menu in JavaScript:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">  items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"tabindex"</span><span class="token punctuation">,</span> <span class="token string">"-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token parameter">open <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>open<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      menu<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      button<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"aria-expanded"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      menu<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      button<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"aria-expanded"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  menuRoot<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Optional parameter to specify desired state. This allows us to use one function to open, close, or toggle the menu.
</li>
<li>
Focus first item of menu when opened.
</li>
<li>
Call <code>toggleMenu</code> with current state, to initialize element attributes.
</li>
<li>
Toggle menu when button is clicked.
</li>
<li>
Close menu when focus moves away.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Let’s also make the menu close when we click outside it, a nice behavior that mimics how native drop-down menus work. This
will require an event listener on the whole window.</p>
</div>
<div class="paragraph">
<p>Note that we need to be careful with this kind of listener: you may find that listeners accumulate as components add
listeners and fail to remove them when the component is removed from the DOM.  This, unfortunately, leads to difficult
to track down memory leaks.</p>
</div>
<div class="paragraph">
<p>There is not an easy way in JavaScript to execute logic when an element is removed.  The best option is what is known
as the <code>MutationObserver</code> API.  A <code>MutationObserver</code> is very useful, but the API is quite heavy and a bit arcane, so we
won’t be using it for our example.</p>
</div>
<div class="paragraph">
<p>Instead, we will use a simple pattern to avoid leaking event listeners: when our event listener runs, we will check if the
attaching component is still in the DOM, and, if the element is no longer in the DOM, we will remove the listener and
exit.</p>
</div>
<div class="paragraph">
<p>This is a somewhat hacky, manual form of <em>garbage collection</em>.  As is (usually) the case with other garbage collection
algorithms, our strategy removes listeners in a nondeterministic amount of time after they are no longer needed. Fortunately
for us, With a frequent event like “the user clicks anywhere in the page” driving the collection, it should work well
enough for our system.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">  menuRoot<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"blur"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">clickAway</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>menuRoot<span class="token punctuation">.</span>isConnected<span class="token punctuation">)</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> clickAway<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>menuRoot<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This line is the garbage collection.
</li>
<li>
If the click is outside the menu, close the menu.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, let’s move on to the keyboard interactions for our dropdown menu. The keyboard handlers turn out to all be pretty
similar to one another and not particularly intricate, so let’s knock them all out in one go:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>menuRoot<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">currentIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> idx <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> idx<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  menu<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keydown"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"ArrowUp"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"ArrowDown"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"Space"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"Home"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"End"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      items<span class="token punctuation">[</span>items<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">"Escape"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">toggleMenu</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
      button<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Helper: Get the index in the items array of the currently focused menu item (0 if none).
</li>
<li>
Move focus to the previous menu item when the up arrow key is pressed.
</li>
<li>
Move focus to the next menu item when the down arrow key is pressed.
</li>
<li>
Activate the currently focused element when the space key is pressed.
</li>
<li>
Move focus to the first menu item when Home is pressed.
</li>
<li>
Move focus to the last menu item when End is pressed.
</li>
<li>
Close menu when Escape is pressed.
</li>
<li>
Return focus to menu button when closing menu.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>That should cover all our bases, and we’ll admit that’s a lot of code. But, in fairness, it’s code that encodes a
lot of behavior.</p>
</div>
<div class="paragraph">
<p>Now, our drop-down menu isn’t perfect, and it doesn’t handle a lot of things.  For example, we don’t support submenus,
or menu items being added or removed dynamically to the menu.  If we needed more menu features like this, it might make
more sense to use an off-the-shelf library, such as GitHub’s <a href="https://github.com/github/details-menu-element"><code>details-menu-element</code></a>.</p>
</div>
<div class="paragraph">
<p>But, for our relatively simple use case, vanilla JavaScript does a fine job, and we got to explore ARIA and RSJS while
implementing it.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_alpine_js">Alpine.js</h3>
<div class="paragraph">
<p>
OK, so that’s an in-depth look at how to structure plain VanillaJS-style JavaScript.  Let’s turn our attention to an
actual JavaScript framework that enables a different approach for adding dynamic behavior to your application,
<a href="https://alpinejs.dev">Alpine.js</a>.</p>
</div>
<div class="paragraph">
<p>Alpine is a relatively new JavaScript library that allows developers to embed JavaScript code directly in HTML, akin to
the <code>on*</code> attributes available in plain HTML and JavaScript.  However, Alpine takes this concept of embedded scripting
much further than <code>on*</code> attributes.</p>
</div>
<div class="paragraph">
<p>Alpine bills itself as a modern replacement for jQuery, the widely used, older JavaScript library.  As you will see, it
definitely lives up to this promise.</p>
</div>
<div class="paragraph">
<p>
Installing Alpine is very easy: it is a single file and is dependency-free, so you can simply include it via a CDN:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Installing Alpine</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/alpinejs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>You can also install it via a package manager such as NPM, or vendor it from your own server.</p>
</div>
<div class="paragraph">
<p>
Alpine provides a set of HTML attributes, all of which begin with the <code>x-</code> prefix, the main one of which is <code>x-data</code>.
The content of <code>x-data</code> is a JavaScript expression which evaluates to an object.  The properties of this object can, then,
be accessed within the element that the <code>x-data</code> attribute is located.</p>
</div>
<div class="paragraph">
<p>To get a flavor of AlpineJS, let’s look at how to implement our counter example using it.</p>
</div>
<div class="paragraph">
<p>For the counter, the only state we need to keep track of is the current number, so let’s declare a JavaScript object
with one property, <code>count</code>, in an <code>x-data</code> attribute on the div for our counter:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Counter with Alpine, line 1</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span> <span class="token attr-name">x-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ count: 0 }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>
This defines our state, that is, the data we are going to be using to drive dynamic updates to the DOM.  With the state
declared like this, we can now use it <em>within</em> the div element it is declared on.  Let’s add an <code>output</code> element with
an <code>x-text</code> attribute.</p>
</div>
<div class="paragraph">
<p>Next, we will <em>bind</em> the <code>x-text</code> attribute to the <code>count</code> attribute we declared in the <code>x-data</code> attribute
on the parent <code>div</code> element.  This will have the effect of setting the text of the <code>output</code> element to whatever the
value of <code>count</code> is: if <code>count</code> is updated, so will the text of the <code>output</code>.  This is “reactive” programming, in that
the DOM will “react” to changes to the backing data.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Counter with Alpine, lines 1-2</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">x-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ count: 0 }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">x-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>x-text</code> attribute.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Next, we need to update the count, using a button.  Alpine allows you to attach event listeners with the <code>x-on</code> attribute.</p>
</div>
<div class="paragraph">
<p>To specify the event to listen for, you add a colon and then the event name after the <code>x-on</code> attribute name.  Then, the
value of the attribute is the JavaScript you wish to execute.  This is similar to the plain <code>on*</code> attributes we discussed
earlier, but it turns out to be much more flexible.</p>
</div>
<div class="paragraph">
<p>We want to listen for a <code>click</code> event, and we want to increment <code>count</code> when a click occurs, so here is what the Alpine
code will look like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Counter with Alpine, the full thing</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">x-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ count: 0 }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">x-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">x-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count++<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
With <code>x-on</code>, we specify the attribute in the attribute <em>name</em>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And that’s all it takes.  A simple component like a counter should be simple to code, and Alpine delivers.</p>
</div>
<section class="sect3">
<h4 id="_x_onclick_vs_onclick">“x-on:click” vs. “onclick”</h4>
<div class="paragraph">
<p>
As we said, the Alpine <code>x-on:click</code> attribute (or its shorthand, the <code>@click</code> attribute) is similar to the built-in
<code>onclick</code> attribute.   However, it has additional features that make it significantly more useful:</p>
</div>
<div class="ulist">
<ul>
<li>
You can listen for events from other elements. For example, the <code>.outside</code> modifier lets you listen to any click event that is <em>not</em> within the element.
</li>
<li>
<p>You can use other modifiers to:</p>
<div class="ulist">
<ul>
<li>
throttle or debounce event listeners
</li>
<li>
ignore events that are bubbled up from descendant elements
</li>
<li>
attach passive listeners
</li>
</ul>
</div>
</li>
<li>
You can listen to custom events.  For example, if you wanted to listen for the <code>htmx:after-request</code> event you could write
<code>x-on:htmx:after-request="doSomething()"</code>.
</li>
</ul>
</div>
</section>
<section class="sect3">
<h4 id="_reactivity_and_templating">Reactivity and Templating</h4>
<div class="paragraph">
<p>We hope you’ll agree that the AlpineJS version of the counter widget is better, in general, than the VanillaJS
implementation, which was either somewhat hacky or spread out over multiple files.</p>
</div>
<div class="paragraph">
<p>A big part of the power of AlpineJS is that it supports a notion of “reactive” variables, allowing you to bind the count
of the <code>div</code> element to a variable that both the <code>output</code> and the <code>button</code> can reference, and properly updating all the
dependencies when a mutation occurs.  Alpine allows for much more elaborate data bindings than we have demonstrated
here, and it is an excellent general purpose client-side scripting library.</p>
</div>
</section>
<section class="sect3">
<h4 id="_alpine_js_in_action_a_bulk_action_toolbar">Alpine.js in Action: A Bulk Action Toolbar</h4>
<div class="paragraph">
<p>Let’s implement a feature in Contact.app with Alpine. As it stands currently, Contact.app has a “Delete Selected
Contacts” button at the very bottom of the page. This button has a long name, is not easy to find and takes up a
lot of room.  If we wanted to add additional “bulk” actions, this wouldn’t scale well visually.</p>
</div>
<div class="paragraph">
<p>In this section, we’ll replace this single button with a toolbar.  Furthermore, the toolbar will only appear when the
user starts selecting contacts. Finally, it will show how many contacts are selected and let you select all contacts in
one go.</p>
</div>
<div class="paragraph">
<p>The first thing we will need to add is an <code>x-data</code> attribute, to hold the state that we will use to determine if the
toolbar is visible or not.  We will need to place this on a parent element of both the toolbar that we are going to
add, as well as the checkboxes, which will be updating the state when they are checked and unchecked.  The best
option given our current HTML is to place the attribute on the <code>form</code> element that surrounds the contacts table.  We
will declare a property, <code>selected</code>, which will be an array that holds the selected contact ids, based on the checkboxes
that are selected.</p>
</div>
<div class="paragraph">
<p>Here is what our form tag will look like:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">x-data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{ selected: [] }<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This form wraps around the contacts table.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
Next, at the top of the contacts table, we are going to add a <code>template</code> tag.  A template tag is <em>not</em> rendered by a
browser, by default, so you might be surprised that we are using it.  However, by adding an Alpine <code>x-if</code> attribute,
we can tell Alpine: if a condition is true, show the HTML within this template.</p>
</div>
<div class="paragraph">
<p>Recall that we want to show the toolbar if and only if one or more contacts are selected.  But we know that we will
have the ids of the selected contacts in the <code>selected</code> property.  Therefore, we can check the <em>length</em> of that array
to see if there are any selected contacts, quite easily:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">x-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected.length &gt; 0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box info tool-bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">x-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected.length<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    contacts selected

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad bg color border<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token attr-name">aria-orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Show this HTML if there are 1 or more selected contacts.
</li>
<li>
We will implement these buttons in just a moment.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
The next step is to ensure that toggling a checkbox for a given contact adds (or removes) a given contact’s id from the
<code>selected</code> property.  To do this, we will need to use a new Alpine attribute, <code>x-model</code>.  The <code>x-model</code> attribute allows
you to <em>bind</em> a given element to some underlying data, or its “model.”</p>
</div>
<div class="paragraph">
<p>In this case, we want to bind the value of the checkbox inputs to the <code>selected</code> property.  This is how we do this:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected_contact_ids<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">x-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The <code>x-model</code> attribute binds the <code>value</code> of this input to the <code>selected</code> property
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, when a checkbox is checked or unchecked, the <code>selected</code> array will be updated with the given row’s contact id.
Furthermore, mutations we make to the <code>selected</code> array will similarly be reflected in the checkboxes' state.  This is
known as a <em>two-way</em> binding.</p>
</div>
<div class="paragraph">
<p>With this code written, we can make the toolbar appear and disappear, based on whether contact checkboxes are selected.</p>
</div>
<div class="paragraph">
<p>Very slick.</p>
</div>
<div class="paragraph">
<p>Before we move on, you may have noticed our code here includes some “class=” references. These are for css styling, and are not part of Alpine.js. We’ve included them only as a reminder that the menu bar we’re building will require css to work well. The classes in the code above refer to a minimal css library called Missing.css. If you use other css libraries, such as Bootstrap, Tailwind, Bulma, Pico.css, etc., your styling code will be different.</p>
</div>
<section class="sect4">
<h5 id="_implementing_actions">Implementing actions</h5>
<div class="paragraph">
<p>Now that we have the mechanics of showing and hiding the toolbar, let’s look at how to implement the buttons within
the toolbar.</p>
</div>
<div class="paragraph">
<p>Let’s first implement the “Clear” button, because it is quite easy.  All we need to do is, when the button is clicked,
clear out the <code>selected</code> array.  Because of the two-way binding that Alpine provides, this will uncheck all the selected
contacts (and then hide the toolbar)!</p>
</div>
<div class="paragraph">
<p>For the <em>Cancel</em> button, our job is simple:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selected = []<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>(1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Reset the <code>selected</code> array.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Once again, AlpineJS makes this very easy.</p>
</div>
<div class="paragraph">
<p>The “Delete” button, however, will be a bit more complicated.  It will need to do two things: first it will confirm
if the user indeed intends to delete the contacts selected. Then, if the user confirms the action, it will use the htmx JavaScript API to issue a <code>DELETE</code> request.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad bg color border<span class="token punctuation">"</span></span>
  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>confirm(`Delete ${selected.length} contacts?`) &amp;&amp; (1)
    htmx.ajax('DELETE', '/contacts', { source: $root, target: document.body })<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
<span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Confirm the user wishes to delete the selected number of contacts.
</li>
<li>
Issue a <code>DELETE</code> using the htmx JavaScript API.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that we are using the short-circuiting behavior of the <code>&amp;&amp;</code> operator in JavaScript to avoid the call to
<code>htmx.ajax()</code> if the <code>confirm()</code> call returns false.</p>
</div>
<div class="paragraph">
<p>
The <code>htmx.ajax()</code> function is just a way to access the normal, HTML-driven hypermedia exchange that htmx’s
HTML attributes give you directly from JavaScript.</p>
</div>
<div class="paragraph">
<p>Looking at how we call <code>htmx.ajax</code>, we first pass in that we want to issue a <code>DELETE</code> to <code>/contacts</code>.  We then pass in
two additional pieces of information: <code>source</code> and <code>target</code>. The <code>source</code> property is the element from which htmx will
collect data to include in the request. We set this to <code>$root</code>, which is a special symbol in Alpine that will be
the element that has the <code>x-data</code> attribute declared on it.  In this case, it will be the form containing all of our
contacts. The <code>target</code>, or where the response HTML will be placed, is just the entire document’s body, since the
<code>DELETE</code> handler returns a whole page when it completes.</p>
</div>
<div class="paragraph">
<p>Note that we are using Alpine here in a Hypermedia-Driven Application compatible manner.  We <em>could</em> have issued an
AJAX request directly from Alpine and perhaps updated an <code>x-data</code> property depending on the results of that request.
But, instead, we delegated to htmx’s JavaScript API, which made a <em>hypermedia exchange</em> with the server.</p>
</div>
<div class="paragraph">
<p>This is the key to scripting in a hypermedia-friendly manner within a Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>So, with all of this in place, we now have a much improved experience for performing bulk actions on contacts:  less
visual clutter and the toolbar can be extended with more options without creating bloat in the main interface of our app.</p>
</div>
</section>
</section>
</section>
<section class="sect2">
<h3 id="_hyperscript">_hyperscript</h3>
<div class="paragraph">
<p>
The final scripting technology we are going to look at is a bit further afield:  <a href="https://hyperscript.org">_hyperscript</a>. The authors of this book initially created _hyperscript as a sibling project to htmx. We felt that JavaScript wasn’t
event-oriented enough, which made adding small scripting enhancements to htmx applications cumbersome.</p>
</div>
<div class="paragraph">
<p>While the previous two examples are JavaScript-oriented, _hyperscript has a completely different syntax than JavaScript, based on an older language called HyperTalk.
HyperTalk was the scripting language for a technology called HyperCard, an old hypermedia system available on early
Macintosh Computers.</p>
</div>
<div class="paragraph">
<p>The most noticeable thing about _hyperscript is that it resembles English prose more than it resembles other programming
languages.</p>
</div>
<div class="paragraph">
<p>Like Alpine,
_hyperscript is a modern jQuery replacement. Also like Alpine, _hyperscript allows you to write your scripting inline, in HTML.</p>
</div>
<div class="paragraph">
<p>Unlike Alpine, however, _hyperscript is <em>not</em> reactive.  It instead focuses on making DOM manipulations in response to events
easy to write and easy to read. It has built-in language constructs for many DOM operations, preventing you from needing
to navigate the sometimes-verbose JavaScript DOM APIs.</p>
</div>
<div class="paragraph">
<p>We will give a small taste of what scripting in the
_hyperscript language is like, so you can pursue the language in more depth later if you find it interesting.</p>
</div>
<div class="paragraph">
<p>
Like htmx and AlpineJS, _hyperscript can be installed via a CDN or from npm (package name <code>hyperscript.org</code>):</p>
</div>
<figure class="listingblock">
<figcaption class="title">Installing _hyperscript via CDN</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//unpkg.com/hyperscript.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>_hyperscript uses the <code>\_</code> (underscore) attribute for putting scripting on DOM elements.  You may also use the <code>script</code>
or <code>data-script</code> attributes, depending on your HTML validation needs.</p>
</div>
<div class="paragraph">
<p>Let’s look at how to implement the simple counter component we have been looking at using _hyperscript.  We will place
 an <code>output</code> element and a <code>button</code> inside of a <code>div</code>.  To implement the counter, we will need to add a small bit of
_hyperscript to the button.  On a click, the button should increment the text of the previous <code>output</code> tag.</p>
</div>
<div class="paragraph">
<p>As you’ll see, that last sentence is close to the actual _hyperscript code:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>counter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>output</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">_</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value hyperscript language-hyperscript"><span class="token keyword"><span class="token hs-start bold">on</span></span> click <span class="token keyword"><span class="token hs-start bold">increment</span></span> <span class="token keyword">the</span> textContent <span class="token keyword">of</span> <span class="token keyword">the</span> previous <span class="token selector">&lt;output/&gt;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The _hyperscript code added inline to the button.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Let’s go through each component of this script:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>on click</code> is an event listener, telling the button to listen for a <code>click</code> event and then executing the remaining code.
</li>
<li>
<code>increment</code> is a “command” in _hyperscript that “increments” things, similar to the <code>++</code> operator in JavaScript.
</li>
<li>
<code>the</code> doesn’t have any semantic meaning in _hyperscript, but can be used to make scripts more readable.
</li>
<li>
<code>textContent of</code> is one form of <em>property access</em> in _hyperscript.  You are probably familiar with the JavaScript syntax <code>a.b</code>, meaning "Get the property <code>b</code> on object <code>a.`" _hyperscript supports this syntax, but <em>also</em> supports
the forms `b of a</code> and <code>a’s b</code>.  Which one you use should depend on which one is most readable.
</li>
<li>
<code>previous</code> is an expression in _hyperscript that finds the previous element in the DOM that matches some condition.
</li>
<li>
<code>&lt;output /&gt;</code> is a <em>query literal</em>, which is a CSS selector wrapped between <code>&lt;</code> and <code>/&gt;</code>.
</li>
</ul>
</div>
<div class="paragraph">
<p>In this code, the <code>previous</code> keyword (and the accompanying <code>next</code> keyword) is an example of how _hyperscript makes DOM operations
easier: there is no such native functionality to be found in the standard DOM API, and implementing this in VanillaJS is trickier
than you might think!</p>
</div>
<div class="paragraph">
<p>So, you can see, _hyperscript is very expressive, particularly when it comes to DOM manipulations.  This makes it
easier to embed scripts directly in HTML: since the scripting language is more powerful, scripts written in it tend
to be shorter and easier to read.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Natural Language Programming?</div>
<div class="paragraph">
<p>Seasoned programmers may be suspicious of _hyperscript: There have been many "natural language programming" (NLP)
projects that target non-programmers and beginner programmers, assuming that being able to read code in their
"natural language" will give them the ability to write it as well.  This has led to some badly written and
structured code and has failed to live up to the (often over the top) hype.</p>
</div>
<div class="paragraph">
<p>_hyperscript is <em>not</em> an NLP programming language.  Yes, its syntax is inspired in many places
by the speech patterns of web developers. But _hyperscript's readability is achieved not through complex
heuristics or fuzzy NLP processing, but rather through judicious use of common parsing tricks, coupled with a culture
of readability.</p>
</div>
<div class="paragraph">
<p>As you can see in the above example, with the use of a <em>query reference</em>, <code>&lt;output/&gt;</code>,  _hyperscript does not shy away
from using DOM-specific, non-natural language when appropriate.</p>
</div>
</div>
</aside>
<section class="sect3">
<h4 id="_hyperscript_in_action_a_keyboard_shortcut">_hyperscript in Action: A Keyboard Shortcut</h4>
<div class="paragraph">
<p>While the counter demo is a good way to compare various approaches to scripting, the rubber meets the road when
you try to actually implement a useful feature with an approach.  For _hyperscript, let’s add a keyboard shortcut
to Contact.app: when a user hits Alt+S in our app, we will focus the search field.</p>
</div>
<div class="paragraph">
<p>Since our keyboard shortcut focuses the search input, let’s put the code for it on that search input, satisfying
locality.</p>
</div>
<div class="paragraph">
<p>Here is the original HTML for the search input:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search Contacts<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>


We will add an event listener using the <code>on keydown</code> syntax, which will fire whenever a keydown occurs.  Further, we
can use an _event filter syntax in _hyperscript using square brackets after the event.  In the square brackets we
can place a <em>filter expression</em> that will filter out <code>keydown</code> events we aren’t interested in.  In our case, we only
want to consider events where the Alt key is held down and where the “S” key is being pressed.  We can create a
boolean expression that inspects the <code>altKey</code> property (to see if it is <code>true</code>) and the <code>code</code> property (to see if
it is <code>"KeyS"</code>) of the event to achieve this.</p>
</div>
<div class="paragraph">
<p>So far our _hyperscript looks like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A start on our keyboard shortcut</figcaption>
<div class="content">
<pre class="highlight language-hyperscript" tabindex="0"><code class="language-hyperscript" data-lang="hyperscript">  <span class="token keyword"><span class="token hs-start bold">on</span></span> keydown<span class="token punctuation">[</span>altKey <span class="token keyword">and</span> code <span class="token keyword">is</span> <span class="token string">'KeyS'</span><span class="token punctuation">]</span> <span class="token operator">..</span><span class="token operator">.</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>
Now, by default, _hyperscript will listen for a given event _on the element where it is declared.  So, with the script we have, we would only get <code>keydown</code> events if the search box is already focused.  That’s not what
we want!  We want to have this key work <em>globally</em>, no matter which element has focus.</p>
</div>
<div class="paragraph">
<p>Not a problem!  We can listen for the <code>keyDown</code> event elsewhere by using a <code>from</code> clause in our event handler.  In this
case we want to listen for the <code>keyDown</code> from the window, and our code ends up looking, naturally, like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Listening globally</figcaption>
<div class="content">
<pre class="highlight language-hyperscript" tabindex="0"><code class="language-hyperscript" data-lang="hyperscript">  <span class="token keyword"><span class="token hs-start bold">on</span></span> keydown<span class="token punctuation">[</span>altKey <span class="token keyword">and</span> code <span class="token keyword">is</span> <span class="token string">'KeyS'</span><span class="token punctuation">]</span> <span class="token keyword">from</span> window <span class="token operator">..</span><span class="token operator">.</span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Using the <code>from</code> clause, we can attach the listener to the window while, at the same time, keeping the code on the
element it logically relates to.</p>
</div>
<div class="paragraph">
<p>Now that we’ve picked out the event we want to use to focus the search box, let’s implement the actual focusing by
calling the standard <code>.focus()</code> method.</p>
</div>
<div class="paragraph">
<p>Here is the entire script, embedded in HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Our final script</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search Contacts<span class="token punctuation">"</span></span>
  <span class="token special-attr"><span class="token attr-name">_</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value hyperscript language-hyperscript"><span class="token keyword"><span class="token hs-start bold">on</span></span> keydown<span class="token punctuation">[</span>altKey <span class="token keyword">and</span> code <span class="token keyword">is</span> <span class="token string">'KeyS'</span><span class="token punctuation">]</span> <span class="token keyword">from</span> <span class="token keyword">the</span> window
       <span class="token builtin">me</span><span class="token operator">.</span>focus<span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span> (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
“me” refers to the element that the script is written on.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Given all the functionality, this is surprisingly terse, and, as an English-like programming language, pretty easy to
read.</p>
</div>
</section>
<section class="sect3">
<h4 id="_why_a_new_programming_language">Why a New Programming Language?</h4>
<div class="paragraph">
<p>This is all well and good, but you may be thinking “An entirely new scripting language?  That seems excessive.”  And,
at some level, you are right: JavaScript is a decent scripting language, is very well optimized and is widely understood
in web development.  On the other hand, by creating an entirely new front end scripting language, we had the freedom
to address some problems that we saw generating ugly and verbose code in JavaScript:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Async transparency</dt>
<dd>
<p>
In _hyperscript, asynchronous functions (i.e., functions that return <code>Promise</code> instances) can be
invoked _as if they were synchronous. Changing a function from sync to async does not break any _hyperscript code that
calls it.  This is achieved by checking for a Promise when evaluating any expression, and suspending the running script
if one exists (only the current event handler is suspended and the main thread is not blocked). JavaScript, instead, requires
either the explicit use of callbacks <em>or</em> the use of explicit <code>async</code> annotations (which can’t be mixed with synchronous
code).</p>
</dd>
<dt class="hdlist1">Array property access</dt>
<dd>
<p>
In _hyperscript, accessing a property on an array (other than <code>length</code> or a number) will return
an array of the values of property on each member of that array, making array property access act like a flat-map operation.
jQuery has a similar feature, but only for its own data structure.</p>
</dd>
<dt class="hdlist1">Native CSS Syntax</dt>
<dd>
<p>
In _hyperscript, you can use things like CSS class and ID literals, or CSS query literals, directly
in the language, rather than needing to call out to a wordy DOM API, as you do in JavaScript.</p>
</dd>
<dt class="hdlist1">Deep Event Support</dt>
<dd>
<p>
Working with events in _hyperscript is far more pleasant than working with them in JavaScript, with
native support for responding to and sending events, as well as for common event-handling patterns such as “debouncing”
or rate limiting events.  _hyperscript also provides declarative mechanisms for synchronizing events within a given element
and across multiple elements.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Again we wish to stress that, in this example, we are not stepping outside the lines of a Hypermedia-Driven
Application: we are only adding frontend, client-side functionality with our scripting.  We are not creating and
managing a large amount of state outside of the DOM itself, or communicating with the server in a non-hypermedia
exchange.</p>
</div>
<div class="paragraph">
<p>Additionally, since _hyperscript embeds so well in HTML, it keeps the focus <em>on the hypermedia</em>, rather than on the
scripting logic.</p>
</div>
<div class="paragraph">
<p>It may not fit all scripting styles or needs, but _hyperscript can provide an
excellent scripting experience for Hypermedia-Driven Applications.  It is a small and obscure programming language worth a look to understand what it is trying to achieve.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_using_off_the_shelf_components">Using Off-the-Shelf Components</h3>
<div class="paragraph">
<p>That concludes our look at three different options for <em>your</em> scripting infrastructure, that is, the code that <em>you</em> write
to enhance your Hypermedia-Driven Application.  However, there is another major area to consider when discussing client
side scripting: “off the shelf” components.  That is, JavaScript libraries that other people have created that offer
some sort of functionality, such as showing modal dialogs.</p>
</div>
<div class="paragraph">
<p>
Components have become very popular in the web development world, with libraries like  <a href="https://datatables.net/">DataTables</a>
providing rich user experiences with very little JavaScript code on the part of a user.  Unfortunately, if these libraries
aren’t integrated well into a website, they can begin to make an application feel “patched together.” Furthermore, some
libraries go beyond simple DOM manipulation, and require that you integrate with a server endpoint, almost invariably
with a JSON data API.  This means you are no longer building a Hypermedia-Driven Application, simply because a particular
widget demands something different.  A shame!</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Web Components/Custom Elements</div>
<div class="paragraph">
<p>Web Components is the collective name of a few standards;
Custom Elements and Shadow DOM, and <code>&lt;template&gt;</code> and <code>&lt;slot&gt;</code>.</p>
</div>
<div class="paragraph">
<p>
All of these standards bring useful capabilities to the table.
<code>&lt;template&gt;</code> elements remove their contents from the document, while still parsing them as HTML (unlike comments) and making them accessible to JavaScript.
Custom Elements let us initialize and tear down behaviors when elements are added or removed, which would previously require manual work or MutationObservers.
Shadow DOM lets us encapsulate elements, leaving the "light" (non-shadow) DOM clean.</p>
</div>
<div class="paragraph">
<p>However, trying to reap these benefits is often frustrating.
Some difficulties are simply growing pains of new standards
(like the accessibility problems of Shadow DOM)
that are actively being worked on.
Others are the result of Web Components trying to be too many things at the same time:</p>
</div>
<div class="ulist">
<ul>
<li>
An extension mechanism for HTML. To this end, each custom element is a tag we add to the language.
</li>
<li>
A lifecycle mechanism for behaviors. Methods like <code>createdCallback</code>, <code>connectedCallback</code>, etc. allow behavior to be added to elements without needing to be manually invoked when those elements are added.
</li>
<li>
A unit of encapsulation. Shadow DOM insulates elements from their surroundings.
</li>
</ul>
</div>
<div class="paragraph">
<p>The result is that if you want any one of these things,
the others come along for the ride.
If you want to attach some behaviors to some elements using lifecycle callbacks,
you need to create a new tag,
which means you can’t have multiple behaviors on one element,
and you isolate elements you add from elements already in the page,
which is a problem if they need to have ARIA relationships.</p>
</div>
<div class="paragraph">
<p>When should we use Web Components?
A good rule of thumb is to ask yourself:
“Could this reasonably be a built-in HTML element?”
For example, a code editor is a good candidate,
since HTML already has <code>&lt;textarea&gt;</code> and <code>contenteditable</code> elements.
In addition, a fully-featured code editor will have many child elements that won’t provide much information anyway.
We can use features like
<a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM">Shadow DOM</a>
to encapsulate these elements<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="hypermedia-systems#_footnotedef_3" title="View footnote.">3</a>]</sup>.
We can create a
<a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements">custom element</a>,
<code>&lt;code-area&gt;</code>, that we can drop into our page whenever we want.</p>
</div>
</div>
</aside>
<section class="sect3">
<h4 id="_integration_options">Integration Options</h4>
<div class="paragraph">
<p>The best JavaScript libraries to work with when you are building a Hypermedia-Driven Application are ones that:</p>
</div>
<div class="ulist">
<ul>
<li>
Mutate the DOM but don’t communicate with a server over JSON
</li>
<li>
Respect HTML norms (e.g., using <code>input</code> elements to store values)
</li>
<li>
Trigger many custom events as the library updates things
</li>
</ul>
</div>
<div class="paragraph">
<p>The last point, triggering many custom events (over the alternative of using lots of methods and callbacks) is especially
important, as these custom events can be dispatched or listened to without additional glue code written in a scripting language.</p>
</div>
<div class="paragraph">
<p>Let’s take a look at two different approaches to scripting, one using JavaScript call backs, and one using events.</p>
</div>
<div class="paragraph">
<p>
To make things concrete, let’s implement a better confirmation dialog for the <code>DELETE</code> button we created in Alpine in the
previous section.  In the original example we used the <code>confirm()</code> function built in to JavaScript, which shows a
pretty bare-bones system confirmation dialog.  We will replace this function with a popular JavaScript library,
SweetAlert2, that shows a much nicer looking confirmation dialog.  Unlike the <code>confirm()</code> function, which blocks
and returns a boolean (<code>true</code> if the user confirmed, <code>false</code> otherwise), SweetAlert2 returns a <code>Promise</code> object, which
is a JavaScript mechanism for hooking in a callback once an asynchronous action (such as waiting for a user to confirm
or deny an action) completes.</p>
</div>
<section class="sect4">
<h5 id="_integrating_using_callbacks">Integrating using callbacks</h5>
<div class="paragraph">
<p>With SweetAlert2 installed as a library, you have access to the <code>Swal</code> object, which has a <code>fire()</code> function on it to
trigger showing an alert.  You can pass in arguments to the <code>fire()</code> method to configure exactly what the buttons
on the confirmation dialog look like, what the title of the dialog is, and so forth.  We won’t get into these details
too much, but you will see what a dialog looks like in a bit.</p>
</div>
<div class="paragraph">
<p>So, given we have installed the SweetAlert2 library, we can swap it in place of the <code>confirm()</code> function call.  We then
need to restructure the code to pass a <em>callback</em> to the <code>then()</code> method on the <code>Promise</code> that <code>Swal.fire()</code> returns.  A
deep dive into Promises is beyond the scope of this chapter, but suffice to say that this callback will be called when
a user confirms or denies the action.  If the user confirmed the action, then the <code>result.isConfirmed</code> property will be
<code>true</code>.</p>
</div>
<div class="paragraph">
<p>Given all that, our updated code will look like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A callback-based confirmation dialog</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad bg color border<span class="token punctuation">"</span></span>
  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Swal.fire({  (1)
                  title: 'Delete these contacts?',  (2)
                  showCancelButton: true,
                  confirmButtonText: 'Delete'
                }).then((result) =&gt; { (3)
                  if (result.isConfirmed) {
                    htmx.ajax('DELETE', '/contacts', { source: $root, target: document.body })
                  }
               });<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Invoke the <code>Swal.fire()</code> function
</li>
<li>
Configure the dialog
</li>
<li>
Handle the result of the user’s selection
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And now, when this button is clicked, we get a nice looking dialog in our web application:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_sweet_alert.png" alt="Modal dialog: &quot;Delete these contacts?&quot; with a colorful delete button and gray cancel button." loading="lazy">
</div>
</figure>
<div class="paragraph">
<p>Much nicer than the system confirmation dialog.  Still, this feels a little wrong.  This is a lot of code to write
just to trigger a slightly nicer <code>confirm()</code>, isn’t it?  And the htmx JavaScript code we are using here feels
awkward.  It would be more natural to move the htmx out to attributes on the button, as we have been doing, and then
trigger the request via events.</p>
</div>
<div class="paragraph">
<p>So let’s take a different approach and see how that looks.</p>
</div>
</section>
<section class="sect4">
<h5 id="_integrating_using_events">Integrating using events</h5>
<div class="paragraph">
<p>
To clean this code up, we will pull the <code>Swal.fire()</code> code out to a custom JavaScript function we will create called
<code>sweetConfirm()</code>.  <code>sweetConfirm()</code> will take the dialog options that are passed into the <code>fire()</code> method, as well as
the element that is confirming an action.  The big difference here is
that the new <code>sweetConfirm()</code> function, rather than calling some htmx directly, will instead trigger a <code>confirmed</code> event on the
button when the user confirms they wish to delete.</p>
</div>
<div class="paragraph">
<p>Here is what our JavaScript function looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">An event-based confirmation dialog</figcaption>
<div class="content">
<pre class="highlight language-javascript" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="token keyword">function</span> <span class="token function">sweetConfirm</span><span class="token punctuation">(</span><span class="token parameter">elt<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Swal<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>isConfirmed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      elt<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'confirmed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Pass the config through to the <code>fire()</code> function.
</li>
<li>
If the user confirmed the action, trigger a <code>confirmed</code> event.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With this method available, we can now tighten up our delete button quite a bit.  We can remove all the SweetAlert2
code that we had in the <code>@click</code> Alpine attribute, and simply call this new <code>sweetConfirm()</code> method, passing in the
arguments <code>$el</code>, which is the Alpine syntax for getting `"the current element`" that the script is on, and then
the exact configuration we want for our dialog.</p>
</div>
<div class="paragraph">
<p>If the user confirms the action, a <code>confirmed</code> event will be triggered on the button.  This means that we can go back
to using our trusty htmx attributes!  Namely, we can move <code>DELETE</code> to an <code>hx-delete</code> attribute, and we can use
<code>hx-target</code> to target the body.  And then, and here is the crucial step, we can use the <code>confirmed</code> event that is
triggered in the <code>sweetConfirm()</code> function, to trigger the request, but adding an <code>hx-trigger</code> for it.</p>
</div>
<div class="paragraph">
<p>Here is what our code looks like:</p>
</div>
<figure class="listingblock">
<figcaption class="title">An Event-based Confirmation Dialog</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bad bg color border<span class="token punctuation">"</span></span>
        <span class="token attr-name">hx-delete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts<span class="token punctuation">"</span></span> <span class="token attr-name">hx-target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">hx-trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>confirmed<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sweetConfirm($el, (2)
                { title: 'Delete these contacts?',  (3)
                  showCancelButton: true,
                  confirmButtonText: 'Delete'})<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Our htmx attributes are back.
</li>
<li>
We pass the button in to the function, so an event can be triggered on it.
</li>
<li>
We pass through the SweetAlert2 configuration information.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
As you can see, this event-based code is much cleaner and certainly more “HTML-ish.” The key to this cleaner
implementation is that our new <code>sweetConfirm()</code> function fires an event that htmx is able to listen for.</p>
</div>
<div class="paragraph">
<p>This is why a rich event model is important to look for when choosing a library to work with, both with htmx and with
Hypermedia-Driven Applications in general.</p>
</div>
<div class="paragraph">
<p>Unfortunately, due to the prevalence and dominance of the JavaScript-first mindset today, many libraries are like
SweetAlert2: they expect you to pass a callback in the first style.  In these cases you can use the technique we
have demonstrated here, wrapping the library in a function that triggers events in a callback, to make the library more
hypermedia and htmx-friendly.</p>
</div>
</section>
</section>
</section>
<section class="sect2">
<h3 id="_pragmatic_scripting">Pragmatic Scripting</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In case of conflict, consider users over authors over implementors over specifiers over theoretical purity.</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— W3C, 
<cite>HTML Design Principles § 3.2 Priority of Constituencies</cite>
</div>
</div>
<div class="paragraph">
<p>We have looked at several tools and techniques for scripting in a Hypermedia-Driven Application.  How should you
pick between them?  The sad truth is that there will never be a single, always correct answer to this question.</p>
</div>
<div class="paragraph">
<p>Are you committed to vanilla JavaScript-only, perhaps due to company policy?  Well, you can use vanilla JavaScript effectively
to script your Hypermedia-Driven Application.</p>
</div>
<div class="paragraph">
<p>Do you have more leeway and like the look of Alpine.js?  That’s a great way to add more structured, localized JavaScript
to your application, and offers some nice reactive features as well.</p>
</div>
<div class="paragraph">
<p>Are you a bit more bold in your technical choices?  Maybe _hyperscript is worth a look. (We certainly think so.)</p>
</div>
<div class="paragraph">
<p>Sometimes you might even consider picking two (or more) of these approaches within an application.  Each has its own
strengths and weaknesses, and all of them are relatively small and self-contained, so picking the right tool for the job
at hand might be the best approach.</p>
</div>
<div class="paragraph">
<p>In general, we encourage a <em>pragmatic</em> approach to scripting: whatever feels right is probably right (or, at least,
right <em>enough</em>) for you.  Rather than being concerned about which particular approach is taken for your scripting,
we would focus on these more general concerns:</p>
</div>
<div class="ulist">
<ul>
<li>
Avoid communicating with the server via JSON data APIs.
</li>
<li>
Avoid storing large amounts of state outside of the DOM.
</li>
<li>
Favor using events, rather than hard-coded callbacks or method calls.
</li>
</ul>
</div>
<div class="paragraph">
<p>And even on these topics, sometimes a web developer has to do what a web developer has to do.  If the perfect widget for your application exists but uses a JSON data API?  That’s OK.</p>
</div>
<div class="paragraph">
<p>Just don’t make it a habit.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_html_is_for_applications">HTML Notes: HTML is for Applications</h3>
<div class="paragraph">
<p>A prevalent meme among developers suggests that HTML was designed for “documents” and is unsuitable for “applications.”
In reality, hypermedia is not only a sophisticated, modern architecture for applications, but it can allow us to do away with this artificial app/document split for good.</p>
</div>
<div class="quoteblock">
<blockquote>
 When I say Hypertext, I mean the simultaneous presentation of information and controls such that the information becomes the affordance through which the user obtains choices and selects actions.
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite><a href="https://www.slideshare.net/royfielding/a-little-rest-and-relaxation">A little REST and Relaxation</a></cite>
</div>
</div>
<div class="paragraph">
<p>HTML allows documents to contain rich multimedia including images, audio, video, JavaScript programs, vector graphics and (with some help) 3D environments.
More importantly, however, it allows interactive controls to be embedded within these documents, allowing the information itself to be the app through which it is accessed.</p>
</div>
<div class="paragraph">
<p>Consider: Is it not mind-boggling that a single application — which works on all types of computers and OSs — can let you read news, place video calls, compose documents, enter virtual worlds, and do almost any other everyday computing task?</p>
</div>
<div class="paragraph">
<p>Unfortunately, it is the interactive capabilities of HTML that is its least developed aspect. For reasons unknown to us, while HTML made it to version 5 and became a Living Standard, accreting many game-changing features on the way, the data interactions in it are still mainly restricted to links and forms. It’s up to developers to extend HTML, and we want to do so in a way that doesn’t abstract over its simplicity with an imitation of classical "native" toolkits.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
SOFTWARE WAS NOT SUPPOSED TO USE NATIVE TOOLKITS
</li>
<li>
YEARS OF WINDOWS UI LIBRARIES yet NO REAL-WORLD USE FOUND for going lower level than THE WEB
</li>
<li>
Wanted a window anyway for a laugh? We had a tool for that: It was called "ELECTRON"
</li>
<li>
"yes I would love to write 4 DIFFERENT copies of the same UI" -  Statements dreamed up by the Utterly Deranged
</li>
</ul>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Leah Clark, 
<cite>@leah@tilde.zone</cite>
</div>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_json_data_apis_hypermedia_driven_applications">JSON Data APIs &amp; Hypermedia-Driven Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we have been focusing on using hypermedia to build Hypermedia-Driven Applications.  In doing so we are
following and taking advantage of the native network architecture of the web, and building a RESTful system, in the original sense
of that term.</p>
</div>
<div class="paragraph">
<p>
However, today, we should acknowledge that many web applications are often <em>not</em> built using this approach.  Instead, they use a
Single Page Application front end library such as React to build their application, and they interact with the server
via a JSON API.  This JSON API almost never uses hypermedia concepts.  Rather JSON APIs tend to be <em>Data APIs</em>, that
is, an API that simply returns structured domain data to the client without any hypermedia control information.  The client
itself must know how to interpret the JSON Data: what end points are associated with the data, how certain fields should
be interpreted, and so on.</p>
</div>
<div class="paragraph">
<p>Now, believe it or not, we <em>have</em> been creating an API for Contact.app.</p>
</div>
<div class="paragraph">
<p>This may sound confusing to you: an API?  We have just been creating a web application, with handlers that just return HTML.</p>
</div>
<div class="paragraph">
<p>How is that an API?</p>
</div>
<div class="paragraph">
<p>It turns out that Contact.app is, indeed, providing an API.  It just happens to be a <em>hypermedia</em> API that a <em>hypermedia client</em>,
that is, a browser, understands.  We are building an API for the browser to interact with over HTTP, and, thanks to the
magic of HTML and hypermedia, the browser doesn’t need to know anything about our hypermedia API beyond an entry point
URL: all the actions and display information comes, self-contained, within the HTML responses.</p>
</div>
<div class="paragraph">
<p>Building RESTful web applications like this is so natural and simple that you might not think of it as an API at all, but
we assure you, it is.</p>
</div>
<section class="sect2">
<h3 id="_hypermedia_apis_json_data_apis">Hypermedia APIs &amp; JSON Data APIs</h3>
<div class="paragraph">
<p>So, we have a hypermedia API for Contact.app.  Should we include a Data API for Contact.app as well?</p>
</div>
<div class="paragraph">
<p>
Sure!  The existence of a hypermedia API <em>in no way means</em> that you can’t <em>also</em> have a Data API.  In fact, this is a
common situation in traditional web applications: there is the “web application” that is entered through that entry point
URL, say <code><a href="https://mywebapp.example.com/" class="bare">https://mywebapp.example.com/</a></code>. And there is also a <em>separate</em> JSON API that is accessible through another
URL, perhaps <code><a href="https://api.mywebapp.example.com/v1" class="bare">https://api.mywebapp.example.com/v1</a></code>.</p>
</div>
<div class="paragraph">
<p>This is a perfectly reasonable way to split up the hypermedia interface to your application and the Data API you provide to other, non-hypermedia clients.</p>
</div>
<div class="paragraph">
<p>Why would you want to include a Data API along with a hypermedia API?  Well, because <em>non-hypermedia clients</em> might also
want to interact with your application as well.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
Perhaps you have a mobile application that isn’t built using Hyperview.  That application will need to interact with
your server somehow, and using the existing HTML API would almost certainly be a poor fit!  You want programmatic
access to your system via a Data API, and JSON is a natural choice for this.
</li>
<li>
Perhaps you have an automated script that needs to interact with the system on a regular basis.  For example, maybe we
have a bulk-import job that runs nightly, and needs to import/sync thousands of contacts.  While it would be possible
to script this against the HTML API, it would also be annoying: parsing HTML in scripts is error prone and tedious.  It
would be better to have a simple JSON API for this use case.
</li>
<li>
Perhaps there are 3rd party clients who wish to integrate with your system’s data in some way.  Maybe a partner
wants to synchronize data nightly.  As with the bulk-import example, this isn’t a great use case for an HTML-based API,
and it would make more sense to provide something more amenable to scripting.
</li>
</ul>
</div>
<div class="paragraph">
<p>For all of these use cases, a JSON Data API makes sense: in each case the API is not being consumed by a hypermedia client,
so presenting an HTML-based hypermedia API would be inefficient and complicated for the client to deal with.  A simple JSON Data API fits the bill for what we want and, as always, we recommend using the right tool for the job.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">“What!?!  You Want Me To Parse HTML!?!”</div>
<div class="paragraph">
<p>A confusion we often run into in online discussions when we advocate a hypermedia approach to building web
applications is that people think we mean that they should parse the HTML responses from the server, and then dump the
data into their SPA framework or mobile applications.</p>
</div>
<div class="paragraph">
<p>This is, of course, silly.</p>
</div>
<div class="paragraph">
<p>What we mean, instead, is that you should consider using a hypermedia API <em>with a hypermedia client</em>, like the browser,
interpreting the hypermedia response itself and presenting it to the user. A hypermedia API can’t simply be welded on
top of an existing SPA approach.  It requires a sophisticated hypermedia client such as the browser to be consumed
effectively.</p>
</div>
<div class="paragraph">
<p>If you are writing code to tease apart your hypermedia only to then treat as data to feed into a client-side model,
you are probably doing it wrong.</p>
</div>
</div>
</aside>
<section class="sect3">
<h4 id="_differences_between_hypermedia_apis_data_apis">Differences Between Hypermedia APIs &amp; Data APIs</h4>
<div class="paragraph">
<p>Let’s accept for a moment that we <em>are</em> going to have a Data API for our application, in addition to our hypermedia API.
At this point, some developers may be wondering: why have both?  Why not have a single API, the JSON Data API, and have
multiple clients use this one API to communicate with it?</p>
</div>
<div class="paragraph">
<p>Isn’t it redundant to have both types of APIs for our application?</p>
</div>
<div class="paragraph">
<p>This is a reasonable point: we do advocate having multiple APIs to your web application if necessary and, yes, this may
lead to some redundancy in code.  However, there are distinct advantages to both sorts of APIs and, even more so,
distinct requirements for both sorts of APIs.</p>
</div>
<div class="paragraph">
<p>By supporting both of these types of APIs separately you can get the strengths of both, while keeping their varying
styles of code and infrastructure needs cleanly split out.</p>
</div>
<div class="paragraph">
<p>Let’s contrast the needs of JSON APIs with Hypermedia APIs:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON API Needs</th>
<th class="tableblock halign-left valign-top">Hypermedia API</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>It must remain stable over time: you cannot change the API willy-nilly or you risk breaking clients that use the API
and expect certain end points to behave in certain ways.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>There is no need to remain stable over time: all URLs are discovered via HTML responses, so you can be much more aggressive in changing the shape of a hypermedia API.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>It must be versioned: related to the first point, when you do make a major change, you need to version the API so that clients that are using the old API continue to work.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Versioning is not an issue, another strength of the hypermedia approach.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>It should be rate limited: since data APIs are often used by other clients, not just your own internal web application, requests should be rate limited, often by user, in order to avoid a single client overloading the system.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Rate limiting probably isn’t as important beyond the prevention of Distributed Denial of Service (DDoS) attacks.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>It should be a general API: since the API is for <em>all</em> clients, not just for your web application, you should avoid specialized end points that are driven by your own application needs.  Instead, the API should be general and expressive enough to satisfy as many potential client needs as possible.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The API can be <em>very specific</em> to your application needs: since it is designed only for your particular web application, and since the API is discovered through hypermedia, you can add and remove highly tuned end points for specific features or optimization needs in your application.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Authentication for these sorts of API is typically token based, which we will discuss in more detail later.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Authentication is typically managed through a session cookie established by a login page.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These two different types of APIs have different strengths and needs, so it makes sense to use both. The hypermedia
approach can be used for your web application, allowing you to specialize the API for the “shape”
of your application.  The Data API approach can be used for other, non-hypermedia clients like mobile, integration
partners, etc.</p>
</div>
<div class="paragraph">
<p>Note that by splitting these two APIs apart, you reduce the pressure to constantly change a general Data API to address application needs.  Your Data API can focus on remaining stable and reliable, rather than requiring a new version with every added feature.</p>
</div>
<div class="paragraph">
<p>This is the key advantage of splitting your Data API from your Hypermedia API.</p>
</div>
<div class="paragraph">
<p></p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">JSON Data APIs vs JSON “REST” APIs</div>
<div class="paragraph">
<p>Unfortunately, today, for historical reasons, what we are calling JSON Data APIs are often referred to as
“REST APIs” in the industry.  This is ironic, because, by any reasonable reading of Roy Fielding’s work defining what REST
means, the vast majority of JSON APIs are <em>not</em> RESTful.  Not even close.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I am getting frustrated by the number of people calling any HTTP-based interface a REST API. Today’s example is the
SocialSite REST API. That is RPC. It screams RPC. There is so much coupling on display that it should be given an X rating.</p>
</div>
<div class="paragraph">
<p>What needs to be done to make the REST architectural style clear on the notion that hypertext is a constraint? In other
words, if the engine of application state (and hence the API) is not being driven by hypertext, then it cannot be RESTful
and cannot be a REST API. Period. Is there some broken manual somewhere that needs to be fixed?</p>
</div>
</blockquote>
<div class="attribution margin-inline-start">
— Roy Fielding, 
<cite>https://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven</cite>
</div>
</div>
<div class="paragraph">
<p>The story of how “REST API” came to mean “JSON APIs” in the industry is a long and sordid one, and beyond the
scope of this book.  However, if you are interested, you can refer to an essay by one of the authors of this book entitled “How Did REST Come To Mean The Opposite of
REST?” on the <a href="https://htmx.org/essays/how-did-rest-come-to-mean-the-opposite-of-rest/">htmx website</a>.</p>
</div>
<div class="paragraph">
<p>In this book we use the term “Data API” to describe these JSON APIs, while acknowledging that many people
in the industry will continue to call them “REST APIs” for the foreseeable future.</p>
</div>
</div>
</aside>
</section>
</section>
<section class="sect2">
<h3 id="_adding_a_json_data_api_to_contact_app">Adding a JSON Data API To Contact.app</h3>
<div class="paragraph">
<p>Alright, so how are we going to add a JSON Data API to our application?  One approach, popularized by the Ruby on Rails
web framework, is to use the same URL endpoints as your hypermedia application, but use the HTTP <code>Accept</code> header to
determine if the client wants a JSON representation or an HTML representation.  The HTTP <code>Accept</code> header allows a client
to specify what sort of  Multipurpose Internet Mail Extensions (MIME) types, that is file types, it wants back from the
server: JSON, HTML, text and so on.</p>
</div>
<div class="paragraph">
<p>So, if the client wanted a JSON representation of all contacts, they might issue a <code>GET</code> request that looks like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">A request for a JSON representation of all contacts</figcaption>
<div class="content">
<pre class="highlight language-http" tabindex="0"><code class="language-http" data-lang="http">Accept: application/json

GET /contacts</code></pre>
</div>
</figure>
<div class="paragraph">
<p>If we adopted this pattern then our request handler for <code>/contacts/</code> would need to be updated to inspect this header and,
depending on the value, return a JSON rather than HTML representation for the contacts.  Ruby on Rails has support for
this pattern baked into the framework, making it very easy to switch on the requested MIME type.</p>
</div>
<div class="paragraph">
<p>Unfortunately, our experience with this pattern has not been great, for reasons that should be clear given the
differences we outlined between Data and hypermedia APIs: they have different needs and often take on very different
“shapes”, and trying to pound them into the same set of URLs ends up creating a lot of tension in the application code.</p>
</div>
<div class="paragraph">
<p>Given the different needs of the two APIs and our experience managing multiple APIs like this, we think separating the two, and, therefore, breaking the JSON Data API out to its own set of URLs is the right choice.  This will
allow us to evolve the two APIs separately from one another, and give us room to improve each independently, in a manner
consistent with their own individual strengths.</p>
</div>
<section class="sect3">
<h4 id="_picking_a_root_url_for_our_api">Picking a Root URL For Our API</h4>
<div class="paragraph">
<p>Given that we are going to split our JSON Data API routes out from our regular hypermedia routes, where should we place
them?  One important consideration here is that we want to make sure that we can version our API cleanly in some way,
regardless of the pattern we choose.</p>
</div>
<div class="paragraph">
<p>Looking around, a lot of places use a subdomain for their APIs, something
like <code><a href="https://api.mywebapp.example.com" class="bare">https://api.mywebapp.example.com</a></code> and, in fact, often encode versioning in the subdomain: <code><a href="https://v1.api.mywebapp.example.com" class="bare">https://v1.api.mywebapp.example.com</a></code>.</p>
</div>
<div class="paragraph">
<p>While this makes sense for large companies, it seems like a bit of overkill for our modest little Contact.app.  Rather
than using subdomains, which are a pain for local development, we will use sub-paths within the existing application:</p>
</div>
<div class="ulist">
<ul>
<li>
We will use <code>/api</code> as the root for our Data API functionality
</li>
<li>
We will use <code>/api/v1</code> as the entry point for version 1 of our Data API
</li>
</ul>
</div>
<div class="paragraph">
<p>If and when we decide to bump the API version, we can move to <code>/api/v2</code> and so on.</p>
</div>
<div class="paragraph">
<p>This approach isn’t perfect, of course, but it will work for our simple application and can be adapted to a subdomain
approach or various other methods at a later point, when our Contact.app has taken over the internet and we can afford
a large team of API developers.  :)</p>
</div>
</section>
<section class="sect3">
<h4 id="_our_first_json_endpoint_listing_all_contacts">Our First JSON Endpoint: Listing All Contacts</h4>
<div class="paragraph">
<p>

Let’s add our first Data API endpoint.  It will handle an HTTP <code>GET</code> request to <code>/api/v1/contacts</code>, and return
a JSON list of all contacts in the system.  In some ways it will look quite a bit like our initial code for the
hypermedia route <code>/contacts</code>: we will load all the contacts from the contacts database and then render some text
as a response.</p>
</div>
<div class="paragraph">
<p>We are also going to take advantage of a nice feature of Flask: if you simply return an object from a handler, it will
serialize (that is, convert) that object into a JSON response.  This makes it very easy to build simple JSON APIs
in flask!</p>
</div>
<figure class="listingblock">
<figcaption class="title">A JSON data API to return all contacts</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/api/v1/contacts", methods=["GET"]) (1)
def json_contacts():
    contacts_set = Contact.all()
    contacts_dicts = [c.__dict__ for c in contacts_set] (2)
    return {"contacts": contacts_dicts} (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
JSON API gets its own path, starting with <code>/api</code>.
</li>
<li>
Convert the contacts array into an array of simple dictionary (map) objects.
</li>
<li>
Return a dictionary that contains a <code>contacts</code> property of all the contacts.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This Python code might look a little foreign to you if you are not a Python developer, but all we are doing is converting
our contacts into an array of simple name/value pairs and returning that array in an enclosing object as the <code>contacts</code>
property.  This object will be serialized into a JSON response automatically by Flask.</p>
</div>
<div class="paragraph">
<p>With this in place, if we make an HTTP <code>GET</code> request to <code>/api/v1/contacts</code>, we will see a response that looks something
like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Some sample data from our API</figcaption>
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{
  "contacts": [
    {
      "email": "carson@example.com",
      "errors": {},
      "first": "Carson",
      "id": 2,
      "last": "Gross",
      "phone": "123-456-7890"
    },
    {
      "email": "joe@example2.com",
      "errors": {},
      "first": "",
      "id": 3,
      "last": "",
      "phone": ""
    },
    ...
  ]
}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>So, you can see, we now have a way to get a relatively simple JSON representation of our contacts via an HTTP request.
Not perfect, but it’s a good start. It’s certainly good enough to write some basic automated
scripts against. For example, you could use this Data API to:</p>
</div>
<div class="ulist">
<ul>
<li>
Move your contacts to another system on a nightly basis
</li>
<li>
Back your contacts up to a local file
</li>
<li>
Automate an email blast to your contacts
</li>
</ul>
</div>
<div class="paragraph">
<p>Having this small JSON Data API opens up a lot of automation possibilities that would be messier to achieve with our existing
hypermedia API.</p>
</div>
</section>
<section class="sect3">
<h4 id="_adding_contacts">Adding Contacts</h4>
<div class="paragraph">
<p>Let’s move on to the next piece of functionality: the ability to add a new contact.  Once again, our code is going
to look similar in some ways to the code that we wrote for our normal web application.  However, here we are also
going to see the JSON API and the hypermedia API for our web application begin to obviously diverge.</p>
</div>
<div class="paragraph">
<p>In the web application, we needed a separate path, <code>/contacts/new</code> to host the HTML form for creating a new contact.  In
the web application we made the decision to issue a <code>POST</code> to that same path to keep things consistent.</p>
</div>
<div class="paragraph">
<p>In the case of the JSON API, there is no such path needed: the JSON API “just is”: it doesn’t need to provide any
hypermedia representation for creating a new contact.  You simply know where to issue a <code>POST</code> to create a contact — likely through some documentation provided about the API — and that’s it.</p>
</div>
<div class="paragraph">
<p>Because of that fact, we can put the “create” handler on the same path as the “list” handler: <code>/api/v1/contacts</code>, but
have it respond only to HTTP <code>POST</code> requests.</p>
</div>
<div class="paragraph">
<p>The code here is relatively straightforward: populate a new contact with the information from the <code>POST</code> request,
attempt to save it, and — if it is not successful — show error messages.  Here is the code:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding contacts with our JSON API</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/api/v1/contacts", methods=["POST"]) (1)
def json_contacts_new():
    c = Contact(None, request.form.get('first_name'), request.form.get('last_name'), request.form.get('phone'),
                request.form.get('email')) (2)
    if c.save(): (3)
        return c.__dict__
    else:
        return {"errors": c.errors}, 400 (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This handler is on the same path as the first one for our JSON API, but handles <code>POST</code> requests.
</li>
<li>
We create a new Contact based on values submitted with the request.
</li>
<li>
We attempt to save the contact and, if successful, render it as a JSON object.
</li>
<li>
If the save is not successful, we render an object showing the errors, with a response code of <code>400 (Bad Request)</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In some ways this is similar to our <code>contacts_new()</code> handler from our web application; we are creating the contact and attempting
to save it. In other ways it is very different:</p>
</div>
<div class="ulist">
<ul>
<li>
There is no redirection happening here on a successful creation, because we are not dealing with a hypermedia client
like the browser.
</li>
<li>
In the case of a bad request, we simply return an error response code, <code>400 (Bad Request)</code>.  This is in contrast with
the web application, where we re-render the form with error messages in it.
</li>
</ul>
</div>
<div class="paragraph">
<p>These sorts of differences, over time, build up and make the idea of keeping your JSON and hypermedia APIs
on the same set of URLs less and less appealing.</p>
</div>
</section>
<section class="sect3">
<h4 id="_viewing_contact_details">Viewing Contact Details</h4>
<div class="paragraph">
<p>Next, let’s make it possible for a JSON API client to download the details for a single contact.  We will naturally use an
HTTP <code>GET</code> for this functionality and will follow the convention we established for our regular web application, and
put the path at <code>/api/v1/contacts/&lt;contact id&gt;</code>. So, for example, if you want to see the details of the contact with the
id <code>42</code>, you would issue an HTTP <code>GET</code> to <code>/api/v1/contacts/42</code>.</p>
</div>
<div class="paragraph">
<p>This code is quite simple:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Getting the details of a contact in JSON</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/api/v1/contacts/&lt;contact_id&gt;", methods=["GET"]) (1)
def json_contacts_view(contact_id=0):
    contact = Contact.find(contact_id) (2)
    return contact.__dict__ (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Add a new <code>GET</code> route at the path we want to use for viewing contact details
</li>
<li>
Look the contact up via the id passed in through the path
</li>
<li>
Convert the contact to a dictionary, so it can be rendered as JSON response
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Nothing too complicated: we look the contact up by the ID provided in the path to the controller.
We then render it as JSON.  You have to appreciate the simplicity of this code!</p>
</div>
<div class="paragraph">
<p>Next, let’s add updating and deleting a contact as well.</p>
</div>
</section>
<section class="sect3">
<h4 id="_updating_deleting_contacts">Updating &amp; Deleting Contacts</h4>
<div class="paragraph">
<p>As with the create contact API endpoint, because there is no HTML UI to produce for them, we can reuse the
<code>/api/v1/contacts/&lt;contact id&gt;</code> path.  We will use the <code>PUT</code> HTTP method for updating a contact and the <code>DELETE</code>
method for deleting one.</p>
</div>
<div class="paragraph">
<p>Our update code is going to look nearly identical to the create handler, except that, rather than creating a new contact,
we will look up the contact by ID and update its fields.  In this sense we are just combining the code of the create
handler and the detail view handler.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Updating a contact with our JSON API</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/api/v1/contacts/&lt;contact_id&gt;", methods=["PUT"]) (1)
def json_contacts_edit(contact_id):
    c = Contact.find(contact_id) (2)
    c.update(request.form['first_name'], request.form['last_name'], request.form['phone'], request.form['email']) (3)
    if c.save(): (4)
        return c.__dict__
    else:
        return {"errors": c.errors}, 400</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We handle <code>PUT</code> requests to the URL for a given contact.
</li>
<li>
Look the contact up via the id passed in through the path.
</li>
<li>
We update the contact’s data from the values included in the request.
</li>
<li>
From here on the logic is identical to the <code>json_contacts_create()</code> handler.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Once again, thanks to the built-in functionality in Flask, simple to implement.</p>
</div>
<div class="paragraph">
<p>Let’s look at deleting a contact now.  This turns out to be even simpler: as with the update handler we are going to
look up the contact by id, and then, well, delete it.  At that point we can return a simple JSON object indicating
success.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Deleting a contact with our JSON API</figcaption>
<div class="content">
<pre class="highlight language-python" tabindex="0"><code class="language-python" data-lang="python">@app.route("/api/v1/contacts/&lt;contact_id&gt;", methods=["DELETE"]) (1)
def json_contacts_delete(contact_id=0):
    contact = Contact.find(contact_id)
    contact.delete() (2)
    return jsonify({"success": True}) (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
We handle <code>DELETE</code> requests to the URL for a given contact.
</li>
<li>
Look the contact up and invoke the <code>delete()</code> method on it.
</li>
<li>
Return a simple JSON object indicating that the contact was successfully deleted.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And, with that, we have our simple little JSON Data API to live alongside our regular web application, nicely separated
out from the main web application, so it can evolve separately as needed.</p>
</div>
</section>
<section class="sect3">
<h4 id="_additional_data_api_considerations">Additional Data API Considerations</h4>
<div class="paragraph">
<p>Now, we would have a lot more to do if we wanted to make this a production ready JSON API. At minimum we would need to add:</p>
</div>
<div class="ulist">
<ul>
<li>
Rate limiting, important for any public-facing Data API to avoid abusive clients.
</li>
<li>
An authentication mechanism.  (We don’t have one for our web application either!)
</li>
<li>
Support for pagination of our contact data.
</li>
<li>
Several small items, such as rendering a proper <code>404 (Not Found)</code> response if someone makes
a request with a contact id that doesn’t exist.
</li>
</ul>
</div>
<div class="paragraph">
<p>These topics are beyond the scope of this book, but we’d like to focus on one in
particular, authentication, in order to show the difference between our hypermedia and JSON API.  In order to secure
our application we need to add <em>authentication</em>, some mechanism for determining who a request is coming from, and
also <em>authorization</em>, determining if they have the right to perform the request.</p>
</div>
<div class="paragraph">
<p>We will set authorization aside for now and consider only authentication.</p>
</div>
<section class="sect4">
<h5 id="_authentication_in_web_applications">Authentication in web applications</h5>
<div class="paragraph">
<p>
In the HTML web application world, authentication has traditionally been done via a login page that asks a user for
their username (often their email) and a password.  This password is then checked against a database of (hashed)
passwords to establish that the user is who they say they are.  If the password is correct, then a <em>session cookie</em>
is established, indicating who the user is.  This cookie is then sent with every request that the user makes to
the web application, allowing the application to know which user is making a given request.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">HTTP Cookies</div>
<div class="paragraph">
<p>
HTTP Cookies are kind of a strange feature of HTTP.  In some ways they violate the goal of remaining stateless, a
major component of the RESTful architecture: a server will often use a session cookie as an index into state kept
on the server “on the side”, such as a cache of the last action performed by the user.</p>
</div>
<div class="paragraph">
<p>Nonetheless, cookies have proven extremely useful and so people tend not to complain about this aspect of them too much
(We are not sure what our other options would be here!)  An interesting example of pragmatism gone (relatively) right in
web development.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>In comparison with the standard web application approach to authentication, a JSON API will typically use some sort of
<em>token based</em> authentication: an authentication token will be established via a mechanism like OAuth, and that authentication
token will then be passed, often as an HTTP Header, with every request that a client makes.</p>
</div>
<div class="paragraph">
<p>At a high level this is similar to what happens in normal web application authentication: a token is established somehow
and then that token is part of every request.  However, in practice, the mechanics tend to be wildly different:</p>
</div>
<div class="ulist">
<ul>
<li>
Cookies are part of the HTTP specification and can be easily <em>set</em> by an HTTP Server.
</li>
<li>
JSON Authentication tokens, in contrast, often require elaborate exchange mechanics like OAuth to be established.
</li>
</ul>
</div>
<div class="paragraph">
<p>These differing mechanics for establishing authentication are yet another good reason for splitting up our JSON and hypermedia
APIs.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_the_shape_of_our_two_apis">The “Shape” of Our Two APIs</h4>
<div class="paragraph">
<p>When we were building out our API, we noted that in many cases the JSON API didn’t require as many end points as our
hypermedia API did: we didn’t need a <code>/contacts/new</code> handler, for example, to provide a hypermedia representation for
creating contacts.</p>
</div>
<div class="paragraph">
<p>Another aspect of our hypermedia API to consider was the performance improvement we made: we pulled the total contact count
out to a separate endpoint and implemented the “Lazy Load” pattern, to improve the perceived performance of our
application.</p>
</div>
<div class="paragraph">
<p>Now, if we had both our hypermedia and JSON API sharing the same paths, would we want to publish this API as a JSON
endpoint as well?</p>
</div>
<div class="paragraph">
<p>Maybe, but maybe not.  This was a pretty specific need for our web application, and, absent a request from a user of
our JSON API, it doesn’t make sense to include it for JSON consumers.</p>
</div>
<div class="paragraph">
<p>And what if, by some miracle, the performance issues with <code>Contact.count()</code> that we were addressing with the Lazy Load
pattern goes away?  Well, in our Hypermedia-Driven Application we can simply revert to the old code and include the
count directly in the request to <code>/contacts</code>.  We can remove the <code>contacts/count</code> endpoint and all the logic associated
with it.  Because of the uniform interface of hypermedia, the system will continue to work just fine.</p>
</div>
<div class="paragraph">
<p>But what if we had tied our JSON API and hypermedia API together, and published <code>/contacts/count</code> as a supported end
point for our JSON API?  In that case we couldn’t simply remove the endpoint: a (non-hypermedia) client might be
relying on it.</p>
</div>
<div class="paragraph">
<p>Once again you can see the flexibility of the hypermedia approach and why separating your JSON API out from your
hypermedia API lets you take maximum advantage of that flexibility.</p>
</div>
</section>
<section class="sect3">
<h4 id="_the_model_view_controller_mvc_paradigm">The Model View Controller (MVC) Paradigm</h4>
<div class="paragraph">
<p>One thing you may have noticed about the handlers for our JSON API is that they are relatively simple and regular.
Most of the hard work of updating data and so forth is done within the contact model itself: the handlers act as simple
connectors that provide a go-between the HTTP requests and the model.</p>
</div>
<div class="paragraph">
<p>This is the ideal controller of the Model-View-Controller (MVC) paradigm that was so popular in the early web: a controller
should be “thin”, with the model containing the majority of the logic in the system.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">The Model View Controller pattern</div>
<div class="paragraph">
<p>
The Model View Controller design pattern is a classic architectural pattern in software development, and was a major
influence in early web development.  It is no longer emphasized as heavily, as web development has split into frontend
and backend camps, but most web developers are still familiar with the idea.</p>
</div>
<div class="paragraph">
<p>Traditionally, the MVC pattern mapped into web development like so:</p>
</div>
<div class="ulist">
<ul>
<li>
Model - A collection of “domain” classes that implement all the logic and rules for the particular domain your application
is designed for.  The model typically provides “resources” that are then presented to clients as HTML “representations.”
</li>
<li>
View - Typically views would be some sort of client-side templating system, and would render the aforementioned HTML representation
for a given Model instance.
</li>
<li>
Controller - The controller’s job is to take HTTP requests, convert them into sensible requests to the Model and forward
those requests on to the appropriate Model objects.  It then passes the HTML representation back to the client as an
HTTP response.
</li>
</ul>
</div>
</div>
</aside>
<div class="paragraph">
<p>Thin controllers make it easy to split your JSON and hypermedia APIs out, because all the important logic lives in the domain
model that is shared by both.  This allows you to evolve both separately, while still keeping logic in sync with one
another.</p>
</div>
<div class="paragraph">
<p>With properly built “thin” controllers and “fat” models, keeping two separate APIs both in sync and yet
still evolving separately is not as difficult or as crazy as it might sound.</p>
</div>
</section>
</section>
<aside class="sect2 html-note info">
<h3 id="_html_notes_microformats">HTML Notes: Microformats</h3>
<div class="paragraph">
<p><a href="https://microformats.org/">Microformats</a> is a standard for embedding machine-readable structured data in HTML.

It uses classes to mark certain elements as containing information to be extracted,
with conventions for extracting common properties like name, URL and photo without classes.
By adding these classes into the HTML representation of an object, we allow the properties of the object to be recovered from the HTML. For example, this simple HTML:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h-card<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://john.example<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>john.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> John Doe
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>can be parsed into this JSON-like structure by a microformats parser:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-json" tabindex="0"><code class="language-json" data-lang="json">{
  "type": ["h-card"],
  "properties": {
    "name": ["John Doe"],
    "photo": ["john.jpg"],
    "url": ["https://john.example"]
  }
}</code></pre>
</div>
</figure>
<div class="paragraph">
<p>Using a variety of properties and nested objects, we could mark up every bit of information about a contact, for example, in a machine-readable way.</p>
</div>
<div class="paragraph">
<p>As explained in the above chapter, trying to use the same mechanism for human and machine interaction is not a good idea.
Your human-facing and machine-facing interfaces may end up being limited by each other.
If you want to expose domain-specific data and actions to users and developers, a JSON API is a great option.</p>
</div>
<div class="paragraph">
<p>However, microformats are way easier to adopt.
A protocol or standard that requires websites to implement a JSON API has a high technical barrier.
In comparison, any website can be augmented with microformats simply by adding a few classes.
Other HTML-embedded data formats like microdata, Open Graph are similarly easy to adopt.
This makes microformats useful for cross-website (dare we say <em>web-scale</em>) systems like the <a href="https://indieweb.org">IndieWeb</a>, which uses it pervasively.</p>
</div>
</aside>
</div>
</section>
<h1 id="_bringing_hypermedia_to_mobile" class="sect0"><sub-title>Part III<v-h>:</v-h></sub-title>  Bringing Hypermedia To Mobile</h1>
<section class="sect1">
<h2 id="_hyperview_a_mobile_hypermedia">Hyperview: A Mobile Hypermedia</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may be forgiven for thinking the hypermedia architecture is synonymous with the web, web browsers, and HTML.
No doubt, the web is the largest hypermedia system, and web browsers are the most popular hypermedia client.
The dominance of the web in discussions about hypermedia make it easy to forget that hypermedia is a general concept, and can be applied to all types of platforms and applications.
In this chapter, we will see the hypermedia architecture applied to a non-web platform: native mobile applications.</p>
</div>
<div class="paragraph">
<p>Mobile as a platform has different constraints than the web.
It requires different trade-offs and design decisions.
Nonetheless, the concepts of hypermedia, HATEOAS, and REST can be directly applied to build delightful mobile applications.</p>
</div>
<div class="paragraph">
<p>In this chapter we will cover shortcomings with the current state of mobile app development, and how a hypermedia architecture can address these problems. We will then look at a path toward hypermedia on mobile: Hyperview, a mobile app framework that uses the hypermedia architecture. We’ll conclude with an overview of HXML, the hypermedia format used by Hyperview.</p>
</div>
<section class="sect2">
<h3 id="_the_state_of_mobile_app_development">The State of Mobile App Development</h3>
<div class="paragraph">
<p>Before we can discuss how to apply hypermedia to mobile platforms, we need to understand how native mobile apps are commonly built.
I’m using the word “native” to refer to code written against an SDK provided by the phone’s operating system (typically Android or iOS).
This code is packaged into an executable binary, and uploaded &amp; approved through app stores controlled by Google and Apple.
When users install or update an app, they’re downloading this executable and running the code directly on their device’s OS.
In this way, mobile apps have a lot in common with old-school desktop apps for Mac, Windows, or Linux.
There is one important difference between PC desktop apps of yesteryear and today’s mobile apps.
These days, almost all mobile apps are “networked”.
By networked, we mean the app needs to read and write data over the Internet to deliver its core functionality.
In other words, a networked mobile app needs to implement the client-server architecture.</p>
</div>
<div class="paragraph">
<p>When implementing the client-server architecture, the developer needs to make a decision: Should the app be designed as a thin client or thick client?
The current mobile ecosystems strongly push developers towards a thick-client approach.
Why?
Remember, Android and iOS require that a native mobile app be packaged and distributed as an executable binary.
There’s no way around it.
Since the developer needs to write code to package into an executable, it seems logical to implement some of the app’s logic in that code.
The code may as well initiate HTTP calls to the server to retrieve data, and then render that data using the platform’s UI libraries.
Thus, developers are naturally led into a thick-client pattern that looks something like this:</p>
</div>
<div class="ulist">
<ul>
<li>
The client contains code to make API requests to the server, and code to translate those responses to UI updates
</li>
<li>
The server implements an HTTP API that speaks JSON, and knows little about the state of the client
</li>
</ul>
</div>
<div class="paragraph">
<p>Just like with SPAs on the web, this architecture has a big downside: the app’s logic gets spread across the client and server.
Sometimes, this means that logic gets duplicated (like to validate form data).
Other times, the client and server each implement disjoint parts of the app’s overall logic.
To understand what the app does, a developer needs to trace interactions between two very different codebases.</p>
</div>
<div class="paragraph">
<p>There’s another downside that affects mobile apps more than SPAs: API churn.
Remember, the app stores control how your app gets distributed and updated.
Users can even control if and when they get updated versions of your app.
As a mobile developer, you can’t assume that every user will be on the latest version of your app.
Your frontend code gets fragmented across many versions, and now your backend needs to support all of them.</p>
</div>
</section>
<section class="sect2">
<h3 id="_hypermedia_for_mobile_apps">Hypermedia for Mobile Apps</h3>
<div class="paragraph">
<p>
We’ve seen that the hypermedia architecture can address the shortcomings of SPAs on the web.
But can hypermedia work for mobile apps as well?
The answer is yes!</p>
</div>
<div class="paragraph">
<p>Just like on the web, we can use hypermedia formats on mobile and let it serve as the engine of application state.
All of the logic is controlled from the backend, rather than being spread between two codebases.
Hypermedia architecture also solves the annoying problem of API churn on mobile apps.
Since the backend serves a hypermedia response containing both data and actions, there’s no way for the data and UI to get out of sync.
No more worries about backwards compatibility or maintaining multiple API versions.</p>
</div>
<div class="paragraph">
<p>So how can you use hypermedia for your mobile app?
There are two approaches employing hypermedia to build &amp; ship native mobile apps today:</p>
</div>
<div class="ulist">
<ul>
<li>
Web views, which wraps the trusty web platform in a mobile app shell
</li>
<li>
Hyperview, a new hypermedia system we designed specifically for mobile apps
</li>
</ul>
</div>
<section class="sect3">
<h4 id="_web_views">Web Views</h4>
<div class="paragraph">
<p>The simplest way to use hypermedia architecture on mobile is by leveraging web technologies.
Both Android and iOS SDKs provide “web views”: chromeless web browsers that can be embedded in native apps.
Tools like Apache Cordova make it easy to take the URL of a website, and spit out native iOS and Android apps based on web views.
If you already have a responsive web app, you can get a “native” mobile HDA for free.
Sounds too good to be true, right?</p>
</div>
<div class="paragraph">
<p>Of course, there is a fundamental limitation with this approach.
The web platform and mobile platforms have different capabilities and UX conventions.
HTML doesn’t natively support common UI patterns of mobile apps.
One of the biggest differences is around how each platform handles navigation.
On the web, navigation is page-based, with one page replacing another and the browser providing back/forward buttons to navigate the page history.
On mobile, navigation is more complex, and tuned for the physicality of gesture-based interactions.</p>
</div>
<div class="ulist">
<ul>
<li>
To drill down, screens slide on top of each other, forming stacks of screens.
</li>
<li>
Tab bars at the top or bottom of the app allow switching between various stacks of screens.
</li>
<li>
Modals slide up from the bottom of the app, covering the other stacks and tab bar.
</li>
<li>
Unlike with web pages, all of these screens are still present in memory, rendered and updating based on app state.
</li>
</ul>
</div>
<div class="paragraph">
<p>The navigation architecture is a major difference between how mobile and web apps function.
But it’s not the only one.
Many other UX patterns are present in mobile apps, but are not natively supported on the web:</p>
</div>
<div class="ulist">
<ul>
<li>
pull-to-refresh to refresh content in a screen
</li>
<li>
horizontal swipe on UI elements to reveal actions
</li>
<li>
sectioned lists with sticky headers
</li>
</ul>
</div>
<div class="paragraph">
<p>While these interactions are not natively supported by web browsers, they can be simulated with JS libraries.
Of course, these libraries will never have the same feel and performance as native gestures.
And using them usually requires embracing a JS-heavy SPA architecture like React.
This puts us back at square 1!
To avoid using the typical thick-client architecture of native mobile apps, we turned to a web view.
The web view allows us to use good-old hypermedia-based HTML.
But to get the desired look &amp; feel of a mobile app, we end up building a SPA in JS, losing the benefits of Hypermedia in the process.</p>
</div>
<div class="paragraph">
<p>To build a mobile HDA that acts and feels like a native app, HTML isn’t going to cut it.
We need a format designed to represent the interactions and patterns of native mobile apps.
That’s exactly what Hyperview does.</p>
</div>
</section>
<section class="sect3">
<h4 id="_hyperview">Hyperview</h4>
<div class="paragraph">
<p>
Hyperview is an open-source hypermedia system that provides:</p>
</div>
<div class="ulist">
<ul>
<li>
A hypermedia format for defining mobile apps called HXML
</li>
<li>
A hypermedia client for HXML that works on iOS and Android
</li>
<li>
Extension points in HXML and the client to customize the framework for a given app
</li>
</ul>
</div>
<section class="sect4">
<h5 id="_the_format">The format</h5>
<div class="paragraph">
<p>
HXML was designed to feel familiar to web developers, used to working with HTML.
Thus the choice of XML for the base format.
In addition to familiar ergonomics, XML is compatible with server-side rendering libraries.
For example, Jinja2 is perfectly suited as a templating library to render HXML.
The familiarity of XML and the ease of integration on the backend make it simple to adopt in both new and existing codebases.
Take a look at a “Hello World” app written in HXML.
The syntax should be familiar to anyone who’s worked with HTML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Hello World</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>styles</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My first app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>But HXML is not just a straight port of HTML with differently named tags.
In previous chapters, we’ve seen how htmx enhances HTML with a handful of new attributes.
These additions maintain the declarative nature of HTML, while giving developers the power to create rich web apps.
In HXML, the concepts of htmx are built into the spec.
Specifically, HXML is not limited to “click a link” and “submit a form” interactions like basic HTML.
It supports a range of triggers and actions for modifying the content on a screen.
These interactions are bundled together in a powerful concept of “behaviors.”
Developers can even define new behavior actions to add new capabilities to their app, without the need for scripting.
We will learn more about behaviors later in this chapter.</p>
</div>
</section>
<section class="sect4">
<h5 id="_the_client">The client</h5>
<div class="paragraph">
<p>
Hyperview provides an open-source HXML client library written in React Native.
With a little bit of configuration and a few steps on the command line, this library compiles into native app binaries for iOS or Android.
Users install the app on their device via an app store.
On launch, the app makes an HTTP request to the configured URL, and renders the HXML response as the first screen.</p>
</div>
<div class="paragraph">
<p>It may seem a little strange that developing a HDA using Hyperview requires a single-purpose client binary.
After all, we don’t ask users to first download and install a binary to view a web app.
No, users just enter a URL in the address bar of a general-purpose web browser.
A single HTML client renders apps from any HTML server.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/one-client-many-servers.svg" alt="Many clients connect to one server" loading="lazy">
</div>
<figcaption class="title">Figure 11. One HTML client, multiple HTML servers</figcaption>
</figure>
<div class="paragraph">
<p>It is theoretically possible to build an equivalent general-purpose “Hyperview browser.”
This HXML client would render apps from any HXML server, and users would enter a URL to specify the app they want to use.
But iOS and Android are built around the concept of single-purpose apps.
Users expect to find and install apps from an app store, and launch them from the home screen of their device.
Hyperview embraces this app-centric paradigm of today’s popular mobile platforms.
That means that the HXML client (app binary) renders its UI from a single pre-configured HXML server:</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/one-server-one-hxml-client.svg" alt="One mobile client connects to the server" loading="lazy">
</div>
<figcaption class="title">Figure 12. One HXML client, one HXML server</figcaption>
</figure>
<div class="paragraph">
<p>Luckily, developers do not need to write a HXML client from scratch; the open-source client library does 99% of the work.
And as we will see in the next section, there are major benefits to controlling both the client and server in a HDA.</p>
</div>
</section>
<section class="sect4">
<h5 id="_extensibility">Extensibility</h5>
<div class="paragraph">
<p>To understand the benefits of Hyperview’s architecture, we need to first discuss the drawbacks of the web architecture.
On the web, any web browser can render HTML from any web server.
This level of compatibility can only happen with well-defined standards such as HTML5.
But defining and evolving standards is a laborious process.
For example, the W3C took over 7 years to go from first draft to recommendation on the HTML5 spec.
It’s not surprising, given the level of thoughtfulness that needs to go into a change that impacts so many people.
But it means that progress happens slowly.
As a web developer, you may need to wait years for browsers to gain widespread support for the feature you need.</p>
</div>
<div class="paragraph">
<p>So what are the benefits of Hyperview’s architecture?
In a Hyperview app, <em>your</em> mobile app only renders HXML from <em>your</em> server.
You don’t need to worry about compatibility between your server and other mobile apps, or between your mobile app and other servers.
There is no standards body to consult.
If you want to add a blink feature to your mobile app, go ahead and implement a <code>&lt;blink&gt;</code> element in the client, and start returning <code>&lt;blink&gt;</code> elements in the HXML responses from your server.
In fact, the Hyperview client library was built with this type of extensibility in mind.
There are extension points for custom UI elements and custom behavior actions.
We expect and encourage developers to use these extensions to make HXML more expressive and customized to their app’s functionality.</p>
</div>
<div class="paragraph">
<p>And by extending the HXML format and client itself, there’s no need for Hyperview to include a scripting layer in HXML.
Features that require client-side logic get “built-in” to the client binary.
HXML responses remain pure, with UI and interactions represented in declarative XML.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_which_hypermedia_architecture_should_you_use">Which Hypermedia Architecture Should You Use?</h4>
<div class="paragraph">
<p>We’ve discussed two approaches for creating mobile apps using hypermedia systems:</p>
</div>
<div class="ulist">
<ul>
<li>
create a backend that returns HTML, and serve it in a mobile app through a web view
</li>
<li>
create a backend that returns HXML, and serve it in a mobile app with the Hyperview client
</li>
</ul>
</div>
<div class="paragraph">
<p>I purposefully described the two approaches in a way to highlight their similarities.
After all, they are both based on hypermedia systems, just with different formats and clients.
Both approaches solve the fundamental issues with traditional, SPA-like mobile app development:</p>
</div>
<div class="ulist">
<ul>
<li>
The backend controls the full state of the app.
</li>
<li>
Our app’s logic is all in one place.
</li>
<li>
The app always runs the latest version, there’s no API churn to worry about.
</li>
</ul>
</div>
<div class="paragraph">
<p>So which approach should you use for a mobile HDA?
Based on our experience building both types of apps, we believe the Hyperview approach results in a better user experience.
The web-view will always feel out-of-place on iOS and Android; there’s just no good way to replicate the patterns of navigation and interaction that mobile users expect.
Hyperview was created specifically to address the limitations of thick-client and web view approaches.
After the initial investment to learn Hyperview, you’ll get all of the benefits of the Hypermedia architecture, without the downsides of a degraded user experience.</p>
</div>
<div class="paragraph">
<p>Of course, if you already have a simple, mobile-friendly web app, then using a web-view approach is sensible.
You will certainly save time from not having to serve your app as HXML in addition to HTML.
But as we will show at the end of this chapter, it doesn’t take a lot of work to convert an existing Hypermedia-driven web app into a Hyperview mobile app.
But before we get there, we need to introduce the concepts of elements and behaviors in Hyperview.
Then, we’ll re-build our contacts app in Hyperview.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">When Shouldn’t You Use Hypermedia to Build a Mobile App?</div>
<div class="paragraph">
<p>Hypermedia is not always the right choice to build a mobile app.
Just like on the web, apps that require highly dynamic UIs (such as a spreadsheet application) are better implemented with client-side code.
Additionally, some apps need to function while fully offline.
Since HDAs require a server to render UI, offline-first mobile apps are not a good fit for this architecture.
However, just like on the web, developers can use a hybrid approach to build their mobile app.
The highly dynamic screens can be built with complex client-side logic, while the less dynamic screens can be built with web views or Hyperview.
In this way, developers can spend their <em>complexity budget</em> on the core of the application, and keep the simple screens simple.</p>
</div>
</div>
</aside>
</section>
</section>
<section class="sect2">
<h3 id="_introduction_to_hxml">Introduction to HXML</h3>
<section class="sect3">
<h4 id="_hello_world">Hello World!</h4>
<div class="paragraph">
<p>
HXML was designed to feel natural to web developers coming from HTML.
Let’s take a closer look at the “Hello World” app defined in HXML:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Hello World, revisited</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>styles</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> (3)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span> (4)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My first app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span> (5)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (6)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The root element of the HXML app
</li>
<li>
The element representing a screen of the app
</li>
<li>
The element representing the UI of the screen
</li>
<li>
The element representing the top header of the screen
</li>
<li>
A wrapper element around the content shown on the screen
</li>
<li>
The text content shown on the screen
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Nothing too strange here, right?
Just like HTML, the syntax defines a tree of elements using start tags (<code>&lt;screen&gt;</code>) and end tags (<code>&lt;/screen&gt;</code>).
Elements can contain other elements (<code>&lt;view&gt;</code>) or text (<code>Hello World!</code>).
Elements can also be empty, represented with an empty tag (<code>&lt;styles /&gt;</code>).
However, you’ll notice that the names of the HXML element are different from those in HTML.
Let’s take a closer look at each of those elements to understand what they do.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;doc&gt;</code> is the root of the HXML app.
Think of it as equivalent to the <code>&lt;html&gt;</code> element in HTML.
Note that the <code>&lt;doc&gt;</code> element contains an attribute <code>xmlns="https://hyperview.org/hyperview"</code>.
This defines the default namespace for the doc.
Namespaces are a feature of XML that allow one doc to contain elements defined by different developers.
To prevent conflicts when two developers use the same name for their element, each developer defines a unique namespace.
We will talk more about namespaces when we discuss custom elements &amp; behaviors later in this chapter.
For now, it’s enough to know that elements in a HXML doc without an explicit namespace are considered to be part of the <code><a href="https://hyperview.org/hyperview" class="bare">https://hyperview.org/hyperview</a></code> namespace.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;screen&gt;</code> represents the UI that gets rendered on a single screen of a mobile app.
It’s possible for one <code>&lt;doc&gt;</code> to contain multiple <code>&lt;screen&gt;</code> elements, but we won’t get into that now.
Typically, a <code>&lt;screen&gt;</code> element will contain elements that define the content and styling of the screen.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;styles&gt;</code> defines the styles of the UI on the screen.
We won’t get too much into styling in Hyperview in this chapter.
Suffice it to say, unlike HTML, Hyperview does not use a separate language (CSS) to define styles.
Instead, styling rules such as colors, spacing, layout, and fonts are defined in HXML.
These rules are then explicitly referenced by UI elements, much like using classes in CSS.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;body&gt;</code> defines the actual UI of the screen.
The body includes all text, images, buttons, forms, etc that will be shown to the user.
This is equivalent to the <code>&lt;body&gt;</code> element in HTML.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;header&gt;</code> defines the header of the screen.
Typically in mobile apps, the header includes some navigation (like a back button), and the title of the screen.
It’s useful to define the header separately from the rest of the body.
Some mobile OSes will use a different transition for the header than the rest of the screen content.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;view&gt;</code> is the basic building block for layouts and structure within the screen’s body.
Think of it like a <code>&lt;div&gt;</code> in HTML.
Note that unlike in HTML, a <code>&lt;div&gt;</code> cannot directly contain text.</p>
</div>
<div class="paragraph">
<p>
<code>&lt;text&gt;</code> elements are the only way to render text in the UI.
In this example, “Hello World” is contained within a  <code>&lt;text&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>That’s all there is to define a basic “Hello World” app in HXML.
Of course, this isn’t very exciting.
Let’s cover some other built-in display elements.</p>
</div>
</section>
<section class="sect3">
<h4 id="_ui_elements">UI Elements</h4>
<section class="sect4">
<h5 id="_lists">Lists</h5>
<div class="paragraph">
<p>

A very common pattern in mobile apps is to scroll through a list of items.
The physical properties of a phone screen (long &amp; vertical) and the intuitive gesture of swiping a thumb up &amp; down makes this a good choice for many screens.</p>
</div>
<div class="paragraph">
<p>HXML has dedicated elements for representing lists and items.</p>
</div>
<figure class="listingblock">
<figcaption class="title">List element</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My first item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (3)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My second item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Element representing a list
</li>
<li>
Element representing an item in the list, with a unique key
</li>
<li>
The content of the item in the list.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Lists are represented with two new elements.
The <code>&lt;list&gt;</code> wraps all of the items in the list.
It can be styled like a generic <code>&lt;view&gt;</code> (width, height, etc).
A <code>&lt;list&gt;</code> element only contains <code>&lt;item&gt;</code> elements.
Of course, these represent each unique item in the list.
Note that <code>&lt;item&gt;</code> is required to have a <code>key</code> attribute, which is unique among all items in the list.</p>
</div>
<div class="paragraph">
<p>You might be asking, “Why do we need a custom syntax for lists of items?
Can’t we just use a bunch of <code>&lt;view&gt;</code> elements?”.
Yes, for lists with a small number of items, using nested <code>&lt;views&gt;</code> will work quite well.
However, often the number of items in a list can be long enough to require optimizations to support smooth scrolling interactions.
Consider browsing a feed of posts in a social media app.
As you keep scrolling through the feed, it’s not unusual for the app to show hundreds if not thousands of posts.
At any time, you can flick your finger to scroll to almost any part of the feed.
Mobile devices tend to be memory-constrained.
Keeping the fully-rendered list of items in memory could consume more resources than available.
That’s why both iOS and Android provide APIs for optimized list UIs.
These APIs know which part of the list is currently on-screen. To save memory, they clear out the non-visible list items, and recycle the item UI objects to conserve memory.
By using explicit <code>&lt;list&gt;</code> and <code>&lt;item&gt;</code> elements in HXML, the Hyperview client knows to use these optimized list APIs to make your app more performant.</p>
</div>
<div class="paragraph">
<p>


It’s also worth mentioning that HXML supports section lists.
Section lists are useful for building list-based UIs, where the items in the list can be grouped for the user’s convenience.
For example, a UI showing a restaurant menu could group the offerings by dish type:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Section list element</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section-list</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section-title</span><span class="token punctuation">&gt;</span></span> (3)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Appetizers<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section-title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>French Fries<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Onion Rings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span> (5)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section-title</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Entrees<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section-title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Burger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section-list</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Element representing a list with sections
</li>
<li>
The first section of appetizer offerings
</li>
<li>
Element for the title of the section, rendering the text “Appetizers”
</li>
<li>
An item representing an appetizer
</li>
<li>
A section for entree offerings
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You’ll notice a couple of differences between <code>&lt;list&gt;</code> and <code>&lt;section-list&gt;</code>.
The section list element only contains <code>&lt;section&gt;</code> elements, representing a group of items.
A section can contain a <code>&lt;section-title&gt;</code> element. This is used to render some UI that acts as the header of the section.
This header is “sticky”, meaning it stays on screen while scrolling through items that belong to the corresponding section.
Finally, <code>&lt;item&gt;</code> elements act the same as in the regular list, but can only appear within a <code>&lt;section&gt;</code>.</p>
</div>
</section>
<section class="sect4">
<h5 id="_images">Images</h5>
<div class="paragraph">
<p>

Showing images in Hyperview is pretty similar to HTML, but there are a few differences.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Image element</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profiles/1.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avatar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>The <code>source</code> attribute specifies how to load the image.
Like in HTML, the source can be an absolute or relative URL.
Additionally, the source can be an encoded data URI, for example <code>data:image/png;base64,iVBORw</code>.
However, the source can also be a “local” URL, referring to an image that is bundled as an asset in the mobile app.
The local URL is prefixed with <code>./</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Image element, pointing to local source</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./logo.png<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logo<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>Using Local URLs is an optimization.
Since the images are on the mobile device, they don’t require a network request and will appear quickly.
However, bundling the image with the mobile app binary increases the binary size.
Using local images is a good trade-off for images that are frequently accessed but rarely change.
Good examples include the app logo, or common button icons.</p>
</div>
<div class="paragraph">
<p>The other thing to note is the presence of the <code>style</code> attribute on the <code>&lt;image&gt;</code> element.
In HXML, images are required to have a style that has rules for the image’s <code>width</code> and <code>height</code>.
This is different from HTML, where <code>&lt;img&gt;</code> elements do not need to explicitly set a width and height.
web browsers will re-flow the content of a web page once the image is fetched and the dimensions are known.
While re-flowing content is a reasonable behavior for web-based documents, users do not expect mobile apps to re-flow as content loads.
To maintain a static layout, HXML requires the dimensions to be known before the image loads.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_inputs">Inputs</h4>
<div class="paragraph">
<p>
There’s a lot to cover about inputs in Hyperview.
Since this is meant to be an introduction and not an exhaustive resource, I’ll highlight just a few types of inputs.
Let’s start with an example of the simplest type of input, a text field.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Text field element</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span>
  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
  <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Adam<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First name<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
<span class="token punctuation">/&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The name used when serializing data from this input
</li>
<li>
The style class applied to the UI element
</li>
<li>
The current value set in the field
</li>
<li>
A placeholder to display when the value is empty
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
This element should feel familiar to anyone who’s created a text field in HTML.
One difference is that most inputs in HTML use the <code>&lt;input&gt;</code> element with a <code>type</code> attribute, eg <code>&lt;input type="text"&gt;</code>.
In Hyperview, each input has a unique name, in this case <code>&lt;text-field&gt;</code>.
By using different names, we can use more expressive XML to represent the input.</p>
</div>
<div class="paragraph">
<p>For example, let’s consider a case where we want to render a UI that lets the user select one among several options.
In HTML, we would use a radio button input, something like <code>&lt;input type="radio" name="choice" value="option1" /&gt;</code>.
Each choice is represented as a unique input element.
This never struck me as ideal.
Most of the time, radio buttons are grouped together to affect the same name.
The HTML approach leads to a lot of boilerplate (duplication of <code>type="radio"</code> and <code>name="choice"</code> for each choice).
Also, unlike radio buttons on desktop, mobile OSes don’t provide a strong standard UI for selecting one option.
Most mobile apps use richer, custom UIs for these interactions.
So in HXML, we implement this UI using an element called <code>&lt;select-single&gt;</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Select-single element</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select-single</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>choice<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>option1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Option 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (3)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>option2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Option 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select-single</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Element representing an input where a single choice is selected. The name of the selection is defined once here.
</li>
<li>
Element representing one of the choices. The choice value is defined here.
</li>
<li>
The UI of the selection. In this example, we use text, but we can use any UI elements.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
The <code>&lt;select-single&gt;</code> element is the parent of the input for selecting one choice out of many.
This element contains the <code>name</code> attribute used when serializing the selected choice.
<code>&lt;option&gt;</code> elements within <code>&lt;select-single&gt;</code> represent the available choices.
Note that each <code>&lt;option&gt;</code> element has a <code>value</code> attribute.
When pressed, this will be the selected value of the input.
The <code>&lt;option&gt;</code> element can contain any other UI elements within it.
This means that we’re not hampered by rendering the input as a list of radio buttons with labels.
We can render the options as radios, tags, images, or anything else that would be intuitive for our interface.
HXML styling supports modifiers for pressed and selected states, letting us customize the UI to highlight the selected option.</p>
</div>
<div class="paragraph">
<p>Describing all features of inputs in HXML would take an entire chapter.
Instead, I’ll summarize a few other input elements and their features.</p>
</div>
<div class="paragraph">
<p>


- <code>&lt;select-multiple&gt;</code> works like <code>&lt;select-single&gt;</code>, but it supports toggling multiple options on &amp; off. This replaces checkbox inputs in HTML.
- The <code>&lt;switch&gt;</code> element renders an on/off switch that is common in mobile UIs
- The <code>&lt;date-field&gt;</code> element supports entering in specific dates, and comes with a wide range of customizations for formatting, settings ranges, etc.</p>
</div>
<div class="paragraph">
<p>

Two more things to mention about inputs.
First is the <code>&lt;form&gt;</code> element.
The <code>&lt;form&gt;</code> element is used to group together inputs for serialization.
When a user takes an action that triggers a backend request, the Hyperview client will serialize all inputs in the surrounding <code>&lt;form&gt;</code> and include them in the request.
This is true for both <code>GET</code> and <code>POST</code> requests.
We will cover this in more detail when talking about behaviors later in this chapter.
Also later in this chapter, I’ll talk about support for custom elements in HXML.
With custom elements, you can also create your own input elements.
Custom input elements allow you to build incredible powerful interactions with simple XML syntax that integrates well with the rest of HXML.</p>
</div>
</section>
<section class="sect3">
<h4 id="_styling">Styling</h4>
<div class="paragraph">
<p>
So far, we haven’t mentioned how to apply styling to all of the HXML elements.
We’ve seen from the Hello World app that each <code>&lt;screen&gt;</code> can contain a <code>&lt;styles&gt;</code> element.
Let’s re-visit the Hello World app and fill out the <code>&lt;styles&gt;</code> element.</p>
</div>
<figure class="listingblock">
<figcaption class="title">UI styling example</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>styles</span><span class="token punctuation">&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">flex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">flexDirection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>column<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span> <span class="token attr-name">borderBottomWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">borderBottomColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ccc<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span> <span class="token attr-name">margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h1<span class="token punctuation">"</span></span> <span class="token attr-name">fontSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>styles</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>My first app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h1 info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Element encapsulating all of the styling for the screen
</li>
<li>
Example of a definition of a style class for “body”
</li>
<li>
Applying the “body” style class to a UI element
</li>
<li>
Example of applying multiple style classes (h1 and info) to an element
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You’ll note that in HXML, styling is part of the XML format, rather than using a separate language like CSS.
However, we can draw some parallels between CSS rules and the <code>&lt;style&gt;</code> element.
A CSS rule consists of a selector and declarations.
In the current version of HXML, the only available selector is a class name, indicated by the <code>class</code> attribute.
The rest of the attributes on the <code>&lt;style&gt;</code> element are declarations, consisting of properties and property values.</p>
</div>
<div class="paragraph">
<p>UI elements within the <code>&lt;screen&gt;</code> can reference the <code>&lt;style&gt;</code> rules by adding the class names to their <code>&lt;style&gt;</code> property.
Note the <code>&lt;text&gt;</code> element around “Hello World!” references two style classes: <code>h1</code> and <code>info</code>. The styles from the corresponding classes are merged together in the order they appear on the element.
It’s worth noting that styling properties are similar to those in CSS (color, margins/padding, borders, etc).
Currently, the only available layout engine is based on flexbox.</p>
</div>
<div class="paragraph">
<p>Style rules can get quite verbose.
For the sake of brevity, we won’t include the <code>&lt;styles&gt;</code> element in the rest of the examples in this chapter unless necessary.</p>
</div>
</section>
<section class="sect3">
<h4 id="_custom_elements">Custom elements</h4>
<div class="paragraph">
<p>
The core UI elements that ship with Hyperview are quite basic.
Most mobile apps require richer elements to deliver a great user experience.
Luckily, HXML can easily accommodate custom elements in its syntax.
This is because HXML is really just XML, aka “Extensible Markup Language”.
Extensibility is already built into the format!
Developers are free to define new elements and attributes to represent custom elements.</p>
</div>
<div class="paragraph">
<p>Let’s see this in action with a concrete example.
Assume that we want to add a map element to our Hello World app.
We want the map to display a defined area, and one or more markers at specific coordinates in that area.
Let’s translate these requirements into XML:</p>
</div>
<div class="ulist">
<ul>
<li>
An <code>&lt;area&gt;</code> element will represent the area displayed by the map. To specify the area, the element will include attributes for <code>latitude</code> and <code>longitude</code> for the center of the area, and a <code>latitude-delta</code> and <code>longitude-delta</code> indicating the +/- display area around the center.
</li>
<li>
A <code>&lt;marker&gt;</code> element will represent a marker in the area. The coordinates of the marker will be defined by <code>latitude</code> and <code>longitude</code> attributes on the marker.
</li>
</ul>
</div>
<div class="paragraph">
<p>Using these custom XML elements, an instance of the map in our app might look like this:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Custom elements in HXML</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>area</span> <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>37.8270<span class="token punctuation">"</span></span> <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>122.4230<span class="token punctuation">"</span></span> <span class="token attr-name">latitude-delta</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.1<span class="token punctuation">"</span></span> <span class="token attr-name">longitude-delta</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>marker</span> <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>37.8118<span class="token punctuation">"</span></span> <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-122.4177<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>area</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Custom element representing the area rendered by the map
</li>
<li>
Custom element representing a marker rendered at specific coordinates on the map
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The syntax feels right at home among the core HXML elements.
However, there’s a potential problem.
“area” and “marker” are pretty generic names.
I could see <code>&lt;area&gt;</code> and <code>&lt;marker&gt;</code> elements being used by a customization to render charts &amp; graphs.
If our app renders both maps and charts, the HXML markup would be ambiguous.
What should the client render when it sees <code>&lt;area&gt;</code> or <code>&lt;marker&gt;</code>?</p>
</div>
<div class="paragraph">
<p>
This is where XML namespaces come in. XML namespaces eliminate ambiguity and collisions between elements and attributes used to represent different things.
Remember that the <code>&lt;doc&gt;</code> element declares that <code><a href="https://hyperview.org/hyperview" class="bare">https://hyperview.org/hyperview</a></code> is the default namespace for the entire document.
Since no other elements define namespaces, every element in the example above is part of the <code><a href="https://hyperview.org/hyperview" class="bare">https://hyperview.org/hyperview</a></code> namespace.</p>
</div>
<div class="paragraph">
<p>Let’s define a new namespace for our map elements. Since this namespace will not be the default for the document, we also need to assign the namespace to a prefix we will add to our elements:</p>
</div>
<div class="paragraph">
<p><code>&lt;doc xmlns="https://hyperview.org/hyperview" xmlns:map="https://mycompany.com/hyperview-map"&gt;</code></p>
</div>
<div class="paragraph">
<p>This new attribute declares that the <code>map:</code> prefix is associated with the namespace "https://mycompany.com/hyperview-map".
This namespace could be anything, but remember the goal is to use something unique that won’t have collisions.
Using your company/app domain is a good way to guarantee uniqueness.
Now that we have a namespace and prefix, we need to use it for our elements:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Namespacing the custom elements</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>map</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://mycompany.com/hyperview-map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
        &lt;map:area latitude="37.8270" longitude="122.4230" latitude-delta="0.1" longitude=delta="0.1"&gt; (2)
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">map:</span>marker</span> <span class="token attr-name">latitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>37.8118<span class="token punctuation">"</span></span> <span class="token attr-name">longitude</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-122.4177<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">map:</span>area</span><span class="token punctuation">&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Definition of namespace aliased to “map”
</li>
<li>
Adding the namespace to the “area” start tag
</li>
<li>
Adding the namespace to the “marker” self-closing tag
</li>
<li>
Adding the namespace to the “area” end tag
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>That’s it! If we introduced a custom charting library with “area” and “marker” elements, we would create a unique namespace for those elements as well. Within the HXML doc, we could easily disambiguate <code>&lt;map:area&gt;</code> from <code>&lt;chart:area&gt;</code>.</p>
</div>
<div class="paragraph">
<p>At this point you might be wondering, “how does the Hyperview client know to render a map when my doc includes &lt;map:area&gt;?”
It’s true, so far we only defined the custom element format, but we haven’t implemented the element as a feature in our app.
We will get into the details of implementing custom elements in the next chapter.</p>
</div>
</section>
<section class="sect3">
<h4 id="_behaviors">Behaviors</h4>
<div class="paragraph">
<p>As discussed in earlier chapters, HTML supports two basic types of interactions:</p>
</div>
<div class="ulist">
<ul>
<li>
Clicking a hyperlink: the client will make a GET request and render the response as a new web page.
</li>
<li>
Submitting a form: the client will (typically) make a POST request with the serialized content of the form, and render the response as a new web page.
</li>
</ul>
</div>
<div class="paragraph">
<p>Clicking hyperlinks and submitting forms is enough to build simple web applications.
But relying on just these two interactions limits our ability to build richer UIs.
What if we want something to happen when the user mouses over a certain element, or perhaps when they scroll some content into the viewport?
We can’t do that with basic HTML.
Additionally, both clicks and form submits result in loading a full new web page.
What if we only want to update a small part of the current page?
This is a very common scenario in rich web applications, where users expect to fetch and update content without navigating to a new page.</p>
</div>
<div class="paragraph">
<p>So with basic HTML, interactions (clicks and submits) are limited and tightly coupled to a single action (loading a new page).
Of course, using JavaScript, we can extend HTML and add some new syntax to support our desired interactions.
Htmx does exactly that with a new set of attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
Interactions can be added to any element, not just links and forms.
</li>
<li>
The interaction can be triggered via a click, submit, mouseover, or any other JavaScript event.
</li>
<li>
The actions resulting from the trigger can modify the current page, not just request a new page.
</li>
</ul>
</div>
<div class="paragraph">
<p>By decoupling elements, triggers, and actions, htmx allows us to build rich Hypermedia-driven applications in a way that feels very compatible with HTML syntax and server-side web development.</p>
</div>
<div class="paragraph">
<p>
HXML takes the idea of defining interactions via triggers &amp; actions and builds them into the spec.
We call these interactions “behaviors.”
We use a special <code>&lt;behavior&gt;</code> element to define them.
Here’s an example of a simple behavior that pushes a new mobile screen onto the navigation stack:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Basic behavior</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(1)</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/next-screen<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
  <span class="token punctuation">/&gt;</span></span>
  Press me!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The element encapsulating an interaction on the parent <code>&lt;text&gt;</code> element.
</li>
<li>
The trigger that will execute the interaction, in this case pressing the <code>&lt;text&gt;</code> element.
</li>
<li>
The action that will execute when triggered, in this case pushing a new screen onto the current stack.
</li>
<li>
The href to load on the new screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Let’s break down what’s happening in this example.
First, we have a <code>&lt;text&gt;</code> element with the content "Press me!".
We’ve shown <code>&lt;text&gt;</code> elements before in examples of HXML, so this is nothing new.
But now, the <code>&lt;text&gt;</code> element contains a new child element, <code>&lt;behavior&gt;</code>.
This <code>&lt;behavior&gt;</code> element defines an interaction on the parent <code>&lt;text&gt;</code> element.
It contains two attributes that are required for any behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>trigger</code>: defines the user action that triggers the behavior
</li>
<li>
<code>action</code>: defines what happens when triggered
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, the <code>trigger</code> is set to <code>press</code>, meaning this interaction will happen when the user presses the <code>&lt;text&gt;</code> element.
The <code>action</code> attribute is set to <code>push</code>.
<code>push</code> is an action that will push a new screen onto the navigation stack.
Finally, Hyperview needs to know what content to load on the newly pushed screen.
This is where the <code>href</code> attribute comes in.
Notice we don’t need to define the full URL.
Much like in HTML, the <code>href</code> can be an absolute or relative URL.</p>
</div>
<div class="paragraph">
<p>So that’s a first example of behaviors in HXML.
You may be thinking this syntax seems quite verbose.
Indeed, pressing elements to navigate to a new screen is one of the most common interactions in a mobile app.
It would be nice to have a simpler syntax for the common case.
Luckily, <code>trigger</code> and <code>action</code> attributes have default values of <code>press</code> and <code>push</code>, respectively.
Therefore, they can be omitted to clean up the syntax:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Basic behavior with defaults</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/next-screen<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
  Press me!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
When pressed, this behavior will open a new screen with the given URL.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This markup for the <code>&lt;behavior&gt;</code> will produce the same interaction as the earlier example.
With the default attributes, the <code>&lt;behavior&gt;</code> element looks similar to an anchor <code>&lt;a&gt;</code> in HTML.
But the full syntax achieves our goals of decoupling elements, triggers, and actions:</p>
</div>
<div class="ulist">
<ul>
<li>
Behaviors can be added to any element, they are not limited to links and forms.
</li>
<li>
Behaviors can specify an explicit <code>trigger</code>, not just clicks or form submits.
</li>
<li>
Behaviors can specify an explicit <code>action</code>, not just a request for a new page.
</li>
<li>
Extra attributes like <code>href</code> provide more context for the action.
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, using a dedicated <code>&lt;behavior&gt;</code> element means a single element can define multiple behaviors.
This lets us execute several actions from the same trigger.
Or, we can execute different actions for different triggers on the same element.
We will show examples of the power of multiple behaviors at the end of this chapter.
First we need to show the variety of supported actions and triggers.</p>
</div>
<section class="sect4">
<h5 id="_actions">Actions</h5>
<div class="paragraph">
<p>
Behavior actions in Hyperview fall into four general categories:</p>
</div>
<div class="ulist">
<ul>
<li>
Navigation actions, which load new screens and move between them
</li>
<li>
Update actions, which modify the HXML of the current screen
</li>
<li>
System actions, which interact with OS-level capabilities.
</li>
<li>
Custom actions, which can execute any code you add to the client.
</li>
</ul>
</div>
<section class="sect5">
<h6 id="_navigation_actions">Navigation actions</h6>
<div class="paragraph">
<p>
We’ve already seen the simplest type of action, <code>push</code>.
We classify <code>push</code> as a “navigation action”, since it’s related to navigating screens in the mobile app.
Pushing a screen onto the navigation stack is just one of several navigation actions supported in Hyperview.
Users also need to be able to go back to previous screens, open and close modals, switch between tabs, or jump to arbitrary screens.
Each of these types of navigation is supported through a different value for the <code>action</code> attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>push</code>: Push a new screen into the current navigation stack. This looks like a screen sliding in from the right, on top of the current screen.
</li>
<li>
<code>new</code>: Open a new navigation stack as a modal. This looks like a screen sliding in from the bottom, on top of the current screen.
</li>
<li>
<code>back</code>: This is a complement to the <code>push</code> action. It pops the current screen off of the navigation stack (sliding it to the right).
</li>
<li>
<code>close</code>: This is a complement to the <code>new</code> action. It closes the current navigation stack (sliding it down).
</li>
<li>
<code>reload</code>: Similar to a browser’s “refresh” button, this will re-request the content of the current screen.
</li>
<li>
<code>navigate</code>: This action will attempt to find a screen with the given <code>href</code> already loaded in the app. If the screen exists, the app will jump to that screen. If it doesn’t exist, it will act the same as <code>push</code>.
</li>
</ul>
</div>
<div class="paragraph">
<p><code>push</code>, <code>new</code>, and <code>navigate</code> all load a new screen.
Thus, they require an <code>href</code> attribute so that Hyperview knows what content to request for the new screen.
<code>back</code> and <code>close</code> do not load new screens, and thus do not require the <code>href</code> attribute.
<code>reload</code> is an interesting case.
By default, it will use the URL of the screen when re-requesting the content for the screen.
However, if you want to replace the screen with a different one, you can provide an <code>href</code> attribute with <code>reload</code> on the behavior element.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example “widgets” app that uses several navigation actions on one screen:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Navigation action examples</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
        Back
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>new<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/widgets/new<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
        New Widget
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
      Check for new widgets
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>widget1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/widgets/1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Takes the user to the previous screen
</li>
<li>
Opens a new modal to add a widget
</li>
<li>
Reloads the content of the screen, showing new widgets from the backend
</li>
<li>
Pushes a new screen with details for a specific widget
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Most screens in your app will need a way for the user to backtrack to the previous screen.
This is usually done with a button in the header that uses either a “back” or “close” action, depending on how the screen was opened.
In this example, we’re assuming the widgets screen was pushed onto the navigation stack, so the “back” action is appropriate.
The header contains a second button that allows the user to enter data for a new widget.
Pressing this button will open a modal with a “New Widget” screen.
Since this “New Widget” screen will open as a modal, it will need a corresponding “close” action to dismiss itself and show our “widgets” screen again.
Finally, to see more details about a specific widget, each <code>&lt;item&gt;</code> element contains a behavior with a “push” action.
This action will push a “Widget Detail” screen onto the current navigation stack.
Like in the “Widgets” screen, “Widget Detail” will need a button in the header that uses the “back” action to let the user backtrack.</p>
</div>
<div class="paragraph">
<p>On the web, the browser handles basic navigation needs such as going back/forward, reloading the current page, or jumping to a bookmark.
iOS and Android don’t provide this sort of universal navigation for native mobile apps.
It’s on the app developers to handle this themselves.
Navigation actions in HXML provide an easy but powerful way for developers to build an architecture that makes sense for their app.</p>
</div>
</section>
<section class="sect5">
<h6 id="_update_actions">Update actions</h6>
<div class="paragraph">
<p>
Behavior actions are not just limited to navigating between screens.
They can also be used to change the content on the current screen.
We call these “update actions”.
Much like navigation actions, update actions make a request to the backend.
However, the response is not an entire HXML document, but a fragment of HXML.
This fragment is added to the HXML of the current screen, resulting in an update to the UI.
The <code>action</code> attribute of the <code>&lt;behavior&gt;</code> determines how the fragment gets incorporated into the HXML.
We also need to introduce a new <code>target</code> attribute on <code>&lt;behavior&gt;</code> to define where the fragment gets incorporated in the existing doc.
The <code>target</code> attribute is an ID reference to an existing element on the screen.</p>
</div>
<div class="paragraph">
<p>Hyperview currently supports these update actions, representing different ways to incorporate the fragment into the screen:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>replace</code>: replaces the entire target element with the fragment
</li>
<li>
<code>replace-inner</code>: replaces the children of the target element with the fragment
</li>
<li>
<code>append</code>: adds the fragment after the last child of the target element
</li>
<li>
<code>prepend</code>: adds the fragment before the first child of the target element.
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s look at some examples to make this more concrete.
For these examples, let’s assume our backend accepts <code>GET</code> requests to <code>/fragment</code>, and the response is a fragment of HXML that looks like <code>&lt;text&gt;My fragment&lt;/text&gt;</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Update action examples</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
      Replace
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
      Replace-inner
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
      Append
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prepend<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area4<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (4)
      Prepend
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Replaces the area1 element with fetched fragment
</li>
<li>
Replaces the child elements of area2 with fetched fragment
</li>
<li>
Appends the fetched fragment to area3
</li>
<li>
Prepends the fetched fragment to area4
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In this example, we have a screen with four buttons corresponding to the four update actions: <code>replace</code>, <code>replace-inner</code>, <code>append</code>, <code>prepend</code>.
Below each button, there’s a corresponding <code>&lt;view&gt;</code> containing some text.
Note that the <code>id</code> of each view matches the <code>target</code> on the behaviors of the corresponding button.</p>
</div>
<div class="paragraph">
<p>When the user presses the first button, the Hyperview client makes a request for <code>/fragment</code>.
Next, it looks for the target, ie the element with id “area1”.
Finally, it replaces the <code>&lt;view id="area1"&gt;</code> element with the fetched fragment, <code>&lt;text&gt;My fragment&lt;/text&gt;</code>.
The existing view and text contained in that view will be replaced.
To the user, it will look like “Existing content” was changed to “My fragment”.
In the HXML, the element <code>&lt;view id="area1"&gt;</code> will also be gone.</p>
</div>
<div class="paragraph">
<p>The second button behaves in a similar way to the first one.
However, the <code>replace-inner</code> action does not remove the target element from the screen, it only replaces the children.
This means the resulting markup will look like <code>&lt;view id="area2"&gt;&lt;text&gt;My fragment&lt;/text&gt;&lt;/view&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The third and fourth buttons do not remove any content from the screen.
Instead, the fragment will be added either after (in the case of <code>append</code>) or before (<code>prepend</code>) the children of the target element.</p>
</div>
<div class="paragraph">
<p>For completeness, let’s look at the state of the screen after a user presses all four buttons:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Update actions, after pressing buttons</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      Replace
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (1)

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      Replace-inner
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      Append
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (3)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prepend<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/fragment<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area4<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      Prepend
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Existing content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Fragment completely replaced the target using <code>replace</code> action
</li>
<li>
Fragment replaced the children of the target using <code>replace-inner</code> action
</li>
<li>
Fragment added as last child of the target using <code>append</code> action
</li>
<li>
fragment added as the first child of the target using <code>prepend</code> action
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The examples above show actions making <code>GET</code> requests to the backend.
But these actions can also make <code>POST</code> requests by setting <code>verb="post"</code> on the <code>&lt;behavior&gt;</code> element.
For both <code>GET</code> and <code>POST</code> requests, the data from the parent <code>&lt;form&gt;</code> element will be serialized and included in the request.
For <code>GET</code> requests, the content will be URL-encoded and added as query params.
For <code>POST</code> requests, the content will be form-URL encoded and set on the request body.
Since they support <code>POST</code> and form data, update actions are often used to send data to the backend.</p>
</div>
<div class="paragraph">
<p>So far, our example of update actions require getting new content from the backend and adding it to the screen.
But sometimes we just want to change the state of existing elements.
The most common state to change for an element is its visibility.
Hyperview has <code>hide</code>, <code>show</code>, and <code>toggle</code> actions that do just that.
Like the other update actions, <code>hide</code>, <code>show</code>, and <code>toggle</code> use the <code>target</code> attribute to apply the action to an element on the current screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Show, hide, and toggle actions</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hide<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
      Hide
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
      Show
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toggle<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
      Toggle
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (4)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My fragment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Hides the element with id “area”.
</li>
<li>
Shows the element with id “area”.
</li>
<li>
Toggles the visibility of the element with id “area”.
</li>
<li>
The element targeted by the actions.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In this example, the three buttons labeled “Hide”, “Show”, and “Toggle” will modify the display state of the <code>&lt;view&gt;</code> with ID “area”.
Pressing “Hide” multiple times will have no affect once the view is hidden.
Likewise, pressing “Show” multiple times will have no affect once the view is showing.
Pressing “Toggle” will keep flipping the visibility status of the element between showing and hidden.</p>
</div>
<div class="paragraph">
<p>Hyperview comes with other actions that modify the existing HXML.
We won’t cover them in detail, but I’ll mention them briefly here:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>set-value</code>: this action can set the value of an input element such as <code>&lt;text-field&gt;</code>, <code>&lt;switch&gt;</code>, <code>&lt;select-single&gt;</code>, etc.
</li>
<li>
<code>select-all</code> and <code>unselect-all</code> work with the <code>&lt;select-multiple&gt;</code> element to select/deselect all options.
</li>
</ul>
</div>
</section>
<section class="sect5">
<h6 id="_system_actions">System actions</h6>
<div class="paragraph">
<p>
Some standard Hyperview actions don’t interact with the HXML at all.
Instead, they expose functionality provided by the mobile OS.
For example, both Android and iOS support a system-level “Share” UI.
This UI allows sharing URLs and messages from one app to another app.
Hyperview has a <code>share</code> action to support this interaction.
It involves a custom namespace, and share-specific attributes.</p>
</div>
<figure class="listingblock">
<figcaption class="title">System share action</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>share</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://instawork.com/hyperview-share<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
  <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>share<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
  <span class="token attr-name"><span class="token namespace">share:</span>url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.instawork.com<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token attr-name"><span class="token namespace">share:</span>message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Check out this website!<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
<span class="token punctuation">/&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Defines the namespace for the share action.
</li>
<li>
The action of this behavior will bring up the share sheet.
</li>
<li>
URL to be shared.
</li>
<li>
Message to be shared.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’ve seen XML namespaces when talking about custom elements.
Here, we are using a namespace for the <code>url</code> and <code>message</code> attributes on the <code>&lt;behavior&gt;</code>.
These attribute names are generic and likely used by other components and behaviors, so the namespace ensures there will be no ambiguity.
When pressed, the “share” action will trigger.
The values of the <code>url</code> and <code>message</code> attributes will be passed to the system Share UI.
From there, the user will be able to share the URL &amp; message via SMS, email, or other communication apps.</p>
</div>
<div class="paragraph">
<p>The <code>share</code> action shows how a behavior action can use custom attributes to pass along extra data needed for the interactions.
But some actions require even more structured data.
This can be provided via child elements on the <code>&lt;behavior&gt;</code>.
Hyperview uses this to implement the <code>alert</code> action.
The <code>alert</code> action shows a customized system-level dialog box.
This dialog needs configuration for a title and message, but also for customized buttons.
Each button needs to then trigger another behavior when pressed.
This level of configuration cannot be done with just attributes, so we use custom child elements to represent the behavior of each button.</p>
</div>
<figure class="listingblock">
<figcaption class="title">System alert action</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>alert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview-alert<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
  <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
  <span class="token attr-name"><span class="token namespace">alert:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Continue to next screen?<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token attr-name"><span class="token namespace">alert:</span>message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to navigate to the next screen?<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Continue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (5)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/next<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (6)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">alert:</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cancel<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (7)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>behavior</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Defines the namespace for the alert action.
</li>
<li>
The action of this behavior will bring up a system dialog box.
</li>
<li>
Title of the dialog box.
</li>
<li>
Content of the dialog box.
</li>
<li>
A “continue” option in the dialog box
</li>
<li>
When “continue” is pressed, push a new screen onto the navigation stack.
</li>
<li>
A “cancel” option that dismisses the dialog box.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Like the <code>share</code> behavior, <code>alert</code> uses a namespace to define some attributes and elements.
The <code>&lt;behavior&gt;</code> element itself contains the <code>title</code> and <code>message</code> attributes for the dialog box.
The button options for the dialog are defined using a new <code>&lt;option&gt;</code> element nested in the <code>&lt;behavior&gt;</code>.
Notice that each <code>&lt;option&gt;</code> element has a label, and then optionally contains a <code>&lt;behavior&gt;</code> itself!
This structure of the HXML allows the system dialog to trigger any interaction that can be defined as a <code>&lt;behavior&gt;</code>.
In the example above, pressing the “Continue” button will open a new screen.
But we could just as easily trigger an update action to change the current screen.
We could even open a share sheet, or a second dialog box.
But please don’t do that in a real app!
With great power comes great responsibility.</p>
</div>
</section>
<section class="sect5">
<h6 id="_custom_actions">Custom actions</h6>
<div class="paragraph">
<p>
You can build a lot of mobile UIs with Hyperview’s standard navigation, update, and system actions.
But the standard set may not cover all interactions you will need for your mobile app.
Luckily, the action system is extensible.
In the same way you can add custom elements to Hyperview, you can also add custom behavior actions.
Custom actions have a similar syntax to the <code>share</code> and <code>alert</code> actions, using namespaces for attributes that pass along extra data.
Custom actions also have full access to the HXML of the current screen, so they can modify the state or add/remove elements from the current screen.
In the next chapter, we will create a custom behavior action to enhance our mobile contacts app.</p>
</div>
</section>
</section>
<section class="sect4">
<h5 id="_triggers">Triggers</h5>
<div class="paragraph">
<p>
We’ve already seen the simplest type of trigger, a <code>press</code> on an element. Hyperview supports many other common triggers used in mobile apps.</p>
</div>
<section class="sect5">
<h6 id="_long_press">Long-press</h6>
<div class="paragraph">
<p>Closely related to a press is a long-press.
A behavior with <code>trigger="longPress"</code> will trigger when the user presses and holds on the element.
“Long-press” interactions are often used for shortcuts and power features.
Sometimes, elements will support different actions for both a <code>press</code> and <code>longPress</code>.
This is done using multiple <code>&lt;behavior&gt;</code> elements on the same UI element.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Long-press trigger example</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/next-screen<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>longPress<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/secret-screen<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
  Press (or long-press) me!
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Normal press will open the next screen.
</li>
<li>
Long press will open a different screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In this example, a normal press will open a new screen and request content from <code>/next-screen</code>.
However, a long press will open a new screen with content from <code>/secret-screen</code>.
This is a contrived example for the sake of brevity.
A better UX would be for the long-press to bring up a contextual menu of shortcuts and advanced options.
This could be achieved by using <code>action="alert"</code> and opening a system dialog box with the shortcuts.</p>
</div>
</section>
<section class="sect5">
<h6 id="_load">Load</h6>
<div class="paragraph">
<p>Sometimes we want an action to trigger as soon as the screen loads.
<code>trigger="load"</code> does exactly this.
One use case is to quickly load a shell of the screen, and then fill in the main content on the screen with a second update action.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Load trigger example</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>My app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/content<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (3)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Container element without the actual content
</li>
<li>
Behavior that immediately fires off a request for /content to replace the container
</li>
<li>
Loading UI that appears until the content is fetched and replaced.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In this example, We load a screen with a heading (“My app”) but no content.
Instead, we show a <code>&lt;view&gt;</code> with ID “container” and some “Loading…​” text.
As soon as this screen loads, the behavior with <code>trigger=“load”</code> fires off the <code>replace</code> action.
It requests content from the <code>/content</code> path and replaces the container view with the response.</p>
</div>
</section>
<section class="sect5">
<h6 id="_visible">Visible</h6>
<div class="paragraph">
<p>Unlike <code>load</code>, the <code>visible</code> trigger will only execute the behavior when the element with the behavior is scrolled into the viewport on the mobile device.
The <code>visible</code> action is commonly used to implement an infinite-scroll interaction on a <code>&lt;list&gt;</code> of <code>&lt;item&gt;</code> elements.
The last item in the list includes a behavior with <code>trigger="visible"</code>.
The <code>append</code> action will fetch the next page of items and append them to the list.</p>
</div>
</section>
<section class="sect5">
<h6 id="_refresh">Refresh</h6>
<div class="paragraph">
<p>This trigger captures a “pull to refresh” action on <code>&lt;list&gt;</code> and <code>&lt;view&gt;</code> items.
This interaction is associated with fetching up-to-date content from the backend.
Thus, it’s typically paired with an update or reload action to show the latest data on the screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Pull-to-refresh trigger example</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">scroll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>No items yet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
When the view is pulled down to refresh, reload the screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that adding a behavior with <code>trigger="refresh"</code> to a <code>&lt;view&gt;</code> or <code>&lt;list&gt;</code> will add the pull-to-refresh interaction to the element, including showing a spinner as the element is pulled down.</p>
</div>
</section>
<section class="sect5">
<h6 id="_focus_blur_and_change">Focus, blur, and change</h6>
<div class="paragraph">
<p>These triggers are related to interactions with input elements.
Thus, they will only trigger behaviors attached to elements like <code>&lt;text-field&gt;</code>.
<code>focus</code> and <code>blur</code> will trigger when the user focuses and blurs the input element, respectively.
<code>change</code> will trigger when the value of the input element changes, like when the user types a letter in a text field.
These triggers are often used with behaviors that need to perform some server-side validation on the form fields.
For example, when the user types in a username and then blurs the field, a behavior could trigger on <code>blur</code> to make a request to the backend and check for uniqueness of the username.
If the entered username is not unique, the response could include an error message letting the user know they need to pick a different username.</p>
</div>
</section>
</section>
<section class="sect4">
<h5 id="_using_multiple_behaviors">Using multiple behaviors</h5>
<div class="paragraph">
<p>
Most of the examples shown above attach a single <code>&lt;behavior&gt;</code> to an element.
But there’s no such limitation in Hyperview; elements can define multiple behaviors.
We already saw an example where a single element had different actions triggered on <code>press</code> and <code>longPress</code>.
But we can also trigger multiple actions on the same trigger.</p>
</div>
<div class="paragraph">
<p>In this admittedly contrived example, we want to hide two elements on the screen when pressing the “Hide” button.
The two elements are far apart in the HXML, and cannot be hidden by hiding a common parent element.
But, we can trigger two behaviors at the same time, each one executing a “hide” action but targeting different elements.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Multiple behaviors triggering on press</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Area 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hide<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hide<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
      Hide
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>area2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Area 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Hide element with ID “area1” when pressed.
</li>
<li>
Hide element with ID “area2” when pressed.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Hyperview processes behaviors in the order they appear in the markup.
In this case, the element with ID “area1” will be hidden first, followed by the element with ID “area2”.
Since “hide” is an instantaneous action (ie, it doesn’t make an HTTP request), both elements will appear to hide simultaneously.
But what if we triggered two actions that depend on responses from HTTP requests (like “replace-inner”)?
In that case, each individual action is processed as soon as Hyperview receives the HTTP response.
Depending on network latency, the two actions could take effect in any order, and they are not guaranteed to be applied simultaneously.</p>
</div>
<div class="paragraph">
<p>We’ve seen elements with multiple behaviors and different triggers.
And we’ve seen elements with multiple behaviors with the same trigger.
These concepts can be mixed together too.
It’s not unusual for a production Hyperview app to contain several behaviors, some triggering together and others triggering on different interactions.
Using multiple behaviors with custom actions keeps HXML declarative, without sacrificing functionality.</p>
</div>
</section>
</section>
<section class="sect3">
<h4 id="_summary">Summary</h4>
<div class="paragraph">
<p>We’re covering a lot of new concepts here, and this introduction to HXML just scratches the surface.
To learn more about HXML, we recommend consulting the <a href="https://hyperview.org/docs/reference_index">official reference documentation</a>.
For now, we hope you come away with a few key takeaways.</p>
</div>
<div class="paragraph">
<p>First, HXML looks and feels similar to HTML.
Web developers comfortable with server-side rendering frameworks can use the same techniques to write HXML.
In addition to basic UI elements (<code>&lt;view&gt;</code>, <code>&lt;text&gt;</code>, <code>&lt;image&gt;</code>), HXML specifies elements to implement mobile-specific UIs.
This includes layout patterns (<code>&lt;screen&gt;</code>, <code>&lt;list&gt;</code>, <code>&lt;section-list&gt;</code>) and input elements (<code>&lt;switch&gt;</code>, <code>&lt;select-single&gt;</code>, <code>&lt;select-multiple&gt;</code>).</p>
</div>
<div class="paragraph">
<p>Second, interactions in HXML are defined using behaviors.
Inspired by htmx, <code>&lt;behavior&gt;</code> elements decouple user interactions (triggers) from the resulting actions.
There are three broad categories of behavior actions:</p>
</div>
<div class="ulist">
<ul>
<li>
Navigation actions (<code>push</code>, <code>back</code>) enable navigating between the screens of a mobile app
</li>
<li>
Update actions (<code>replace</code>, <code>append</code>) enable updating a screen with new fragments of HXML requested from the server.
</li>
<li>
System actions (<code>alert</code>, <code>share</code>) enable interacting with system-level functionality on iOS and Android.
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, HXML itself was designed for customization.
Developers can define custom elements and custom behavior actions to expand the possible user interactions with their apps.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_hypermedia_for_mobile">Hypermedia, for Mobile</h3>
<div class="paragraph">
<p>There is a strong case for Hypermedia-Driven Applications on mobile.
Mobile app platforms push developers towards a thick-client architecture.
But apps that use a thick client suffer from the same problems as SPAs on the web.
Using the hypermedia architecture for mobile apps can solve these problems.</p>
</div>
<div class="paragraph">
<p>Hyperview, based on a new format called HXML, offers a path here.
It provides an open-source mobile thin client to render HXML.
And HXML opens a toolkit of elements and patterns that correspond to mobile UIs.
Developers can evolve Hyperview to suit their apps' requirements, while fully embracing the hypermedia architecture.
That’s a win.</p>
</div>
<div class="paragraph">
<p>Yes, hypermedia can work for mobile apps, too.
In the next two chapters we’ll show how by turning the Contact.app web application into a native mobile app using Hyperview.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_hypermedia_notes_maximize_your_server_side_strengths">Hypermedia Notes: Maximize Your Server-Side Strengths</h3>
<div class="paragraph">
<p>In the Hyperview sections of the book, since we aren’t using HTML, we are going to make broader observations on hypermedia
rather than offer HTML-specific advice and thoughts.</p>
</div>
<div class="paragraph">
<p>A big advantage of the hypermedia-driven approach is that it makes the server-side environment far more important when
building your web application. Rather than simply producing JSON, your back end is an integral component in the user
experience of your hypermedia application.</p>
</div>
<div class="paragraph">
<p>Because of this, it makes sense to look deeply into the functionality available there. Many older web frameworks, for example,
have incredibly deep functionality available around producing HTML. Features like server-side caching can make the
difference between an incredibly snappy web application and a sluggish user experience.</p>
</div>
<div class="paragraph">
<p>Take time to learn all the tools available to you.</p>
</div>
<div class="paragraph">
<p>A good rule of thumb is to shoot to have server responses in your hypermedia-driven application take less than 100ms to
complete, and mature server-side frameworks have tools to help make this happen.</p>
</div>
<div class="paragraph">
<p>Server-side environments often have extremely mature mechanisms for factoring (or organizing) your code properly. The
Model/View/Controller pattern is well-developed in most environments, and tools like modules, packages, etc. provide an
excellent way to organize your code.</p>
</div>
<div class="paragraph">
<p>Whereas today’s SPA and mobile user interfaces are typically organized via components, hypermedia-driven applications
are typically organized via template inclusion, where the server-side templates are broken up according to the
hypermedia-rendering needs of the application, and then included in one another as needed. This tends to lead to fewer,
chunkier files than you would find in a component-based application.</p>
</div>
<div class="paragraph">
<p>Another technology to look for are Template Fragments, which allow you to render only part of a template file. This can
reduce even further the number of template files required for your server-side application.</p>
</div>
<div class="paragraph">
<p>A related tip is to take advantage of direct access to the data store. When an application is built using a thick client
approach, the data store typically lives behind a data API (e.g. JSON). This level of indirection often prevents front
end developers from being able to take full advantage of the tools available in the data store. GraphQL, for example,
can help address this issue, but comes with security-related issues that do not appear to be well understood by many developers.</p>
</div>
<div class="paragraph">
<p>When you produce your hypermedia on the server side, on the other hand, the developer creating that hypermedia can have
full access to the data store and take advantage of, for example, joins and aggregation functions in SQL stores.</p>
</div>
<div class="paragraph">
<p>This puts far more expressive power directly in the hands of the developer producing the final hypermedia. Because your
hypermedia API can be structured around your UI needs, you can tune each endpoint to issue as few data store requests as possible.</p>
</div>
<div class="paragraph">
<p>A good rule of thumb is that every request to your server should shoot to have three or fewer data-store accesses.  If
you follow this rule of thumb, your hypermedia-driven application should be extremely snappy.</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_building_a_contacts_app_with_hyperview">Building a Contacts App With Hyperview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Earlier chapters in this book explained the benefits of building apps using the hypermedia architecture.
These benefits were demonstrated by building a robust Contacts web application.
Then, Chapter 11 argued that hypermedia concepts can and should be applied to platforms other than the web.
We introduced Hyperview as an example of a hypermedia format and client specifically designed for building mobile apps.
But you may still be wondering: what is it like to create a fully-featured, production-ready mobile app using Hyperview?
Do we have to learn a whole new language and framework?
In this chapter, we will show Hyperview in action by porting the Contacts web app to a native mobile app.
You will see that many web development techniques (and indeed, much of the code) are completely identical when developing with Hyperview.
How is that possible?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
Our Contacts web app was built with the principle of HATEOAS (Hypermedia as the Engine of Application State).
All of the app’s features (retrieving, searching, editing, and creating contacts) are implemented in the backend (the <code>Contacts</code> Python class).
Our mobile app, built with Hyperview, also leverages HATEOAS and relies on the backend for all of the app’s logic.
That means the <code>Contacts</code> Python class can power our mobile app the same way it powers the web app, without any changes required.
</li>
<li>
The client-server communication in the web app happens using HTTP.
The HTTP server for our web app is written using the Flask framework.
Hyperview also uses HTTP for client-server communication.
So we can re-use the Flask routes and views from the web app for the mobile app as well.
</li>
<li>
The web app uses HTML for its hypermedia format, and Hyperview uses HXML.
HTML and HXML are different formats, but the base syntax is similar (nested tags with attributes).
This means we can use the same templating library (Jinja) for HTML and HXML.
Additionally, many of the concepts of htmx are built into HXML.
We can directly port web app features implemented with htmx (search, infinite loading) to HXML.
</li>
</ol>
</div>
<div class="paragraph">
<p>Essentially, we can re-use almost everything from the web app backend, but we will need to replace the HTML templates with HXML templates.
Most of the sections in this chapter will assume we have the web contacts app running locally and listening on port 5000.
Ready? Let’s create new HXML templates for our mobile app’s UI.</p>
</div>
<section class="sect2">
<h3 id="_creating_a_mobile_app">Creating a mobile app</h3>
<div class="paragraph">
<p>To get started with HXML, there’s one pesky requirement: the Hyperview client.
When developing web applications, you only need to worry about the server because the client (web browser) is universally available.
There’s no equivalent Hyperview client installed on every mobile device.
Instead, we will create our own Hyperview client, customized to only talk to our server.
This client can be packaged up into an Android or iOS mobile app, and distributed through the respective app stores.</p>
</div>
<div class="paragraph">
<p>Luckily, we don’t need to start from scratch to implement a Hyperview client.
The Hyperview code repository comes with a demo backend and a demo client built using Expo.
We will use this demo client but point it to our contacts app backend as a starting point.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-bash" tabindex="0"><code class="language-bash" data-lang="bash">&gt; git clone git@github.com:Instawork/hyperview.git
&gt; cd hyperview/demo
&gt; yarn (1)
&gt; yarn start (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Install dependencies for the demo app
</li>
<li>
Start the Expo server to run the mobile app in the iOS simulator.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>After running <code>yarn start</code>, you will be presented with a prompt asking you to open the mobile app using an Android emulator or iOS simulator.
Select an option based on which developer SDK you have installed.
(The screenshots in this chapter will be taken from the iOS simulator.)
With any luck, you will see the Expo mobile app installed in the simulator.
The mobile app will automatically launch and show a screen saying “Network request failed.”
That’s because by default, this app is configured to make a request to http://0.0.0.0:8085/index.xml, but our backend is listening on port 5000.
To fix this, we can make a simple configuration change in the <code>demo/src/constants.js</code> file:</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token comment">//export const ENTRY_POINT_URL = 'http://0.0.0.0:8085/index.xml'; (1)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ENTRY_POINT_URL</span> <span class="token operator">=</span> <span class="token string">'http://0.0.0.0:5000/'</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The default entry point URL in the demo app
</li>
<li>
Setting the URL to point to our contacts app
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’re not up and running yet.
With our Hyperview client now pointing to the right endpoint, we see a different error, a “ParseError.”
That’s because the backend is responding to requests with HTML content, but the Hyperview client expects an XML response (specifically, HXML).
So it’s time to turn our attention to our Flask backend.
We will go through the Flask views, and replace the HTML templates with HXML templates.
Specifically, let’s support the following features in our mobile app:</p>
</div>
<div class="ulist">
<ul>
<li>
A searchable list of contacts
</li>
<li>
Viewing the details of a contact
</li>
<li>
Editing a contact
</li>
<li>
Deleting a contact
</li>
<li>
Adding a new contact
</li>
</ul>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Zero Client-Configuration in Hypermedia Applications</div>
<div class="paragraph">
<p>
For many mobile apps that use the Hyperview client, configuring this entry point URL is the only on-device code you need to write to deliver a full-featured app.
Think of the entry point URL as the address you type into a web browser to open a web app.
Except in Hyperview, there is no address bar, and the browser is hard-coded to only open one URL.
This URL will load the first screen when a user launches the app.
Every other action the user can take will be declared in the HXML of that first screen.
This minimal configuration is one of the benefits of the Hypermedia-driven architecture.</p>
</div>
<div class="paragraph">
<p>Of course, you may want to write more on-device code to support more features in your mobile app.
We will demonstrate how to do that later in this chapter, in the section called “Extending the Client.”</p>
</div>
</div>
</aside>
</section>
<section class="sect2">
<h3 id="_a_searchable_list_of_contacts">A Searchable List of Contacts</h3>
<div class="paragraph">
<p>We will start building our Hyperview app with the entry point screen, the list of contacts.
For the initial version of this screen, let’s support the following features from the web app:</p>
</div>
<div class="ulist">
<ul>
<li>
display a scrollable list of contacts
</li>
<li>
“search-as-you-type” field above the list
</li>
<li>
“infinite-scroll” to load more contacts as the user scrolls through
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, we will add a “pull-to-refresh” interaction on the list, since users expect this from list UIs in mobile apps.</p>
</div>
<div class="paragraph">
<p>If you recall, all of the pages in the Contacts web app extended a common base template, <code>layout.html</code>.
We need a similar base template for the screens of the mobile app.
This base template will contain the style rules of our UI, and a basic structure common to all screens.
Let’s call it <code>layout.xml</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Base template <code>hv/layout.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>doc</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>screen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>styles</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- omitted for brevity --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>styles</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token attr-name">safe-area</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        {% block header %} (1)
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Contact.app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
        {% endblock %}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        {% block content %}{% endblock %} (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>screen</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>doc</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The header section of the template, with a default title.
</li>
<li>
The content section of the template, to be provided by other templates.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’re using the HXML tags and attributes covered in the previous chapter.
This template sets up a basic screen layout using <code>&lt;doc&gt;</code>, <code>&lt;screen&gt;</code>, <code>&lt;body&gt;</code>, <code>&lt;header&gt;</code>, and <code>&lt;view&gt;</code> tags.
Note that the HXML syntax plays well with the Jinja templating library.
Here, we’re using Jinja’s blocks to define two sections (<code>header</code> and <code>content</code>) that will hold the unique content of a screen.
With our base template completed, we can create a template specifically for the contacts list screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Start of <code>hv/index.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% extends 'hv/layout.xml' %} (1)

{% block content %} (2)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span> (3)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search...<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-field<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (4)
      {% include 'hv/rows.xml' %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
{% endblock %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Extend the base layout template
</li>
<li>
Override the <code>content</code> block of the layout template
</li>
<li>
Create a search form that will issue an HTTP <code>GET</code> to <code>/contacts</code>
</li>
<li>
The list of contacts, using a Jinja <code>include</code> tag.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This template extends the base <code>layout.xml</code>, and overrides the <code>content</code> block with a <code>&lt;form&gt;</code>.
At first, it might seem strange that the form wraps both the <code>&lt;text-field&gt;</code> and the <code>&lt;list&gt;</code> elements.
But remember: in Hyperview, the form data gets included in any request originating from a child element.
We will soon add interactions to the list (pull to refresh) that will require the form data.
Note the use of a Jinja <code>include</code> tag to render the HXML for the rows of contacts in the list (<code>hv/rows.xml</code>).
Just like in the HTML templates, we can use the <code>include</code> to break up our HXML into smaller pieces.
It also allows the server to respond with just the <code>rows.xml</code> template for interactions like searching, infinite scroll, and pull-to-refresh.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>items</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  {% for contact in contacts %} (2)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        {% if contact.first %}
          {{ contact.first }} {{ contact.last }}
        {% elif contact.phone %}
          {{ contact.phone }}
        {% elif contact.email %}
          {{ contact.email }}
        {% endif %}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>items</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
An HXML element that groups a set of <code>&lt;item&gt;</code> elements in a common parent.
</li>
<li>
Iterate over the contacts that were passed in to the template.
</li>
<li>
Render an <code>&lt;item&gt;</code> for each contact, showing the name, phone number, or email.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In the web app, each row in the list showed the contact’s name, phone number, and email address.
But in a mobile app, we have less real-estate.
It would be hard to cram all this information into one line.
Instead, the row just shows the contact’s first and last name, and falls back to email or phone if the name is not set.
To render the row, we again make use of Jinja template syntax to render dynamic text with data passed to the template.</p>
</div>
<div class="paragraph">
<p>We now have templates for the base layout, the contacts screen, and the contact rows.
But we still have to update the Flask views to use these templates.
Let’s take a look at the <code>contacts()</code> view in its current form, written for the web app:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    page = int(request.args.get("page", 1))
    if search:
        contacts_set = Contact.search(search)
        if request.headers.get('HX-Trigger') == 'search':
            return render_template("rows.html", contacts=contacts_set, page=page)
    else:
        contacts_set = Contact.all(page)
    return render_template("index.html", contacts=contacts_set, page=page)</code></pre>
</div>
</figure>
<div class="paragraph">
<p>This view supports fetching a set of contacts based on two query params, <code>q</code> and <code>page</code>.
It also decides whether to render the full page (<code>index.html</code>) or just the contact rows (<code>rows.html</code>) based on the <code>HX-Trigger</code> header.
This presents a minor problem.
The <code>HX-Trigger</code> header is set by the htmx library; there’s no equivalent feature in Hyperview.
Moreover, there are multiple scenarios in Hyperview that require us to respond with just the contact rows:</p>
</div>
<div class="ulist">
<ul>
<li>
searching
</li>
<li>
pull-to-refresh
</li>
<li>
loading the next page of contacts
</li>
</ul>
</div>
<div class="paragraph">
<p>Since we can’t depend on a header like <code>HX-Trigger</code>, we need a different way to detect if the client needs the full screen or just the rows in the response.
We can do this by introducing a new query param, <code>rows_only</code>.
When this param has the value <code>true</code>, the view will respond to the request by rendering the <code>rows.xml</code> template.
Otherwise, it will respond with the <code>index.xml</code> template:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/contacts")
def contacts():
    search = request.args.get("q")
    page = int(request.args.get("page", 1))
    rows_only = request.args.get("rows_only") == "true" (1)
    if search:
        contacts_set = Contact.search(search)
    else:
        contacts_set = Contact.all(page)

    template_name = "hv/rows.xml" if rows_only else "hv/index.xml" (2)
    return render_template(template_name, contacts=contacts_set, page=page)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Check for a new <code>rows_only</code> query param.
</li>
<li>
Render the appropriate HXML template based on <code>rows_only</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>There’s one more change we have to make.
Flask assumes that most views will respond with HTML.
So Flask defaults the <code>Content-Type</code> response header to a value of <code>text/html</code>.
But the Hyperview client expects to receive HXML content, indicated by a <code>Content-Type</code> response header with value <code>application/vnd.hyperview+xml</code>.
The client will reject responses with a different content type.
To fix this, we need to explicitly set the <code>Content-Type</code> response header in our Flask views.
We will do this by introducing a new helper function, <code>render_to_response()</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">def render_to_response(template_name, *args, **kwargs):
    content = render_template(template_name, *args, **kwargs) (1)
    response = make_response(content) (2)
    response.headers['Content-Type'] = 'application/vnd.hyperview+xml' (3)
    return response</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Renders the given template with the supplied arguments and keyword arguments.
</li>
<li>
Create an explicit response object with the rendered template.
</li>
<li>
Sets the response <code>Content-Type</code> header to XML.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>As you can see, this helper function uses <code>render_template()</code> under the hood.
<code>render_template()</code> returns a string.
This helper function uses that string to create an explicit <code>Response</code> object.
The response object has a <code>headers</code> attribute, allowing us to set and change the response headers.
Specifically, <code>render_to_response()</code> sets <code>Content-Type</code> to <code>application/vnd.hyperview+xml</code> so that the Hyperview client recognizes the content.
This helper is a drop-in replacement for <code>render_template</code> in our views.
So all we need to do is update the last line of the <code>contacts()</code> function.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>contacts() function</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">return render_to_response(template_name, contacts=contacts_set, page=page) (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Render the HXML template to an XML response.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>With these changes to the <code>contacts()</code> view, we can finally see the fruits of our labor.
After restarting the backend and refreshing the screen in our mobile app, we can see the contacts screen!</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_list.png" alt="List of contacts showing names and a search bar at the top" loading="lazy">
</div>
<figcaption class="title">Figure 13. Contacts Screen</figcaption>
</figure>
<section class="sect3">
<h4 id="_searching_contacts">Searching Contacts</h4>
<div class="paragraph">
<p>
So far, we have a mobile app that displays a screen with a list of contacts.
But our UI doesn’t support any interactions.
Typing a query in the search field doesn’t filter the list of contacts.
Let’s add a behavior to the search field to implement a search-as-you-type interaction.
This requires expanding <code>&lt;text-field&gt;</code> to add a <code>&lt;behavior&gt;</code> element.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/index.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>q<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Search...<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search-field<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>change<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?rows_only=true<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
    <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">(5)</span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text-field</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This behavior will trigger when the value of the text field changes.
</li>
<li>
When the behavior triggers, the action will replace the content inside the target element.
</li>
<li>
The target of the action is the element with ID <code>contacts-list</code>.
</li>
<li>
The replacement content will be fetched from this URL path.
</li>
<li>
The replacement content will be fetched with the <code>GET</code> HTTP method.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The first thing you’ll notice is that we changed the text field from using a self-closing tag (<code>&lt;text-field /&gt;</code>) to using opening and closing tags (<code>&lt;text-field&gt;…​&lt;/text-field&gt;</code>).
This allows us to add a child <code>&lt;behavior&gt;</code> element to define an interaction.</p>
</div>
<div class="paragraph">
<p>The <code>trigger="change"</code> attribute tells Hyperview that a change to the value of the text field will trigger an action.
Any time the user edits the content of the text field by adding or deleting characters, an action will trigger.</p>
</div>
<div class="paragraph">
<p>The remaining attributes on the <code>&lt;behavior&gt;</code> element define the action.
<code>action="replace-inner"</code> means the action will update content on the screen, by replacing the HXML content of an element with new content.
For <code>replace-inner</code> to do its thing, we need to know two things: the current element on the screen that will be targeted by the action, and the content that will used for the replacement.
<code>target="contacts-list"</code> tells us the ID of the current element.
Note that we set <code>id="contacts-list"</code> on the <code>&lt;list&gt;</code> element in <code>index.xml</code>.
So when the user enters a search query into the text field, Hyperview will replace the content of <code>&lt;list&gt;</code> (a bunch of <code>&lt;item&gt;</code> elements)
with new content (<code>&lt;item&gt;</code> elements that match the search query) received in the relative href response. The domain here is inferred from the domain used to fetch the screen.
Note that <code>href</code> includes our <code>rows_only</code> query param; we want the response to only include the rows and not the entire screen.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_search.png" alt="Searching the letters c a r brings up Carson Gross" loading="lazy">
</div>
<figcaption class="title">Figure 14. Searching for Contacts</figcaption>
</figure>
<div class="paragraph">
<p>That’s all it takes to add search-as-you-type functionality to our mobile app!
As the user types a search query, the client will make requests to the backend and replace the list with the search results.
You may be wondering, how does the backend know the query to use?
The <code>href</code> attribute in the behavior does not include the <code>q</code> param expected by our backend.
But remember, in <code>index.xml</code>, we wrapped the <code>&lt;text-field&gt;</code> and <code>&lt;list&gt;</code> elements with a parent <code>&lt;form&gt;</code> element.
The <code>&lt;form&gt;</code> element defines a group of inputs that will be serialized and included in any HTTP requests triggered by its child elements.
In this case, the <code>&lt;form&gt;</code> element surrounds the search behavior and the text field.
So the value of the <code>&lt;text-field&gt;</code> will be included in our HTTP request for the search results.
Since we are making a <code>GET</code> request, the name and value of the text field will be serialized as a query param.
Any existing query params on the <code>href</code> will be preserved.
This means the actual HTTP request to our backend looks like <code>GET /contacts?rows_only=true&amp;q=Car</code>.
Our backend already supports the <code>q</code> param for searching, so the response will include rows that match the string “Car.”</p>
</div>
</section>
<section class="sect3">
<h4 id="_infinite_scroll_2">Infinite scroll</h4>
<div class="paragraph">
<p>
If the user has hundreds or thousands of contacts, loading them all at once may result in poor app performance.
That’s why most mobile apps with long lists implement an interaction known as “infinite scroll.”
The app loads a fixed number of initial items in the list, let’s say 100 items.
If the user scrolls to the bottom of the list, they see a spinner indicating more content is loading.
Once the content is available, the spinner is replaced with the next page of 100 items.
These items are appended to the list, they don’t replace the first set of items.
So the list now contains 200 items.
If the user scrolls to the bottom of the list again, they will see another spinner, and the app will load the next set of content.
Infinite scroll improves app performance in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
The initial request for 100 items will be processed quickly, with predictable latency.
</li>
<li>
Subsequent requests can also be fast and predictable.
</li>
<li>
If the user doesn’t scroll to the bottom of the list, the app won’t have to make subsequent requests.
</li>
</ul>
</div>
<div class="paragraph">
<p>Our Flask backend already supports pagination on the <code>/contacts</code> endpoint via the <code>page</code> query param.
We just need to modify our HXML templates to make use of this parameter.
To do this, let’s edit <code>rows.xml</code> to add a new <code>&lt;item&gt;</code> below the Jinja for-loop:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>items</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  {% for contact in contacts %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  {% endfor %}
  {% if contacts|length &gt; 0 %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load-more<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load-more<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load-more-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
        <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visible<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
        <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
        <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load-more<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
        <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?rows_only=true&amp;page={{ page + 1 }}<span class="token punctuation">"</span></span> <span class="token attr-name">(5)</span>
        <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span>
      <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spinner</span> <span class="token punctuation">/&gt;</span></span> (6)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  {% endif %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>items</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Include an extra <code>&lt;item&gt;</code> in the list to show the spinner.
</li>
<li>
The item behavior triggers when visible in the viewport.
</li>
<li>
When triggered, the behavior will replace an element on the screen.
</li>
<li>
The element to be replaced is the item itself (ID <code>load-more</code>).
</li>
<li>
Replace the item with the next page of content.
</li>
<li>
The spinner element.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>If the current list of contacts passed to the template is empty, we can assume there’s no more contacts to fetch from the backend.
So we use a Jinja conditional to only include this new <code>&lt;item&gt;</code> if the list of contacts is non-empty.
This new <code>&lt;item&gt;</code> element gets an ID and a behavior.
The behavior defines the infinite scroll interaction.</p>
</div>
<div class="paragraph">
<p>Up until now, we’ve seen <code>trigger</code> values of <code>change</code> and <code>refresh</code>.
But to implement infinite scroll, we need a way to trigger the action when the user scrolls to the bottom of the list.
The <code>visible</code> trigger can be used for this exact purpose.
It will trigger the action when the element with the behavior is visible in the device viewport.
In this case, the new <code>&lt;item&gt;</code> element is the last item in the list, so the action will trigger when the user scrolls down far enough for the item to enter the viewport.
As soon as the item is visible, the action will make an HTTP GET request, and replace the loading <code>&lt;item&gt;</code> element with the response content.</p>
</div>
<div class="paragraph">
<p>Note that our href must include the <code>rows_only=true</code> query param, so that our response will only include HXML for the contact items, and not the entire screen.
Also, we’re passing the <code>page</code> query param, incrementing the current page number to ensure we load the next page.</p>
</div>
<div class="paragraph">
<p>What happens when there’s more than one page of items?
The initial screen will include the first 100 items, plus the “load-more” item at the bottom.
When the user scrolls to the bottom of the screen, Hyperview will request the second page of items (<code>&amp;page=2</code>), and replace the “load-more” item with the new items.
But this second page of items will include a new “load-more” item.
So once the user scrolls through all of the items from the second page, Hyperview will again request more items (<code>&amp;page=3</code>).
And once again, the “load-more” item will be replaced with the new items.
This will continue until all of the items will be loaded on the screen.
At that point, there will be no more contacts to return, the response will not include another “load-more” item, and our pagination is over.</p>
</div>
</section>
<section class="sect3">
<h4 id="_pull_to_refresh">Pull-to-refresh</h4>
<div class="paragraph">
<p>
Pull-to-refresh is a common interaction in mobile apps, especially on screens featuring dynamic content.
It works like this:
At the top of a scrolling view, the user pulls the scrolling content downwards with a swipe-down gesture.
This reveals a spinner “below” the content.
Pulling the content down sufficiently far will trigger a refresh.
While the content refreshes, the spinner remains visible on screen, indicating to the user that the action is still taking place.
Once the content is refreshed, the content retracts back up to its default position, hiding the spinner and letting the user know that the interaction is done.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_refresh_cropped.png" alt="Pulling the contact list down shows the refresh progress indicator" loading="lazy">
</div>
<figcaption class="title">Figure 15. Pull-to-refresh</figcaption>
</figure>
<div class="paragraph">
<p>This pattern is so common and useful that it’s built in to Hyperview via the <code>refresh</code> action.
Let’s add pull-to-refresh to our list of contacts to see it in action.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/index.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span>
  <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
  <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?rows_only=true<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
  <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">(5)</span>
<span class="token punctuation">&gt;</span></span>
  {% include 'hv/rows.xml' %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
This behavior will trigger when the user does a “pull-to-refresh” gesture.
</li>
<li>
When the behavior triggers, this action will replace the content inside the target element.
</li>
<li>
The target of the action is the <code>&lt;list&gt;</code> element itself.
</li>
<li>
The replacement content will be fetched from this URL path.
</li>
<li>
The replacement content will be fetched with the <code>GET</code> HTTP method.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>You’ll notice something unusual in the snippet above: rather than adding a <code>&lt;behavior&gt;</code> element to the <code>&lt;list&gt;</code>, we added the behavior attributes directly to the <code>&lt;list&gt;</code> element.
This is a shorthand notation that’s sometimes useful for specifying single behaviors on an element.
It is equivalent to adding a <code>&lt;behavior&gt;</code> element to the <code>&lt;list&gt;</code> with the same attributes.</p>
</div>
<div class="paragraph">
<p>So why did we use the shorthand syntax here?
It has to do with the action, <code>replace-inner</code>.
Remember, this action replaces all child elements of the target with the new content.
This includes <code>&lt;behavior&gt;</code> elements too!
Let’s say our <code>&lt;list&gt;</code> did contain a <code>&lt;behavior&gt;</code>.
If the user did a search or pull-to-refresh, we would replace the content of <code>&lt;list&gt;</code> with the content from <code>rows.xml</code>.
The <code>&lt;behavior&gt;</code> would no longer be defined on the <code>&lt;list&gt;</code>, and subsequent attempts to pull-to-refresh would not work.
By defining the behavior as attributes of <code>&lt;list&gt;</code>, the behavior will persist even when replacing the items in the list.
Generally, we prefer to use explicit <code>&lt;behavior&gt;</code> elements in HXML.
It makes it easier to define multiple behaviors, and to move the behavior around while refactoring.
But the shorthand syntax is good to apply in situations like this.</p>
</div>
</section>
<section class="sect3">
<h4 id="_viewing_the_details_of_a_contact_2">Viewing The Details Of A Contact</h4>
<div class="paragraph">
<p>Now that our contacts list screen is in good shape, we can start adding other screens to our app.
The natural next step is to create a details screen, which appears when the user taps an item in the contacts list.
Let’s update the template that renders the contact <code>&lt;item&gt;</code> elements, and add a behavior to show the details screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>items</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  {% for contact in contacts %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
  {% endfor %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>items</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Behavior to push the contact details screen onto the stack when pressed.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Our Flask backend already has a route for serving the contact details at <code>/contacts/&lt;contact_id&gt;</code>.
In our template, we use a Jinja variable to dynamically generate the URL path for the current contact in the for-loop.
We also used the “push” action to show the details by pushing a new screen onto the stack.
If you reload the app, you can now tap any contact in the list, and Hyperview will open the new screen.
However, the new screen will show an error message.
That’s because our backend is still returning HTML in the response, and the Hyperview client expects HXML.
Let’s update the backend to respond with HXML and the proper headers.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/contacts/&lt;contact_id&gt;")
def contacts_view(contact_id=0):
    contact = Contact.find(contact_id)
    return render_to_response("hv/show.xml", contact=contact) (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Generate an XML response from a new template file.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Just like the <code>contacts()</code> view, <code>contacts_view()</code> uses <code>render_to_response()</code> to set the <code>Content-Type</code> header on the response.
We’re also generating the response from a new HXML template, which we can create now:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/show.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% extends 'hv/layout.xml' %} (1)

{% block header %} (2)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
    Back
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
{% endblock %}

{% block content %} (4)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>details<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.first }} {{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{contact.phone}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{contact.email}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
{% endblock %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Extend the base layout template.
</li>
<li>
Override the <code>header</code> block of the layout template to include a "Back" button.
</li>
<li>
Behavior to navigate to the previous screen when pressed.
</li>
<li>
Override the <code>content</code> block to show the full details of the selected contact.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The contacts detail screen extends the base <code>layout.xml</code> template, just like we did in <code>index.xml</code>.
This time, we’re overriding content in both the <code>header</code> block and <code>content</code> block.
Overriding the header block lets us add a "Back" button with a behavior.
When pressed, the Hyperview client will unwind the navigation stack and return the user to the contacts list.</p>
</div>
<div class="paragraph">
<p>Note that triggering this behavior is not the only way to navigate back.
The Hyperview client respects navigation conventions on different platforms.
On iOS, users can also navigate to the previous screen by swiping right from the left edge of the device.
On Android, users can also navigate to the previous screen by pressing the hardware back button.
We don’t need to specify anything extra in the HXML to get these interactions.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_detail_cropped.png" alt="Contact detail shows phone number and email as well as back and edit buttons in navbar" loading="lazy">
</div>
<figcaption class="title">Figure 16. Contact Details Screen</figcaption>
</figure>
<div class="paragraph">
<p>With just a few simple changes, we’ve gone from a single-screen app to a multi-screen app.
Note that we didn’t need to change anything in the actual mobile app code to support our new screen.
This is a big deal.
In traditional mobile app development, adding screens can be a significant task.
Developers need to create the new screen, insert it into the appropriate place of the navigation hierarchy, and write code to open the new screen from existing screens.
In Hyperview, we just added a behavior with <code>action="push"</code>.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_editing_a_contact">Editing a Contact</h3>
<div class="paragraph">
<p>So far, our app lets us browse a list of contacts, and view details of a specific contact.
Wouldn’t it be nice to update the name, phone number, or email of a contact?
Let’s add UI to edit contacts as our next enhancement.</p>
</div>
<div class="paragraph">
<p>First we have to figure out how we want to display the editing UI.
We could push a new editing screen onto the stack, the same way we pushed the contact details screen.
But that’s not the best design from a user-experience perspective.
Pushing new screens makes sense when drilling down into data, like going from a list to a single item.
But editing is not a “drill-down” interaction, it’s a mode switch between viewing and editing.
So instead of pushing a new screen, let’s replace the current screen with the editing UI.
That means we need to add a button and behavior that use the <code>reload</code> action.
This button can be added to the header of the contact details screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/show.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% block header %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    Back
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/edit<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
    Edit
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
{% endblock %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
The new “Edit” button.
</li>
<li>
Behavior to reload the current screen with the edit screen when pressed.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Once again, we’re reusing an existing Flask route (<code>/contacts/&lt;contact_id&gt;/edit</code>) for the edit UI, and filling in the contact ID using data passed to the Jinja template.
We also need to update the <code>contacts_edit_get()</code> view to return an XML response based on an HXML template (<code>hv/edit.xml</code>).
We’ll skip the code sample because the needed changes are identical to what we applied to <code>contacts_view()</code> in the previous section.
Instead, let’s focus on the template for the edit screen.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/edit.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% extends 'hv/layout.xml' %}

{% block header %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    Back
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
{% endblock %}

{% block content %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
    {% include 'hv/form_fields.xml' %} (3)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (4)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
      <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
      <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span>
      <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/edit<span class="token punctuation">"</span></span>
      <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
{% endblock %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Form wrapping the input fields and buttons.
</li>
<li>
Container with ID, containing the input fields.
</li>
<li>
Template include to render the input fields.
</li>
<li>
Button to submit the form data and update the input fields container.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Since the edit screen needs to send data to the backend, we wrap the entire content section in a <code>&lt;form&gt;</code> element.
This ensures the form field data will be included in the HTTP requests to our backend.
Within the <code>&lt;form&gt;</code> element, our UI is divided into two sections: the form fields, and the Save button.
The actual form fields are defined in a separate template (<code>form_fields.xml</code>) and added to the edit screen using a Jinja include tag.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/form_fields.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.first }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field-error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span> (2)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>last_name<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Last name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.last }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field-error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- same markup for contact.email and contact.phone --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Text input holding the current value for the contact’s first name.
</li>
<li>
Text element that could display errors from the contact model.
</li>
<li>
Another text field, this time for the contact’s last name.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We omitted the code for the contact’s phone number and email address, because they follow the same pattern as the first and last name.
Each contact field has its own <code>&lt;text-field&gt;</code>, and a <code>&lt;text&gt;</code> element below it to display possible errors.
The <code>&lt;text-field&gt;</code> has two important attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>name</code> defines the name to use when serializing the text-field’s value into form data for HTTP requests.
We are using the same names as the web app from previous chapters (<code>first_name</code>, <code>last_name</code>, <code>phone</code>, <code>email</code>).
That way, we don’t need to make changes in our backend to parse the form data.
</li>
<li>
<code>value</code> defines the pre-filled data in the text field.
Since we are editing an existing contact, it makes sense to pre-fill the text field with the current name, phone, or email.
</li>
</ul>
</div>
<div class="paragraph">
<p>You might be wondering, why did we choose to define the form fields in a separate template (<code>form_fields.xml</code>)?
To understand that decision, we need to first discuss the “Save” button.
When pressed, the Hyperview client will make an HTTP <code>POST</code> request to <code>contacts/&lt;contact_id&gt;/edit</code>, with form data serialized from the <code>&lt;text-field&gt;</code> inputs.
The HXML response will replace the contents of form field container (ID <code>form-fields</code>).
But what should that response be?
That depends on the validity of the form data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
If the data is invalid (e.g., duplicate email address), our UI will remain in the editing mode and show error messages on the invalid fields.
This allows the user to correct the errors and try saving again.
</li>
<li>
If the data is valid, our backend will persist the edits, and our UI will switch back to a display mode (the contact details UI).
</li>
</ol>
</div>
<div class="paragraph">
<p>So our backend needs to distinguish between a valid and invalid edit.
To support these two scenarios, let’s make some changes to the existing <code>contacts_edit_post()</code> view in the Flask app.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/contacts/&lt;contact_id&gt;/edit", methods=["POST"])
def contacts_edit_post(contact_id=0):
    c = Contact.find(contact_id)
    c.update(request.form['first_name'], request.form['last_name'], request.form['phone'], request.form['email']) (1)
    if c.save(): (2)
        flash("Updated Contact!")
        return render_to_response("hv/form_fields.xml", contact=c, saved=True) (3)
    else:
        return render_to_response("hv/form_fields.xml", contact=c) (4)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Update the contact object from the request’s form data.
</li>
<li>
Attempt to persist the updates. This returns <code>False</code> for invalid data.
</li>
<li>
On success, render the form fields template, and pass a <code>saved</code> flag to the template
</li>
<li>
On failure, render the form fields template. Error messages are present on the contact object.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This view already contains conditional logic based on whether the contact model <code>save()</code> succeeds.
If <code>save()</code> fails, we render the <code>form_fields.xml</code> template.
<code>contact.errors</code> will contain error messages for the invalid fields, which will be rendered into the <code>&lt;text style="edit-field-error"&gt;</code> elements.
If <code>save()</code> succeeds, we will also render the <code>form_fields.xml</code> template.
But this time, the template will get a <code>saved</code> flag, indicating success.
We will update the template to use this flag to implement our desired UI: switching the UI back to display mode.</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>hv/form_fields.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  {% if saved %} (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
      <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
      <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
    <span class="token punctuation">/&gt;</span></span>
  {% endif %}

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text-field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>first_name<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>First name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.first }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-field-error<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.errors.first }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- same markup for the other fields --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Only include this behavior after successfully saving a contact.
</li>
<li>
Trigger the behavior immediately.
</li>
<li>
The behavior will reload the entire screen.
</li>
<li>
The screen will be reloaded with the contact details screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The Jinja template conditional ensures that our behavior only renders on successful saves, and not when the screen first opens (or the user submits invalid data).
On success, the template includes a behavior that triggers immediately thanks to <code>trigger="load"</code>.
The action reloads the current screen with the Contact Details screen (from the <code>/contacts/&lt;contact_id&gt;</code> route).</p>
</div>
<div class="paragraph">
<p>The result?
When the user hits “Save”, our backend persists the new contact data, and the screen switches back to the Details screen.
Since the app will make a new HTTP request to get the contact details, it’s guaranteed to show the freshly saved edits.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Why Not Redirect?</div>
<div class="paragraph">
<p>You may remember the web app version of this code behaved a little differently.
On a successful save, the view returned <code>redirect("/contacts/" + str(contact_id))</code>.
This HTTP redirect would tell the web browser to navigate to the contact details page.</p>
</div>
<div class="paragraph">
<p>This approach is not supported in Hyperview.
Why?
A web app’s navigation stack is simple: a linear sequence of pages, with only one active page at a time.
Navigation in a mobile app is considerably more complex.
Mobile apps use a nested hierarchy of navigation stacks, modals, and tabs.
All screens in this hierarchy are active, and may be displayed instantly in response to user actions.
In this world, how would the Hyperview client interpret an HTTP redirect?
Should it reload the current screen, push a new one, or navigate to a screen in the stack with the same URL?</p>
</div>
<div class="paragraph">
<p>Instead of making a choice that would be suboptimal for many scenarios, Hyperview takes a different approach.
Server-controlled redirects are not possible, but the backend can render navigation behaviors into the HXML.
This is what we do to switch from the Edit UI to the Details UI in the code above.
Think of these as client-side redirects, or better yet client-side navigations.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>We now have a working Edit UI in our contacts app.
Users can enter the Edit mode by pressing a button on the contact details screen.
In the Edit mode, they can update the contact’s data and save it to the backend.
If the backend rejects the edits as invalid, the app stays in Edit mode and shows the validation errors.
If the backend accepts and persists the edits, the app will switch back to the details mode, showing the updated contact data.</p>
</div>
<div class="paragraph">
<p>Let’s add one more enhancement to the Edit UI.
It would be nice to let the user switch away from the Edit mode without needing to save the contact.
This is typically done by providing a “Cancel” action.
We can add this as a new button below the “Save” button.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/edit.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/edit<span class="token punctuation">"</span></span> <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
A new Cancel button on the edit screen.
</li>
<li>
When pressed, reload the entire screen.
</li>
<li>
The screen will be reloaded with the contact details screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This is the same technique we used to switch from the edit UI to the details UI upon successfully editing the contact.
But pressing “Cancel” will update the UI faster than pressing “Save.”
On save, the app will first make a <code>POST</code> request to save the data, and then a <code>GET</code> request for the details screen.
Cancelling skips the <code>POST</code>, and immediately makes the <code>GET</code> request.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_edit.png" alt="We can edit the contact details and even see validation errors inline" loading="lazy">
</div>
<figcaption class="title">Figure 17. Contact Edit Screen</figcaption>
</figure>
<section class="sect3">
<h4 id="_updating_the_contacts_list">Updating the Contacts List</h4>
<div class="paragraph">
<p>At this point, we can claim to have fully implemented the Edit UI.
But there’s a problem.
In fact, if we stopped here, users may even consider the app to be buggy!
Why?
It has to do with syncing the app state across multiple screens.
Let’s walk through this series of interactions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
Launch the app to the Contacts List.
</li>
<li>
Press on the contact “Joe Blow” to load his Contact Details.
</li>
<li>
Press Edit to switch to the edit mode, and change the contact’s first name to “Joseph.”
</li>
<li>
Press Save to switch back to viewing mode. The contact’s name is now “Joseph Blow.”
</li>
<li>
Hit the back button to return to the Contacts List.
</li>
</ol>
</div>
<div class="paragraph">
<p>Did you catch the issue?
Our Contacts list is still showing the same list of names as when we launched the app.
The contact we just renamed to “Joseph” is still showing up in the list as “Joe.”
This is a general problem in hypermedia applications.
The client does not have a notion of shared data across different parts of the UI.
Updates in one part of the app will not automatically update other parts of the app.</p>
</div>
<div class="paragraph">
<p>Luckily, there’s a solution to this problem in Hyperview: events.
Events are built into the behavior system, and allow lightweight communication between different parts of the UI.</p>
</div>
<aside class="sidebarblock">
<div class="content">
<div class="title bold secondary-font">Event Behaviors</div>
<div class="paragraph">
<p>
Events are a client-side feature of Hyperview.
In <a href="client-side-scripting/index.html#_hyperscript">Client-Side Scripting</a>, we discussed events while working with HTML, _hyperscript and the DOM.
DOM Elements will dispatch events as a result of user interactions.
Scripts can listen for these events, and respond to them by running arbitrary JavaScript code.</p>
</div>
<div class="paragraph">
<p>Events in Hyperview are a good deal simpler, but they don’t require any scripting and can be defined declaratively in the HXML.
This is done through the behavior system.
Events require adding a new behavior attribute, action type, and trigger type:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>event-name</code>: This attribute of <code>&lt;behavior&gt;</code> defines the name of the event that will either be dispatched or listened for.
</li>
<li>
<code>action="dispatch-event"</code>: When triggered, this behavior will dispatch an event with the name defined by the <code>event-name</code> attribute.
This event is dispatched globally across the entire Hyperview app.
</li>
<li>
<code>trigger="on-event"</code>: This behavior will trigger if another behavior in the app dispatches an event matching the <code>event-name</code> attribute.
</li>
</ul>
</div>
<div class="paragraph">
<p>If a <code>&lt;behavior&gt;</code> element uses <code>action="dispatch-event"</code> or <code>trigger="on-event"</code>, it must also define an <code>event-name</code>.
Note that multiple behaviors can dispatch an event with the same name.
Likewise, multiple behaviors can trigger on the same event name.</p>
</div>
<div class="paragraph">
<p>Let’s look at this simple behavior:</p>
</div>
<div class="paragraph">
<p><code>&lt;behavior trigger="press" action="toggle" target="container" /&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Pressing an element containing this behavior will toggle the visibility of an element with the ID “container”.
But what if the element we want to toggle is on a different screen?
The “toggle” action and target ID lookup only work on the current screen, so this solution wouldn’t work.
The solution is to create two behaviors, one on each screen, communicating via events:</p>
</div>
<div class="ulist">
<ul>
<li>
Screen A: <code>&lt;behavior trigger="press" action="dispatch-event" event-name="button-pressed" /&gt;</code>
</li>
<li>
Screen B: <code>&lt;behavior trigger="on-event" event-name="button-pressed" action="toggle" target="container" /&gt;</code>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pressing an element containing the first behavior (on Screen A) will dispatch an event with the name “button-pressed”.
The second behavior (on Screen B) will trigger on an event with this name, and toggle the visibility of an element with ID “container”.</p>
</div>
<div class="paragraph">
<p>Events have plenty of uses, but the most common is to inform different screens about backend state changes that require the UI to be re-fetched.</p>
</div>
</div>
</aside>
<div class="paragraph">
<p>We now know enough about Hyperview’s event system to solve the bug in our app.
When the user saves a change to a contact, we need to dispatch an event from the Details screen.
And the Contacts screen needs to listen to that event, and reload itself to reflect the edits.
Since the <code>form_fields.xml</code> template already gets the <code>saved</code> flag when the backend successfully saves a contact, it’s a good place to dispatch the event:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet from <code>hv/form_fields.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% if saved %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dispatch-event<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">event-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-updated<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
  <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(4)</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}<span class="token punctuation">"</span></span>
  <span class="token punctuation">/&gt;</span></span>
{% endif %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Trigger the behavior immediately.
</li>
<li>
The behavior will dispatch an event.
</li>
<li>
The event name is "contact-updated".
</li>
<li>
The existing behavior to show the Details UI.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, we just need the contacts list to listen for the <code>contact-updated</code> event, and reload itself:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet from <code>hv/index.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>on-event<span class="token punctuation">"</span></span> <span class="token attr-name">(1)</span>
    <span class="token attr-name">event-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-updated<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts?rows_only=true<span class="token punctuation">"</span></span>
    <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span>
  <span class="token punctuation">/&gt;</span></span>
  <span class="token comment">&lt;!-- text-field omitted --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contacts-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {% include 'hv/rows.xml' %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Trigger the behavior on event dispatch.
</li>
<li>
Trigger the behavior for dispatched events with the name “contact-updated”.
</li>
<li>
When triggered, replace the contents of the <code>&lt;list&gt;</code> element with rows from the backend.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Any time the user edits a contact, the Contacts List screen will update to reflect the edits.
The addition of these two <code>&lt;behavior&gt;</code> elements fixes the bug: the Contacts List screen will correctly show “Joseph Blow” in the list. Note that we intentionally added the new behavior inside the <code>&lt;form&gt;</code> element.
The ensures the triggered request will preserve any search query.</p>
</div>
<div class="paragraph">
<p>To show what we mean, let’s revisit the set of steps that demonstrated the buggy behavior.
Assume that before pressing on “Joe Blow,” the user had searched the contacts by typing “Joe” in the search field.
When the user later updates the contact to “Joseph Blow”, our template dispatches the “contact-updated” event, which triggers the <code>replace-inner</code> behavior on the contact list screen.
Due to the parent <code>&lt;form&gt;</code> element, the search query “Joe” will be serialized with the request: <code>GET /contacts?rows_only=true&amp;q=Joe</code>.
Since the name “Joseph” doesn’t match the query “Joe”, the contact we edited will not appear in the list (until the user clears out the query).
Our app’s state remains consistent across our backend and all active screens.</p>
</div>
<div class="paragraph">
<p>Events introduce a level of abstraction to behaviors.
So far, we’ve seen that editing a contact will cause the list of contacts to refresh.
But the list of contacts should also refresh after other actions, such as deleting a contact or adding a new contact.
As long as our HXML responses for deletion or creation include a behavior to dispatch a <code>contact-updated</code> event, then we will get the desired refresh behavior on the contacts list screen.</p>
</div>
<div class="paragraph">
<p>The screen doesn’t care what causes the <code>contact-updated</code> event to be dispatched.
It just knows what it needs to do when it happens.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_deleting_a_contact_2">Deleting a Contact</h3>
<div class="paragraph">
<p>Speaking of deleting a contact, this is a good next feature to implement.
We will let users delete a contact from the Edit UI.
So let’s add a new button to <code>edit.xml</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/edit.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>replace-inner<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/edit<span class="token punctuation">"</span></span> <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span>
    <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/delete<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
  <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label button-label-delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
New Delete Contact button on the edit screen.
</li>
<li>
When pressed, append HXML to a container on the screen.
</li>
<li>
The HXML will be fetched by making a <code>POST /contacts/&lt;contact_id&gt;/delete</code> request.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The HXML for the Delete button is pretty similar to the Save button, but there are a few subtle differences.
Remember, pressing the Save button results in one of two expected outcomes: failing and showing validation errors on the form, or succeeding and switching to the contact details screen.
To support the first outcome (failing and showing validation errors), the save behavior replaces the contents of the <code>&lt;view id="form-fields"&gt;</code> container with a re-rendered version of <code>form_fields.xml</code>.
Therefore, using the <code>replace-inner</code> action makes sense.</p>
</div>
<div class="paragraph">
<p>Deletion does not involve a validation step, so there’s only one expected outcome: successfully deleting the contact.
When deletion succeeds, the contact no longer exists.
It doesn’t make sense to show the edit UI or contact details for a non-existent contact.
Instead, our app will navigate back to the previous screen (the contacts list).
Our response will only include behaviors that trigger immediately, there’s no UI to change.
Therefore, using the <code>append</code> action will preserve the current UI while Hyperview runs the actions.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/deleted.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dispatch-event<span class="token punctuation">"</span></span> <span class="token attr-name">event-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-updated<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
On load, dispatch the <code>contact-updated</code> event to update the contact lists screen.
</li>
<li>
Navigate back to the contacts list screen.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Note that in addition to behavior to navigate back, this template also includes a behavior to dispatch the <code>contact-updated</code> event.
In the previous chapter section, we added a behavior to <code>index.xml</code> to refresh the list when that event is dispatched.
By dispatching the event after a deletion, we will make sure the deleted contact gets removed from the list.</p>
</div>
<div class="paragraph">
<p>Once again, we’ll skip over the changes to the Flask backend.
Suffice it to say, we will need to update the <code>contacts_delete()</code> view to respond with the <code>hv/deleted.xml</code> template.
And we need to update the route to support <code>POST</code> in addition to <code>DELETE</code>, since the Hyperview client only understands <code>GET</code> and <code>POST</code>.</p>
</div>
<div class="paragraph">
<p>We now have a fully functioning deletion feature!
But it’s not the most user-friendly: it takes one accidental tap to permanently delete a contact.
For destructive actions like deleting a contact, it’s always a good idea to ask the user for confirmation.</p>
</div>
<div class="paragraph">
<p>We can add a confirmation to the delete behavior by using the <code>alert</code> system action described in the previous chapter.
As you recall, the <code>alert</code> action will show a system dialog box with buttons that can trigger other behaviors.
All we have to do is wrap the delete <code>&lt;behavior&gt;</code> in a behavior that uses <code>action="alert"</code>.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Delete button in <code>hv/edit.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(1)</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>alert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview-alert<span class="token punctuation">"</span></span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">alert:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Confirm delete<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">alert:</span>message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete {{ contact.first }}?<span class="token punctuation">"</span></span>
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Confirm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(3)</span>
        <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
        <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span>
        <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-fields<span class="token punctuation">"</span></span>
        <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}/delete<span class="token punctuation">"</span></span>
        <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">alert:</span>option</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cancel<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (4)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>behavior</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label button-label-delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete Contact<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Pressing "Delete" triggers an action to show the system dialog with the given title and message.
</li>
<li>
The first pressable option in the system dialog.
</li>
<li>
Pressing the first option will trigger contact deletion.
</li>
<li>
The second pressable option has no behavior, so it only closes the dialog.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Unlike before, pressing the delete button will not have an immediate effect.
Instead, the user will be presented with the dialog box and asked to confirm or cancel.
Our core deletion behavior didn’t change, we just chained it from another behavior.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_delete_cropped.png" alt="Deleting shows a native confirmation dialog" loading="lazy">
</div>
<figcaption class="title">Figure 18. Delete Contact confirmation</figcaption>
</figure>
</section>
<section class="sect2">
<h3 id="_adding_a_new_contact_2">Adding a New Contact</h3>
<div class="paragraph">
<p>Adding a new contact is the last feature we want to support in our mobile app.
And luckily, it’s also the easiest.
We can reuse the concepts (and even some templates) from features we’ve already implemented.
In particular, adding a new contact is very similar to editing an existing contact.
Both features need to:</p>
</div>
<div class="ulist">
<ul>
<li>
Show a form to collect information about the contact.
</li>
<li>
Have a way to save the entered information.
</li>
<li>
Show validation errors on the form.
</li>
<li>
Persist the contact when there are no validation errors.
</li>
</ul>
</div>
<div class="paragraph">
<p>Since the functionality is so similar, we’ll summarize the changes here without showing the code.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update <code>index.xml</code>.</p>
<div class="ulist">
<ul>
<li>
Override the <code>header</code> block to add a new “Add” button.
</li>
<li>
Include a behavior in the button. When pressed, push a new screen as a modal by using <code>action="new"</code>, and request the screen content from <code>/contacts/new</code>.
</li>
</ul>
</div>
</li>
<li>
<p>Create a template <code>hv/new.xml</code>.</p>
<div class="ulist">
<ul>
<li>
Override the header block to include a button that closes the modal, using <code>action="close"</code>.
</li>
<li>
Include the <code>hv/form_fields.xml</code> template to render empty form fields
</li>
<li>
Add a “Add Contact” button below the form fields.
</li>
<li>
Include a behavior in the button. When pressed, make a <code>POST</code> request to <code>/contacts/new</code>, and use <code>action="replace-inner"</code> to update the form fields.
</li>
</ul>
</div>
</li>
<li>
<p>Update the Flask view.</p>
<div class="ulist">
<ul>
<li>
Change <code>contacts_new_get()</code> to use <code>render_to_response()</code> with the <code>hv/new.xml</code> template.
</li>
<li>
Change <code>contacts_new()</code> to use <code>render_to_response()</code> with the <code>hv/form_fields.xml</code> template. Pass <code>saved=True</code> when rendering the template after successfully persisting the new contact.
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>By reusing <code>form_fields.xml</code> for both editing and adding a contact, we get to reuse some code and ensure the two features have a consistent UI.
Also, our “Add Contact” screen will benefit from the “saved” logic that’s already a part of <code>form_fields.xml</code>.
After successfully adding a new contact, the screen will dispatch the <code>contact-updated</code> event, which will refresh the contacts list and show the newly added contact.
The screen will reload itself to show the Contact Details.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_add.png" alt="Form to enter contact details pops up from bottom of screen" loading="lazy">
</div>
<figcaption class="title">Figure 19. Add Contact modal</figcaption>
</figure>
</section>
<section class="sect2">
<h3 id="_deploying_the_app">Deploying the App</h3>
<div class="paragraph">
<p>
With the completion of the contact creation UI, we have a fully implemented mobile app.
It supports searching a list of contacts, viewing the details of a contact, editing and deleting a contact, and adding a new contact.
But so far, we’ve been developing the app using a simulator on our desktop computer.
How can we see it running on a mobile device?
And how can we get it into the hands of our users?</p>
</div>
<div class="paragraph">
<p>To see the app running on a physical device, let’s take advantage of the Expo platform’s app preview functionality.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
Download the Expo Go app on an Android or iOS device.
</li>
<li>
Restart the Flask app, binding to an interface accessible on your network.
This might look something like <code>flask run --host 192.168.7.229</code>, where the host is your computer’s IP address on the network.
</li>
<li>
Update the Hyperview client code so that <code>ENTRY_POINT_URL</code> (in <code>demo/src/constants.js</code>) points to the IP and port that the Flask server is bound to.
</li>
<li>
After running <code>yarn start</code> in the Hyperview demo app, you will see a QR code printed in the console, with instructions on how to scan it on Android and iOS.
</li>
</ol>
</div>
<div class="paragraph">
<p>Once you scan the QR code, the full app will run on the device.
As you interact with the app, you will see HTTP requests made to the Flask server.
You can even use the physical device during development.
Any time you make a change in the HXML, just reload the screen to see the UI updates.</p>
</div>
<div class="paragraph">
<p>So we have the app running on a physical device, but it’s still not production ready.
To get the app into the hands of our users, there’s a few things we need to do:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
Deploy our backend in production.
We need to use a production-grade web server like Gunicorn instead of the Flask development server.
And we should run our app on a machine reachable on the Internet, most likely using a cloud provider like AWS or Heroku.
</li>
<li>
Create standalone binary apps.
By following the instructions from the Expo project, we can create a <code>.ipa</code> or <code>.apk</code> file, for the iOS and Android platforms.
Remember to update <code>ENTRY_POINT_URL</code> in the Hyperview client to point to the production backend.
</li>
<li>
Submit our binaries to the iOS App Store or Google Play Store, and wait for app approval.
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the app is approved, congratulations!
Our mobile app can be downloaded by Android and iOS users.
And here’s the best part:
Because our app uses the hypermedia architecture, we can add features to our app by simply updating the backend.
The UI and interactions are completely specified with the HXML generated from server-side templates.
Want to add a new section to a screen?
Just update an existing HXML template.
Want to add a new type of screen to the app?
Create a new route, view, and HXML template.
Then, add a behavior to an existing screen that will open the new screen.
To push these changes to your users, you just need to re-deploy the backend.
Our app knows how to interpret HXML, and that’s enough for it to understand how to handle the new features.</p>
</div>
</section>
<section class="sect2">
<h3 id="_one_backend_multiple_hypermedia_formats">One Backend, Multiple Hypermedia formats</h3>
<div class="paragraph">
<p>To create a mobile app using the hypermedia architecture, we started with the web-based contacts app and made a few changes, primarily replacing HTML templates with HXML templates.
But in the process of porting the backend to serve our mobile app, we lost the web application functionality.
Indeed, if you tried to visit <code><a href="http://0.0.0.0:5000" class="bare">http://0.0.0.0:5000</a></code> in a web browser, you would see a jumble of text and XML markup.
That’s because web browsers don’t know how to render plain XML, and they certainly don’t know how to interpret the tags and attributes of HXML to render an app.
It’s a shame, because the Flask code for the web application and mobile app are nearly identical.
The database and model logic are shared, and most of the views are unchanged as well.</p>
</div>
<div class="paragraph">
<p>At this point you’re surely wondering: is it possible to use the same backend to serve both a web application and mobile app?
The answer is yes!
In fact, this is one of the benefits of using a hypermedia architecture across multiple platforms.
We don’t need to port any client-side logic from one platform to another, we just need to respond to requests with the appropriate Hypermedia format.
To do this, we will utilize content negotiation built into HTTP.</p>
</div>
<section class="sect3">
<h4 id="_what_is_content_negotiation">What is Content Negotiation?</h4>
<div class="paragraph">
<p>Imagine a German speaker and Japanese speaker both visit <code><a href="https://google.com" class="bare">https://google.com</a></code> in their web browser.
They will see the Google home page localized in German and Japanese, respectively.
How does Google know to return a different version of the homepage based on the user’s preferred language?
The answer lies in the REST architecture, and how it separates the concepts of resources and representations.</p>
</div>
<div class="paragraph">
<p>In the REST architecture, the Google homepage is considered to be a single “resource,” represented by a unique URL.
However, that single resource can have multiple “representations.”
Representations are variations on how the content of the resource is presented to the client.
The German and Japanese versions of the Google homepage are two representations of the same resource.
To determine the best representation of a resource to return, HTTP clients and servers engage in a process called “content negotiation.”
It works like this:</p>
</div>
<div class="ulist">
<ul>
<li>
Clients specify the preferred representation through <code>Accept-*</code> request headers.
</li>
<li>
The server tries to match the preferred representation as best it can, and communicates back the chosen representation using <code>Content-*</code>.
</li>
</ul>
</div>
<div class="paragraph">
<p>In the Google homepage example, the German speaker uses a browser that is set to prefer content localized for German.
Every HTTP request made by the web browser will include a header <code>Accept-Language: de-DE</code>.
The server sees the request header, and it will return a response localized for German (if it can).
The HTTP response will include a <code>Content-Language: de-DE</code> header to inform the client of the language of the response content.</p>
</div>
<div class="paragraph">
<p>Language is just one factor for resource representation.
More importantly for us, resources can be represented using different content types, such as HTML or HXML.
Content negotiation over content type is done using the <code>Accept</code> request header and <code>Content-Type</code> response header.
Web browsers set <code>text/html</code> as the preferred content type in the <code>Accept</code> header.
The Hyperview client sets <code>application/vnd.hyperview+xml</code> as the preferred content type.
This gives our backend a way to distinguish requests coming from a web browser or Hyperview client, and serve the appropriate content to each.</p>
</div>
<div class="paragraph">
<p>There are two main approaches to content negotiation: fine-grained and global.</p>
</div>
</section>
<section class="sect3">
<h4 id="_approach_1_template_switching">Approach 1: Template Switching</h4>
<div class="paragraph">
<p>When we ported the Contacts app from the web to mobile, we kept all of the Flask views but made some minor changes.
Specifically, we introduced a new function <code>render_to_response()</code> and called it in the return statement of each view.
Here’s the function again to refresh your memory:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">def render_to_response(template_name, *args, **kwargs):
    content = render_template(template_name, *args, **kwargs)
    response = make_response(content)
    response.headers['Content-Type'] = 'application/vnd.hyperview+xml'
    return response</code></pre>
</div>
</figure>
<div class="paragraph">
<p><code>render_to_response()</code> renders a template with the given context, and turns it into an Flask response object with the appropriate Hyperview <code>Content-Type</code> header.
Obviously, the implementation is highly-specific to serving our Hyperview mobile app.
But we can modify the function to do content negotiation based on the request’s <code>Accept</code> header:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">HTML_MIME = 'text/html'
HXML_MIME = 'application/vnd.hyperview+xml'

def render_to_response(html_template_name, hxml_template_name, *args, **kwargs): (1)
    response_type = request.accept_mimetypes.best_match([HTML_MIME, HXML_MIME], default=HTML_MIME) (2)
    template_name = hxml_template_name if response_type == HXML_MIME else html_template_name (3)
    content = render_template(template_name, *args, **kwargs)
    response = make_response(content)
    response.headers['Content-Type'] = response_type (4)
    return response</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Function signature takes two templates, one for HTML and one for HXML.
</li>
<li>
Determine whether the client wants HTML or HXML.
</li>
<li>
Select the template based on the best match for the client.
</li>
<li>
Set the <code>Content-Type</code> header based on the best match for the client.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Flask’s request object exposes an <code>accept_mimetypes</code> property to help with content negotiation.
We pass our two content MIME types to <code>request.accept_mimetypes.best_match()</code> and get back the MIME type that works for our client.
Based on the best matching MIME type, we choose to either render an HTML template or HXML template.
We also make sure to set the <code>Content-Type</code> header to the appropriate MIME type.
The only difference in our Flask views is that we need to provide both an HTML and HXML template:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/contacts/&lt;contact_id&gt;")
def contacts_view(contact_id=0):
    contact = Contact.find(contact_id)
    return render_to_response("show.html", "hv/show.xml", contact=contact) (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Template switching between an HTML and HXML template, based on the client.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>After updating all of the Flask views to support both templates, our backend will support both web browsers and our mobile app!
This technique works well for the Contacts app because the screens in the mobile app map directly to pages of the web application.
Each app has a dedicated page (or screen) for listing contacts, showing and editing details, and creating a new contact.
This meant the Flask views could be kept as-is without major changes.</p>
</div>
<div class="paragraph">
<p>But what if we wanted to re-imagine the Contacts app UI for our mobile app?
Perhaps we want the mobile app to use a single screen, with rows that expanded in-line to support viewing and editing the information?
In situations where the UI diverges between platforms, Template Switching becomes cumbersome or impossible.
We need a different approach to have one backend serve both hypermedia formats.</p>
</div>
</section>
<section class="sect3">
<h4 id="_approach_2_the_redirect_fork">Approach 2: The Redirect Fork</h4>
<div class="paragraph">
<p>If you recall, the Contacts web app has an <code>index</code> view, routed from the root path <code>/</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/")
def index():
    return redirect("/contacts") (1)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Redirect requests from "/" to "/contacts"
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>When someone requests to the root path of the web application, Flask redirects them to the <code>/contacts</code> path.
This redirect also works in our Hyperview mobile app.
The Hyperview client’s <code>ENTRY_POINT_URL</code> points to <code><a href="http://0.0.0.0:5000/" class="bare">http://0.0.0.0:5000/</a></code>, and the server redirects it to <code><a href="http://0.0.0.0:5000/contacts" class="bare">http://0.0.0.0:5000/contacts</a></code>.
But there’s no law that says we need to redirect to the same path in our web application and mobile app.
What if we used the <code>Accept</code> header to redirect to decide on the redirect path?</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">HTML_MIME = 'text/html'
HXML_MIME = 'application/vnd.hyperview+xml'

@app.route("/")
def index():
    response_type = request.accept_mimetypes.best_match([HTML_MIME, HXML_MIME], default=HTML_MIME) (1)
    if response_type == HXML_MIME:
      return redirect("/mobile/contacts") (2)
    else:
      return redirect("/web/contacts") (3)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Determine whether the client wants HTML or HXML.
</li>
<li>
If the client wants HXML, redirect them to <code>/mobile/contacts</code>.
</li>
<li>
If the client wants HTML, redirect them to <code>/web/contacts</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The entry point is a fork in the road: if the client wants HTML, we redirect them to one path.
If the client wants HXML, we redirect them to a different path.
These redirects would be handled by different Flask views:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>app.py</code></figcaption>
<div class="content">
<pre class="highlight language-py" tabindex="0"><code class="language-py" data-lang="py">@app.route("/mobile/contacts")
def mobile_contacts():
  # Render an HXML response

@app.route("/web/contacts")
def web_contacts():
  # Render an HTML response</code></pre>
</div>
</figure>
<div class="paragraph">
<p>The <code>mobile_contacts()</code> view would render an HXML template with a list of contacts.
Tapping a contact item would open a screen requested from <code>/mobile/contacts/1</code>, handled by a view <code>mobile_contacts_view</code>.
After the initial fork, all subsequent requests from our mobile app go to paths prefixed with <code>/mobile/</code>, and get handled by mobile-specific Flask views.
Likewise, all subsequent requests from the web app go to paths prefixed with <code>/web/</code>, and get handled by web-specific Flask views.
(Note that in practice, we would want to separate the web and mobile views into separate parts of our codebase: <code>web_app.py</code> and <code>mobile_app.py</code>. We may also choose not to prefix the web paths with <code>/web/</code>, if we want more elegant URLs displayed in the browser’s address bar.)</p>
</div>
<div class="paragraph">
<p>You may be thinking that the Redirect Fork leads to a lot of code duplication.
After all, we need to write double the number of views: one set for the web application, and one set for the mobile app.
That is true, which is why the Redirect Fork is only preferred if the two platforms require a disjointed set of view logic.
If the apps are similar on both platforms, Template Switching will save a lot of time and keep the apps consistent.
Even if we need to use the Redirect Fork, the bulk of the logic in our models can be shared by both sets of views.</p>
</div>
<div class="paragraph">
<p>In practice, you may start out using Template Switching, but then realize you need to implement a fork for platform-specific features.
In fact, we’re already doing that in the Contacts app.
When porting the app from web to mobile, we didn’t bring over certain features like archiving functionality.
The dynamic archive UI is a power feature that wouldn’t make sense on a mobile device.
Since our HXML templates don’t expose any entry points to the Archive functionality, we can treat it as “web-only” and not worry about supporting it in Hyperview.</p>
</div>
</section>
</section>
<section class="sect2">
<h3 id="_contact_app_in_hyperview">Contact.app, in Hyperview</h3>
<div class="paragraph">
<p>We’ve covered a lot of ground in this chapter.
Take a breath and take stock of how far we’ve come: we ported the core functionality of the Contact.app web application to mobile.
And we did it by re-using much of our Flask backend and while sticking with Jinja templating.
We again saw the utility of events for connecting different aspects of an application.</p>
</div>
<div class="paragraph">
<p>We’re not done yet.
In the next chapter we’ll implement custom behaviors and UI elements to finish our mobile Contact.app.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_hypermedia_notes_api_endpoints">Hypermedia Notes: API Endpoints</h3>
<div class="paragraph">
<p>Unlike a JSON API, the hypermedia API you produce for your hypermedia-driven application should feature endpoints
specialized for your particular application’s UI needs.</p>
</div>
<div class="paragraph">
<p>Because hypermedia APIs are not designed to be consumed by general-purpose clients you can set aside the pressure to keep
them generalized and produce the content specifically needed for your application. Your endpoints should be optimized to
support your particular applications UI/UX needs, not for a general-purpose data-access model for your domain model.</p>
</div>
<div class="paragraph">
<p>A related tip is that, when you have a hypermedia-based API, you can aggressively refactor your API in a way that is
heavily discouraged when writing JSON API-based SPAs or mobile clients. Because hypermedia-based applications use
Hypermedia As The Engine Of Application State, you are able and, in fact, encouraged, to change the shape of them as
your application developers and as use cases change.</p>
</div>
<div class="paragraph">
<p>A great strength of the hypermedia approach is that you can completely rework your API to adapt to new needs over
time without needing to version the API or even document it.  Take advantage of it!</p>
</div>
</aside>
</div>
</section>
<section class="sect1">
<h2 id="_extending_the_hyperview_client">Extending the Hyperview Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous chapter, we created a fully-featured native mobile version of our Contacts app.
Aside from customizing the entry point URL, we didn’t need to touch any code that runs on the mobile device.
We defined our mobile app’s UI and logic completely in the backend code, using Flask and HXML templates.
This is possible because the standard Hyperview client supports all of the basic features by mobile apps.</p>
</div>
<div class="paragraph">
<p>But the standard Hyperview client can’t do everything out of the box.
As app developers, we want apps to have unique touches like custom UIs or deep integration with platform capabilities.
To support these needs, the Hyperview client was designed to be extended with custom behavior actions and UI elements.
In this section, we will enhance our mobile app with examples of both.</p>
</div>
<div class="paragraph">
<p>Before diving in, let’s take a quick look at the tech stack we’ll be using.
The Hyperview client is written in React Native, a popular cross-platform framework for creating mobile apps.
It uses the same component-based API as React.
This means developers familiar with JavaScript and React can quickly pick up React Native.
React Native has a healthy ecosystem of open-source libraries.
We’ll be leveraging these libraries to create our custom extensions to the Hyperview client.</p>
</div>
<section class="sect2">
<h3 id="_adding_phone_calls_and_email">Adding Phone Calls and Email</h3>
<div class="paragraph">
<p>
Let’s start with the most obvious feature missing from our Contacts app: phone calls.
Mobile devices can make phone calls.
The contacts in our app have phone numbers.
Shouldn’t our app support calling those phone numbers?
And while we’re at it, our app should also support e-mailing the contacts.</p>
</div>
<div class="paragraph">
<p>On the web, calling phone numbers is supported with the <code>tel:</code> URI scheme, and e-mails are supported with the <code>mailto:</code> URI scheme:</p>
</div>
<figure class="listingblock">
<figcaption class="title"><code>tel</code> and <code>mailto</code> schemes in HTML</figcaption>
<div class="content">
<pre class="highlight language-html" tabindex="0"><code class="language-html" data-lang="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tel:555-555-5555<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Call<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (1)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:joe@example.com<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
When clicked, prompt the user to call the given phone number
</li>
<li>
When clicked, open an e-mail client with the given address populated in the <code>to:</code> field.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The Hyperview client doesn’t support the <code>tel:</code> and <code>mailto:</code> URI schemes.
But we can add these capabilities to the client with custom behavior actions.
Remember that behaviors are interactions defined in HXML.
Behaviors have triggers (“press”, “refresh”) and actions (“update”, “share”).
The values of “action” are not limited to the set that comes in the Hyperview library.
So let’s define two new actions, “open-phone” and “open-email”.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Phone and Email actions</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>comms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/communications<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open-phone<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">comms:</span>phone-number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>555-555-5555<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (2)
    Call
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open-email<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">comms:</span>email-address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>joe@example.com<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (3)
    Email
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Define an alias for an XML namespace used by our new attributes.
</li>
<li>
When pressed, prompt the user to call the given phone number.
</li>
<li>
When pressed, open an e-mail client with the given address populated in the <code>to:</code> field.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Notice we defined the actual phone number and email address using separate attributes.
In HTML, the scheme and data are crammed into the <code>href</code> attribute.
HXML’s <code>&lt;behavior&gt;</code> elements give more options for representing the data.
We chose to use attributes, but we could have represented the phone number or email using child elements.
We’re also using a namespace to avoid potential future conflicts with other client extensions.</p>
</div>
<div class="paragraph">
<p>So far so good, but how does the Hyperview client know how to interpret <code>open-phone</code> and <code>open-email</code>, and how to reference the <code>phone-number</code> and <code>email-address</code> attributes?
This is where we finally need to write some JavaScript.</p>
</div>
<div class="paragraph">
<p>First, we’re going to add a 3rd-party library (<code>react-native-communications</code>) to our demo app.
This library provides a simple API that interacts with OS-level functionality for calls and emails.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-bash" tabindex="0"><code class="language-bash" data-lang="bash">&gt; cd hyperview/demo
&gt; yarn add react-native-communications (1)
&gt; yarn start (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Add dependency on <code>react-native-communications</code>
</li>
<li>
Re-start the mobile app
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Next, we’ll create a new file, <code>phone.js</code>, that will implement the code associated with the <code>open-phone</code> action:</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/phone.js</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">import</span> <span class="token punctuation">{</span> phonecall <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native-communications'</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> namespace <span class="token operator">=</span> <span class="token string">"https://hypermedia.systems/hyperview/communications"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">"open-phone"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">behaviorElement</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> number <span class="token operator">=</span> behaviorElement<span class="token punctuation">.</span><span class="token function">getAttributeNS</span><span class="token punctuation">(</span>namespace<span class="token punctuation">,</span> <span class="token string">"phone-number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">phonecall</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Import the function we need from the 3rd party library.
</li>
<li>
The name of the action.
</li>
<li>
The callback that runs when the action triggers.
</li>
<li>
Get the phone number from the <code>&lt;behavior&gt;</code> element.
</li>
<li>
Pass the phone number to the function from the 3rd party library.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Custom actions are defined as a JavaScript object with two keys: <code>action</code> and <code>callback</code>.
This is how the Hyperview client associates a custom action in the HXML with our custom code.
The callback value is a function that takes a single parameter, <code>behaviorElement</code>.
This parameter is an XML DOM representation of the <code>&lt;behavior&gt;</code> element that triggered the action.
That means we can call methods on it like <code>getAttribute</code>, or access attributes like <code>childNodes</code>.
In this case, we use <code>getAttributeNS</code> to read the phone number from the <code>phone-number</code> attribute on the <code>&lt;behavior&gt;</code> element.
If the phone number is defined on the element, we can call the <code>phonecall()</code> function provided by the <code>react-native-communications</code> library.</p>
</div>
<div class="paragraph">
<p>There’s one more thing to do before we can use our custom action: register the action with the Hyperview client.
The Hyperview client is represented as a React Native component called <code>Hyperview</code>.
This component takes a prop called <code>behaviors</code>, which is an array of custom action objects like our “open-phone” action.
Let’s pass our “open-phone” implementation to the <code>Hyperview</code> component in our demo app.</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/HyperviewScreen.js</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Hyperview <span class="token keyword">from</span> <span class="token string">'hyperview'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenPhone <span class="token keyword">from</span> <span class="token string">'./phone'</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HyperviewScreen</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... omitted for brevity</span>

  behaviors <span class="token operator">=</span> <span class="token punctuation">[</span>OpenPhone<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Hyperview
        behaviors<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>behaviors<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        entrypointUrl<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>entrypointUrl<span class="token punctuation">}</span>
        <span class="token comment">// more props...</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Import the open-phone action.
</li>
<li>
Create an array of custom actions.
</li>
<li>
Pass the custom actions to the <code>Hyperview</code> component, as a prop called <code>behaviors</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Under the hood, the <code>Hyperview</code> component is responsible for taking HXML and turning it into mobile UI elements.
It also handles triggering behavior actions based on user interactions.</p>
</div>
<div class="paragraph">
<p>By passing the “open-phone” action to Hyperview, we can now use it as a value for the <code>action</code> attribute on <code>&lt;behavior&gt;</code> elements.
In fact, let’s do that now by updating the <code>show.xml</code> template in our Flask app:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/show.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% block content %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>details<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-name<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ contact.first }} {{ contact.last }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(1)</span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>comms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/communications<span class="token punctuation">"</span></span>
      <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
      <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open-phone<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
      <span class="token attr-name"><span class="token namespace">comms:</span>phone-number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{contact.phone}}<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{contact.phone}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(4)</span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>comms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/communications<span class="token punctuation">"</span></span>
      <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
      <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>open-email<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">comms:</span>email-address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{contact.email}}<span class="token punctuation">"</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-section-info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{contact.email}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
{% endblock %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Add a behavior to the phone number section that triggers on “press.”
</li>
<li>
Trigger the new “open-phone” action.
</li>
<li>
Set the attribute expected by the “open-phone” action.
</li>
<li>
Same idea, with a different action (“open-email”).
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>
We’ll skip over the implementation of the second custom action, “open-email.”
As you can guess, this action will open a system-level email composer to let the user send an email to their contact.
The implementation of “open-email” is almost identical to “open-phone.”
The <code>react-native-communications</code> library exposes a function called <code>email()</code>, so we just wrap it and pass arguments to it in the same way.</p>
</div>
<div class="paragraph">
<p>We now have a complete example of extending the client with custom behavior actions.
We chose a new name for our actions (“open-phone” and “open-email”), and mapped those names to functions.
The functions take <code>&lt;behavior&gt;</code> elements and can run any arbitrary React Native code.
We wrapped an existing 3rd party library, and read attributes set on the <code>&lt;behavior&gt;</code> element to pass data to the library.
After re-starting our demo app, our client has new capabilities we can immediately utilize by referencing the actions from our HXML templates.</p>
</div>
</section>
<section class="sect2">
<h3 id="_adding_messages">Adding Messages</h3>
<div class="paragraph">
<p>
The phone and email actions added in the previous section are examples of “system actions.”
System actions trigger some UI or capability provided by the device’s OS.
But custom actions are not limited to interacting with OS-level APIs.
Remember, the callbacks that implement actions can run arbitrary code, including code that renders our own UI elements.
This next custom action example will do just that: render a custom confirmation message UI element.</p>
</div>
<div class="paragraph">
<p>If you recall, our Contacts web app shows messages upon successful actions, such as deleting or creating a contact.
These messages are generated in the Flask backend using the <code>flash()</code> function, called from the views.
Then the base <code>layout.html</code> template renders the messages into the final web page.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet templates/layout.html</figcaption>
<div class="content">
<pre>{% for message in get_flashed_messages() %}
  &lt;div class="flash"&gt;{{ message }}&lt;/div&gt;
{% endfor %}</pre>
</div>
</figure>
<div class="paragraph">
<p>Our Flask app still includes the calls to <code>flash()</code>, but the Hyperview app is not accessing the flashed message to display to the user.
Let’s add that support now.</p>
</div>
<div class="paragraph">
<p>We could just show the messages using a similar technique to the web app: loop through the messages and render some <code>&lt;text&gt;</code> elements in <code>layout.xml</code>.
This approach has a major downside: the rendered messages would be tied to a specific screen.
If that screen was hidden by a navigation action, the message would be hidden too.
What we really want is for our message UI to display “above” all of the screens in the navigation stack.
That way, the message would remain visible (fading away after a few seconds), even if the stack of screens changes below.
To display some UI outside of the <code>&lt;screen&gt;</code> elements, we’re going to need to extend the Hyperview client with a new custom action, <code>show-message</code>.
This is another opportunity to use an open-source library, <code>react-native-root-toast</code>.
Let’s add this library to our demo app.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-bash" tabindex="0"><code class="language-bash" data-lang="bash">&gt; cd hyperview/demo
&gt; yarn add react-native-root-toast (1)
&gt; yarn start (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Add dependency on <code>react-native-root-toast</code>
</li>
<li>
Re-start the mobile app
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now, we can write the code to implement the message UI as a custom action.</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/message.js</figcaption>
<div class="content">
<pre>import Toast from 'react-native-root-toast'; <b class="conum">(1)</b>

const namespace = "https://hypermedia.systems/hyperview/message";

export default {
  action: "show-message", <b class="conum">(2)</b>
  callback: (behaviorElement) =&gt; { <b class="conum">(3)</b>
    const text = behaviorElement.getAttributeNS(namespace, "text");
    if (text != null) {
      Toast.show(text, {position: Toast.positions.TOP, duration: 2000}); <b class="conum">(4)</b>
    }
  },
};</pre>
</div>
<div class="colist arabic">
<ol>
<li>
Import the <code>Toast</code> API.
</li>
<li>
The name of the action.
</li>
<li>
The callback that runs when the action triggers.
</li>
<li>
Pass the message to the toast library.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This code looks very similar to the implementation of <code>open-phone</code>.
Both callbacks follow a similar pattern: read namespaced attributes from the <code>&lt;behavior&gt;</code> element, and pass those values to a 3rd party library.
For simplicity, we’re hard-coding options to show the message at the top of the screen, fading out after 2 seconds.
But <code>react-native-root-toast</code> exposes many options for positioning, timing of animations, colors, and more.
We could specify these options using extra attributes on <code>behaviorElement</code> to make the action more configurable.
For our purposes, we will just stick to a bare-bones implementation.</p>
</div>
<div class="paragraph">
<p>Now we need to register our custom action with the <code>&lt;Hyperview&gt;</code> component, by passing it to the <code>behaviors</code> prop.</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/HyperviewScreen.js</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Hyperview <span class="token keyword">from</span> <span class="token string">'hyperview'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenEmail <span class="token keyword">from</span> <span class="token string">'./email'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenPhone <span class="token keyword">from</span> <span class="token string">'./phone'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ShowMessage <span class="token keyword">from</span> <span class="token string">'./message'</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HyperviewScreen</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... omitted for brevity</span>

  behaviors <span class="token operator">=</span> <span class="token punctuation">[</span>OpenEmail<span class="token punctuation">,</span> OpenPhone<span class="token punctuation">,</span> ShowMessage<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token comment">// ... omitted for brevity</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Import the <code>show-message</code> action.
</li>
<li>
Pass the action to the <code>Hyperview</code> component, as a prop called <code>behaviors</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>All that’s left to do is trigger the <code>show-message</code> action from our HXML.
There are three user actions that result in showing a message:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
Creating a new contact
</li>
<li>
Updating an existing contact
</li>
<li>
Deleting a contact
</li>
</ol>
</div>
<div class="paragraph">
<p>The first two actions are implemented in our app using the same HXML template, <code>form_fields.xml</code>.
Upon successfully creating or updating a contact, this template will reload the screen and trigger an event, using behaviors that trigger on “load”.
The deletion action also uses behaviors that trigger on “load”, defined in the <code>deleted.xml</code> template.
So both <code>form_fields.xml</code> and <code>deleted.xml</code> need to be modified to also show messages on load.
Since the actual behaviors will be the same in both templates, let’s create a shared template to reuse the HXML.</p>
</div>
<figure class="listingblock">
<figcaption class="title">hv/templates/messages.xml</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml">{% for message in get_flashed_messages() %}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(1)</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/message<span class="token punctuation">"</span></span>
    <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">(2)</span>
    <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>show-message<span class="token punctuation">"</span></span> <span class="token attr-name">(3)</span>
    <span class="token attr-name"><span class="token namespace">message:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ message }}<span class="token punctuation">"</span></span> <span class="token attr-name">(4)</span>
  <span class="token punctuation">/&gt;</span></span>
{% endfor %}</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Define a behavior for each message to display.
</li>
<li>
Trigger this behavior as soon as the element loads.
</li>
<li>
Trigger the new “show-message” action.
</li>
<li>
The “show-message” action will display the flashed message in its UI.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Like in <code>layout.html</code> of the web app, we loop through all of the flashed messages and render some markup for each message.
However, in the web app, the message was directly rendered into the web page.
In the Hyperview app, each message is displayed using a behavior that triggers our custom UI.
Now we just need to include this template in <code>form_fields.xml</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of hv/templates/form_fields.xml</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>edit-group<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  {% if saved %}
    {% include "hv/messages.xml" %} (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">once</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dispatch-event<span class="token punctuation">"</span></span> <span class="token attr-name">event-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-updated<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">once</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{contact.id}}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  {% endif %}
  <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Show the messages as soon as the screen loads.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>And we can do the same thing in <code>deleted.xml</code>:</p>
</div>
<figure class="listingblock">
<figcaption class="title">hv/templates/deleted.xml</figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  {% include "hv/messages.xml" %} (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dispatch-event<span class="token punctuation">"</span></span> <span class="token attr-name">event-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-updated<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>load<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Show the messages as soon as the screen loads.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>In both <code>form_fields.xml</code> and <code>deleted.xml</code>, multiple behaviors get triggered on “load.”
In <code>deleted.xml</code>, we immediately navigate back to the previous screen.
In <code>form_fields.xml</code>, we immediately reload the current screen to show the Contact details.
If we rendered our message UI elements directly in the screen, the user would barely see them before the screen disappeared or reloaded.
By using a custom action, the message UI remains visible even while the screens change beneath them.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_toast.png" alt="Small gray box shows at top of screen: 'Deleted Contact!'" loading="lazy">
</div>
<figcaption class="title">Figure 20. Message shown during back navigation</figcaption>
</figure>
</section>
<section class="sect2">
<h3 id="_swipe_gesture_on_contacts">Swipe Gesture on Contacts</h3>
<div class="paragraph">
<p>To add communication capabilities and the message UI, we extended the client with custom behavior actions.
But the Hyperview client can also be extended with custom UI components that render on the screen.
Custom components are implemented as React Native components.
That means anything that’s possible in React Native can be done in Hyperview as well!
Custom components open up endless possibilities to build rich mobile apps with the Hypermedia architecture.</p>
</div>
<div class="paragraph">
<p>To illustrate the possibilities, we will extend the Hyperview client in our mobile app to add a “swipeable row” component.
How does it work?
The “swipeable row” component supports a horizontal swiping gesture.
As the user swipes this component from right to left, the component will slide over, revealing a series of action buttons.
Each action button will be able to trigger standard Hyperview behaviors when pressed.
We will use this custom component in our Contacts List screen.
Each contact item will be a “swipeable row”, and the actions will give quick access to edit and delete actions for the contact.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_swipe.png" alt="As we swipe the contact list item to the left, Edit and Delete buttons are revealed" loading="lazy">
</div>
<figcaption class="title">Figure 21. Swipeable contact item</figcaption>
</figure>
<section class="sect3">
<h4 id="_designing_the_component">Designing The Component</h4>
<div class="paragraph">
<p>Rather than implementing the swipe gesture from scratch, we will once again use an open-source third-party library: <code>react-native-swipeable</code>.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-bash" tabindex="0"><code class="language-bash" data-lang="bash">&gt; cd hyperview/demo
&gt; yarn add react-native-swipeable (1)
&gt; yarn start (2)</code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Add dependency on <code>react-native-swipeable</code>.
</li>
<li>
Re-start the mobile app.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This library provides a React Native component called <code>Swipeable</code>.
It can render any React Native components as its main content (the part that can be swiped).
It also takes an array of React Native components as a prop to render as the action buttons.</p>
</div>
<div class="paragraph">
<p>When designing a custom component, we like to define the HXML of the component before writing the code.
This way, we can make sure the markup is expressive but succinct, and will work with the underlying library.</p>
</div>
<div class="paragraph">
<p>For the swipeable row, we need a way to represent the entire component, the main content, and one of many buttons.</p>
</div>
<figure class="listingblock">
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>row</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>swipe</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/swipeable<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span> (2)
    <span class="token comment">&lt;!-- main content shown here --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span> (3)
    <span class="token comment">&lt;!-- first button that appears when swiping --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span> (4)
    <span class="token comment">&lt;!-- second button that appears when swiping --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>row</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Parent element encapsulating the entire swipeable row, with custom namespace.
</li>
<li>
The main content of the swipeable row, can hold any HXML.
</li>
<li>
The first button that appears when swiping, can hold any HXML.
</li>
<li>
The second button that appears when swiping, can hold any HXML.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>This structure clearly separates the main content from the buttons.
It also supports one, two, or more buttons.
Buttons appear in the order of definition, making it easy to swap the order.</p>
</div>
<div class="paragraph">
<p>This design covers everything we need to implement a swipeable row for our contacts list.
But it’s also generic enough to be reusable.
The previous markup contains nothing specific to the contact name, editing the contact, or deleting the contact.
If later we add another list screen to our app, we can use this component to make the items in that list swipeable.</p>
</div>
</section>
<section class="sect3">
<h4 id="_implementing_the_component">Implementing The Component</h4>
<div class="paragraph">
<p>Now that we know the HXML structure of our custom component, we can write the code to implement it.
What does that code look like?
Hyperview components are written as React Native components.
These React Native components are mapped to a unique XML namespace and tag name.
When the Hyperview client encounters that namespace and tag name in the HXML, it delegates rendering of the HXML element to the matching React Native component.
As part of delegation, the Hyperview Client passes several props to the React Native component:</p>
</div>
<div class="ulist">
<ul>
<li>
<code>element</code>: The XML DOM element that maps to the React Native component.
</li>
<li>
<code>stylesheets</code>: The styles defined in the <code>&lt;screen&gt;</code>.
</li>
<li>
<code>onUpdate</code>: The function to call when the component triggers a behavior.
</li>
<li>
<code>option</code>: Miscellaneous settings used by the Hyperview client.
</li>
</ul>
</div>
<div class="paragraph">
<p>Our swipeable row component is a container with slots to render arbitrary main content and buttons.
That means it needs to delegate back to the Hyperview client to render those parts of the UI.
This is done with a public function exposed by the Hyperview client, <code>Hyperview.renderChildren()</code>.</p>
</div>
<div class="paragraph">
<p>Now that we know how custom Hyperview components are implemented, let’s write the code for our swipeable row.</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/swipeable.js</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Hyperview <span class="token keyword">from</span> <span class="token string">'hyperview'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Swipeable <span class="token keyword">from</span> <span class="token string">'react-native-swipeable'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">NAMESPACE_URI</span> <span class="token operator">=</span> <span class="token string">'https://hypermedia.systems/hyperview/swipeable'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SwipeableRow</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> namespaceURI <span class="token operator">=</span> <span class="token constant">NAMESPACE_URI</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> localName <span class="token operator">=</span> <span class="token string">"row"</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

  <span class="token function-variable function">getElements</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tagName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">getElementsByTagNameNS</span><span class="token punctuation">(</span><span class="token constant">NAMESPACE_URI</span><span class="token punctuation">,</span> tagName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">getButtons</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getElements</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">buttonElement</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Hyperview<span class="token punctuation">.</span><span class="token function">renderChildren</span><span class="token punctuation">(</span>buttonElement<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>stylesheets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onUpdate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>main<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getElements</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Swipeable rightButtons<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>Hyperview<span class="token punctuation">.</span><span class="token function">renderChildren</span><span class="token punctuation">(</span>main<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>stylesheets<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onUpdate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Swipeable<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Class-based React Native component.
</li>
<li>
Map this component to the given HXML namespace.
</li>
<li>
Map this component to the given HXML tag name.
</li>
<li>
Function that returns an array of React Native components for each <code>&lt;button&gt;</code> element.
</li>
<li>
Delegate to the Hyperview client to render each button.
</li>
<li>
Pass the buttons and main content to the third-party library.
</li>
<li>
Delegate to the Hyperview client to render the main content.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The <code>SwipeableRow</code> class implements a React Native component.
At the top of the class, we set a static <code>namespaceURI</code> property and <code>localName</code> property.
These properties map the React Native component to a unique namespace and tag name pair in the HXML.
This is how the Hyperview client knows to delegate to <code>SwipeableRow</code> when encountering custom elements in the HXML.
At the bottom of the class, you’ll see a <code>render()</code> method.
<code>render()</code> gets called by React Native to return the rendered component.
Since React Native is built on the principle of composition, <code>render()</code> typically returns a composition of other React Native components.
In this case, we return the <code>Swipeable</code> component (provided by the <code>react-native-swipeable</code> library), composed with React Native components for the buttons and main content.
The React Native components for the buttons and main content are created using a similar process:</p>
</div>
<div class="ulist">
<ul>
<li>
Find the specific child elements (<code>&lt;button&gt;</code> or <code>&lt;main&gt;</code>).
</li>
<li>
Turn those elements into React Native components using <code>Hyperview.renderChildren()</code>.
</li>
<li>
Set the components as children or props of <code>Swipeable</code>.
</li>
</ul>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/diagram/hyperview-components.svg" alt="The HyperviewClient delegates to us to render XML swipe:row element. We delegate back to render text elements." loading="lazy">
</div>
<figcaption class="title">Figure 22. Rendering delegation between the client and the custom components</figcaption>
</figure>
<div class="paragraph">
<p>This code may be hard to follow if you’ve never worked with React or React Native.
That’s OK.
The important takeaway is: we can write code to translate arbitrary HXML into React Native components. The structure of the HXML (both attributes and elements) can be used to represent multiple facets of the UI (in this case, the buttons and main content).
Finally, the code can delegate rendering of child components back to the Hyperview client.</p>
</div>
<div class="paragraph">
<p>The result: this swipeable row component is completely generic.
The actual structure and styling and interactions of the main content and buttons can be defined in the HXML.
Creating a generic component means we can reuse it across multiple screens for different purposes.
If we add more custom components or new behavior actions in the future, they will work with our swipeable row implementation.</p>
</div>
<div class="paragraph">
<p>The last thing to do is register this new component with the Hyperview client.
The process is similar to registering custom actions.
Custom components are passed as a separate <code>components</code> prop to the <code>Hyperview</code> component.</p>
</div>
<figure class="listingblock">
<figcaption class="title">demo/src/HyperviewScreen.js</figcaption>
<div class="content">
<pre class="highlight language-js" tabindex="0"><code class="language-js" data-lang="js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Hyperview <span class="token keyword">from</span> <span class="token string">'hyperview'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenEmail <span class="token keyword">from</span> <span class="token string">'./email'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenPhone <span class="token keyword">from</span> <span class="token string">'./phone'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ShowMessage <span class="token keyword">from</span> <span class="token string">'./message'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SwipeableRow <span class="token keyword">from</span> <span class="token string">'./swipeable'</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HyperviewScreen</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... omitted for brevity</span>

  behaviors <span class="token operator">=</span> <span class="token punctuation">[</span>OpenEmail<span class="token punctuation">,</span> OpenPhone<span class="token punctuation">,</span> ShowMessage<span class="token punctuation">]</span><span class="token punctuation">;</span>
  components <span class="token operator">=</span> <span class="token punctuation">[</span>SwipeableRow<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Hyperview
        behaviors<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>behaviors<span class="token punctuation">}</span>
        components<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>components<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        entrypointUrl<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>entrypointUrl<span class="token punctuation">}</span>
        <span class="token comment">// more props...</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Import the <code>SwipeableRow</code> component.
</li>
<li>
Create an array of custom components.
</li>
<li>
Pass the custom component to the <code>Hyperview</code> component, as a prop called <code>components</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>We’re now ready to update our HXML templates to make use of the new swipeable row component.</p>
</div>
<section class="sect4">
<h5 id="_using_the_component">Using the component</h5>
<div class="paragraph">
<p>Currently, the HXML for a contact item in the list consists of a <code>&lt;behavior&gt;</code> and <code>&lt;text&gt;</code> element:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
</figure>
<div class="paragraph">
<p>With our swipeable row component, this markup will become the “main” UI.
So let’s start by adding <code>&lt;row&gt;</code> and <code>&lt;main&gt;</code> as parent elements.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding swipeable row <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>row</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>swipe</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/swipeable<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> (3)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contact-item-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>row</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Added <code>&lt;swipe:row&gt;</code> parent element, with namespace alias for <code>swipe</code>.
</li>
<li>
Added <code>&lt;swipe:main&gt;</code> element to define the main content.
</li>
<li>
Wrapped the existing <code>&lt;behavior&gt;</code> and <code>&lt;text&gt;</code> elements in a <code>&lt;view&gt;</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Previously, the <code>contact-item</code> style was set on the <code>&lt;item&gt;</code> element.
That made sense when the <code>&lt;item&gt;</code> element was the container for the main content of the list item.
Now that the main content is a child of <code>&lt;swipe:main&gt;</code>, we need to introduce a new <code>&lt;view&gt;</code> where we apply the styles.</p>
</div>
<div class="paragraph">
<p>If we reload our backend and mobile app, you won’t experience any changes on the Contacts List screen yet.
Without any action buttons defined, there’s nothing to reveal when swiping a row.
Let’s add two buttons to the swipeable row.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Adding swipeable row <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{{ contact.id }}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>row</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>swipe</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hypermedia.systems/hyperview/swipeable<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- omitted for brevity --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>main</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span> (1)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>swipe-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span> (2)
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>swipe-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label-delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>row</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
Added <code>&lt;swipe:button&gt;</code> for edit action.
</li>
<li>
Added <code>&lt;swipe:button&gt;</code> for delete action.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now if we use our mobile app, we can see the swipeable row in action!
As you swipe the contact item, the “Edit” and “Delete” buttons reveal themselves.
But they don’t do anything yet. We need to add some behaviors to these buttons.
The “Edit” button is straight-forward: pressing it should open the contact details screen in edit mode.</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>swipe-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>push<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/edit<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> (1)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
When pressed, push a new screen with the Edit Contact UI.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>The “Delete” button is a bit more complicated.
There’s no screen to open for deletion, so what should happen when the user presses this button?
Perhaps we use the same interaction as the “Delete” button on the Edit Contact screen.
That interaction brings up a system dialog, asking the user to confirm the deletion.
If the user confirms, the Hyperview client makes a <code>POST</code> request to <code>/contacts/&lt;contact_id&gt;/delete</code>, and appends the response to the screen.
The response triggers a few behaviors immediately to reload the contacts list and show a message.
This interaction will work for our action button as well:</p>
</div>
<figure class="listingblock">
<figcaption class="title">Snippet of <code>hv/rows.xml</code></figcaption>
<div class="content">
<pre class="highlight language-xml" tabindex="0"><code class="language-xml" data-lang="xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>swipe-button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(1)</span>
      <span class="token attr-name"><span class="token namespace">xmlns:</span>alert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hyperview.org/hyperview-alert<span class="token punctuation">"</span></span>
      <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
      <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">alert:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Confirm delete<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">alert:</span>message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Are you sure you want to delete {{ contact.first }}?<span class="token punctuation">"</span></span>
    <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Confirm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>behavior</span> <span class="token attr-name">(2)</span>
          <span class="token attr-name">trigger</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>press<span class="token punctuation">"</span></span>
          <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>append<span class="token punctuation">"</span></span>
          <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-{{ contact.id }}<span class="token punctuation">"</span></span>
          <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/contacts/{{ contact.id }}/delete<span class="token punctuation">"</span></span>
          <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span>
        <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">alert:</span>option</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">alert:</span>option</span> <span class="token attr-name"><span class="token namespace">alert:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cancel<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>behavior</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button-label-delete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Delete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">swipe:</span>button</span><span class="token punctuation">&gt;</span></span></code></pre>
</div>
<div class="colist arabic">
<ol>
<li>
When pressed, open a system dialog box asking the user to confirm the action.
</li>
<li>
If confirmed, make a POST request to the deletion endpoint, and append the response to the parent <code>&lt;item&gt;</code>.
</li>
</ol>
</div></figure>

<div class="paragraph">
<p>Now when we press “Delete,” we get the confirmation dialog as expected.
After pressing confirm, the backend response triggers behaviors that show a confirmation message and reload the list of contacts.
The item for the deleted contact disappears from the list.</p>
</div>
<figure class="imageblock">
<div class="content">
<img src="images/screenshot_hyperview_swipe_delete.png" alt="Swiping and pressing Delete shows delete confirmation dialog" loading="lazy">
</div>
<figcaption class="title">Figure 23. Delete from swipe button</figcaption>
</figure>
<div class="paragraph">
<p>Notice that the action buttons are able to support any type of behavior action, from <code>push</code> to <code>alert</code>.
If we wanted to, we could have the action buttons trigger our custom actions, like <code>open-phone</code> and <code>open-email</code>.
Custom components and actions can be mixed freely with the standard components and actions that come standard with the Hyperview framework.
This makes the extensions to the Hyperview client feel like first-class features.</p>
</div>
<div class="paragraph">
<p>In fact, we’ll let you in on a secret.
Within the Hyperview client, standard components and actions are implemented the same way as custom components and actions!
The rendering code does not treat <code>&lt;view&gt;</code> differently from <code>&lt;swipe:row&gt;</code>.
The behavior code does not treat <code>alert</code> differently from <code>open-phone</code>.
They are both implemented using the same techniques described in this section.
Standard components and actions are just the ones that are universally needed by all mobile apps.
But they are just the starting point.</p>
</div>
<div class="paragraph">
<p>Most mobile apps will require some extensions to the Hyperview client to deliver a great user experience.
Extensions evolve the client from being a generic “Hyperview client,” to being a purpose-built client for your app.
And importantly, this evolution preserves the Hypermedia, server-driven architecture and all of its benefits.</p>
</div>
</section>
</section>
</section>
<section class="sect2">
<h3 id="_mobile_hypermedia_driven_applications">Mobile Hypermedia-Driven Applications</h3>
<div class="paragraph">
<p>That concludes our build of mobile Contact.app.
Step back from the code details and consider the broader pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
The core logic of the app resides on the server.
</li>
<li>
Server-rendered templates power both the web and mobile apps.
</li>
<li>
Platform customizations are done through scripting on the web, and client customization on mobile.
</li>
</ul>
</div>
<div class="paragraph">
<p>The Hypermedia-Driven Application architecture allowed for significant code reuse and a manageable tech stack.
Ongoing app updates and maintenance for both web and mobile can be done at the same time.</p>
</div>
<div class="paragraph">
<p>Yes, there is a story for Hypermedia-Driven Applications on mobile.</p>
</div>
</section>
<aside class="sect2 html-note info">
<h3 id="_hypermedia_notes_good_enough_ux_and_islands_of_interactivity">Hypermedia Notes: Good-Enough UX and Islands of Interactivity</h3>
<div class="paragraph">
<p>A problem many SPA and native mobile developers face when coming to the HDA approach is that they look at their current
application and imagine implementing it exactly using hypermedia. While htmx and Hyperview significantly improve the
user experience available via the hypermedia-driven approach, there are still times when it won’t be easy to pull of
a particular user experience.</p>
</div>
<div class="paragraph">
<p>As we saw in Chapter Two, Roy Fielding noted this tradeoff with respect to the web’s RESTful network architecture,
where "information is transferred in a standardized form rather than one which is specific to an application’s needs."</p>
</div>
<div class="paragraph">
<p>Accepting a slightly less efficient and interactive solution to a particular UX can save you a tremendous amount of
complexity when building your applications.</p>
</div>
<div class="paragraph">
<p>Do not let the perfect be the enemy of the good.  Many advantages are to be gained by accepting a slightly less
sophisticated user experience in some cases, and tools like htmx and Hyperview make that compromise much more palatable
when they are used properly.</p>
</div>
</aside>
</div>
</section>
<h1 id="_conclusion_3" class="sect0"><sub-title>Part IV<v-h>:</v-h></sub-title>  Conclusion</h1>
<section class="sect1">
<h2 id="_conclusion_4">Conclusion</h2>
<div class="sectionbody">
<section class="sect2">
<h3 id="_hypermedia_reconsidered">Hypermedia Reconsidered</h3>
<div class="paragraph">
<p>We hope to have convinced you that hypermedia, rather than being a “legacy” technology
or a technology only appropriate for “documents” of links, text and pictures, is, in fact, a powerful technology for
building <em>applications</em>.  In this book you have seen how to build sophisticated user interfaces — for both the web, with htmx,
and for mobile applications, using Hyperview — using hypermedia as a core underlying application technology.</p>
</div>
<div class="paragraph">
<p>Many web developers view the links and forms of “plain” HTML as bygone tools
from a less sophisticated age.  And, in some ways, they are right: there were definite usability issues with the
original web. However, there are now JavaScript libraries that extend HTML by addressing its core limitations.</p>
</div>
<div class="paragraph">
<p>Htmx, for example, allowed us to:</p>
</div>
<div class="ulist">
<ul>
<li>
Make any element capable of issuing an HTTP request
</li>
<li>
Make any event capable of triggering an HTTP event
</li>
<li>
Use all the available types of HTTP methods
</li>
<li>
Target any element in the DOM for replacement
</li>
</ul>
</div>
<div class="paragraph">
<p>With that, we were able to build user interfaces for Contact.app that many developers would assume require a significant amount of client-side
JavaScript, and we did it using hypermedia concepts.</p>
</div>
<div class="paragraph">
<p>The Hypermedia-Driven Application approach is not right for every application. For many applications, though, the increased flexibility and simplicity of hypermedia can be a huge
benefit.  Even if your application wouldn’t benefit from this approach, it is worthwhile to <em>understand</em>
the approach, its strengths and weaknesses, and how it differs from the approach you are taking.  The original web
grew faster than any distributed system in history; web developers should know how to tap the power of the underlying technologies that
made that growth possible.</p>
</div>
</section>
<section class="sect2">
<h3 id="_pausing_and_reflecting">Pausing, and Reflecting</h3>
<div class="paragraph">
<p>The JavaScript community and, by extension, the web development community is famously chaotic, with new frameworks and
technologies emerging monthly, and sometimes even <em>weekly</em>.  It can be exhausting to keep up with the latest and
greatest technologies, and, at the same time, terrifying that we <em>won’t</em> keep up with them and
be left behind in our career.</p>
</div>
<div class="paragraph">
<p>This is not a fear without foundation: there are many senior software engineers that have seen their careers peter out
because they picked a technology to specialize in that, fairly or not, did not thrive.  The web development world tends
to be young, with many companies favoring young developers over older developers who “haven’t kept up.”</p>
</div>
<div class="paragraph">
<p>We shouldn’t sugar-coat these realities of our industry.  On the other hand, we also shouldn’t ignore the downside that
these realities create.  It creates a high-pressure environment where everyone is watching for “the new new” thing, that
is, for the latest and greatest technology that is going to change everything.  It creates pressure to <em>claim</em> that your
technology is going to change everything.  It tends to favor <em>sophistication</em> over
<em>simplicity</em>.  People are scared to ask “Is this too complex?” because it sounds an awful lot like “I’m not smart enough
to understand this.”</p>
</div>
<div class="paragraph">
<p>The software industry tends, especially in web development, to lean far more towards innovating, rather than
understanding existing technologies and building on them or within them.  We tend to look ahead for new, genius
solutions, rather than looking to established ideas.  This is understandable: the technology world is necessarily
a forward-looking industry.</p>
</div>
<div class="paragraph">
<p>On the other hand — as we saw with Roy Fielding’s formulation of REST — some early architects of the web had some great ideas which have been overlooked. We are old enough
to have seen hypermedia come and go as the “new new” idea. It was a little shocking to us to see powerful ideas like
REST discarded so cavalierly by the industry. Fortunately, the concepts are still sitting there, waiting to be rediscovered
and reinvigorated.  The original, RESTful architecture of the web, when looked at with fresh eyes, can address many of
the problems that today’s web developers are facing.</p>
</div>
<div class="paragraph">
<p>Perhaps, following Mark Twain’s advice, it is time to pause and reflect.  Perhaps, for a few quiet moments, we can
put the endless swirl of the “new new” aside, look back on where the web came from, and learn.</p>
</div>
<div class="paragraph">
<p>Perhaps it’s time to give hypermedia a chance.</p>
</div>
</section>
</div>
</section>
<ol id="footnotes" class="<small>">

<li class="footnote" id="_footnotedef_1">
The single-page version is too slow to load and render on most computers. There’s also a developers' edition at /dev, but the standard version has nicer styling.
<a href="hypermedia-systems#_footnoteref_1">↵</a></li>
<li class="footnote" id="_footnotedef_2">
Rendering here refers to HTML generation. Framework support for server-side rendering is not needed in a HDA because generating HTML on the server is the default.
<a href="hypermedia-systems#_footnoteref_2">↵</a></li>
<li class="footnote" id="_footnotedef_3">
Beware that Shadow DOM is a newer web platform feature that’s still in development at the time of writing. In particular, there are some accessibility bugs that may occur when elements inside and outside the shadow root interact.
<a href="hypermedia-systems#_footnoteref_3">↵</a></li>
</ol></main>

<div class="container secondary-font">
    
        <div class="grid spacious margin-block">
            
            
        </div>
        
</div>

<footer>
    <p>
    
</p><nav class="f-row flex-wrap:wrap justify-content:center crowded" aria-label="Site navigation">
    <a href="index.html" id="footer-book-name" class="bold allcaps display-font italic">Hypermedia Systems</a>
    <a href="book/contents">Contents</a>
    <a href="https://github.com/bigskysoftware/hypermedia-systems">GitHub</a>
</nav>

    <p></p>
</footer>

</body></html>